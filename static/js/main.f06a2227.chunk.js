/*! For license information please see main.f06a2227.chunk.js.LICENSE.txt */
(this.webpackJsonpterminal=this.webpackJsonpterminal||[]).push([[0],Array(20).concat([function(e,t,n){var r=n(53),o=n(8),a=n(4),i=(n(11)("interblock:models:utils"),n(292)),s=n(24),c=n(125),u=n(294),l=u.produce;(0,u.setAutoFreeze)(!1);var p=n(295).modelInflator,d=n(128).registry,f=n(55),h=n(100).assertNoUndefined,v=n(59),g=function(e,t,n){var r,o,s,u=function(){a.strictEqual(typeof t,"object");var n=y(e,t),r=n.hash,i=n.proof;o=r,s=i};return{equals:function(e){return!!n(e)&&v(t,e)},serialize:function(){return r||(h(t),a(!i(t),"state must be stringifiable"),r=c(t)),r},getHash:function(){return o||(u(),a(o)),o},getProof:function(){return s||(u(),a(s)),s}}},y=function(e,t){switch(e.title){case"Integrity":return{hash:t.hash};case"Block":var n=s.omit(t,["provenance","network","validators"]),r=f.objectHash(b(n));return{hash:t.provenance.getHash(),proof:r};case"Network":var o=b(t);return{hash:o.hash,proof:{networkChannels:o.proof}};case"Channel":var a=d.get("Remote"),i=a.clone(s.pick(t,["address","requests","replies","heavyHeight","lineageHeight"])),c=s.omit(t,Object.keys(i)),u=s.omit(e.properties,a.schema.properties),l=m({properties:u},c).hash;return{hash:f.objectHash({remote:i.getHash(),proof:l}),proof:l};case"State":return{hash:f.objectHash(t)};default:return m(e,t)}},m=function(e,t){if(e.patternProperties)return{hash:b(t).hash};var n={},r=e.properties;return Object.keys(t).map((function(e){var o=r[e],a=o.title,i=o.type,s=o.patternProperties,c=t[e];if(d.isRegistered(a))n[e]=c.getHash();else if("array"!==i)if(s){var u=b(c).hash;n[e]=u}else n[e]=f.objectHash(c);else n[e]=k(c)})),{hash:f.objectHash(n)}},k=function(e){return f.objectHash(e.map((function(e){return e.getHash()})))},b=function(e){var t=Object.keys(e).map((function(t){return f.objectHash(r({},t,e[t].getHash()))}));return t.sort(),{hash:f.objectHash(t),proof:t}},x=function(e,t){var n=new Proxy(e,{get:function(e,n,r){return t[n]?t[n]:e[n]},set:function(e,t,n,r){throw new Error("Model properties cannot be altered: ".concat(t))},deleteProperty:function(e,t){throw new Error("Model properties cannot be deleted: ".concat(t))}});return n},w=function(e){var t=e.schema.title;["create","logicize"].forEach((function(n){if("function"!==typeof e[n])throw new Error("Model: ".concat(t," needs function: ").concat(n))}));var n=Object.keys(e).length;if(3!==n)throw new Error("Model: ".concat(t," has ").concat(n," properties, not 3"))};e.exports={standardize:function(e){var t;w(e);var n=new WeakSet,r=new WeakMap,i=function(e){return n.has(e)},s=Object.freeze(o({},e,{clone:function(c,u){if(!c)return t||(t=s.create()),t;if(i(c)&&!u)return c;if(c&&"function"===typeof u&&(a(i(c),"instance must be ".concat(e.schema.title)),c=l(c,u)),"string"===typeof c&&(c=JSON.parse(c)),r.has(c))return r.get(c);var d=p(e.schema,c),f=e.logicize(d),h=g(e.schema,d,i),v=h.serialize,y=h.getHash,m=h.getProof,k=h.equals,b=o({},f,{equals:k,serialize:v,getHash:y,getProof:m}),w=x(d,b);return Object.freeze(w),n.add(w),r.set(c,w),w},isModel:i}));return s}}},function(e,t,n){var r=n(8),o={};["aclModel","actionModel","addressModel","binaryModel","blockModel","covenantIdModel","continuationModel","dmzModel","configModel","integrityModel","interblockModel","keypairModel","lockModel","provenanceModel","publicKeyModel","signatureModel","timestampModel","channelModel","networkModel","stateModel","remoteModel","validatorsModel","proofModel"].forEach((function(e){try{var t=n(291)("./".concat(e));o[e]=t[e]}catch(r){throw console.log("error loading: ".concat(e)),r}}));var a=n(128).registry,i=n(441),s=n(230);a.registerModels(o),a.registerModels(i),a.registerModels(s);var c=n(443);e.exports=r({},o,{},s,{},i,{registry:a,cryptoCacher:c})},,,,,,,,,,,,,,,,function(e,t,n){var r=n(8),o=n(19),a={title:"Action",description:"Messages for communicating with a chains reducer.\n  Actions are always delivered as part of a channel between chains.",type:"object",required:["type","payload"],additionalProperties:!1,properties:{type:{type:"string",description:"The type of the action which is specified by the developer"},payload:{type:"object",description:"Type dependent data being transmitted with the action"}}},i={title:"Continuation",description:"Actions that implement the continuation system.",type:"object",required:["type","payload"],additionalProperties:!1,properties:{type:{type:"string",description:"One of three types.  Synchronous replies are resolves or rejections too.",enum:["@@REJECT","@@PROMISE","@@RESOLVE"]},payload:{type:"object",description:"Type dependent data being transmitted with the action"}}},s={title:"Integrity",description:"cryptographically secure hash produced from content.\n  May be 'UNKNOWN' to signal an address is unknown.",type:"object",additionalProperties:!1,required:["hash","algorithm"],properties:{hash:{type:"string",description:"base58 encoded hash hopefully with identifier at front, or UNKNOWN"},algorithm:{enum:["sha256"]}}},c={title:"Address",description:"Hash of the Provenance of the first block in this chain, \n  with prefix, check digits, in base58",type:"object",additionalProperties:!1,required:["chainId","status"],properties:{chainId:s,status:{pattern:"^UNKNOWN$|^GENESIS_|^LOOPBACK$|^ROOT$|^RESOLVED$"}}},u={title:"PublicKey",description:"public key of a public / secret pair",type:"object",additionalProperties:!1,required:["key","algorithm"],properties:{key:{type:"string"},algorithm:{enum:["tweetnacl","sodium"]}}},l={title:"Signature",description:"A cryptographic signature of some detached integrity",type:"object",additionalProperties:!1,required:["publicKey","integrity","seal"],properties:{publicKey:u,integrity:s,seal:{type:"string"}}},p={title:"Provenance",description:'Proof of the Provenance of the object \n  referenced by signed integrity.\n  The integrity of the first provenance in a chain is the chainId.\n  When the provenance is inserted back into the dmz, the dmz becomes a Block.\n  The integrity which is signed is the integrity of the whole object, \n  minus "integrity" and "signatures" keys\n  \n  Integrity can be a merkle proof so a set of chains with the same\n  validators can create signatures for the root hash, then distribute\n  to all the chains where each is blinded to the others in the merkle \n  proof.\n  \n  Running chains internally is much faster than cross block boundaries.',type:"object",additionalProperties:!1,required:["dmzIntegrity","address","lineage","height","integrity","signatures"],properties:{dmzIntegrity:s,address:c,lineage:{type:"object",description:"Object of previous blockhashes this provenance item extends.\n  There may be many, but at least one is the most recent block provenance.\n  Others might be those resulting from overdrive consensus,\n  or periodic shortcutting of the chain history to quick lookup purposes.\n  Height must always be greater than any previous provenance for this address.\n  Provenance is monotonic, and should increment by 1 each time.\n  \n  First lineage supplied to create defines the chainId of the result.\n  \n  Provenance is a statement of authenticity and position in lineage.  \n  Lineage is the chain of previous provenances.\n  \n  Key gives the provenance id, which can be height, or foreignChain:height.\n  Value gives the hash of the block at the provenance id.",patternProperties:{"(.*?)":s}},height:{type:"integer",minimum:0},integrity:s,signatures:{type:"array",items:l,minItems:1,uniqueItems:!0}}},d={title:"Validators",type:"object",additionalProperties:!1,minProperties:1,patternProperties:{"(.*?)":u}},f={title:"Proof",description:"Interblock proof model.",type:"object",additionalProperties:!1,required:["block"],properties:{block:{type:"string"},network:{type:"object"},channel:{type:"string"}}},h={title:"Remote",description:"Slice of Channel state transmitted with a heavy Interblock",type:"object",additionalProperties:!1,required:["address","replies","requests","heavyHeight","lineageHeight"],properties:{address:c,replies:{type:"object",additionalProperties:!1,patternProperties:{"[0-9]*":i}},requests:{type:"object",additionalProperties:!1,patternProperties:{"[0-9]*":a}},heavyHeight:{type:"integer",minimum:-1},lineageHeight:{type:"integer",minimum:-1}}},v={title:"Interblock",description:"The fundamental unit of inter chain communication.\n  Contains provenance, a punched out DMZ, and a single transmit channel\n  of the source chain.\n  This must be an model, so as to ensure we do not leak info, rather \n  than making it a special case of a BlockModel.\n  This cannot import dmzModel directly, as it is a fundamental\n  circular reference, as the outside depends on the inside.\n  This can only be made from a validated block.\n  \n  This is the only place that needs punched out proofs.\n  \n  With no transmit key, an interblock is simply a provenance chain,\n  which is needed to ensure lineage\n  \n  By placing interblock stream inside the transmission, each side of\n  a connection can know what block of theirs the other side has processed.",type:"object",required:["provenance","proof","validators"],additionalProperties:!1,properties:{provenance:p,proof:f,network:{type:"object",additionalProperties:!1,minProperties:0,maxProperties:1,patternProperties:{"(.*?)":h}},validators:d}},g={title:"Channel",description:"Communication Queues.\n  These queues and their responses are what all interchain\n  communication seeks to facilitate.  All the cryptography\n  employed in this system is to reliably process these \n  queues.\n  \n  Each connection side has a transmit and a receive.\n  Each connection side transmits requests and replies to the other.\n  \n  Transmit = Sum( Channel ) \n  Receive = Sum( Interblock( Channel ) )\n  Interblocks  = Channel + Provenance\n  \n  'provenance' contains a continuous chain all the way back to  the foreign genesis.\n  \n  The contents of the latest received channel is stored on 'remote'\n  Replies are always processed before incoming requests.\n  When a received reply has executed, the local transmit action is removed\n  from the transmit queue.\n  \n  The queues hold the index for their next actions within them:\n  1.  Next remote reply index is the smallest index of the transit queue\n      for which there is a remote reply that is not a promise\n  2.  Next remote request index is given by the local highest reply index\n  \n  If systemRole === '.' then provenance checks are excused, as the\n  networkProducer.tx() function will flip outbound and inbound.  This is used\n  in the self channel.\n  \n  Counter is required to know where the request counter is up to, which needs independent\n  tracking as the channel might be cleared completely, but we cannot reuse numbers until\n  looparound at 32bit limit or similar",type:"object",required:[].concat(o(h.required),["systemRole","requestsLength","lineage","lineageTip"]),additionalProperties:!1,properties:r({},h.properties,{systemRole:{enum:["..",".","./","UP_LINK","DOWN_LINK"]},requestsLength:{type:"integer",minimum:0},heavy:v,lineage:{type:"array",uniqueItems:!0,items:s},lineageTip:{type:"array",uniqueItems:!0,items:v}})};e.exports={integritySchema:s,addressSchema:c,proofSchema:f,interblockSchema:v,provenanceSchema:p,validatorsSchema:d,signatureSchema:l,publicKeySchema:u,remoteSchema:h,channelSchema:g,actionSchema:a,continuationSchema:i}},function(e,t,n){var r=n(4),o=(n(11)("interblock:models:integrity"),n(55)),a=(0,n(20).standardize)({schema:n(37).integritySchema,create:function(e){if(!e||"UNKNOWN"===e)return a.clone({hash:"UNKNOWN",algorithm:"sha256"});"string"===typeof e&&(e={string:e}),r("object"===typeof e,"Must supply object: ".concat(e));var t={hash:o.objectHash(e),algorithm:"sha256"};return a.clone(t)},logicize:function(e){return{isUnknown:function(){return"UNKNOWN"===e.hash},isIntegrityMatch:function(t){return a.create(t).hash===e.hash}}}});e.exports={integrityModel:a}},,,,,,,,,,,function(e,t,n){var r=n(8),o=n(4),a=n(55),i=n(20).standardize,s=n(38).integrityModel,c=i({schema:n(37).addressSchema,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.create(),t="UNKNOWN";if("GENESIS"===e)t="GENESIS_".concat(a.generateNonce()),e=s.create("UNKNOWN");else if("LOOPBACK"===e)t="LOOPBACK",e=s.create("UNKNOWN");else if("ROOT"===e)t="ROOT",e=s.create("UNKNOWN");else if("string"===typeof e){var n=s.create(e);if(n.hash.length===e.length){var i=e;e=s.clone(r({},n,{hash:i}))}else e=n}return s.isModel(e)||debug("integrity not model: ",e),o(s.isModel(e)),e.isUnknown()||(t="RESOLVED"),c.clone({chainId:e,status:t})},logicize:function(e){var t=e.chainId,n=e.status;return{getChainId:function(){if("LOOPBACK"===n)return"LOOPBACK";if("ROOT"===n)return"ROOT";if("RESOLVED"!==n)throw new Error("Tried to get chainId on address with status: ".concat(n));return t.hash},isRoot:function(){return"ROOT"===n},isLoopback:function(){return"LOOPBACK"===n},isGenesis:function(){return n.startsWith("GENESIS_")},isUnknown:function(){return"UNKNOWN"===n},isResolved:function(){return"RESOLVED"===n}}}});e.exports={addressModel:c}},function(e,t,n){var r=n(446).consistencySourceFactory,o=n(452),a=o.toFunctions,i=o.fromFunctions,s=n(111).ramDynamoDbFactory,c=n(158).ramS3Factory,u=n(239).s3Keys,l=n(238).dbFactory;e.exports={consistencyFactory:function(e,t,n){var o=r(e,t,n);return i(o)},toFunctions:a,ramDynamoDbFactory:s,ramS3Factory:c,consistencySourceFactory:r,s3Keys:u,dbFactory:l}},,,,,function(e,t,n){e.exports=n(330)},,,,,,,,,function(e,t,n){var r=n(8),o=n(20).standardize,a=n(37).actionSchema,i=n(100).assertNoUndefined,s=o({schema:a,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"DEFAULT_ACTION";return"string"===typeof e&&(e={type:e}),e.payload||(e=r({},e,{payload:{}})),s.clone(e)},logicize:function(e){return i(e),{}}});e.exports={actionModel:s}},,function(e,t,n){var r=n(2),o=n(3),a=n(53),i=n(4),s=n(11)("interblock:models:keypair"),c=n(55),u=n(20).standardize,l=n(85).publicKeyModel,p=n(38).integrityModel,d=n(148).signatureModel,f=u({schema:{title:"Keypair",description:"public private key pair",type:"object",additionalProperties:!1,required:["name","publicKey","secretKey","algorithm"],properties:{name:{type:"string"},publicKey:l.schema,secretKey:{type:"string"},algorithm:{enum:["tweetnacl","sodium"]}}},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"CI",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c._ciKeypair;i.strictEqual(typeof e,"string");var n=l.clone({key:t.publicKey,algorithm:"sodium"}),r=t.secretKey;return f.clone({name:e,publicKey:n,secretKey:r,algorithm:"sodium"})},logicize:function(e){var t={publicKey:e.publicKey.key,secretKey:e.secretKey};if(!c.verifyKeyPairSync(t))throw new Error("Not a valid keypair - refusing to instantiate");return{sign:function(){var t=o(r.mark((function t(n){var o,a,u,l,f,h,v,g;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s("sign"),n){t.next=3;break}throw new Error("Refusing to sign undefined integrity");case 3:return n=p.clone(n),o=n.hash,a=e.publicKey,u=e.secretKey,t.next=8,c.signHash(o,u);case 8:return l=t.sent,f=l.signature,t.next=12,c.verifyHash(o,f,a.key);case 12:return h=t.sent,i(h),i(c.verifyHashSync(o,f,a.key)),v={publicKey:a,integrity:n,seal:f},g=d.clone(v),s("sign complete"),t.abrupt("return",g);case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getValidatorEntry:function(){return a({},e.name,e.publicKey)}}}});e.exports={keypairModel:f}},function(e,t,n){var r=n(21).covenantIdModel,o=n(431);o.covenantId=r.create("shell");var a=n(438);a.covenantId=r.create("net");var i=n(439);i.covenantId=r.create("socket");var s=n(440);s.covenantId=r.create("hyper");var c={reducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e}};c.covenantId=r.create("unity"),e.exports={shell:o,net:a,socket:i,unity:c,hyper:s}},function(e,t,n){var r=n(432);e.exports=r},function(e,t,n){var r=n(433),o=n(434),a=n(435),i=n(229);e.exports={networkProducer:r,blockProducer:o,lockProducer:a,channelProducer:i}},,,,,,,,,,,,,,function(e,t,n){var r=n(65),o=n(2),a=n(3),i=n(19),s=n(8),c=n(4),u=n(11)("interblock:models:block"),l=n(20).standardize,p=n(84).provenanceModel,d=n(66).keypairModel,f=n(101).dmzModel,h=n(38).integrityModel,v=f.schema,g=s({},v,{title:"Block",description:"The fundamental unit of state persistence and transmission\nA DMZ with a 'provenance' key is a block.",required:[].concat(i(v.required),["provenance"]),properties:s({},v.properties,{provenance:p.schema})}),y=function(){var e=a(o.mark((function e(t){var n;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.create("CI");case 2:return n=e.sent,c(h.isModel(t)),e.abrupt("return",n.sign(t));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=l({schema:g,create:function(e){var t=arguments;return a(o.mark((function n(){var r,a,i,l;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.length>1&&void 0!==t[1]?t[1]:y,u("create"),c("function"===typeof r),e=f.clone(e),void 0,a={},n.next=8,p.create(e,void 0,a,r);case 8:return i=n.sent,l=m.clone(s({},e,{provenance:i})),n.abrupt("return",l);case 11:case"end":return n.stop()}}),n)})))()},logicize:function(e){var t=e.network.getAliases().some((function(t){var n=e.network[t].address;return e.provenance.getAddress().equals(n)}));c(!t,"Loop detected");var n=e.provenance,o=r(e,["provenance"]),a=f.clone(o),i=a.getHash();c(i===n.dmzIntegrity.hash);return{isValidated:function(){if(n.address.isGenesis())return!0;var e=a.validators,t=Object.values(e),r=n.signatures.map((function(e){return e.publicKey})),o=t.every((function(e){return r.some((function(t){return t.equals(e)}))})),i=r.every((function(e){return t.some((function(t){return t.equals(e)}))}));return o&&i},getDmz:function(){return a},whoami:function(e,t){c(m.isModel(t)),e.forEach((function(e){publicKeyModel.clone(e)}))},isNext:function(t){var n=m.isModel(t)&&t.isValidated(),r=e.provenance.isNext(t.provenance);return n&&r},getChainId:function(){return e.provenance.getAddress().getChainId()}}}});e.exports={blockModel:m}},function(e,t,n){var r=n(19),o=n(8),a=n(2),i=n(3),s=n(4),c=n(24),u=(n(11)("interblock:models:provenance"),n(20).standardize),l=n(38).integrityModel,p=n(66).keypairModel,d=n(49).addressModel,f=n(37).provenanceSchema,h=function(){var e=i(a.mark((function e(t){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.create("CI");case 2:return n=e.sent,s(l.isModel(t)),e.abrupt("return",n.sign(t));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=u({schema:f,create:function(e,t){var r=arguments;return i(a.mark((function i(){var c,u,p,f,g,y,m,k,b,x,w,M,I;return a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return c=r.length>2&&void 0!==r[2]?r[2]:{},u=r.length>3&&void 0!==r[3]?r[3]:h,p=n(101),f=p.dmzModel,e=e||f.create(),s(f.isModel(e)),s(!t||v.isModel(t)),s.strictEqual(typeof c,"object"),s(Object.values(c).every(l.isModel)),s(!Object.keys(c).length||t),g=l.create(),dmzIntegrity=l.clone(o({},g,{hash:e.getHash()})),y=d.create("GENESIS"),m=0,k=o({},c),t&&(b=t.reflectIntegrity(),s(!Object.values(k).some((function(e){return e.equals(b)}))),k[t.height]=b,m=t.height+1,y=t.getAddress()),x={dmzIntegrity:dmzIntegrity,address:y,lineage:k,height:m},w=l.create(x),a.next=19,u(w);case 19:return M=a.sent,I=[M],a.abrupt("return",v.clone(o({},x,{integrity:w,signatures:I})));case 22:case"end":return a.stop()}}),i)})))()},logicize:function(e){if(e.dmzIntegrity.isUnknown())throw new Error("Dmz not a genuine type of integrity: ".concat(e.dmzIntegrity.hash));var t=Object.keys(e.lineage).map((function(e){return parseInt(e)}));s(t.length||e.address.isGenesis()),s(e.height||e.address.isGenesis()),s(t.every((function(t){return t>=0&&t<e.height}))),s.strictEqual(e.signatures.length,1,"single signer only");if(!function(){var t=c.omit(e,["integrity","signatures"]),n=l.create(t).equals(e.integrity);return n}())throw new Error("Self integrity degraded - refusing to instantiate");if(!e.signatures.length||!e.signatures.every((function(t){return t.integrity.equals(e.integrity)})))throw new Error("Signature degraded - refusing to instantiate");var n=l.create(e),o=e.address;0===e.height&&(s(o.isGenesis()),o=d.create(n));var a=function(){return n};return{merge:function(){},getAddress:function(){return o},reflectIntegrity:a,isNext:function(t){var n=Object.values(t.lineage).some((function(e){return e.equals(a())})),r=t.height>e.height;t.signatures[0].publicKey;return n&&r},getShortestHeight:function(){var n=r(t);n.sort((function(e,t){return e-t}));var o=n.shift();return s(o>=0&&o<e.height),o}}}});e.exports={provenanceModel:v}},function(e,t,n){var r=(0,n(20).standardize)({schema:n(37).publicKeySchema,create:function(){throw new Error("Only the keypairModel can create publicKeyModel types")},logicize:function(e){return{}}});e.exports={publicKeyModel:r}},function(e,t,n){var r=n(4),o=n(20).standardize,a=n(37).continuationSchema,i=n(100).assertNoUndefined,s=o({schema:a,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"@@RESOLVE",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.clone({type:e,payload:t})},logicize:function(e){"@@PROMISE"===e.type&&r.strictEqual(Object.keys(e.payload).length,0,"Promises cannot have payloads"),i(e);return{isPromise:function(){return"@@PROMISE"===e.type},isRejection:function(){return"@@REJECT"===e.type},isResolve:function(){return"@@RESOLVE"===e.type}}}});e.exports={continuationModel:s}},,,,,,,,,,,,,,function(e,t,n){n(4);var r=n(228);e.exports={assertNoUndefined:function(e){r(e).forEach((function(e){if("undefined"===typeof e)throw new Error("Values cannot be undefined: ".concat(this.path))}))}}},function(e,t,n){var r=n(4),o=n(20).standardize,a=n(149).covenantIdModel,i=n(104).timestampModel,s=n(66).keypairModel,c=n(124).aclModel,u=n(147).binaryModel,l=(n(38).integrityModel,n(151).networkModel),p=n(152).stateModel,d=n(153).configModel,f=n(154).validatorsModel,h=o({schema:{type:"object",title:"Dmz",description:"DMZ coordinates all the models in one place.\nDmz is equivalent to CombineReducers in Redux.",required:["validators","encryption","config","network","covenantId","binaryIntegrity","acl","state"],additionalProperties:!1,properties:{validators:f.schema,encryption:s.schema,config:d.schema,covenantId:a.schema,binaryIntegrity:u.schema,timestamp:i.schema,acl:c.schema,network:l.schema,state:p.schema}},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r("object"===typeof e);var t={validators:f.clone(e.validators),encryption:s.clone(e.encryption),config:d.create(e.config),covenantId:a.clone(e.covenantId),binaryIntegrity:u.clone(e.binaryIntegrity),acl:c.clone(e.acl),network:l.clone(e.network),state:p.clone(e.state)};return h.clone(t)},logicize:function(e){return r(!e.state.actions),{}}});e.exports={dmzModel:h}},function(e,t,n){var r=n(8),o=n(436);e.exports=r({},o)},,function(e,t,n){var r=(0,n(20).standardize)({schema:{title:"Timestamp",type:"object",description:"Time of issuance in standard format, with Zulu offset",additionalProperties:!1,required:["date","ms"],properties:{date:{type:"string",format:"date-time",examples:["2011-10-05T14:48:00.000Z"]},ms:{type:"integer"}}},create:function(){var e=new Date,t=e.toISOString(),n=e.valueOf();return r.clone({date:t,ms:n})},logicize:function(e){return{isExpired:function(t){return Date.now()-e.ms>=t}}}});e.exports={timestampModel:r}},function(e,t,n){var r=n(28),o=n(8),a=n(4),i=n(11)("interblock:models:channel"),s=n(24),c=n(230),u=c.rxRequestModel,l=c.rxReplyModel,p=n(20).standardize,d=n(49).addressModel,f=n(64).actionModel,h=n(86).continuationModel,v=n(107).remoteModel,g=p({schema:n(37).channelSchema,create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"UP_LINK";e=d.clone(e);var n=v.create({address:e}),r=o({},n,{systemRole:t,requestsLength:0,lineage:[],lineageTip:[]});return g.clone(r)},logicize:function(e){var t=e.address,n=e.systemRole,o=e.requests,c=e.replies,p=e.heavy,d=e.lineageHeight,h=e.heavyHeight,x=e.lineage,w=e.lineageTip,M=(e.requestsLength,"."===n),I=M?v.create(e):p&&p.getRemote()?p.getRemote():v.create();if(a(I),p){a(p.getRemote()||0===h),a.strictEqual(p.provenance.height,h),a(d>=h);var C=s.last(w).provenance;a.strictEqual(C.height,d),a(s.last(x).equals(C.reflectIntegrity()))}a(w.every((function(e){return!e.getRemote()}))),b(o),b(c);var A=function(){if(!t.isUnknown())return k(I.replies).find((function(e){return!I.replies[e].isPromise()&&o[e]}))},E=function(){var e,t=k(I.requests),n=r(t);try{for(n.s();!(e=n.n()).done;){var o=e.value;if(!c[o])return o}}catch(a){n.e(a)}finally{n.f()}};return{rxRequest:function(e){if(!t.isUnknown()||M){Number.isInteger(e)||(e=E());var n=I.requests[e];if(n){a(f.isModel(n));var r=n.type,o=n.payload,s=u.create(r,o,t,e);return i("rxRequest ".concat(s.type)),s}}},rxReply:function(){var e=A();if(Number.isInteger(e)){a(o[e],"No request for: ".concat(e)),a(I.replies[e],"No reply for: ".concat(e));var t=I.replies[e],n=t.type,r=t.payload,i=o[e];return l.create(n,r,i)}},rxReplyIndex:A,getNextReplyIndex:E,getRemoteRequestIndices:function(){return k(I.requests)},getRemoteReplyIndices:function(){return k(I.replies)},isTxGreaterThan:function(e){a(g.isModel(e));var n=!e.address.equals(t),r=m(c,e.replies),i=m(o,e.requests),s=y(c,e.replies);return n||r||i||s},getRemote:function(){return I}}}}),y=function(e,t){return k(e).some((function(n){var r=e[n],o=t[n];return!(!o||!r)&&(a(h.isModel(r)),a(h.isModel(o)),o.isPromise()&&!r.isPromise())}))},m=function(e,t){var n=k(e),r=k(t),o=x(n,r);return o},k=function(e){var t=[];return Object.keys(e).forEach((function(e){var n=parseInt(e);t.push(n)})),t.sort((function(e,t){return e-t})),t},b=function(e){var t=-1,n=Object.keys(e).every((function(e){var n=parseInt(e),r=n>t;return t=n,r}));a(n)},x=function(e,t){return!(!t.length&&!e.length)&&(!(t.length||!e.length)||!(t.length&&!e.length)&&s.last(t)<s.last(e))};e.exports={channelModel:g}},function(e,t){e.exports={txRequestSchema:{title:"txRequest",description:"Covenant created",type:"object",required:["type","payload","to"],additionalProperties:!1,properties:{type:{type:"string"},payload:{type:"object"},to:{type:"string"}}},rxRequestSchema:{title:"rxRequest",description:"System created inside ChannelModel",type:"object",required:["type","payload","sequence"],additionalProperties:!1,properties:{type:{type:"string"},payload:{type:"object"},sequence:{type:"string",pattern:""}}},txReplySchema:{title:"txReply",description:"Covenant created",type:"object",required:["type","payload","request"],additionalProperties:!1,properties:{type:{type:"string",enum:["@@REJECT","@@PROMISE","@@RESOLVE"]},payload:{type:"object"},request:{description:"Sequence created in rxRequest",type:"object",required:["sequence"],additionalProperties:!1,properties:{sequence:{type:"string",pattern:""}}}}},rxReplySchema:{title:"rxReply",description:'System created.\nCreate requires the sequence to be included.\n@@PROMISE cannot ever be dispatched to a reducer, hence its exclusion from "type"',type:"object",required:["type","payload","request"],additionalProperties:!1,properties:{type:{type:"string",enum:["@@REJECT","@@RESOLVE"]},payload:{type:"object"},request:{description:"Covenants original request, without the 'to' field",type:"object",required:["type","payload"],additionalProperties:!1,properties:{type:{type:"string"},payload:{type:"object"}}}}}}},function(e,t,n){var r=n(8),o=n(4),a=(n(24),n(20).standardize),i=n(37).remoteSchema,s=n(49).addressModel,c=a({schema:i,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o("object"===typeof e);var t={},n=["address","requests","replies","heavyHeight","lineageHeight"];n.forEach((function(n){e[n]&&(t[n]=e[n])}));var a={address:s.create(),requests:{},replies:{},heavyHeight:-1,lineageHeight:-1},i=r({},a,{},t);return c.clone(i)},logicize:function(e){return{}}});e.exports={remoteModel:c}},function(e,t,n){var r=n(8),o=n(53),a=n(4),i=(n(24),n(11)("interblock:models:interblock"),n(20).standardize),s=(n(84).provenanceModel,n(38).integrityModel,n(86).continuationModel),c=n(83).blockModel,u=n(105).channelModel,l=n(107).remoteModel,p=n(37).interblockSchema,d=n(155).proofModel,f=i({schema:p,create:function(e,t){a(c.isModel(e)),h(e,t);var n=e.provenance,r=e.validators,i={provenance:n,proof:d.create(e,t),validators:r};if(t){var s=e.network[t];a(u.isModel(s));var p=l.create(s);i.network=o({},t,p)}return f.clone(i)},logicize:function(e){var t,n=e.provenance,o=(e.proof,e.validators,e.network),i=o&&Object.keys(o)[0],u=i&&o[i];if(a(!u||l.isModel(u)),i){a.strictEqual(Object.keys(o).length,1);var p=o[i];a(!p.address.isUnknown(),"interblock transmission address must be known")}var d,h=function(){if(!t){var e=c.clone(u.requests[0].payload.genesis);a(e.provenance.address.isGenesis()),t=e}return t},v=function(){if(!u)return!1;var e=u.requests[0];return!(!e||"@@INTRO"!==e.type)||void 0};return{extractGenesis:h,getTargetAddress:function(){return u&&u.address},getOriginAlias:function(){return i},getRemote:function(){return u},isConnectionAttempt:v,isGenesisAttempt:function(){try{return h()}catch(e){}return!1},getWithoutRemote:function(){if(!d){var t={block:e.proof.block},n=r({},e,{proof:t});delete n.network,d=f.clone(n)}return d},getLineageHeight:function(){return u.lineageHeight},getHeavyHeight:function(){return u.heavyHeight},isConnectionResponse:function(){if(!u)return!1;a(u&&i);var e=-1===u.lineageHeight&&-1===u.heavyHeight,t=i.startsWith("@@PUBLIC_"),n=i.substring("@@PUBLIC_".length),r=t&&n===u.address.getChainId(),o=u.requests[0],s=o&&"@@ACCEPT"===o.type,c=!Object.keys(u.replies).length;return e&&r&&s&&c},isConnectionResolve:function(){if(!v())return!1;var e=u.replies[0];return e?(a(s.isModel(e)),e.isResolve()):void 0},getChainId:function(){return n.getAddress().getChainId()}}}}),h=function(e,t){if(t&&"string"!==typeof t)throw new Error("Invalid format for target alias: ".concat(t));if(!e.isValidated())throw new Error("Only validated blocks can be reduced to Interblocks");if("."===t)throw new Error("Cannot make interblock from loopback channel")};e.exports={interblockModel:f}},function(e,t,n){var r=n(8),o=n(2),a=n(3),i=n(4),s=n(39).interpret,c=n(445).machineLogger,u=function(){var e=a(o.mark((function e(t,n){var i,u,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c(t.type||t,n.id),u=s(n,{execute:!1}),l=new Promise((function(e,t){var n=!1;u.onTransition(function(){var e=a(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("error"===t.value&&(n=t.event),"error"===t.value||"done"===t.value){e.next=4;break}return e.next=4,i.writeTransition(t.value,t.event,t.context);case 4:u.execute(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),u.onDone(function(){var s=a(o.mark((function a(s){var c,u,l;return o.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!n){o.next=11;break}return(c=n).type,u=c.data,(l=r({},new Error,{},u)).message=u.message,l.stack=u.stack,l.name=u.name,o.next=8,i.writeTermination(l);case 8:t(l),o.next=14;break;case 11:return o.next=13,i.writeTermination();case 13:e(s.data);case 14:case"end":return o.stop()}}),a)})));return function(e){return s.apply(this,arguments)}}())})),u.start(),u.send(t),e.abrupt("return",l);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();e.exports={thread:u,setLogger:function(e){i.strictEqual(typeof e,"function"),c=e}}},function(e,t,n){var r=n(2),o=n(3),a=n(11)("interblock:services:crypto"),i=n(4),s=n(21),c=s.cryptoCacher,u=s.keypairModel,l=s.integrityModel,p=n(50),d=p.ramDynamoDbFactory,f=p.dbFactory,h=n(55),v=c.cacheVerifyKeypair,g=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CI";e=e||d();var n=f(e);i("string"===typeof t);var s,c=function(){var e=o(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(l.isModel(t)),e.next=3,g();case 3:return n=e.sent,e.abrupt("return",n.sign(t));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=function(){var e=o(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g();case 2:return t=e.sent,e.abrupt("return",t.getValidatorEntry());case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=function(){var e=o(r.mark((function e(){var o,i,c,l,p,d,f,g;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s){e.next=2;break}return e.abrupt("return",s);case 2:return e.next=4,n.scanKeypair();case 4:if(!(o=e.sent)){e.next=12;break}return i=JSON.parse(o.keypairJson),e.next=9,v(i);case 9:s=u.clone(i),e.next=30;break;case 12:return e.next=14,h.generateKeyPair();case 14:return c=e.sent,l=u.create(t,c),p=l.serialize(),e.next=19,n.putKeypair({keyname:t,keypairJson:p});case 19:return e.next=21,n.scanKeypair();case 21:if(d=e.sent,f=d.keypairJson){e.next=25;break}throw new Error("cannot store keypair");case 25:return g=JSON.parse(f),e.next=28,v(g);case 28:(s=u.clone(g)).equals(l)||a("collision avoided for: ",t);case 30:return e.abrupt("return",s);case 31:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{sign:c,getValidatorEntry:p}};e.exports={cryptoFactory:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CI",n=g(e,t),i=function(){var e=o(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a("crypto: ".concat(t.type)),e.t0=t.type,e.next="SIGN"===e.t0?4:"VALIDATOR"===e.t0?5:6;break;case 4:return e.abrupt("return",n.sign(t.payload));case 5:return e.abrupt("return",n.getValidatorEntry());case 6:throw new Error("Unknown crypto action type: ".concat(t.type));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return i},toFunctions:function(e){return{sign:function(t){return e.push({type:"SIGN",payload:t})},getValidatorEntry:function(){return e.push({type:"VALIDATOR"})}}},crypto:h}},function(e,t,n){(function(t){var r=n(65),o=n(2),a=n(3),i=n(11)("interblock:aws:ramDynamoDb"),s=n(4),c=(n(24),{dbChains:"height",dbPools:"originChainId_height_type",dbLocks:"chainId",dbSockets:"socketId",dbSubscribers:"targetChainId"}),u=function(e,t){return t[c[e]]};e.exports={ramDynamoDbFactory:function(){var e={dbCrypto:{},dbChains:{},dbPools:{},dbLocks:{},dbSubscribers:{},dbSockets:{}};return{get:function(n,r){var c=n.TableName,l=n.Key;i("get %O callback: %O",c,r),s(e[c]),r&&t(a(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=r,e.next=3,p.promise();case 3:e.t1=e.sent,(0,e.t0)(null,e.t1);case 5:case"end":return e.stop()}}),e)}))));var p={promise:function(){var t=a(o.mark((function t(){var n,r,a;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:return s(l.chainId),n=e[c][l.chainId]||{},r=u(c,l),a=n[r],t.abrupt("return",{Item:a});case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()};return p},query:function(t){i("query %O",t.TableName);var n=t.TableName,r=t.KeyConditionExpression,c=t.ExpressionAttributeValues;s.strictEqual(r,"chainId = :hkey");var u=c[":hkey"];return s(u),{promise:function(){var t=a(o.mark((function t(){var r,a;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:return r=e[n][u]||{},a=Object.values(r).reverse(),t.abrupt("return",{Items:a});case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}},delete:function(t){var n=t.TableName,r=t.Key;return i("del %O %O",n,r),{promise:function(){var t=a(o.mark((function t(){var a,i,c;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:a=e[n][r.chainId],i=u(n,r),c=a[i],s(c,"cannot delete non existent item"),delete a[i];case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}},put:function(n,s){var c=n.TableName,l=n.Item;r(n,["TableName","Item"]);i("put %O %O",c,l.chainId),s&&t(a(o.mark((function e(){var t;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.promise();case 3:t=e.sent,s(null,t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),s(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))));var p={promise:function(){var t=a(o.mark((function t(){var n,r,a;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:return n=l.chainId,r=e[c][n]||{},a=u(c,l),r[a]&&i("already exists: %O",l.chainId),r[a]=l,e[c][n]=r,t.abrupt("return",!0);case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()};return p},scan:function(t){var n=t.TableName,r=t.Limit;return i("scan: %O %O",n,r),s(["dbChains","dbCrypto"].includes(n)),s.strictEqual(r,1),{promise:function(){var t=a(o.mark((function t(){var r,a,i;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:return r=e[n],a=Object.values(r)[0],i=[],a&&i.push(Object.values(a)[0]),t.abrupt("return",{Items:i});case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}},_getTables:function(){return e}}}}}).call(this,n(54).setImmediate)},,function(e,t,n){t.cd=n(253),t.config=n(556),t.exit=n(557),t.help=n(558),t.ls=n(570),t.pwd=n(572),t.version=n(573),t.pkg=n(575),t.clear=n(576),t.open=n(578),t.login=n(581),t.logout=n(582),t.su=n(583),t.add=n(585),t.ln=n(586),t.rm=n(587),t.whoami=n(588),t.search=n(589),t.time=n(590),t.ping=n(593),t.reset=n(594),t.dns=n(595),t.cat=n(596),t.net=n(597),t.debug=n(598),t.edit=n(599),t.about=n(600),t.blocks=n(601),t.scrub=n(602),t.namegen=n(603)},,,,,function(e,t,n){var r=n(281),o=r.browserFactory,a=r.effectorFactory,i=r.awsFactory,s=n(123),c=n(21);e.exports={browserFactory:o,effectorFactory:a,awsFactory:i,engine:s,models:c}},,,,,function(e,t,n){var r=n(282).metrologyFactory,o=n(170).standardEngineFactory,a=n(50),i=a.consistencyFactory,s=a.toFunctions,c=n(110),u=c.cryptoFactory,l=c.crypto,p=n(243).blockPrint,d=n(109).setLogger;e.exports={metrologyFactory:r,standardEngineFactory:o,consistencyFactory:i,cryptoFactory:u,crypto:l,blockPrint:p,setLogger:d,consistencyQueueToFunctions:s}},function(e,t,n){var r=(0,n(20).standardize)({schema:{type:"object",title:"Acl",description:"Access control list, power rating, alias table, and chargeout rates\nGroups are similar to roles.\nGroups contain only Actors\nActors are similar to users, but represent chains\nThis is the alias table\nActors contain only a single ChainId\nThis might be extended to cover token balance from other chains.\nCould use proofs to show your current balance when an action was requested.\n\nAlias table is contained within the join slices directly.",required:["groups","everybody","balance","shares","costs"],additionalProperties:!1,properties:{groups:{},everybody:{},balance:{},shares:{},costs:{}}},create:function(){return r.clone({groups:{children:{alice:50,chain123:60},founders:{chain123:1}},everybody:{},balance:{},shares:{children:0,founders:100},costs:{"*":{children:50}}})},logicize:function(e){return{isAllowed:function(e,t,n){}}}});e.exports={aclModel:r}},,,,function(e,t){var n={},r={registerModels:function(e){Object.keys(e).forEach((function(t){var r=e[t];if(!t||!e[t])throw new Error("".concat(t," passed in as undefined"));var o=r.schema.title;if(n[o])throw new Error("".concat(o," was already registered"));n[o]=r}))},isRegistered:function(e){return!!n[e]},get:function(e){if(!n[e])throw new Error("Model not found in registry: ".concat(e));return n[e]},_getContainer:function(){return n}};e.exports={registry:r}},,,,,,,,,,,,,,,,,,,function(e,t,n){var r=n(20).standardize,o=n(38).integrityModel,a=r({schema:{title:"Binary",type:"object",description:"Manages the binary attached to each chain.",additionalProperties:!1,required:["integrity","size"],properties:{integrity:o.schema,size:{type:"number",min:0}}},create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e=o.clone(e),a.clone({integrity:e,size:t})},logicize:function(e){return{}}});e.exports={binaryModel:a}},function(e,t,n){var r=n(55),o=n(20).standardize,a=(n(85).publicKeyModel,n(38).integrityModel,o({schema:n(37).signatureSchema,create:function(){throw new Error("Only the keypairModel can create signatureModel types")},logicize:function(e){var t=e.integrity,n=e.seal,o=e.publicKey,a=t.hash,i=o.key;if(!r.verifyHashSync(a,n,i)){var s=new Error("Could not verify hash synchronously: ".concat(a));throw s.toVerify={hash:a,seal:n,key:i},s}return{}}}));e.exports={signatureModel:a}},function(e,t,n){var r=n(20).standardize,o=n(38).integrityModel,a=r({schema:{title:"CovenantId",description:"Covenants are how behaviour is introduced to the system.\nA Covenant represents the loaded piece of language specific code.\nA covenant is a binary package on disk, but in ram it is executable code.\n\nIn all languages, a reducer must be supplied.\nThis pure function takes a json state, and a json action, and returns a json state\n\nOptionally, a list of async functions that are invoked by the side effect system \nmay be supplied",type:"object",additionalProperties:!1,required:["name","version","integrity","language"],properties:{name:{type:"string"},version:{type:"string"},integrity:o.schema,language:{enum:["javascript","javascript/xstate","python","go","rust","haskell","c","c++"]}}},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unity",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.create(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0.0.0",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"javascript";if(!o.isModel(t))throw new Error("Invalid integrity for name: ".concat(e));return a.clone({name:e,version:n,integrity:t,language:r})},logicize:function(e){return{isSystemCovenant:function(){return i(e.name)}}}}),i=function(e){return"string"===typeof e&&!!n(67)[e]};e.exports={covenantIdModel:a}},function(e,t,n){var r=n(437);e.exports=r},function(e,t,n){var r=n(8),o=n(4),a=(n(11)("interblock:models:network"),n(24)),i=n(20).standardize,s=n(105).channelModel,c=n(49).addressModel,u=n(84).provenanceModel,l=i({schema:{title:"Network",description:"All communication in and out of this blockchain.",type:"object",required:["..","."],additionalProperties:!1,minProperties:2,patternProperties:{"(.*?)":s.schema}},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e[".."]?e[".."]:s.create(c.create(),".."),n=e["."]?e["."]:s.create(c.create("LOOPBACK"),".");return o(n.address.isLoopback()),l.clone(r({},e,{"..":t,".":n}))},logicize:function(e){o(!e[void 0]);var t=Object.keys(e);Object.freeze(t),o(t.includes("..")),o(t.includes(".")),o(s.isModel(e["."]),"channel invalid"),o("."===e["."].systemRole,"self not loopback channel");var n=function(){return i("reply")},r=function(){return i("request")},i=function(n){var r;return t.find((function(t){var o,a=e[t],i=a.rxReply(),s=a.rxRequest();switch(n){case"reply":o=i;break;case"request":o=s}if(o)return r={alias:t,event:o,channel:a},!0})),r},p=function(){return t},d=function(){return p().filter((function(t){return e[t].address.isResolved()}))},f=function(t){return o(c.isModel(t)),o(!t.isUnknown()),p().find((function(n){return e[n].address.equals(t)}))};return{rxReply:n,rxRequest:r,rxSelf:function(){var t=e["."];return t.rxReply()||t.rxRequest()},rx:function(){return n()||r()},getAliases:p,getResolvedAliases:d,getAlias:f,getParent:function(){return e[".."]},includesInterblock:function(t){var n=t.provenance;o(u.isModel(n));var r=f(n.getAddress());if(!r)return!1;var i=!1,s=e[r];if(n.height<=s.lineageHeight&&(i=!0),n.height===s.lineageHeight){var c=n.equals(a.last(s.lineageTip).provenance);o(c)}return t.getRemote()&&i?(n.height===s.heavy.provenance.height&&o(t.equals(s.heavy)),n.height<=s.heavy.provenance.height):i},isResponseDone:function(t,n){o(c.isModel(t)),o(Number.isInteger(n)),o(n>=0);var r=f(t);return o(e[r]),e[r].replies[n]},txInterblockAliases:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.create();o(l.isModel(t));var n=d(),r=n.filter((function(n){var r=e[n],o=t.getAlias(r.address);if(!o)return!0;var a=t[o];return r.isTxGreaterThan(a)}));return r},isNewChannels:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.create();o(l.isModel(t));var n=d(),r=n.some((function(n){var r=e[n].address;if(!t.getAlias(r))return!0}));return r}}}});e.exports={networkModel:l}},function(e,t,n){var r=n(8),o=n(65),a=n(4),i=n(20).standardize,s=n(235).txRequestModel,c=n(234).txReplyModel,u=n(231).rxReplyModel,l=n(232).rxRequestModel,p=(n(100).assertNoUndefined,{title:"State",description:"The result of running a covenant is stored here.\nIt checks the state minus the actions is serializable\nIncludes the array of requests and replies returned from \nreducing the covenant.  These actions are intended to be transmitted\nvia the network.  This model enforces the format and logic of the\nreturns from the reducer\n\nThis is how covenant info is ingested back into the trusted system.\nIt is crucial that the format of this data is correct\n\nEntry point from covenant to system.\n\nMaximally inflates actions with defaults.  Logical checking is done inside\nthe networkProducer as needs context of the initiating action to fill in\nremaining defaults\n\nThe actions in from the covenant are refined over three states:\n1. create( state ) inflates actions to pass schema validation\n2. logicize( state ) checks static logic\n3. networkProducer.tx( state ) checks context logic\n\nThe returned model is forbidden to have an actions key on it.\nThe validation is run during clone, then logicize strips the actions out.\n\nCreate is only called immediately after a reducer call returns some state.\nTherefore, we always know what the default action is, so we require it of create.\n",type:"object",required:[],additionalProperties:!0,properties:{actions:{type:"array",uniqueItems:!1,items:{oneOf:[s.schema,c.schema]}}}}),d=function(e,t){if(!e)throw new Error("Action cannot be interpreted: ".concat(e));if("string"===typeof e&&(e={type:e}),a(e.type,"Action must supply a type"),f(e.type)){var n,r=e,o=r.type,i=r.payload,u=void 0===i?{}:i,p=e.request;return p?n=p.sequence:(a(l.isModel(t)),n=t.sequence),c.create(o,u,n)}var d=e,h=d.type,v=d.payload,g=void 0===v?{}:v,y=d.to,m=void 0===y?".":y;return s.create(h,g,m)},f=function(e){return c.schema.properties.type.enum.includes(e)},h=i({schema:p,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;a.strictEqual(typeof e,"object");var n=e.actions,i=o(e,["actions"]);if(t&&a(l.isModel(t)||u.isModel(t),"defaultAction must be either rxRequest or rxReply: ".concat(t)),n){!Array.isArray(n)&&n&&(n=[n]);var s=n.map((function(e){return d(e,t)}));i=r({actions:n=s},i)}return h.clone(i)},logicize:function(e){var t=e.actions,n=void 0===t?[]:t,r=o(e,["actions"]);a(Array.isArray(n),"actions must be an array: ".concat(n));var i=[],u=[];n.forEach((function(e){if(f(e.type)){var t=c.clone(e);u.forEach((function(n){n.isPromise()&&a(!t.isPromise(),"Duplicate promise: ".concat(e));var r=n.request.sequence!==t.request.sequence;a(r,"Duplicate reply: ".concat(e))})),u.push(t)}else{var n=s.clone(e);i.push(n)}}));return{getRequests:function(){return[].concat(i)},getReplies:function(){return[].concat(u)},getState:function(){return r}}}});e.exports={stateModel:h}},function(e,t,n){var r=n(8),o=(0,n(20).standardize)({schema:{title:"Config",description:"Configuration options for the chain",type:"object",required:["isPierced","isSideEffectCapable","isPublicChannelOpen"],additionalProperties:!1,properties:{isPierced:{type:"boolean",description:"If the chain should be reduced, even with no known actions"},isSideEffectCapable:{type:"boolean",description:"When reducing, will this chain be allowed network access"},isPublicChannelOpen:{type:"boolean",description:"Will the validators open up new channels on request from unknown chains"}}},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={isPierced:!1,isSideEffectCapable:!1,isPublicChannelOpen:!1};return o.clone(r({},t,{},e))},logicize:function(e){return{}}});e.exports={configModel:o}},function(e,t,n){var r=n(20).standardize,o=n(37).validatorsSchema,a=(n(85).publicKeyModel,n(66)),i=a.keypairModel,s=a.ciKeypair,c=r({schema:o,create:function(){var e=i.create("CI",s).getValidatorEntry();return c.clone(e)},logicize:function(e){return{}}});e.exports={validatorsModel:c}},function(e,t,n){var r=n(4),o=n(20).standardize,a=n(37).proofSchema,i=n(83).blockModel,s=o({schema:a,create:function(e,t){r(i.isModel(e));var n={block:e.getProof()};return t&&(r(e.network[t],"missing ".concat(t)),n.network=e.network.getProof(),n.channel=e.network[t].getProof()),s.clone(n)},logicize:function(e){return{}}});e.exports={proofModel:s}},function(e,t,n){var r=n(2),o=n(3),a=n(8),i=n(4),s=n(21).blockModel,c=n(67),u=n(11)("interblock:isolate");e.exports={isolateFactory:function(e){var t=function(e){var t={},n=a({},c,{},e);return{loadCovenant:function(){var e=o(r.mark((function e(o){var a,c,l;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(s.isModel(o)),a=o.covenantId,c=o.provenance.reflectIntegrity().hash,l=a.name,i(n[l],"No covenant loaded: ".concat(l)),u("loadCovenant %o from %o",l,Object.keys(n)),u("containerId: %o",c.substring(0,9)),t[c]={covenant:n[l],block:o},e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),tick:function(){var e=o(r.mark((function e(n){var o,a,s,c,l;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.containerId,a=n.state,s=n.action,u("tick: %o action: %o",o.substring(0,9),s.type),c=t[o],i(c,"No tick container for: ".concat(o)),e.next=6,c.covenant.reducer(a,s);case 6:return l=e.sent,e.abrupt("return",l);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),unloadCovenant:function(){var e=o(r.mark((function e(n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u("attempting to unload: %o",n),e.next=3,Promise.resolve();case 3:i(t[n],"No container for: ".concat(n)),delete t[n];case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}(e);return function(e){switch(e.type){case"LOAD_COVENANT":return t.loadCovenant(e.payload);case"TICK":return t.tick(e.payload);case"UNLOAD_COVENANT":return t.unloadCovenant(e.payload);default:throw new Error("Unknown isolator action type")}}},toFunctions:function(e){return{loadCovenant:function(t){return e.push({type:"LOAD_COVENANT",payload:t})},tick:function(t){return e.push({type:"TICK",payload:t})},unloadCovenant:function(t){return e.push({type:"UNLOAD_COVENANT",payload:t})}}}}},,function(e,t,n){var r=n(2),o=n(3),a=n(11)("interblock:aws:ramS3"),i=n(4);n(24);e.exports={ramS3Factory:function(){var e={wbblockbucket:{},wbinterbucket:{}};return{putObject:function(t){var n=t.Bucket,s=t.Key,c=t.Body;return a("putObject %O %O",n,s),i("string"===typeof n),i("string"===typeof s),i("object"===typeof c),{promise:function(){var t=o(r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:return i(e[n]),e[n][s]&&a("item already exists: %O %O",n,s),e[n][s]=c,t.abrupt("return",!0);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}},getObject:function(t){var n=t.Bucket,s=t.Key;return a("getObject %O %O",n,s),i("string"===typeof n),i("string"===typeof s),{promise:function(){var t=o(r.mark((function t(){var o;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:return i(e[n]),e[n][s]||(a(n),a(s)),i(e[n][s]),o=e[n][s],t.abrupt("return",{Body:o});case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}},deleteObject:function(t){var n=t.Bucket,s=t.Key;return a("deleteObject %O %O",n,s),{promise:function(){var t=o(r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:return i(e[n]),i(e[n][s]),delete e[n][s],t.abrupt("return",!0);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}},_getBuckets:function(){return e},_isRam:!0}}}},,,function(e,t,n){var r=n(19),o=n(22)("dos:eval"),a=n(113);e.exports.evaluate=function(e,t,n){if(o(t,n),t=t||""){if(!a[t])throw new Error("".concat(t,": command not found"));return a[t].apply(a,[e].concat(r(n)))}}},function(e,t,n){var r=n(2),o=n(3),a=n(245),i=n(22)("dos:spinner");t.withSpin=function(e){return function(){var t=o(r.mark((function t(n){var o=arguments;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i("spinner"),n.spinner=a({spinner:"arrow3"}).start(),t.prev=2,t.next=5,e.apply(this,o);case 5:return t.abrupt("return",t.sent);case 8:t.prev=8,t.t0=t.catch(2),i(t.t0);case 11:return t.prev=11,n.spinner.stop(),n.spinner=null,t.finish(11);case 15:case"end":return t.stop()}}),t,this,[[2,8,11,15]])})));return function(e){return t.apply(this,arguments)}}()}},,,,,,,function(e,t,n){var r=n(8),o=n(2),a=n(3),i=n(4),s=n(123).metrologyFactory,c=n(24),u=n(11)("interblock:effector"),l=n(67),p=(l.shell,l.net),d=(l.hyper,n(21)),f=(d.addressModel,d.socketModel,n(490).tcpTransportFactory,function(){var e=a(o.mark((function e(t){var n,r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u("effectorFactory"),e.next=3,s(t);case 3:return n=e.sent,r=h(n),e.next=7,r.add("net",{covenantId:p.covenantId});case 7:return function(){var e=a(o.mark((function e(t){var n;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,awsFactory("aws");case 2:n=e.sent,client.sqsTx.setProcessor(n.sqsRx.push),n.sqsTx.setProcessor(client.sqsRx.push);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),h=function e(t){var o,a=r({},t,{_debug:n(11)}),i={},s=function(){var n=t.getState();if(n){var r=m(n,l);if(r&&!r.covenantId.equals(o)){o=r.covenantId,u("set covenant to: %O",o.name);var s=l[o.name];n.network[".."].address.isRoot()&&(u("assinging shell in special case root chain"),s=l.shell);var c=k(t.dispatch,s);y(a,t),Object.assign(a,c)}var p=t.getChildren();if(u("currentChildren",Object.keys(p)),!v(p,i)){for(var d in g(a,i),p)u("creating child: %O",d),i[d]=e(p[d]);Object.assign(a,i)}}};return s(),t.subscribe(s),a},v=function(e,t){var n=Object.keys(e).sort(),r=Object.keys(t).sort();return c.isEqual(n,r)},g=function(e,t){for(var n in t)delete e[n],delete t[n]},y=function(e,t){for(var n in e)"_debug"===n||t[n]||"function"===typeof e[n]&&delete e[n]},m=function(e,t){var n=e.covenantId,r=t.unity;for(var o in t)t[o].covenantId.equals(n)&&(i(r===t.unity),r=t[o]);return r},k=function(e,t){var n={},r=function(r){n[r]=function(){var n,o=(n=t.actions)[r].apply(n,arguments);return e(o)}};for(var o in t.actions)r(o);return n};e.exports={effectorFactory:f}},function(e,t,n){var r=n(8),o=n(2),a=n(3),i=n(4),s=(n(24),n(286)),c=n(172).sqsQueueFactory,u=n(21),l=u.interblockModel,p=u.addressModel,d=u.txModel,f=(u.socketModel,n(444).fsmFactory),h=n(11)("interblock:engine");e.exports={standardEngineFactory:function(){h("standardEngineFactory");var e=0,t=f(),n=(t.ioIsolate,t.ioCrypto,t.ioConsistency,t.ioPool),u=t.ioIncrease,v=t.ioReceive,g=t.ioTransmit,y=c("sqsTx",d),m=c("sqsRx",d),k=c("sqsTransmit",l),b=c("sqsPool",l),x=c("sqsIncrease",p),w={sqsTx:y,sqsRx:m,sqsTransmit:k,sqsPool:b,sqsIncrease:x};m.setProcessor(function(e,t,n){return function(){var r=a(o.mark((function r(a){var s,c,u,l,p;return o.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return h.extend("receiver")("receiver"),i(d.isModel(a)),s=a.interblock,r.next=6,e.push(a);case 6:return c=r.sent,u=c.isPoolable,l=c.isCatchupable,i("boolean"===typeof u),i("boolean"===typeof l),p=[],u&&p.push(t.push(s)),l&&p.push(n.push(s)),r.next=16,Promise.all(p);case 16:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}(v,b,k)),k.setProcessor(function(e,t,n){return function(){var r=a(o.mark((function r(a){var s,c;return o.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return h.extend("transmitter")("transmitter"),i(l.isModel(a)),r.next=5,e.push(a);case 5:return s=r.sent,i(s.every(d.isModel),"failed transmitter"),c=s.map((function(e){var r=e.interblock;return e.socket.getIsInternal()?n.push(r):t.push(e)})),r.next=10,Promise.all(c);case 10:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}(g,y,b)),b.setProcessor(function(e,t){return function(){var n=a(o.mark((function n(r){var a,s,c;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(a=h.extend("pooler"))("pooler"),i(l.isModel(r)),n.next=5,e.push(r);case 5:return s=n.sent,i(Array.isArray(s),"failed pool"),a("affectedAddresses length: %o",s.length),c=s.map((function(e){return t.push(e)})),n.next=11,Promise.all(c);case 11:return n.abrupt("return",s);case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}(n,x)),x.setProcessor(function(t,n){var r=new Map,c=new Map;return function(){var u=a(o.mark((function a(u){var d,f,v,g;return o.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if((d=h.extend("increasor").extend(s(3,e++)))("throttler"),i(p.isModel(u)),f=u.getChainId(),c.get(f)){o.next=24;break}case 5:return r.delete(f),c.set(f,!0),o.next=9,t.push(u);case 9:if(!(v=o.sent)){o.next=19;break}return i(Array.isArray(v)),i(v.every(l.isModel)),d("transmission count: ".concat(v.length)),g=v.map((function(e){return n.push(e)})),o.next=17,Promise.all(g);case 17:o.next=20;break;case 19:d("could not externally lock: %o",f);case 20:c.delete(f);case 21:if(r.get(f)){o.next=5;break}case 22:o.next=26;break;case 24:r.set(f,!0),d("redrive raised");case 26:case"end":return o.stop()}}),a)})));return function(e){return u.apply(this,arguments)}}()}(u,k));var M=r({},t,{},w);return Object.freeze(M),M}}},,function(e,t,n){var r=n(289),o=r.ioQueueFactory,a=r.sqsQueueFactory;e.exports={ioQueueFactory:o,sqsQueueFactory:a}},,,,,,,,,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=n(19),o=n(4),a=n(11)("interblock:producers:channel"),i=n(24),s=n(21),c=s.addressModel,u=s.channelModel,l=s.interblockModel,p=s.actionModel,d=s.continuationModel;e.exports={ingestInterblock:function(e,t){return u.clone(e,(function(n){a("ingestInterblock"),o(l.isModel(t)),o(e.address.equals(t.provenance.getAddress()));var s=t.provenance,c=s.reflectIntegrity(),u=t.getRemote(),p=t.getWithoutRemote(),d=r(e.lineage),f=function(){d.push(c),n.lineageTip.push(p),n.lineageHeight=s.height,a("ingested lineage: ".concat(s.height))},h=function(){if(n.heavy=t,n.heavyHeight=s.height,o(u||s.address.isGenesis()),u){var e=u.requests,r=Object.keys(e),c=i.pick(n.replies,r);n.replies=c,a("ingested heavy: ".concat(s.height))}},v=i.last(e.lineageTip);v?v.provenance.isNext(s)&&f():s.address.isGenesis()&&(a("ingesting genesis"),f(),h()),u&&n.heavy&&s.height>n.heavy.provenance.height&&d.some((function(e){return e.equals(c)}))&&h(),n.lineage=d}))},setAddress:function(e,t){return u.clone(e,(function(e){o(c.isModel(t)),o(!t.isGenesis()),e.address=t}))},txRequest:function(e,t){return u.clone(e,(function(e){a("txRequest"),o(p.isModel(t),"must supply request object");var n=e.requestsLength;e.requests[n]=t,e.requestsLength++}))},txReply:function(e,t,n){return u.clone(e,(function(r){o(d.isModel(t),"must supply reply object");var a=e.getNextReplyIndex();n=Number.isInteger(n)?n:a;var s=i.last(e.getRemoteRequestIndices());o(n>=0&&n<=s,"replyIndex out of bounds: ".concat(n)),o(e.getRemote().requests[n]);var c=e.replies[n],u=a===n;if(c&&!c.isPromise())throw new Error("Can only settle previous promises: ".concat(n));if(t.isPromise()&&!u)throw new Error("Can only promise for current action: ".concat(n));if(!c&&!u)throw new Error("Can only settle directly with tip: ".concat(t));r.replies[n]=t}))},shiftTxRequest:function(e,t){return u.clone(e,(function(n){o(u.isModel(e)),o(e.rxReply()),a("shiftTxRequest requestsLength: ".concat(e.requestsLength));var r="."===e.systemRole,i=e.rxReplyIndex();r&&(o(u.isModel(t)),o(t.address.isLoopback()),i=t.rxReplyIndex(),o(e.replies[i],"loopback empty at ".concat(i)),delete n.replies[i]),o(e.requests[i],"nothing to remove at ".concat(i)),delete n.requests[i]}))}}},function(e,t,n){var r=n(231).rxReplyModel,o=n(232).rxRequestModel,a=n(234).txReplyModel,i=n(235).txRequestModel;e.exports={rxReplyModel:r,rxRequestModel:o,txReplyModel:a,txRequestModel:i}},function(e,t,n){var r=n(4),o=n(20).standardize,a=n(64).actionModel,i=o({schema:n(106).rxReplySchema,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"@@RESOLVE",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;r(a.isModel(n),"Request not model: ".concat(n));var o={type:e,payload:t,request:n};return i.clone(o)},logicize:function(e){var t=e.request,n=t.type,r=t.payload,o=a.create(n,r);return{getRequest:function(){return o},isReply:function(){return!0}}}});e.exports={rxReplyModel:i}},function(e,t,n){var r=n(4),o=n(20).standardize,a=n(233),i=n(64).actionModel,s=n(49).addressModel,c=o({schema:n(106).rxRequestSchema,create:function(e,t,n,o){r(Number.isInteger(o)),r(s.isModel(n));var a={type:e,payload:t,sequence:"".concat(n.getChainId(),"_").concat(o)};return c.clone(a)},logicize:function(e){var t=e.type,n=e.payload,r=e.sequence,o=a(r),s=o.address,c=o.index,u=i.create(t,n);return{getAddress:function(){return s},getIndex:function(){return c},getRequest:function(){return u},isReply:function(){return!1}}}});e.exports={rxRequestModel:c}},function(e,t,n){var r=n(8),o=n(33),a=n(4),i=n(49).addressModel,s=n(38).integrityModel;e.exports=function(e){a("string"===typeof e);var t,n=e.split("_"),c=o(n,2),u=c[0],l=c[1],p=parseInt(l);if("LOOPBACK"===u)t=i.create("LOOPBACK");else{var d=s.clone(r({},s.clone(),{hash:u}));t=i.create(d)}return{address:t,index:p}}},function(e,t,n){var r=n(4),o=n(20).standardize,a=n(86).continuationModel,i=n(106).txReplySchema,s=n(233),c=o({schema:i,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"@@RESOLVE",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;r.strictEqual(typeof t,"object");var o={type:e,payload:t,request:{sequence:n}};return c.clone(o)},logicize:function(e){var t=e.type,n=e.payload,r=e.request.sequence,o=s(r),i=o.address,c=o.index,u=a.create(t,n);return{getAddress:function(){return i},getIndex:function(){return c},getContinuation:function(){return u}}}});e.exports={txReplyModel:c}},function(e,t,n){var r=n(4),o=n(20).standardize,a=n(64).actionModel,i=o({schema:n(106).txRequestSchema,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"DEFAULT_TX_REQUEST",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";r.strictEqual(typeof t,"object");var o={type:e,payload:t,to:n};return i.clone(o)},logicize:function(e){var t=e.type,n=e.payload,r=(e.to,a.create({type:t,payload:n}));return{getAction:function(){return r}}}});e.exports={txRequestModel:i}},function(e,t,n){var r=n(4),o=(n(11)("interblock:models:lock"),n(117).v4),a=n(20).standardize,i=n(104).timestampModel,s=n(83).blockModel,c=n(108).interblockModel,u=a({schema:{title:"Lock",description:"Locking of the persistence layer for execution to take place.",type:"object",required:["uuid","timestamp","expires","interblocks"],additionalProperties:!1,properties:{uuid:{type:"string",description:"uuidv4 identifying a lock on a chainId"},timestamp:i.schema,expires:{type:"integer",description:"ms until the lock expires",min:0},block:s.schema,interblocks:{type:"array",description:"Punched out blocks from other chains that have accumulated for this chain",uniqueItems:!0,items:c.schema}}},create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o();r(!e||s.isModel(e)),t=t.map(c.clone);var a=i.create(),l=2e3,p={uuid:n,timestamp:a,expires:l,interblocks:t};e&&(p.block=e);var d=u.clone(p);return d},logicize:function(e){var t=e.timestamp,n=e.expires;return{isLocked:function(){return!t.isExpired(n)},isMatch:function(t){return t.uuid===e.uuid}}}});e.exports={lockModel:u}},function(e,t,n){var r=n(8),o=(n(4),n(117).v4),a=n(20).standardize,i={id:"fd9e9077-cda5-4b1d-afbf-c8a7cf648ded",type:"internal",info:{}},s=a({schema:{title:"Socket",description:"Socket info, used to store info about block producers",type:"object",required:["id","type","info"],additionalProperties:!1,properties:{id:{type:"string"},type:{enum:["internal","websocket","https","email","udp"]},info:{type:"object"}}},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;return e=r({id:o(),type:"internal",info:{}},e),s.clone(r({},e))},logicize:function(e){return{getIsInternal:function(){return"internal"===e.type}}}});e.exports={socketModel:s}},function(e,t,n){var r=n(33),o=n(2),a=n(3),i=n(11)("interblock:consistency:db"),s=n(4),c=(n(24),n(111).ramDynamoDbFactory);e.exports={dbFactory:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c(),n=function(){var e=a(o.mark((function e(n,r){var a,i,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={TableName:n,Key:r,ConsistentRead:!0,ReturnConsumedCapacity:"TOTAL"},e.next=3,t.get(a).promise();case 3:return i=e.sent,i.ConsumedCapacity,s=i.Item,e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),u=function(e){return n("dbChains",e)},l=function(){var e=a(o.mark((function e(n,r){var a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(n),s(r),Array.isArray(r)||(r=[r]),a=r.map((function(e){var r={TableName:n,Item:e,ReturnConsumedCapacity:"TOTAL"};return t.put(r).promise()})),e.next=6,Promise.all(a);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),p=function(e){return l("dbPools",e)},d=function(e){return l("dbChains",e)},f=function(e){return l("dbSubscribers",e)},h=function(){var e=a(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l("dbSockets",t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=a(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l("dbCrypto",t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=a(o.mark((function e(n,r){var a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(Array.isArray(r)),a=r.map((function(e){var r={TableName:n,Key:e,ReturnConsumedCapacity:"TOTAL"};return t.delete(r).promise()})),e.next=4,Promise.all(a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),y=function(e){return g("dbSubscribers",e)},m=function(e){return g("dbPools",e)},k=function(){var e=a(o.mark((function e(n,r,a){var c,u,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={TableName:n,KeyConditionExpression:"chainId = :hkey",ExpressionAttributeValues:{":hkey":r},ScanIndexForward:!1,ConsistentRead:!0,ReturnConsumedCapacity:"TOTAL"},a&&(c.Limit=1),i("dbQuery: %O %O",n,r),e.next=5,t.query(c).promise();case 5:if(u=e.sent,u.ConsumedCapacity,l=u.Items,s(Array.isArray(l)),i("dbQuery items length: %O",l.length),!a){e.next=11;break}return e.abrupt("return",l[0]);case 11:return e.abrupt("return",l);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),b=function(e,t){return k("dbSubscribers",e,t)},x=function(e){return k("dbSockets",e)},w=function(e){return k("dbChains",e,!0)},M=function(e){return k("dbPools",e)},I=function(){var e=a(o.mark((function e(n){var a,i,c,u,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={TableName:n,ConsistentRead:!0,Limit:1},e.next=3,t.scan(a).promise();case 3:if(i=e.sent,i.ConsumedCapacity,c=i.Items,s(Array.isArray(c)),!c.length){e.next=10;break}return s.strictEqual(c.length,1),u=r(c,1),l=u[0],e.abrupt("return",l);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var t=a(o.mark((function t(){var n;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=2;break}return t.abrupt("return",e);case 2:return t.next=4,I("dbChains");case 4:return(n=t.sent)&&(e=n),t.abrupt("return",e);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),A=function(){var e=a(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",I("dbCrypto"));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{putPool:p,putBlock:d,putSubscriptions:f,putSocket:h,delSubscriptions:y,delPool:m,getBlock:u,queryAffected:b,querySockets:x,queryLatest:w,queryPool:M,scanBaseChainId:C,scanKeypair:A,putKeypair:v}}}},function(e,t,n){var r=n(33),o=n(2),a=n(3),i=n(4),s=n(11)("interblock:consistency:s3"),c=(n(24),n(21)),u=c.cryptoCacher,l=c.blockModel,p=c.interblockModel,d=n(158).ramS3Factory,f={fromInterblock:function(e){var t=e.getHash(),n=e.provenance.getAddress().getChainId(),r=e.provenance.height,o=e.getRemote(),a=o?o.address.getChainId():"#LINEAGE";return"".concat(n,"/").concat(r,"_").concat(a,"_").concat(t)},fromPoolItem:function(e){var t=e.chainId,n=e.originChainId_height_type,o=e.interblockHash,a=n.split("_"),i=r(a,3),s=i[0],c=i[1],u="light"===i[2]?"#LINEAGE":t;return"".concat(s,"/").concat(c,"_").concat(u,"_").concat(o)},fromBlock:function(e){var t=h(e);return f.fromBlockItem(t)},fromBlockItem:function(e){var t=e.chainId,n=e.height,r=e.blockHash;e.shortestLineage;return"".concat(t,"/").concat(n,"_").concat(r)}},h=function(e){return{chainId:e.provenance.getAddress().getChainId(),height:e.provenance.height,blockHash:e.getHash(),shortestLineage:e.provenance.lineage[0]}};e.exports={s3Factory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d(),t=new Map,n=function(){var n=a(o.mark((function n(r,a){var c,u,l;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return c=e._isRam?a:a.serialize(),u={Bucket:"wbinterbucket",Key:r,Body:c,ContentType:"application/json"},n.next=4,e.putObject(u).promise();case 4:l=n.sent,t.set(r,a),s("putInterblock: %O",r),i(l);case 8:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),r=function(){var n=a(o.mark((function n(r){var a,i,c,l,d;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a={Bucket:"wbinterbucket",Key:r},s("getInterblock"),!t.has(r)){n.next=5;break}return s("interblock cache hit for %o",r),n.abrupt("return",t.get(r));case 5:return n.prev=5,n.next=8,e.getObject(a).promise();case 8:if(i=n.sent,!p.isModel(i.Body)){n.next=13;break}return n.abrupt("return",i.Body);case 13:return c=i.Body.toString(),l=JSON.parse(c),n.next=17,u.cacheVerifyHash(l);case 17:return d=p.clone(c),s("s3GetInterblock complete"),n.abrupt("return",d);case 20:n.next=25;break;case 22:n.prev=22,n.t0=n.catch(5),s("error fetching: %O %O",r,n.t0.message);case 25:case"end":return n.stop()}}),n,null,[[5,22]])})));return function(e){return n.apply(this,arguments)}}(),c=function(){var n=a(o.mark((function n(r){var c;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i(Array.isArray(r)),s("deleteInterblocks: %O",r.length),c=r.map(function(){var n=a(o.mark((function n(r){var a;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a={Bucket:"wbinterbucket",Key:r},n.next=3,e.deleteObject(a).promise();case 3:t.delete(r);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),n.next=5,Promise.all(c);case 5:s("deleteInterblocks complete");case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),f=function(){var n=a(o.mark((function n(r,a){var c,u,p;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i(l.isModel(a)),c=e._isRam?a:a.serialize(),u={Bucket:"wbblockbucket",Key:r,Body:c,ContentType:"application/json"},n.next=5,e.putObject(u).promise();case 5:p=n.sent,t.set(r,a),s("putBlock: %O",r),i(p);case 9:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),h=function(){var n=a(o.mark((function n(r){var a,i,c,p,d;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a={Bucket:"wbblockbucket",Key:r},s("getBlock: %O",r),!t.has(r)){n.next=5;break}return s("block cache hit for: %o",r),n.abrupt("return",t.get(r));case 5:return n.next=7,e.getObject(a).promise();case 7:if(i=n.sent,!l.isModel(i.Body)){n.next=10;break}return n.abrupt("return",i.Body);case 10:return c=i.Body.toString(),p=JSON.parse(c),n.next=14,u.cacheVerifyHash(p);case 14:return d=l.clone(p),s("getBlock complete: %O",r),n.abrupt("return",d);case 17:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return{putInterblock:n,getInterblock:r,deleteInterblocks:c,putBlock:f,getBlock:h}},s3Keys:f}},,,,function(e,t,n){var r=n(19),o=n(4),a=n(240),i=n(242),s=n(82),c=n(481),u=n(482),l=n(21),p=l.interblockModel,d=(l.blockModel,l.addressModel,l.provenanceModel,i.gray("undefined")),f=new WeakMap,h=function(e){if(f.has(e))return f.get(e);var t=s(c(2*e.serialize().length),12);return f.set(e,t),t},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bgGreen",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white",r=" ".concat(a(s(e,9),9)," ");return i[n][t].bold(r)},g=function(e){return u(e,{truncate:!0,showHeaders:!1,minWidth:3,config:{msg:{minWidth:15,maxWidth:15},height:{minWidth:8,maxWidth:8},path:{minWidth:18,maxWidth:18}}})},y=function(e,t){var n=m(e),o=m(t),a=[].concat(r(n),r(o)),i=new Set(a),s=r(i);return s.sort((function(e,t){return e-t})),s},m=function(e){var t=[];return Object.keys(e).forEach((function(e){var n=parseInt(e);t.push(n)})),t.sort((function(e,t){return e-t})),t};e.exports={blockPrint:function(e,t,n,r){var o=v(e.provenance.getAddress().getChainId()),a=i.green(e.provenance.height),l=e.provenance.reflectIntegrity().hash,p=i.dim(v(l,"bgWhite","green")),f=h(e),g={msg:r?i.gray("NOCHANGE"):i.green("BLOCK"),height:a,path:t,chainId:o,hash:p,size:f};n&&(g.msg=i.red("NEW_CHAIN"));var m=[g],k=e.network.getAliases();!r&&k.forEach((function(t){var n=e.network[t],r=n.address,o="-",a=d,u=d,l=s(c(2*n.serialize().length),12);r.isResolved()&&(a=v(r.getChainId(),"bgMagenta","gray")),(r.isRoot()||r.isLoopback())&&(a=v(r.getChainId(),"bgBlack","gray"),u="");var p=n.getRemote();if(n.heavy){var f=n.heavy.provenance.reflectIntegrity().hash;u=i.dim(v(f,"bgWhite","magenta"));var g=n.lineageHeight,k=n.heavyHeight;o=i.magenta(k+"."+g)}var b={msg:i.magenta("  \u2514\u2500\u2500 channel"),height:o,path:i.gray(t),chainId:a,hash:u,size:l};m.push(b),y(n.requests,p.replies).forEach((function(e){var t=n.requests[e],r=p.replies[e],o=i.cyan("      \u2514\u2500\u2500 tx:"),a=t?t.type:d,s=i.gray(r?r.type:d),c={msg:o,height:i.cyan(e),path:"",chainId:a,hash:s,size:t?h(t):d};m.push(c)})),y(p.requests,n.replies).forEach((function(e){var t=p.requests[e],r=n.replies[e],o={msg:i.yellow("      \u2514\u2500\u2500 rx:"),height:i.yellow(e),path:"",chainId:i.gray(t?t.type:d),hash:r?r.type:d,size:r?h(r):d};m.push(o)}))}));return function(e){return u(e,{truncate:!0,showHeaders:!1,minWidth:3,config:{msg:{minWidth:15,maxWidth:15},height:{minWidth:8,maxWidth:8},path:{minWidth:18,maxWidth:18}}})}(m)},interPrint:function(e,t,n,r,a){o(p.isModel(e)),t=t||"INTERBLOCK",n=n||"(unknown)",r=r||"bgYellow",a=a||"yellow";var s=e.provenance,c=s.height,u=s.getAddress().getChainId(),l=v(u,r),f=s.reflectIntegrity().hash,y=i.dim(v(f,"bgWhite",a)),m=h(e),k=[{msg:t,height:c,path:n,chainId:l,hash:y,size:m}],b=e.getRemote();return b&&(t=i.magenta("  \u2514\u2500\u2500 channel"),c="-",n=i.gray(e.getOriginAlias()),m=h(b),k.push({msg:t,height:c,path:n,size:m}),t=i.cyan("      \u2514\u2500\u2500 tx:"),Object.keys(b.requests).forEach((function(e){c=e,l=b.requests[e].type,y=d,m=h(b.requests[e]),k.push({msg:t,height:c,chainId:l,hash:y,size:m})})),t=i.yellow("      \u2514\u2500\u2500 rx:"),Object.keys(b.replies).forEach((function(e){c=e,l=d,y=b.replies[e].type,m=h(b.replies[e]),k.push({msg:t,height:c,chainId:l,hash:y,size:m})}))),g(k)}}},,,,,,,,,,function(e,t,n){var r=n(2),o=n(3),a=n(4),i=(n(34).posix||n(34),n(22)("dos:commands:cd")),s=function(){var e=o(r.mark((function e(t){var n,o,s,c,u,l=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.spinner,o=t.blockchain,s=l.length>1&&void 0!==l[1]?l[1]:"~",a.equal(typeof s,"string"),i("cd: ".concat(s)),n.text="Resolving ".concat(s),e.next=7,o.cd(s);case 7:return c=o.getContext(),i("context: %O",c),u=c.wd,e.abrupt("return",{ctx:{wd:u}});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();e.exports=s,e.exports.help="\nNavigate through the filesystem graph using Posix compliant pathing.\nCan jump straight to an object by specifying a chainId.\n"},,,,function(e,t,n){(function(t){var r=n(2),o=n(3),a=n(40),i=n(22)("dos:print");e.exports=function(){var e=o(r.mark((function e(n){var o,s,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"string"!==typeof n){e.next=5;break}o={out:n},e.next=8;break;case 5:return e.next=7,n();case 7:o=e.sent;case 8:o&&o.out&&(s="[object String]"===Object.prototype.toString.call(o.out)?o.out:JSON.stringify(o.out,null,2),c=s.replace(/(?:\r\n|\r|\n)/g,"\r\n"),t.stdout.write(c),t.stdout.write("\r\n")),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),i(e.t0),t.stderr.writeln("".concat(a.red("\u2716")," ").concat(e.t0));case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}()}).call(this,n(10))},,,function(e,t,n){"use strict";(function(e){var r=n(119),o=n(4),a=n.n(o),i=n(5),s=n.n(i),c=n(71),u=n.n(c),l=n(261),p=n(264),d=n(265),f=(n(608),n(609).stdin),h=u()("terminal"),v=function(t){h("toStdStream");var n=function(){var t=e.stdin;f();var n=e.stdin;return Object.defineProperty(e,"stdin",{value:t,writable:!0}),n}();t.stdin=n,t.isTTY=!0;t.clearLine=function(){return t.write("\x1b[2K")},t.cursorTo=function(e,n){h("cursorTo: ",e,n),a.a.equal(e,0);t.write("\x1b[1000D")}},g="F1 F2 F3 F4 F5 F6 F7 F8 F9 F10 F11 F12".split(" ");t.a=function(t){var n=Object(i.useRef)();Object(i.useEffect)((function(){h("opening terminal");var t=new p.Terminal({cursorBlink:!0,cursorStyle:"underline",convertEol:!0,rendererType:"dom"}),r=new d.FitAddon;t.loadAddon(r),t.open(document.getElementById("xterm-container")),r.fit(),t.focus(),v(t),t.attachCustomKeyEventHandler((function(e){var t=e.key;e.type;if(g.includes(t))return h("ignoring: ".concat(t)),!1})),t.onKey((function(e){var n=e.key;e.domEvent;t.stdin.send(n)})),n.current=t,window.addEventListener("resize",(function(){return r.fit()})),e.stdout=t,e.stdin=t.stdin,e.stderr=t}),[]);var o=Object(l.a)();Object(r.a)(o,2)[1];return s.a.createElement("div",Object.assign({id:"xterm-container"},t))}}).call(this,n(10))},function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(2),o=n.n(r),a=n(262),i=n(119),s=n(4),c=n.n(s),u=n(5),l=n(118),p=n(71)("useBlockchain"),d=n(495),f=new Map,h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];c.a.equal(typeof e,"string"),"string"===typeof t&&(t=[t]),c()(Array.isArray(t));var n=Object(u.useState)(),r=Object(i.a)(n,2),s=r[0],h=r[1],v=Object(u.useRef)();Object(u.useEffect)((function(){return function(){var t=Object(a.a)(o.a.mark((function t(){var n,r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!v.current){t.next=2;break}return t.abrupt("return");case 2:return f.has(e)||(p("initializing blockchain: ".concat(e)),n=Object(l.effectorFactory)(),f.set(e,n),d([],{blockchain:n})),t.next=5,f.get(e);case 5:r=t.sent,v.current=r,h(r.getState()),r.subscribe((function(){h(r.getState())}));case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()(),function(){p("TODO shutting down shell")}}),[e]);var g=v.current;return[s,g]}},,,,,,function(e,t,n){e.exports=n(615)},,,,,function(e,t,n){},function(e,t,n){},,,,,,,,function(e,t,n){var r=n(169).effectorFactory,o=n(492).awsFactory,a=n(493).browserFactory;e.exports={effectorFactory:r,awsFactory:o,browserFactory:a}},function(e,t,n){(function(t){var r=n(2),o=n(8),a=n(3),i=n(4),s=n(11)("interblock:metrology"),c=n(24),u=n(170).standardEngineFactory,l=n(465).dispatchCovenantFactory,p=n(156).isolateFactory,d=n(50),f=d.consistencyFactory,h=d.ramDynamoDbFactory,v=d.ramS3Factory,g=d.s3Keys,y=n(466).createBase,m=n(467).createTap,k=n(68).actions,b=n(67).shell,x=n(21),w=x.blockModel,M=x.interblockModel,I=x.addressModel,C=0,A=function(){var e=a(r.mark((function e(n){var d,m,x,A,P,O,R,T,S,q,L,N,j,D,z=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=z.length>1&&void 0!==z[1]?z[1]:{},i.strictEqual(typeof d,"object"),n=n||"id-".concat(C++),m=s.extend("".concat(n)),x=u(),x.sqsTx,x.sqsRx,x.sqsTransmit,A=x.sqsPool,P=x.sqsIncrease,x.ioCrypto,O=x.ioIsolate,R=x.ioConsistency,x.ioPool,x.ioIncrease,T=function(){throw new Error("injector was not overridden")},d.hyper||(S=l(b.reducer),d=o({},d,{hyper:S})),T=d.hyper.injector,O.setProcessor(p(d)),q=h(),L=v(),R.setProcessor(f(q,L,n)),(N=E(x,n)).on(),e.next=17,y(R,A);case 17:return j=e.sent,D=function e(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";i(I.isModel(n));var s=function(e){var t=e.type,n=e.payload,r=e.to,a=void 0===r?o:r;m("dispatch to: %o type: %O",a,t);var i=T({type:t,payload:n,to:a});return P.push(j),i},u=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0,o=q._getTables(),a=o.dbChains,s=a[n.getChainId()]||{};if(void 0===r)e=c.last(Object.values(s));else{if(!s[r])throw new Error("out of bounds: ".concat(r," ").concat(s.length));e=s[r]}if(e){var u=g.fromBlockItem(e),l=L._getBuckets(),p=l.wbblockbucket,d=p[u];i(w.isModel(d));var f=d;return t.forEach((function(e){i(f[e],"No segment: ".concat(e)),f=f[e]})),f}},l=function(){return u(["state","xstate","context"])},p=new Set,d=new Set;R.subscribe(function(){var e=a(r.mark((function e(t,o){var a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("UNLOCK"!==t.type){e.next=5;break}return e.next=3,o;case 3:a=t.payload.block,d.has(a)||a.getChainId()!==n.getChainId()||(d.add(a),p.forEach((function(e){return e()})));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),t((function(){return p.forEach((function(e){return e()}))}));var f=function(e){return i.strictEqual(typeof e,"function"),p.add(e),function(){return p.delete(e)}},h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(k.spawn(e,t))},v=function(){var t=u(),n=t.network.getAliases(),r={};return n.forEach((function(n){var a=t.network[n];if("./"===a.systemRole){var i=a.address,s="."===o?n:o+"/"+n;r[n]=e(i,s)}})),r},y=function(){var e=u(),t=e.network.getAliases();return c.pick(e.network,t)},b=function(){return x},C=function(){return R.getProcessor().persistence},A=function(){return u().provenance.getAddress().getChainId()},E=function(){return u().provenance.height},O=function(){var e=q._getTables().dbPools[n.getChainId()],t=Object.values(e).map(g.fromPoolItem),r=L._getBuckets().wbinterbucket;return t.map((function(e){var t=r[e];return i(t),M.clone(t)}))},S=function(){var e=a(r.mark((function e(n){var o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=Object.values(x);case 1:if(!o.some((function(e){return e.length()||e.awaitingLength()}))){e.next=12;break}return a=o.map((function(e){return e.settle()})),e.next=5,Promise.all(a);case 5:return e.next=7,new Promise(t);case 7:if(!n){e.next=10;break}return e.next=10,n.settle();case 10:e.next=1;break;case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){return N.on()},z=function(){return N.off()};return{dispatch:s,subscribe:f,getState:u,getContext:l,getChildren:v,getChannels:y,getEngine:b,getPersistence:C,getChainId:A,getHeight:E,getPool:O,spawn:h,settle:S,enableLogging:D,disableLogging:z}},e.abrupt("return",D(j));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(e,t){var n=e.sqsPool,o=e.sqsTransmit,i=e.ioConsistency;debugPrefix=t?"interblock:metrology:".concat(t):"interblock:metrology";var s=m(debugPrefix);return n.subscribe(function(){var e=a(r.mark((function e(t,n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),o.subscribe(function(){var e=a(r.mark((function e(t,n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),i.subscribe(function(){var e=a(r.mark((function e(t,n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("UNLOCK"!==t.type){e.next=4;break}return e.next=3,n;case 3:s.block(t.payload.block);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),s};e.exports={metrologyFactory:A}}).call(this,n(54).setImmediate)},,,,,,,function(e,t,n){(function(t){var r=n(8),o=n(28),a=n(19),i=n(2),s=n(3),c=n(290),u=n(4),l=function(e,r){u(e&&"string"===typeof e);var l,d=n(11)("interblock:queue:"+e),f=!0,h=[],v=new Set,g=Number.MAX_SAFE_INTEGER,y=0,m=function(){var e=s(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.resolve();case 4:for(;f&&v.size<g&&h.length;)d("awaiting size: ".concat(v.size)),t=h.shift(),v.add(t),k(t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var n=s(i.mark((function n(r){var o,a,s,c;return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return u(r&&"object"===typeof r),o=r.action,a=r.resolve,s=r.reject,r.promise,u(a&&s),n.prev=3,n.next=6,l(o);case 6:c=n.sent,t(a,c),n.next=14;break;case 10:n.prev=10,n.t0=n.catch(3),d("".concat(e," rejected: %O %O"),r,n.t0),t(s,n.t0);case 14:m(),u(v.has(r)),v.delete(r);case 17:case"end":return n.stop()}}),n,null,[[3,10]])})));return function(e){return n.apply(this,arguments)}}(),b=new Set,x={name:e,settle:function(){var e=s(i.mark((function e(){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!v.size&&!h.length){e.next=11;break}if(!v.size){e.next=7;break}return n=a(v).map((function(e){return e.promise})),e.next=5,Promise.race(n);case 5:e.next=9;break;case 7:return e.next=9,new Promise(t);case 9:e.next=0;break;case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),length:function(){return h.length},awaitingLength:function(){return v.size},awaitNextPush:function(){var e=s(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var t=x.subscribe((function(n,r){t(),e(n)}))})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),subscribe:function(e){return u("function"===typeof e),b.add(e),function(){return b.delete(e)}},getProcessor:function(){return l},rejectAll:function(){x.setProcessor((function(e){throw new Error("Tried to process: ".concat(JSON.parse(e,null,2)))}))},setConcurrency:function(e){g=e,m()},push:function(){var e=s(i.mark((function e(t){var n,a,s,c;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d("push ".concat(t.type||r.schema.title)),p(r,t),a=new Promise((function(e,r){var o=y++;n={id:o,action:t,resolve:e,reject:r}})),n.promise=a,h.push(n),m(),s=o(b.values());try{for(s.s();!(c=s.n()).done;)(0,c.value)(t,a)}catch(i){s.e(i)}finally{s.f()}return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),setProcessor:function(e){u(!y||!l,"cannot switch after commencing"),u("function"===typeof e),l=e},halt:function(){var e=s(i.mark((function e(t){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("_isActive"),f=!1,e.next=3,new Promise((function(e){return setTimeout(e,t)}));case 3:n=new Error("Queue is halting operation"),v.values().forEach((function(e){return(0,e.reject)(n)})),v.clear();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};return x},p=function(e,t){e&&(u("function"===typeof e.isModel),u(e.isModel(t),"model is not addable"))};e.exports={ioQueueFactory:l,sqsQueueFactory:function(e,t){u(e&&"string"===typeof e);var o=n(11)("interblock:queue:sqs:"+e),a=l(e,t),c=a.push,d=function(e){a.push(e)};return r({},a,{push:function(){var n=s(i.mark((function n(r){return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o("push sqs ".concat(e)),p(t,r),n.next=4,d(r);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),pushDirect:c,setSqsProcessor:function(e){!a.getProcessor()||a.setProcessor(a.getProcessor()),d=e}})}}}).call(this,n(54).setImmediate)},,function(e,t,n){var r={"./aclModel":124,"./aclModel.js":124,"./actionModel":64,"./actionModel.js":64,"./addressModel":49,"./addressModel.js":49,"./binaryModel":147,"./binaryModel.js":147,"./blockModel":83,"./blockModel.js":83,"./channelModel":105,"./channelModel.js":105,"./configModel":153,"./configModel.js":153,"./continuationModel":86,"./continuationModel.js":86,"./covenantIdModel":149,"./covenantIdModel.js":149,"./dmzModel":101,"./dmzModel.js":101,"./integrityModel":38,"./integrityModel.js":38,"./interblockModel":108,"./interblockModel.js":108,"./keypairModel":66,"./keypairModel.js":66,"./lockModel":236,"./lockModel.js":236,"./networkModel":151,"./networkModel.js":151,"./proofModel":155,"./proofModel.js":155,"./provenanceModel":84,"./provenanceModel.js":84,"./publicKeyModel":85,"./publicKeyModel.js":85,"./remoteModel":107,"./remoteModel.js":107,"./signatureModel":148,"./signatureModel.js":148,"./stateModel":152,"./stateModel.js":152,"./timestampModel":104,"./timestampModel.js":104,"./validatorsModel":154,"./validatorsModel.js":154};function o(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=a,e.exports=o,o.id=291},,,,function(e,t,n){var r=n(8),o=n(4),a=(n(11)("interblock:models:modelInflator"),new(n(296))({allErrors:!0,verbose:!0})),i=n(128).registry,s=function(e,t){o("object"===e.type),o(e.patternProperties),o(!e.additionalProperties),o.strictEqual(Object.keys(e.patternProperties).length,1);var n=Object.keys(e.patternProperties)[0],r="[0-9]*"===n,a=e.patternProperties[n],s=i.get(a.title);o(s,"patternProperties must use models for values");var c={};return Object.keys(t).map((function(e){if(r){var n=parseInt(e);o(Number.isInteger(n),"".concat(e," is not number: ").concat(n))}c[e]=s.clone(t[e])})),c},c=function(e,t){o(Array.isArray(t)),o("array"===e.type),o(e.uniqueItems,"uniqueItems not set: ".concat(e.title));var n=i.get(e.items.title);return o(n,"Arrays must be models"),t.map(n.clone)},u=function(e,t){o(!e.additionalProperties);var n=Object.keys(t),r=Object.keys(e.properties),a=e.required.every((function(e){return n.includes(e)}));return o(a),o(n.every((function(e){return r.includes(e)}))),!0},l=new WeakMap,p=function(e,t){o(e,"No schema supplied");var n=l.get(e);if(!n)try{n=a.compile(e),l.set(e,n)}catch(c){var r="Compilation failed: ".concat(e&&e.title," ").concat(c.message);throw new Error(r)}var i=n(t),s=a.errorsText(n.errors);if(!i)throw new Error("".concat(e.title," failed validation: ").concat(s))};e.exports={modelInflator:function(e,t){if("State"===e.title){var n=t.actions;return n&&(o(Array.isArray(n)),o(n.every((function(e){return e.getAction||e.getContinuation})))),r({},t)}if(e.patternProperties)return s(e,t);o(u(e,t),"Keys do not match");var a={},l=e.properties;return Object.keys(t).map((function(e){var n=l[e],r=n.title,o=n.type,u=n.patternProperties,d=t[e];i.isRegistered(r)?a[e]=i.get(r).clone(d):"array"!==o?u?a[e]=s(l[e],d):(p(l[e],d),a[e]=d):a[e]=c(l[e],d)})),a}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){(function(t){var r=n(2),o=n(3),a=n(4),i=n(11)("interblock:crypto:sodium"),s=n(331),c=s.SodiumPlus,u=s.Ed25519PublicKey,l=s.Ed25519SecretKey,p=n(423),d=p.objectHash,f=p.generateNonce,h={publicKey:"I7xUkSwebpLEqGglyGfif/3FVb/71CRPF6Jqv//ull0=",secretKey:"MDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYjvFSRLB5uksSoaCXIZ+J//cVVv/vUJE8Xomq//+6WXQ=="};Object.freeze(h);var v,g=new Set(["".concat(h.publicKey,"_").concat(h.secretKey)]),y=function(){return v||(v=c.auto()),v},m=d("template"),k=function(){var e=o(r.mark((function e(){var t,n,o,s,c,u,l,p,d,f=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.length>0&&void 0!==f[0]?f[0]:"",e.next=3,y();case 3:for(n=e.sent,a.strictEqual(typeof t,"string"),a(t.length<=32,"seed too long: ".concat(t.length)),t.length&&i("INSECURE padding seed to 32 bytes - got ".concat(t.length));t.length&&t.length<32;)t+="_";if(t.length){e.next=12;break}return e.next=11,n.randombytes_buf(32);case 11:t=e.sent;case 12:return e.next=14,n.crypto_sign_seed_keypair(t);case 14:return o=e.sent,e.next=17,n.crypto_sign_secretkey(o);case 17:return s=e.sent,e.next=20,n.crypto_sign_publickey(o);case 20:return c=e.sent,u={publicKey:c.toString("base64"),secretKey:s.toString("base64")},l=u.publicKey,p=u.secretKey,d="".concat(l,"_").concat(p),g.add(d),e.abrupt("return",u);case 26:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=function(){var e=o(r.mark((function e(t){var n,o,i,s,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.publicKey,o=t.secretKey,a.strictEqual(typeof n,"string"),a.strictEqual(typeof o,"string"),i="".concat(n,"_").concat(o),e.prev=4,e.next=7,x(m,o);case 7:return s=e.sent,c=s.signature,e.next=11,w(m,c,n);case 11:e.sent&&g.add(i),e.next=17;break;case 15:e.prev=15,e.t0=e.catch(4);case 17:return e.abrupt("return",g.has(i));case 18:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=o(r.mark((function e(t,n){var o,i,s,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.strictEqual(t.length,m.length,"use objectHash()"),o=l.from(n,"base64"),e.next=4,y();case 4:return i=e.sent,e.next=7,i.crypto_sign_detached(t,o);case 7:return s=e.sent,c=s.toString("base64"),e.abrupt("return",{messageHash:t,signature:c});case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),w=function(){var e=o(r.mark((function e(n,o,a){var s,c,l,p,d;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.from(o,"base64"),c=u.from(a,"base64"),e.next=4,y();case 4:return l=e.sent,e.next=7,l.crypto_sign_verify_detached(n,c,s);case 7:return p=e.sent,d="".concat(n,"_").concat(o,"_").concat(a),p?g.add(d):i("verifyHash failed"),e.abrupt("return",p);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),M=function(){var e=o(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:return t=e.sent,e.abrupt("return",t.getBackendName());case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e.exports={objectHash:d,signHash:x,verifyHash:w,verifyHashSync:function(e,t,n){var r="".concat(e,"_").concat(t,"_").concat(n);return g.has(r)},generateKeyPair:k,verifyKeyPair:b,verifyKeyPairSync:function(e){var t=e.publicKey,n=e.secretKey;return g.has("".concat(t,"_").concat(n))},generateNonce:f,testMode:function(){i("no testmode in sodium")},_ciKeypair:h,_verifiedSet:g,_getBackend:M}}).call(this,n(7).Buffer)},,,,,,,,,,function(e,t){},,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){(function(t){var r=n(424)({coerce:!1}),o=n(427),a=n(82),i=n(429),s=0;e.exports={objectHash:function(e){if("undefined"===typeof t){var n=r.sort(e);return i(n,{algorithm:"sha256",encoding:"hex"})}return r.hash(e)},generateNonce:function(e){if(e){var t=a(9,s,"0");return s++,"0x".concat(t,"c6ee4f60107cc496d1dcacd642be4011c3b4fe09668f08f01f41cc9")}return"0x"+o(32,{type:"Array"}).map((function(e){return("0"+(255&e).toString(16)).slice(-2)})).join("")}}}).call(this,n(10))},,,,,function(e,t){},,,function(e,t,n){var r=n(8),o=n(2),a=n(65),i=n(3),s=n(11)("interblock:covenants:shell"),c=n(4),u=n(68),l=n(39),p=l.Machine,d=(l.assign,u.actions),f=d.spawn,h=d.connect,v=n(150),g=v.respond,y=(v.send,v.sendParent,v.invoke),m=v.translator,k=p({id:"shell",initial:"idle",context:{root:"/",wd:"~"},strict:!0,states:{idle:{on:{"@@INIT":"idle",PING:"ping",LOGIN:"login",ADD:"addActor",LS:"listActors",CD:"changeDirectory",RM:"removeActor",MV:"moveActor",LN:"linkActor",UP:"uplinkActor",CAT:"getState",DISPATCH:"dispatch",INSTALL:"install",LOGOUT:"logout",BAL:"balance"}},ping:{invoke:{src:"ping",onDone:"idle"},exit:"respondPing"},login:{invoke:{src:"login",onDone:"idle"}},addActor:{invoke:{src:"addActor",onError:"idle",onDone:"idle"},exit:"respondAddActor"},listActors:{invoke:{src:"listActors",onDone:"idle",onError:"idle"}},changeDirectory:{invoke:{src:"changeDirectory",onDone:"idle",onError:"idle"}},removeActor:{invoke:{src:"removeActor",onDone:"idle",onError:"idle"}},moveActor:{},linkActor:{},uplinkActor:{},getState:{},logout:{},balance:{},dispatch:{},install:{},done:{id:"done",data:"info about the files ?",type:"final"},error:{id:"error",type:"final"}}},{actions:{respondPing:function(e,t){return s("respondPing event: %O",t),g(t.data)},respondAddActor:function(e,t){return g(t.data.addActor)}},guards:{},services:{ping:function(){var e=i(o.mark((function e(t,n){var r,i,u,l,p,d;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s("ping: %O",n),r=n.type,i=n.payload,u=i.to,l=void 0===u?".":u,p=a(i,["to"]),c("PING"===r),"."!==l){e.next=7;break}return s("ping to self"),e.abrupt("return",{type:"PONG",payload:p});case 7:return e.next=9,y(r,{},l);case 9:return d=e.sent,s("ping result: %O",d),e.abrupt("return",d);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),login:function(){var e=i(o.mark((function e(t,n){var r,i,c,u,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s("login: %O",n.payload.terminal),r=n.payload,i=r.chainId,c=a(r,["chainId"]),u=h("terminal",i),e.next=5,y(u);case 5:return e.next=7,y("@@INTRO",c,"terminal");case 7:return l=e.sent,s("loginResult: %O",l),e.abrupt("return",{loginResult:l});case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),addActor:function(){var e=i(o.mark((function e(t,n){var r,a,i,u,l,p,d,h;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.strictEqual(typeof n.payload,"object"),r=n.payload,a=r.alias,i=r.spawnOptions,u=r.to,s("addActor",a,u),l=f(a,i),p=l.type,d=l.payload,e.next=6,y(p,d,u);case 6:return h=e.sent,e.abrupt("return",{addActor:h});case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),listActors:function(){var e=i(o.mark((function e(t,n){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),changeDirectory:function(){var e=i(o.mark((function e(t,n){var r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.payload.path,s("changeDirectory",r),c.strictEqual(typeof r,"string");case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),removeActor:function(){var e=i(o.mark((function e(t,n){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s("removeActor",n);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}}),b={ping:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".",t=arguments.length>1?arguments[1]:void 0;return{type:"PING",payload:r({},t,{to:e})}},login:function(e){return{type:"LOGIN",payload:e}},add:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";return{type:"ADD",payload:{alias:e,spawnOptions:t,to:n}}},ls:function(e){return{type:"LS",payload:{path:e}}},rm:function(e){return{type:"RM",payload:{path:e}}},cd:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".";return{type:"CD",payload:{path:e}}},up:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".",t=arguments.length>1?arguments[1]:void 0;return{type:"UP",payload:{path:e,remoteParent:t}}}},x=m(k);e.exports={actions:b,reducer:x}},function(e,t,n){var r=n(2),o=n(8),a=n(3),i=n(4),s=n(11)("interblock:dmzReducer"),c=(n(24),n(82)),u=n(21),l=u.addressModel,p=(u.stateModel,u.keypairModel,u.dmzModel),d=u.blockModel,f=u.interblockModel,h=u.channelModel,v=u.networkModel,g=u.rxRequestModel,y=u.rxReplyModel,m=n(69).channelProducer,k=n(102),b=k.promise,x=k.resolve,w=k.request,M=k.isReplyFor,I=(k.reject,function(){var e=a(r.mark((function e(t,n){var a,c,u,l,f,h,v,g,y,m,k,w,I,C;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s("reducer( ".concat(n.type," )")),i(p.isModel(t)),a=[],c=t.network,e.t0=n.type,e.next="@@SPAWN"===e.t0?7:"@@CONNECT"===e.t0?16:"@@GENESIS"===e.t0?18:"@@OPEN_CHILD"===e.t0?19:"@@INTRO"===e.t0?20:"@@ACCEPT"===e.t0?21:22;break;case 7:return e.next=9,E(t,n);case 9:return u=e.sent,l=u.nextNetwork,f=u.genesisRequest,c=l,a.push(f),a.push(b()),e.abrupt("break",23);case 16:return c=P(t.network,n),e.abrupt("break",23);case 18:case 19:case 20:case 21:case 22:return e.abrupt("break",23);case 23:if(!M(n)){e.next=35;break}h=n.request,e.t1=h.type,e.next="@@GENESIS"===e.t1?28:35;break;case 28:return v=h.payload,g=v.genesis,y=v.alias,m=v.originAction,k=d.clone(g),w={alias:y,chainId:k.getChainId()},I=x(m,w),s("reply received for @@GENESIS"),a.push(I),e.abrupt("break",35);case 35:return C=o({},t,{network:c,actions:a}),e.abrupt("return",C);case 37:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),C={},A={spawn:"@@SPAWN",connect:"@@CONNECT",intro:"@@INTRO",accept:"@@ACCEPT",genesis:"@@GENESIS",open:"@@OPEN_CHILD",listChildren:"@@LIST_CHILDREN"};C.spawn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:A.spawn,payload:{alias:e,spawnOpts:t}}};var E=function(){var e=a(r.mark((function e(t,n){var a,c,u,l,g,y,k,b,x;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n.payload,u=c.alias,l=c.spawnOpts,g=t.network,y=t.validators,k=p.create(o({},l,{validators:y})),e.next=5,d.create(k);case 5:return a=e.sent,b=v.clone(g,(function(e){s("spawn alias: ".concat(u)),u=u||O(g),i(!g[u],"childAlias exists: ".concat(u));var t=a.provenance.getAddress(),n=h.create(t,"./"),r=f.create(a);n=m.ingestInterblock(n,r),e[u]=n})),i(d.isModel(a),"Genesis block creation failed"),x=w("@@GENESIS",{genesis:a,alias:u,originAction:n},u),e.abrupt("return",{nextNetwork:b,genesisRequest:x});case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();C.connect=function(e,t){return{type:A.connect,payload:{alias:e,chainId:t}}};var P=function(e,t){return v.clone(e,(function(n){i(v.isModel(e));var r=l.create(t.payload.chainId);i.strictEqual(r.getChainId(),t.payload.chainId);var o=t.payload.alias;i(o&&"string"===typeof o);var a=e[o]||h.create(r);n[o]=m.setAddress(a,r)}))},O=function(e){var t=0;return e.getAliases().forEach((function(e){if(e.startsWith("file_"))try{var n=parseInt(e.substring("file_".length));t=n>t?n:t}catch(r){s("autoAlias error: ",r)}})),"file_"+c(5,t+1,"0")};e.exports={actions:C,reducer:I,isSystemRequest:function(e){i(g.isModel(e));var t=e&&Object.values(A).includes(e.type);return s("isSystemAction: ".concat(t&&e.type)),t},isSystemReply:function(e){i(y.isModel(e));var t=e&&"@@GENESIS"===e.request.type;return s("isSystemReply: ".concat(t&&e.type)),t}}},function(e,t,n){var r=n(19),o=n(8),a=n(4),i=n(11)("interblock:producers:network"),s=n(24),c=n(21),u=c.channelModel,l=c.continuationModel,p=c.actionModel,d=c.networkModel,f=c.stateModel,h=c.interblockModel,v=c.addressModel,g=c.rxRequestModel,y=c.txRequestModel,m=c.txReplyModel,k=c.configModel,b=n(229),x=k.create(),w=function(e,t,n){return d.clone(e,(function(r){a(g.isModel(t)),a(l.isModel(n));var o=t.getAddress(),i=e.getAlias(o),s=e[i];a(u.isModel(s)),a(s.address.equals(o)),a(s.rxRequest().equals(t));var c=t.getIndex();a(!s.replies[c]);var p=b.txReply(s,n);a(p.replies[c]),r[i]=p}))},M=function(e,t){return Array.isArray(e)||(e=[e]),e.map(t)};e.exports={ingestInterblocks:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x;return d.clone(e,(function(c){t=M(t,h.clone),a(k.isModel(n)),i("ingestInterblocks count: ".concat(t.length)),t.sort((function(e,t){return e.provenance.height-t.provenance.height}));var l={};t.forEach((function(t){var r=t.provenance.getAddress(),s=e.getAlias(r),d=n.isPublicChannelOpen;if(!s&&d&&t.isConnectionAttempt()){i("connection attempt accepted");var f="@@PUBLIC_".concat(r.getChainId()),h=u.create(r),v=p.create({type:"@@ACCEPT"}),g=u.clone(o({},h,{requests:{0:v}}));c[f]=g}if(s){var y=l[s]||e[s];if(a(u.isModel(y)),y=b.ingestInterblock(y,t),t.isConnectionResponse(),!y.heavy||y.equals(e[s]))return;l[s]=y}})),e.getAliases().forEach((function(t){var n=e[t];if(n&&n.address.isResolved()&&n.heavy){var i=l[t]||n,c=n.lineageTip.slice(0,-1),p=s.without.apply(s,[i.lineageTip].concat(r(c))),d=i.lineage.findIndex((function(e){return e.equals(i.heavy.provenance.reflectIntegrity())})),f=i.lineage.findIndex((function(e){return e.equals(p[0].provenance.reflectIntegrity())})),h=d<f?d:f;a(h>=0,"minIndex out of bounds");var v=i.lineage.slice(h);(i=u.clone(o({},i,{lineage:v,lineageTip:p}))).equals(n)||(l[t]=i)}})),Object.keys(l).forEach((function(e){return c[e]=l[e]}))}))},respondRejection:function(e,t,n){i("respondRejection %O",n);var r=l.create("@@REJECT",n);return w(e,t,r)},respondRequest:function(e,t){i("respondRequest request: %o",t.type);var n=l.create("@@RESOLVE");return w(e,t,n)},respondReply:function(e,t,n){return d.clone(e,(function(r){a(d.isModel(e)),a(v.isModel(t)),a(u.isModel(n));var o=e.getAlias(t);i("respondReply alias: ".concat(o));var s=e[o],c=b.shiftTxRequest(s,n);r[o]=c}))},tx:function(e,t){return d.clone(e,(function(n){a(d.isModel(e)),a(f.isModel(t));var r=t.getRequests(),o=t.getReplies();i("tx requests: ".concat(r.length," replies: ").concat(o.length));var s={};r.forEach((function(t){a(y.isModel(t));var n=t.to,r=s[n]||e[n];if(!r){var o=v.create();r=u.create(o,"DOWN_LINK"),i("channel created with systemRole: ".concat("DOWN_LINK"))}s[n]=b.txRequest(r,t.getAction())})),o.forEach((function(t){a(m.isModel(t));var n=t.getAddress(),r=t.getIndex(),o=e.getAlias(n);if(o){var c=s[o]||e[o],u=t.getContinuation();s[o]=b.txReply(c,u,r)}else i("No alias found for: %O",t)})),Object.keys(s).forEach((function(e){return n[e]=s[e]}))}))}}},function(e,t,n){var r=n(8),o=n(2),a=n(3),i=n(4),s=n(21),c=s.dmzModel,u=s.keypairModel,l=s.provenanceModel,p=s.blockModel,d=s.integrityModel,f=function(){var e=a(o.mark((function e(t){var n;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.create("CI"),i(d.isModel(t)),e.abrupt("return",n.sign(t));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=a(o.mark((function e(t,n){var a,s,u,h,v,g,y,m,k,b=arguments;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=b.length>2&&void 0!==b[2]?b[2]:f,i(c.isModel(t)),i(p.isModel(n)),i(!t.equals(n.getDmz())),i("function"===typeof a),s=t.network.isNewChannels(n.network),u={},h=0===n.provenance.height,s&&!h&&(v=d.create(),g=n.provenance.getAddress().getChainId(),y=d.clone(r({},v,{hash:g})),u[0]=y),e.next=11,l.create(t,n.provenance,u,a);case 11:return m=e.sent,k=p.clone(r({},t,{provenance:m})),i(n.isNext(k)),e.abrupt("return",k);case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();e.exports={generateNext:h}},function(e,t,n){var r=n(4),o=n(21),a=o.lockModel,i=o.blockModel;e.exports={reconcile:function(e,t){return a.clone(e,(function(n){r(i.isModel(t)),r(a.isModel(e)),n.block=t;var o=e.interblocks.filter((function(e){var n=t.network.includesInterblock(e),r=t.network.getAlias(e.provenance.getAddress());return!n&&r}));n.interblocks=o}))}}},function(e,t,n){var r=n(228),o=n(59),a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"@@RESOLVE",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;switch(e){case"@@PROMISE":if(Object.keys(t).length)throw new Error("Promise payload must be empty");if(n)throw new Error("can only promise to the current request - leave blank");break;case"@@RESOLVE":case"@@REJECT":break;default:throw new Error("Disallowed type: ".concat(e))}if("object"!==typeof t)throw new Error("payload must be object: ".concat(t));c(t);var r={type:e,payload:t,request:n};return r},i=["@@PROMISE","@@RESOLVE","@@REJECT"],s=function(e){return!e||!e.type||!i.includes(e.type)},c=function(e){r(e).forEach((function(e){if("undefined"===typeof e)throw new Error("Values cannot be undefined: ".concat(this.path))}))};e.exports={request:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PING",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if("object"===typeof e&&(t=e.payload||{},n=e.to||".",e=e.type),"string"!==typeof e)throw new Error('"type" must be a string: '.concat(e));if("string"!==typeof n)throw new Error('"to" must be a string: '.concat(n));if("object"!==typeof t)throw new Error('"payload" must be an object: '.concat(t));c(t);var r={type:e,payload:t,to:n};return r},promise:function(){return a("@@PROMISE")},resolve:function(e,t){return a("@@RESOLVE",t,e)},reject:function(e,t){return a("@@RESOLVE",e,t)},isReplyFor:function(e,t){if(t&&"object"!==typeof t)return!1;if(s(e))return!1;if(!t)return!0;var n=t.type,r=t.payload,a=e&&e.request;return a&&a.type===n&&o(a.payload,r)}}},function(e,t,n){(function(t){var r=n(65),o=n(19),a=n(8),i=n(2),s=n(3),c=n(4),u=n(11)("interblock:xstate:translator"),l=(n(24),n(59)),p=n(39).State,d=n(102),f=d.request,h=d.promise,v=d.resolve,g=(d.reject,d.isReplyFor),y=function(){var e,t=function(){var t=s(i.mark((function t(n,r,o){var a;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=f(n,r,o),u("invoke: %O",a.type),c("function"===typeof e,"_callback not set"),t.abrupt("return",e(a));case 4:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}();return t._hook=function(t){c(!e,"attempt to overwrite hook"),e=t},t._clearHook=function(){c(e,"attempt to remove empty hook"),e=void 0},t}(),m=function(e,t){return e.some((function(e){var n=e.request;return l(n,t)}))},k=function(){var e=s(i.mark((function e(n,r,o){var l,p,d,f,h,v,g,m,k,x,w,M,I,C;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u("exhaust requestId: ".concat(o)),l=r.context,p=r.event,d=r.src,f=r.accumulator,h=n.options.services[d],c("function"===typeof h),v=0,y._hook(function(){var e=s(i.mark((function e(t){var n,r,s,l;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u("reExecute hook invoked"),!(v<f.length)){e.next=6;break}return n=f[v],v++,u("prior resolve returned"),e.abrupt("return",n);case 6:return u("making new response with id: ".concat(o)),c("undefined"===typeof t.payload.requestId),r=a({},t.payload,{requestId:o}),s=a({},t,{payload:r}),g(s),l=new Promise((function(){})),e.abrupt("return",l);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m=b("invoke",function(){var e=s(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Promise((function(e,t){u("setting exhaustedTrigger"),g=function(t){u("exhaustedTrigger pulled: %O",t),e(t)}})),e.abrupt("return",t);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()),k=b("service",h(l,p)),x=b("reaper",new Promise(t)),w=[m,k,x],e.next=13,Promise.race(w);case 13:M=e.sent,y._clearHook(),I=M.name,C=M.response,e.t0=I,e.next="invoke"===e.t0?19:"service"===e.t0?21:"reaper"===e.t0?23:24;break;case 19:return u("invoke completed first"),e.abrupt("return",a({},r,{response:C}));case 21:return u("service completed first"),e.abrupt("return",a({},r,{response:C,done:!0}));case 23:throw new Error("Neither service nor invoke completed in time");case 24:throw new Error("Unreachable");case 25:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),b=function(){var e=s(i.mark((function e(t,n){var r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n;case 2:return"string"===typeof(r=e.sent)&&(r={type:r}),e.abrupt("return",{name:t,response:r});case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),x=function(e,t){if(e&&e.message&&e.stack){u("error detected %O",e);var n=e,r=n.message,o=n.stack;e=a({},e,{stack:o,message:r})}return{type:"done.invoke."+t,data:e}},w=function(e){c(Array.isArray(e))},M=function(e,t){switch(e.type){case"@@SEND":return void u("send: %O",e);case"@@SEND_PARENT":return void u("sendParent: %O",e);case"@@RESPOND":var n=v(t,e.data);return u("respond: ",n),n;default:if(e.type.startsWith("done.invoke.")){var r=a({},e,{payload:e.data});return delete r.data,r}return e}},I=function(e,t){if(!e.nextEvents.includes(t.type)){var n=t&&t.type,r=e&&e.value;throw new Error("State: ".concat(r," does not accept event type: ").concat(n))}};e.exports={respond:function(e){return"string"===typeof e&&(e={type:e}),{type:"@@RESPOND",data:e}},send:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";return{type:"@@SEND",payload:e,path:t}},sendParent:function(e){return{type:"@@SEND_PARENT",payload:e,path:".."}},invoke:y,translator:function(e){var t={xstate:e.initialState,promises:[],requestId:0,originAction:null};return s(i.mark((function n(){var l,d,f,y,b,C,A,E,P,O,R,T,S,q,L,N,j,D,z,B,K,F,_,G,H=arguments;return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l=H.length>0&&void 0!==H[0]?H[0]:t,d=H.length>1?H[1]:void 0,c(!l.actions,"Actions key disallowed in state"),"@@PIERCE"!==d.type){n.next=9;break}if(l.xstate){n.next=8;break}d="@@INIT",n.next=9;break;case 8:return n.abrupt("return",l);case 9:if("string"===typeof d&&(d={type:d}),d.type.startsWith("done.invoke.")&&delete(d=a({},d,{data:d.payload})).payload,u("translator reducer action: %O",d),l=l.xstate?l:t,y=(f=l).xstate,b=f.promises,C=f.requestId,A=f.originAction,c(!y.actions||!y.actions.length,"uncleared xstate"),!g(d)){n.next=36;break}if(u("reply received: ".concat(d.type)),E=b.find((function(e){var t=e.response;return t&&g(d,t)}))){n.next=21;break}return u("No promise found for action ".concat(d.type)),n.abrupt("return",l);case 21:return(P=o(E.accumulator)).push(d.payload),O=a({},E,{accumulator:P}),n.next=26,k(e,O,C++);case 26:if(R=n.sent,b=b.filter((function(e){return e!==E})),R.done){n.next=31;break}return b.push(R),n.abrupt("return",a({},l,{promises:b,requestId:C,actions:[R.response]}));case 31:c(!b.length),u("transforming into doneInvoke: %O",d.type),d=x(R.response,R.src),n.next=37;break;case 36:A||"@@INIT"===d.type||(u("setting originAction: %O",d.type),A=d);case 37:return u("previous machine state: ",y.value),T=p.create(y),S=e.resolveState(T),I(S,d),q=e.transition(S,d),u("next machine state: ",q.value),L=q.toJSON(),N=L.actions,j=r(L,["actions"]),D=JSON.parse(JSON.stringify(j)),z=D.context,B=D.event,w(N),K=[],F=N.some((function(e){return"@@RESPOND"===e.type})),_=N.some((function(e){return"xstate.start"===e.type})),!F&&_&&A===d&&K.push(h()),G=N.map(function(){var t=s(i.mark((function t(n){var r,a,s,l,p,d,f,h,v,g,y,m;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=n.type,t.next="xstate.start"===t.t0?3:"xstate.stop"===t.t0?15:17;break;case 3:return u("invoke called"),r=n.activity,c(r&&"xstate.invoke"===r.type),a=r.src,s={context:z,event:B,src:a,accumulator:[],done:!1},t.next=10,k(e,s,C++);case 10:return l=t.sent,p=l.response,u("invoke result: ",p&&p.type),l.done?(d=l.response,f=l.src,u("tracker done immediately after starting"),h=x(d,f),v=M(h),K.push(v)):(b=[].concat(o(b),[l]),K.push(l.response)),t.abrupt("break",20);case 15:return u("end of invoke"),t.abrupt("break",20);case 17:return u("default: %O",n),n.exec?(g=n.exec(z,B),u("execResult %O",g),y=M(g,A),u("mapped %O",y),K.push(y)):(u("standard action ? %O",n),m=M(n,A),K.push(m)),t.abrupt("break",20);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),n.next=55,Promise.all(G);case 55:return K.length||"@@INIT"===d.type||(K.push(v(A)),A=null),m(K,A)&&(A=null),u("shell actions length: ",K),n.abrupt("return",{actions:K,xstate:D,promises:b,requestId:C,originAction:A});case 59:case"end":return n.stop()}}),n)})))}}}).call(this,n(54).setImmediate)},function(e,t,n){var r=n(8),o=n(2),a=n(3),i=n(11)("interblock:covenants:net"),s=(n(4),n(68)),c=n(39),u=c.Machine,l=(c.assign,s.actions),p=l.spawn,d=(l.connect,n(21)),f=d.socketModel,h=d.covenantIdModel,v=n(150),g=(v.respond,v.send,v.sendParent,v.invoke),y=v.translator,m=u({id:"net",initial:"idle",context:{},strict:!0,states:{idle:{on:{"@@INIT":"idle",ADD:"addTransport",RM:"rmTransport",PING:"ping",PING_LAMBDA:"pingLambda",VERSION:"version"}},addTransport:{invoke:{src:"addTransport",onDone:"idle"}},rmTransport:{invoke:{src:"addTransport",onDone:"idle"}},ping:{invoke:{src:"addTransport",onDone:"idle"}},pingLambda:{invoke:{src:"addTransport",onDone:"idle"}},version:{invoke:{src:"addTransport",onDone:"idle"}},done:{id:"done",type:"final"},error:{id:"error",type:"final"}}},{actions:{},guards:{},services:{addTransport:function(){var e=a(o.mark((function e(t,n){var r,a,s,c,u,l,d;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i("event: %o",n.payload),r=n.payload,a=r.name,s=r.type,c=r.url,u=h.create("socket"),l={type:s,url:c},d={isPierced:!0},e.next=7,g(p(a,{covenantId:u,state:l,config:d}));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),rmTransport:function(){var e=a(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}}),k={add:function(e){return{type:"ADD",payload:{name:e.name,type:e.type,url:e.url}}},rm:function(e){},ping:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".",t=arguments.length>1?arguments[1]:void 0;return{type:"PING",payload:r({},t,{to:e})}},pingLambda:function(){},version:function(){}},b={add:{type:"object",description:"Add a new transport.  Will result in a child of this chain.",required:["url"],properties:{url:{type:"url"},type:f.schema.properties.type,name:{type:"string"}}},rm:{description:"Removes a transport.  Gracefully attempts to close the connection.\n        Force will terminate immediately by deleting the chain"},ping:{description:"Ping the transport, or the function.  Pings to chain are handled by the chain directly"}},x=y(m);e.exports={actions:k,schemas:b,reducer:x}},function(e,t,n){var r=n(65),o=n(2),a=n(3),i=n(11)("interblock:covenants:net"),s=n(4),c=n(68),u=n(39),l=u.Machine,p=(u.assign,c.actions),d=p.spawn,f=p.connect,h=n(21).socketModel,v=n(150),g=(v.respond,v.send,v.sendParent,v.invoke),y=(0,v.translator)(l({id:"net",initial:"idle",context:{},strict:!0,states:{idle:{on:{"@@INIT":"idle",ADD:"addChainId",RM:"rmTransport",PING:"ping",PING_LAMBDA:"pingLambda",VERSION:"version"}},addChainId:{invoke:{src:"addChainId",onDone:"idle"}},rmTransport:{invoke:{src:"addTransport",onDone:"idle"}},ping:{invoke:{src:"addTransport",onDone:"idle"}},pingLambda:{invoke:{src:"addTransport",onDone:"idle"}},version:{invoke:{src:"addTransport",onDone:"idle"}},done:{id:"done",type:"final"},error:{id:"error",type:"final"}}},{actions:{},guards:{},services:{addChainId:function(){var e=a(o.mark((function e(t,n){var r,a,c,u,l,p,d;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.strictEqual(typeof socketInfo,"object"),s.strictEqual(typeof chainId,"string"),s.strictEqual(typeof socketInfo.url,"string"),r=socketInfo,a=r.url,c=tcpTransportFactory(a),e.next=7,c.connect();case 7:return i("connected to %o",a),e.next=10,c.pingLambda();case 10:return u=e.sent,i("latency of %o ms to %o ",u,a),l=addressModel.create(chainId),p=h.create({type:"awsApiGw",info:socketInfo}),d={type:"PUT_SOCKET",payload:{address:l,socket:p}},e.next=17,ioConsistency.push(d);case 17:return e.abrupt("return",u);case 18:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),rmTransport:function(){var e=a(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ping:function(){var e=a(o.mark((function e(t,n){var a,c,u,l,p;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i("ping: %O",n),a=n.type,c=n.payload,u=c.to,l=r(c,["to"]),s("PING"===a),"."!==u){e.next=7;break}return i("ping to self"),e.abrupt("return",{type:"PONG",payload:l});case 7:return e.next=9,g(a,{},u);case 9:return p=e.sent,i("ping result: %O",p),e.abrupt("return",p);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),login:function(){var e=a(o.mark((function e(t,n){var a,s,c,u,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i("login: %O",n.payload.terminal),a=n.payload,s=a.chainId,c=r(a,["chainId"]),u=f("terminal",s),e.next=5,g(u);case 5:return e.next=7,g("@@INTRO",c,"terminal");case 7:return l=e.sent,i("loginResult: %O",l),e.abrupt("return",{loginResult:l});case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),addActor:function(){var e=a(o.mark((function e(t,n){var r,a,c,u,l,p,f,h;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.strictEqual(typeof n.payload,"object"),r=n.payload,a=r.alias,c=r.spawnOptions,u=r.to,i("addActor",a,u),l=d(a,c),p=l.type,f=l.payload,e.next=6,g(p,f,u);case 6:return h=e.sent,e.abrupt("return",{addActor:h});case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),listActors:function(){var e=a(o.mark((function e(t,n){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),changeDirectory:function(){var e=a(o.mark((function e(t,n){var r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.payload.path,i("changeDirectory",r),s.strictEqual(typeof r,"string");case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),removeActor:function(){var e=a(o.mark((function e(t,n){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i("removeActor",n);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}}));e.exports={actions:{addChainId:function(e){return{type:"ADD",payload:{chainId:e}}},connect:function(){},disconnect:function(){},ping:function(){},pingLambda:function(){},version:function(){},rmChainId:function(){}},schemas:{ping:{description:"Ping the transport, or the function.  Pings to chain are handled by the chain directly"}},reducer:y}},function(e,t,n){var r=n(2),o=n(8),a=n(3),i=n(11)("interblock:covenants:hyper"),s=n(102),c=s.resolve,u=(s.request,n(68).actions,{}),l={reducer:function(){var e=a(r.mark((function e(){var t,n,a,s,l=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=l.length>0&&void 0!==l[0]?l[0]:u,n=l.length>1?l[1]:void 0,i("hyper action: ",n.type),a=[],e.t0=n.type,e.next="PING"===e.t0?7:10;break;case 7:return s=c(n,{type:"PONG"}),a.push(s),e.abrupt("break",10);case 10:return e.abrupt("return",o({},t,{actions:a}));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),actions:{}};e.exports=o({},l)},function(e,t,n){var r=n(442).txModel,o=n(237).socketModel;e.exports={socketModel:o,txModel:r}},function(e,t,n){var r=n(4),o=n(20).standardize,a=n(108).interblockModel,i=n(237).socketModel,s=o({schema:{title:"Tx",description:"An interblock plus socket info, used for transmission functions",type:"object",required:["socket","interblock"],additionalProperties:!1,properties:{socket:i.schema,interblock:a.schema}},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.create(),t=arguments.length>1?arguments[1]:void 0;return r(i.isModel(e)),r(a.isModel(t)),s.clone({socket:e,interblock:t})},logicize:function(e){return{}}});e.exports={txModel:s}},function(e,t,n){var r=n(2),o=n(3),a=n(55),i=function(){var e=o(r.mark((function e(t){var n,i,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("object"===typeof t){e.next=2;break}return e.abrupt("return");case 2:if(n=t,t.interblock&&(n=t.interblock),n.provenance&&n.provenance.signatures){e.next=6;break}return e.abrupt("return");case 6:if(i=n.provenance.signatures,Array.isArray(i)){e.next=9;break}return e.abrupt("return");case 9:return c=i.map(function(){var e=o(r.mark((function e(t){var n,o,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.publicKey,o=t.integrity,i=t.seal,a.verifyKeyPairSync(o.hash,i,n.key)){e.next=3;break}return e.abrupt("return",a.verifyHash(o.hash,i,n.key));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=12,Promise.all(c);case 12:if(!n.network||!n.network["."]){e.next=15;break}return e.next=15,s(n.network);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s=function(){var e=o(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object.values(t).map(function(){var e=o(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(t.heavy);case 2:return n=t.lineageTip.map(i),e.next=5,Promise.all(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=3,Promise.all(n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=o(r.mark((function e(t){var n,o,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.publicKey.key,o=t.secretKey,i={publicKey:n,secretKey:o},a.verifyKeyPairSync(i)){e.next=6;break}return e.next=6,a.verifyKeyPair(i);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();e.exports={cacheVerifyHash:i,cacheVerifyKeypair:c}},function(e,t,n){(function(t){var r=n(2),o=n(3),a=n(39),i=a.Machine,s=a.assign;t.Machine=i,t.assign=s;var c=n(4),u=n(172).ioQueueFactory,l=n(21),p=l.interblockModel,d=l.addressModel,f=l.txModel,h=n(109).thread,v=n(156).isolateFactory,g=n(110).cryptoFactory,y=n(50).consistencyFactory,m=n(453).increasorConfig,k=n(459).poolConfig,b=n(461).receiveConfig,x=n(463).transmitConfig;e.exports={fsmFactory:function(){var e=u("ioIsolate"),t=u("ioCrypto"),n=u("ioConsistency"),a=u("ioPool",p),i=u("ioIncrease",d),s=u("ioReceive",f),l=u("ioTransmit",p);e.setProcessor(v()),t.setProcessor(g()),n.setProcessor(y());var w=k(t,n);a.setProcessor(function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(p.isModel(t)),n={type:"POOL_INTERBLOCK",payload:t},e.next=4,h(n,w);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var M=m(t,n,e);i.setProcessor(function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(d.isModel(t)),n={type:"INCREASE_CHAIN",payload:t},e.next=4,h(n,M);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var I=b(n);s.setProcessor(function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(f.isModel(t)),n={type:"RECEIVE_INTERBLOCK",payload:t},e.next=4,h(n,I);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var C=x(n);return l.setProcessor(function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(p.isModel(t)),n={type:"TRANSMIT_INTERBLOCK",payload:t},e.next=4,h(n,C);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),{ioIsolate:e,ioCrypto:t,ioConsistency:n,ioPool:a,ioIncrease:i,ioReceive:s,ioTransmit:l}}}}).call(this,n(31))},function(e,t,n){var r=n(117).v4,o=n(82),a=n(11),i=0;e.exports={machineLogger:function(e,t){var n=r(),s=Date.now(),c=a("interblock:machines:".concat(o(t,11)));c("INVOCATION: ".concat(t," -> ").concat(e));var u=[],l=!1,p={},d=function(){for(var e=Date.now();p[e];)e++;return p[e]=!0,e},f=function(e){i++,c("TRANSITION: ".concat(o(3,i)," %O"),e)},h=function(e){c("TERMINATOR: ".concat(e.machine," -> ").concat(e.type," execution ended after ").concat(e.elapsedTime,"ms"))};return{writeTransition:function(e,t,n){var r=d();r;var o=e;if(u.push(o),l)return f(o);l=!0},writeTermination:function(r){var o=d();return h({invocation:n,timestamp:o,type:e,machine:t,elapsedTime:o-s,state:"TERMINATION",event:u})}}}}},function(e,t,n){var r=n(19),o=n(2),a=n(3),i=n(8),s=n(4),c=n(24),u=n(21),l=u.addressModel,p=u.integrityModel,d=u.provenanceModel,f=u.lockModel,h=u.blockModel,v=u.socketModel,g=u.interblockModel,y=n(11)("interblock:services:consistency"),m=function(e){var t=p.create(),n=p.clone(i({},t,{hash:e})),r=l.create(n);return s.strictEqual(r.getChainId(),e),r},k=function(e){return{chainId:e.provenance.getAddress().getChainId(),height:e.provenance.height,blockHash:e.getHash(),shortestLineage:e.provenance.lineage[0]}},b=function(e){return function(t){return x(t,e)}},x=function(e,t){var n=t.getChainId(),r=e.getRemote()?"heavy":"light",o=e.provenance.getAddress().getChainId(),a=e.provenance.height;return{chainId:n,originChainId_height_type:"".concat(o,"_").concat(a,"_").concat(r),interblockHash:e.getHash(),isDeleted:!1}},w=function(e){return function(t){var n=t.getChainId(),r=e.provenance.getAddress().getChainId(),o=e.network.getAlias(t),a=e.network[o];return s(a),{chainId:n,targetChainId:r,heavyHeight:a.heavyHeight,lineageHeight:a.lineageHeight,height:e.provenance.height}}},M=n(447).lockFactory,I=n(238).dbFactory,C=n(239),A=C.s3Factory,E=C.s3Keys,P=n(111).ramDynamoDbFactory,O=n(158).ramS3Factory;e.exports={consistencySourceFactory:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"CI";e=e||P(),t=t||O();var u=M(e),p=I(e),C=A(t),R=new Map,T=function(){var e=a(o.mark((function e(t){var n,r,a,i,c,u,d,f,h;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.affectedAddresses,r=t.interblock,s(n.every(l.isModel)),s(g.isModel(r)),y("poolInterblocks for ".concat(n.length," addresses")),c=r.getWithoutRemote(),u=n.map((function(e){var t=c;return e.equals(r.getTargetAddress())?(i=!0,t=r):a=!0,x(t,e)})),y("poolItems count: %O",u.length),d=[],a&&(f=E.fromInterblock(c),d.push(C.putInterblock(f,c))),i&&(h=E.fromInterblock(r),d.push(C.putInterblock(h,r))),e.next=12,p.putPool(u);case 12:return e.next=14,Promise.all(d);case 14:y("poolInterblock complete for: ".concat(n.length," addresses"));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=a(o.mark((function e(t,r){var i,d,h,v,m,k,b,x,w,M;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(l.isModel(t)),i=t.getChainId(),e.next=4,u.tryAcquire(i,n,r);case 4:if(d=e.sent){e.next=8;break}return y("lockChain could not lock ".concat(i)),e.abrupt("return");case 8:return y("locked chain: ".concat(i," with: ").concat(d)),h=H({address:t}),e.next=12,p.queryPool(i);case 12:return v=e.sent,m=v.filter((function(e){return!e.isDeleted})),y("pool total: ".concat(v.length," valid: ").concat(m.length)),k=m.map(function(){var e=a(o.mark((function e(t){var n,r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=E.fromPoolItem(t),e.next=3,C.getInterblock(n);case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return");case 6:return s(g.isModel(r)),s.strictEqual(t.interblockHash,r.getHash()),e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=18,Promise.all(k);case 18:return b=e.sent,x=c.compact(b),y("interblocks fetched: ".concat(x.length)),e.next=23,h;case 23:return w=e.sent,y("block height: %O",w&&w.provenance.height),y("interblock count: %O",x.length),M=f.create(w,x,d),s(!R.has(i)),R.set(i,M),y("lock complete: %O",M.uuid),e.abrupt("return",M);case 31:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),q=function(){var e=a(o.mark((function e(t){var n,r,a,i,c,l,d,h,v;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y("putUnlockChain"),s(f.isModel(t)),s(t.block,"cannot unlock without a block"),n=t.block.provenance.getAddress(),r=n.getChainId(),e.next=7,u.isValid(r,t.uuid);case 7:if(e.sent){e.next=11;break}return y("unlock rejected for ".concat(r)),e.abrupt("return");case 11:if(a=R.get(r),i=t.block,!(c=a.block)||c.isNext(i)){e.next=19;break}y("block is not next %O",i.provenance.height),y("no change: ",c.equals(i)),e.next=30;break;case 19:if(c||i.provenance.address.isGenesis()){e.next=23;break}y("next was not genesis: %O",i.height),e.next=30;break;case 23:return l=E.fromBlock(i),e.next=26,C.putBlock(l,i);case 26:return d=k(i),e.next=29,p.putBlock(d);case 29:y("block added");case 30:return h=L(i,c),v=N(a,t),e.next=34,Promise.all([h,v]);case 34:return R.delete(r),e.next=37,u.release(r,t.uuid);case 37:y("putUnlockChain complete");case 38:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=a(o.mark((function e(t,n){var r,a,i,c,u,l,d,f;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(h.isModel(t)),s(!n||h.isModel(n)),r=n?n.network.getAliases():[],a=r.filter((function(e){return n.network[e].address.isResolved()})),i=t.network.getAliases().filter((function(e){return t.network[e].address.isResolved()})),c=i.filter((function(e){return!a.includes(e)})).map((function(e){return t.network[e].address})),u=a.filter((function(e){return!i.includes(e)})).map((function(e){return t.network[e].address})),l=c.map((function(e){return e.getChainId()})),y("_updateRouteTable newAddresses",l),d=c.map(w(t)),f=u.map(w(t)),e.next=13,Promise.all([p.putSubscriptions(d),p.delSubscriptions(f)]);case 13:y("updateRouteTable complete");case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),N=function(){var e=a(o.mark((function e(t,n){var r,a,u,l,d,f,h,v;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(n.block),r=t.interblocks,a=n.interblocks,s(r.length>=a.length),u=c.difference(r,a),l=n.block.provenance.getAddress(),d=u.map(b(l)).map((function(e){return i({},e,{isDeleted:!0})})),e.next=9,p.putPool(d);case 9:return y("_purgePool isDeleted marked"),e.next=12,j(u);case 12:return f=e.sent,y("_purgePool _findOrphans found: ".concat(f.length)),h=f.map(E.fromInterblock),e.next=17,C.deleteInterblocks(h);case 17:return v=d.map((function(e){return{chainId:e.chainId,originChainId_height_type:e.originChainId_height_type}})),e.next=20,p.delPool(v);case 20:y("_purgePool complete");case 21:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),j=function(){var e=a(o.mark((function e(t){var n,i,s,u;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.filter((function(e){return e.getRemote()})),i=t.filter((function(e){return!e.getRemote()})),s=i.map(function(){var e=a(o.mark((function e(t){var n;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(t);case 2:return n=e.sent,e.abrupt("return",!n&&t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.t0=c,e.next=6,Promise.all(s);case 6:return e.t1=e.sent,u=e.t0.compact.call(e.t0,e.t1),e.abrupt("return",[].concat(r(u),r(n)));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=a(o.mark((function e(t){var n,r,a,i,c,u,l,p,f;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.provenance,r=t.height,y("getLineage from height: ",a=void 0===r?0:r),s(d.isModel(n)),s(Number.isInteger(a)&&a>=0),s(a<n.height),i=n.getAddress(),c=[],l=n;case 8:return u=l.getShortestHeight(),e.next=11,H({address:i,height:u});case 11:p=e.sent,s(h.isModel(p)),c.push(p),l=p.provenance;case 15:if(u>a){e.next=8;break}case 16:return f=c.map((function(e){return g.create(e)})),e.abrupt("return",f);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=a(o.mark((function e(t){var n,r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(g.isModel(t)),n=t.provenance.getAddress().getChainId(),!0,e.next=5,p.queryAffected(n,!0);case 5:return r=e.sent,e.abrupt("return",!!r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=a(o.mark((function e(t){var n,a,i,c,u,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(g.isModel(t)),n=t.provenance.getAddress().getChainId(),a=t.provenance.height,e.next=5,p.queryAffected(n);case 5:return i=e.sent,c=i.filter((function(e){var t=e.targetChainId,n=e.heavyHeight,r=e.lineageHeight;return t.startsWith(t)?n<a:r<a})),u=c.map((function(e){var t=e.targetChainId;return m(t)})),l=new Set(u),y("dbQueryAffected items length: %O",l.size),e.abrupt("return",r(l));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),K=function(){var e=a(o.mark((function e(t){var n,r,a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(l.isModel(t)),n=t.getChainId(),y("getSockets for: %O",n),e.next=5,p.querySockets(n);case 5:return r=e.sent,s(Array.isArray(r)),s(r.every((function(e){return"object"===typeof e}))),a=r.map((function(e){var t=e.socketJson;return s(t),v.clone(t)})),y("getSockets length: ".concat(a.length)),e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=a(o.mark((function e(t){var n,r,a,i,c,u,d;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.address,r=t.socket,y("putSocket"),s(l.isModel(n)),s(v.isModel(r)),a=n.getChainId(),i=r.id,c=parseInt(Date.now()/1e3),u=r.serialize(),d={chainId:a,socketId:i,updatedTime:c,socketJson:u},e.next=11,p.putSocket(d);case 11:y("putSocket complete");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=a(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s(v.isModel(t)),y("delSocket %o",t.id);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),G=function(e){return p.queryLatest(e.getChainId())},H=function(){var e=a(o.mark((function e(t){var n,r,a,i,c,u;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.address,r=t.height,y("getBlock",n&&n.getChainId(),r),n){e.next=5;break}return s(!r),e.abrupt("return",U());case 5:if(s(l.isModel(n)),a=n.getChainId(),Number.isInteger(r)){e.next=13;break}return e.next=10,p.queryLatest(a);case 10:i=e.sent,e.next=16;break;case 13:return e.next=15,p.getBlock({chainId:a,height:r});case 15:i=e.sent;case 16:if(i){e.next=18;break}return e.abrupt("return");case 18:return Number.isInteger(r)||(r=i.height),c=E.fromBlockItem(i),y("s3.getBlock(s3Key)",c),e.next=23,C.getBlock(c);case 23:return u=e.sent,s(h.isModel(u)),s(n.equals(u.provenance.getAddress())),s.strictEqual(u.getHash(),i.blockHash),s.strictEqual(u.provenance.height,r),y("getBlock complete"),e.abrupt("return",u);case 30:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=a(o.mark((function e(){var t,n;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y("getBaseAddress"),e.next=3,p.scanBaseChainId();case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return");case 6:return s(t.chainId),n=l.create(t.chainId),s.strictEqual(t.chainId,n.getChainId()),y("getBaseAddress: ".concat(n.getChainId())),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{putSocket:F,getSockets:K,delSocket:_,putPoolInterblock:T,putLockChain:S,putUnlockChain:q,getLineage:D,getIsAnyAffected:z,getAffected:B,getIsPresent:G,getBlock:H}}}},function(e,t,n){var r=n(2),o=n(3),a=n(448),i=n(52).promisify,s=n(111).ramDynamoDbFactory,c=0,u=1;e.exports={lockFactory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s(),t=n(11)("interblock:aws:lock:id-".concat(c++)),l=new Map,p=function(){var n=o(r.mark((function n(s,c,p){var d,f,v,g,y,m,k,b,x,w,M,I;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t("attempting to lock %o %o %o",s.substring(0,16),c,p),!l.has(s)){n.next=4;break}return t("already locked to this thread: ".concat(s)),n.abrupt("return");case 4:if(!e._getTables){n.next=9;break}return d="ramLockId-"+u++,f={uuid:d,tryRelease:function(){t("ram tryRelease for uuid: %o and chainId: %o",d,s)}},l.set(s,f),n.abrupt("return",d);case 9:return l.set(s,"acquisition in progress"),v=new a.FailOpen({dynamodb:e,lockTable:"dbLocks",partitionKey:"chainId",leaseDurationMs:p||12e3,retryCount:0,owner:c,trustLocalTime:!0}),n.prev=11,n.next=14,h("dbLocks",{chainId:s});case 14:if(!(g=n.sent)||1===g.leaseDurationMs){n.next=23;break}if(y=g.lockAcquiredTimeUnixMs,m=g.leaseDurationMs,2e3,Date.now()-y>m+2e3){n.next=23;break}return t("lock not available ".concat(s)),n.abrupt("return");case 23:return k=i(v.acquireLock).bind(v),n.next=26,k(s);case 26:return b=n.sent,x=b.fencingToken,t("locked ".concat(s," with fencing token: ").concat(x)),w=function(){var e=o(r.mark((function e(){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=i(b.release).bind(b),e.next=4,n();case 4:t("released lock for ".concat(s)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t("failed to release lock for ".concat(s," ").concat(e.t0.message));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),M=b._guid.toString("base64"),I={uuid:M,tryRelease:w},l.set(s,I),t("lock complete"),n.abrupt("return",M);case 37:return n.prev=37,n.t0=n.catch(11),t("failed to lock: ".concat(s," %O"),n.t0),"string"===typeof l.get(s)&&l.delete(s),n.abrupt("return");case 43:case"end":return n.stop()}}),n,null,[[11,37]])})));return function(e,t,r){return n.apply(this,arguments)}}(),d=function(){var e=o(r.mark((function e(n,o){var a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve();case 2:if(l.has(n)){e.next=5;break}return t("unknown lock for ".concat(n)),e.abrupt("return",!1);case 5:return a=l.get(n),e.abrupt("return",a.uuid===o);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),f=function(){var e=o(r.mark((function e(t,n){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((o=l.get(t)).uuid!==n){e.next=6;break}return e.next=4,o.tryRelease();case 4:return l.delete(t),e.abrupt("return");case 6:throw new Error("invalid lock: ".concat(t," ").concat(n));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),h=function(){var t=o(r.mark((function t(n,o){var a,i,s;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={TableName:n,Key:o,ConsistentRead:!0,ReturnConsumedCapacity:"TOTAL"},t.next=3,e.get(a).promise();case 3:return i=t.sent,i.ConsumedCapacity,s=i.Item,t.abrupt("return",s);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return{tryAcquire:p,isValid:d,release:f}}}},,,,,function(e,t,n){var r=n(2),o=n(3);e.exports={toFunctions:function(e){return{putSocket:function(t){return e.push({type:"PUT_SOCKET",payload:t})},getSockets:function(t){return e.push({type:"GET_SOCKETS",payload:t})},delSocket:function(t){return e.push({type:"DEL_SOCKET",payload:t})},putPoolInterblock:function(t){return e.push({type:"POOL",payload:t})},putLockChain:function(t){return e.push({type:"LOCK",payload:t})},putUnlockChain:function(t){return e.push({type:"UNLOCK",payload:t})},getLineage:function(t){return e.push({type:"LINEAGE",payload:t})},getIsAnyAffected:function(t){return e.push({type:"ANY_AFFECTED",payload:t})},getAffected:function(t){return e.push({type:"AFFECTED",payload:t})},getIsPresent:function(t){return e.push({type:"IS_PRESENT",payload:t})},getBlock:function(t){return e.push({type:"GET_BLOCK",payload:t})}}},fromFunctions:function(e){return function(){var t=o(r.mark((function t(n){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=n.type,t.next="PUT_SOCKET"===t.t0?3:"GET_SOCKETS"===t.t0?4:"DEL_SOCKET"===t.t0?5:"POOL"===t.t0?6:"LOCK"===t.t0?7:"UNLOCK"===t.t0?8:"LINEAGE"===t.t0?9:"ANY_AFFECTED"===t.t0?10:"AFFECTED"===t.t0?11:"IS_PRESENT"===t.t0?12:"GET_BLOCK"===t.t0?13:14;break;case 3:return t.abrupt("return",e.putSocket(n.payload));case 4:return t.abrupt("return",e.getSockets(n.payload));case 5:return t.abrupt("return",e.delSocket(n.payload));case 6:return t.abrupt("return",e.putPoolInterblock(n.payload));case 7:return t.abrupt("return",e.putLockChain(n.payload));case 8:return t.abrupt("return",e.putUnlockChain(n.payload));case 9:return t.abrupt("return",e.getLineage(n.payload));case 10:return t.abrupt("return",e.getIsAnyAffected(n.payload));case 11:return t.abrupt("return",e.getAffected(n.payload));case 12:return t.abrupt("return",e.getIsPresent(n.payload));case 13:return t.abrupt("return",e.getBlock(n.payload));case 14:throw new Error("Unknown action type: ".concat(n&&n.type));case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}}},function(e,t,n){var r=n(2),o=n(3),a=n(4),i=n(11)("interblock:config:increasor"),s=(n(24),n(39).assign),c=n(21),u=c.lockModel,l=c.addressModel,p=c.dmzModel,d=c.blockModel,f=c.interblockModel,h=c.networkModel,v=n(69),g=v.blockProducer,y=v.lockProducer,m=(v.networkProducer,g.generateNext),k=n(109).thread,b=n(454).machine,x=n(50),w=n(110),M=n(455).isolatorConfig;e.exports={increasorConfig:function(e,t,n){var c=x.toFunctions(t),v=w.toFunctions(e);return b.withConfig({actions:{assignLock:s({lock:function(e,t){i("assignLock");var n=t.data;return a(u.isModel(n)),n}}),assignNextDmz:s({nextDmz:function(e,t){var n=t.data;return a(p.isModel(n)),n}}),assignBlock:s({block:function(e,t){var n=t.data;return a(d.isModel(n)),n}}),reconcileLock:s({nextLock:function(e){var t=e.lock,n=e.block;a(u.isModel(t)),a(d.isModel(n)),i("reconcileLock");var r=y.reconcile(t,n);return r}}),repeatLock:s({nextLock:function(e){return e.lock}}),assignTxInterblocks:s({txInterblocks:function(e){var t=e.block,n=e.lock;i("txInterblocks");var r=n.block;a(d.isModel(t)),a(d.isModel(r)),a(!t.provenance.address.isGenesis());var o=r.network;2===t.provenance.height&&!t.network[".."].address.isRoot()&&(o=h.create());var s=t.network.txInterblockAliases(o).map((function(e){return f.create(t,e)}));return i("txInterblocks raw length: ".concat(s.length)),s.push(f.create(t)),s}}),unassignTxInterblocks:s({txInterblocks:void 0})},guards:{isLockAcquired:function(e,t){var n=!1,r=t.data;return r&&(a(u.isModel(r)),n=r.block,!r.block&&i("WARNING missing chain locked")),i("isLockAcquired: ",!!n),n},isProposer:function(){return!0},isValidator:function(){return!1},isIsolationComplete:function(e){var t=!!e.nextDmz;return i("isIsolationComplete: ".concat(t)),t},isDmzChanged:function(e){var t=e.lock,n=e.nextDmz;a(u.isModel(t)),a(p.isModel(n)),a(t.block);var r=t.block.network,o=n.network.txInterblockAliases(r).length;return i("isDmzChanged: ".concat(o)),o},isNewBlock:function(e){var t=e.block,n=t&&d.isModel(t);return i("isNewBlock: ".concat(n)),n}},services:{lockChain:function(){var e=o(r.mark((function e(t,n){var o,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.payload,i("lockChain ".concat(o.getChainId())),a(l.isModel(o)),e.next=5,c.putLockChain(o);case 5:return s=e.sent,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),isolate:function(){var e=o(r.mark((function e(t){var o,i,s,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.lock,i={type:"EXECUTE_COVENANT",payload:{lock:o}},s=M(n),e.next=5,k(i,s);case 5:return c=e.sent,a(p.isModel(c)),e.abrupt("return",c);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),signBlock:function(){var e=o(r.mark((function e(t){var n,o,i,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.lock,o=t.nextDmz,a(p.isModel(o)),a(u.isModel(n)),i=n.block,a(i),e.next=7,m(o,i,v.sign);case 7:return s=e.sent,e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),unlockChain:function(){var e=o(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.nextLock,a(u.isModel(n)),i("unlockChain"),e.next=5,c.putUnlockChain(n);case 5:return e.abrupt("return");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}})}}},function(e,t,n){var r={id:"increasor",initial:"idle",context:{lock:void 0,nextLock:void 0,block:void 0,nextDmz:void 0,txInterblocks:[]},strict:!0,states:{idle:{on:{INCREASE_CHAIN:"lockChain"}},lockChain:{invoke:{src:"lockChain",onDone:[{target:"execute",cond:"isLockAcquired",actions:"assignLock"},{target:"done",actions:"unassignTxInterblocks"}],onError:"error"}},execute:{initial:"branch",states:{branch:{always:[{target:"proposeNext",cond:"isProposer"},{target:"validateNext",cond:"isValidator"},{target:"#done"}]},proposeNext:{initial:"branch",states:{branch:{always:[{target:"isDmzChanged",cond:"isIsolationComplete"},{target:"#increasor.isolate"}]},isDmzChanged:{always:[{target:"signBlock",cond:"isDmzChanged"},{target:"#increasor.unlockChain"}]},signBlock:{invoke:{src:"signBlock",onDone:{target:"#increasor.unlockChain",actions:"assignBlock"},onError:"#error"}}}},validateNext:{always:[{target:".signBlock",cond:"isIsolationComplete"},{target:"#increasor.isolate",cond:"isIsolationRequired"}],initial:"signBlock",states:{signBlock:{}}},history:{type:"history"}}},isolate:{invoke:{src:"isolate",onDone:{target:"#increasor.execute.history",actions:"assignNextDmz"},onError:"error"}},unlockChain:{initial:"isNewBlock",states:{isNewBlock:{always:[{target:"unlockChain",cond:"isNewBlock",actions:"reconcileLock"},{target:"unlockChain",actions:"repeatLock"}]},unlockChain:{invoke:{src:"unlockChain",onDone:"done"}},done:{type:"final"}},onDone:[{target:"done",cond:"isNewBlock",actions:"assignTxInterblocks"},{target:"done"}]},done:{id:"done",data:function(e){return e.txInterblocks},type:"final"},error:{id:"error",type:"final"}}},o=Machine(r);e.exports={definition:r,machine:o}},function(e,t,n){var r=n(2),o=n(3),a=n(8),i=n(4),s=n(11)("interblock:config:isolator"),c=n(39).assign,u=n(21),l=u.rxRequestModel,p=u.dmzModel,d=u.lockModel,f=n(69).networkProducer,h=n(109).thread,v=n(456).interpreterConfig,g=n(458).machine,y=n(156),m=g.withConfig({actions:{assignLock:c({lock:function(e,t){var n=t.payload.lock;return i(d.isModel(n)),i(n.block,"can only isolate for existing chains"),n}}),primeDmz:c({dmz:function(e){var t=e.lock;i(d.isModel(t));var n=t.block,r=t.interblocks,o=n.getDmz(),s=f.ingestInterblocks(o.network,r,o.config);return p.clone(a({},o,{network:s}))}}),assignContainerId:c({containerId:function(e,t){var n=t.data.containerId;return i(n),n}}),updateDmz:c({dmz:function(e,t){s("updateDmz");var n=t.data.nextDmz;return i(p.isModel(n)),n}}),assignHasPierced:c({hasPierced:function(){return!0}})},guards:{isDmzChangeable:function(e){var t=e.dmz;i(p.isModel(t));var n=t.config.isPierced,r=t.network.rx(),o=n||r;return s("isDmzChangeable: ".concat(o)),o},isPiercable:function(e){var t=e.dmz,n=e.hasPierced;i(p.isModel(t));var r=!t.network.rx(),o=t.config.isPierced,a=r&&o&&!n;return s("isPiercable: %O",a),a},isExhausted:function(e){var t=e.dmz;i(p.isModel(t));var n=!t.network.rx();return s("isExhausted: ".concat(n)),n}},services:{loadCovenant:function(){var e=o(r.mark((function e(t){var n,o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.lock,o=t.isolation,i(d.isModel(n)),e.next=4,o.loadCovenant(n.block);case 4:return a=e.sent,s("loadCovenant containerId: ".concat(a.substring(0,9))),e.abrupt("return",{containerId:a});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),reduceActionless:function(){var e=o(r.mark((function e(t){var n,o,a,c,u,l,d,f;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dmz,o=t.containerId,a=t.isolation,s("reduceActionless"),i(p.isModel(n)),c=n.network["."].address,u=b(c),l=k(o,a.tick),d=v(l,n,u,c),e.next=9,h("TICK",d);case 9:return f=e.sent,i(p.isModel(f)),e.abrupt("return",{nextDmz:f});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),reduce:function(){var e=o(r.mark((function e(t){var n,o,a,c,u,l,d,f,g,y,m;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dmz,o=t.containerId,a=t.isolation,i(p.isModel(n)),i(n.network.rx()),c=n.network.rx(),u=c.event,l=c.channel,d=l.getNextReplyIndex(),s("reduce: ",u.type,d),f=l.address,i(!f.isUnknown()),g=k(o,a.tick),y=v(g,n,u,f),e.next=12,h("TICK",y);case 12:return m=e.sent,i(p.isModel(m)),e.abrupt("return",{nextDmz:m});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),unloadCovenant:function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.containerId,o=t.isolation,s("unloadCovenant containerId: %o",n.substring(0,9)),e.next=4,o.unloadCovenant(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}),k=function(e,t){return function(n,r){return t({containerId:e,state:n,action:r})}},b=function(e){return l.create("@@PIERCE",{timestamp:Date.now()},e,0)};e.exports={isolatorConfig:function(e){var t=y.toFunctions(e);return m.withContext({isolation:t})}}},function(e,t,n){var r=n(2),o=n(3),a=n(8),i=n(4),s=n(11)("interblock:config:interpreter"),c=n(21),u=c.rxReplyModel,l=c.rxRequestModel,p=c.addressModel,d=c.stateModel,f=c.dmzModel,h=c.channelModel,v=n(69).networkProducer,g=n(68),y=n(457).machine,m=n(39).assign,k=y.withConfig({actions:{assignRejection:m({reduceRejection:function(e,t){return t.data}}),assignResolve:m({reduceResolve:function(e,t){return t.data}}),assignOriginalLoopback:m({originalLoopback:function(e){return e.dmz.network["."]}}),mergeSystem:m({dmz:function(e){var t=e.reduceResolve;s("mergeSystem"),i(d.isModel(t));var n=f.clone(t.getState()),r=v.tx(n.network,t);return f.clone(a({},n,{network:r}))}}),mergeCovenant:m({dmz:function(e){var t=e.dmz,n=e.reduceResolve;i(d.isModel(n)),i(f.isModel(t));var r=n.getRequests().length,o=n.getReplies().length;s("mergeCovenant requests: %o replies %o",r,o);var c=v.tx(t.network,n),u=n.getState();return f.clone(a({},t,{state:u,network:c}))}}),respondReply:m({dmz:function(e){var t=e.dmz,n=e.address,r=e.originalLoopback;i(f.isModel(t)),i(h.isModel(r)),i(p.isModel(n)),s("respondReply");var o=v.respondReply(t.network,n,r);return f.clone(a({},t,{network:o}))}}),respondRejection:m({dmz:function(e){var t=e.dmz,n=e.anvil,r=e.reduceRejection;i("@@REJECT"===n.type),i(f.isModel(t));var o=v.respondRejection(t.network,n,r);return f.clone(a({},t,{network:o}))}}),respondRequest:m({dmz:function(e){var t=e.dmz,n=e.address,r=e.anvil;s("respondRequest"),i(f.isModel(t)),i(l.isModel(r)),i(r.getAddress().equals(n));var o=v.respondRequest(t.network,r);return f.clone(a({},t,{network:o}))}}),loadSelfAnvil:m({anvil:function(e){var t=e.dmz.network.rxSelf();return s("loadSelfAnvil anvil: %o",t.type),t},address:function(e){var t=e.dmz.network["."].address;return i(t,"Self not found"),s("loadSelfAnvil selfAddress: %o",t.getChainId()),t}})},guards:{isSystem:function(e){var t=e.anvil,n=e.address;if("@@PIERCE"===t.type)return!1;if(i(p.isModel(n)),i(l.isModel(t)||u.isModel(t)),t.isReply()){var r=g.isSystemReply(t);return s("isSystem: ".concat(r)),r}var o=g.isSystemRequest(t);return s("isSystem: ".concat(o)),o},isChannelUnavailable:function(e){var t=e.anvil,n=e.dmz,r=e.address;if("@@PIERCE"===t.type)return s("isChannelUnavailable: ",!0),!0;i(p.isModel(r),"If Anvil, then address required"),i(!r.isUnknown(),"Address unknown");var o=n.network.getAlias(r);return s("isChannelUnavailable: ",!o),!o},isReply:function(e){var t=e.anvil;i(t);var n=t.isReply();return s("isReply: %O",n),n&&i(u.isModel(t)),n},isRejection:function(e){var t=e.reduceRejection;return s("isRejection ".concat(!!t)),t&&s(t.message),t},isResponseDone:function(e){var t=e.dmz,n=e.anvil,r=e.address;i(f.isModel(t)),i(l.isModel(n)),i(n.getAddress().equals(r));var o=n.getIndex(),a=t.network.isResponseDone(r,o);return s("isResponseDone: ".concat(!!a," anvil: %o"),n.type),a},isSelfExhausted:function(e){var t=!e.dmz.network.rxSelf();return s("isSelfExhausted: ".concat(t)),t}},services:{reduceCovenant:function(){var e=o(r.mark((function e(t){var n,o,a,c,u,l;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dmz,o=t.anvil,a=t.isolatedTick,s("reduceCovenant anvil: %o",o.type),i(o),c=n.state.getState(),e.next=6,a(c,o);case 6:return u=e.sent,i(u,"Covenant returned: ".concat(u)),l=d.create(u,o),e.abrupt("return",l);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),reduceSystem:function(){var e=o(r.mark((function e(t){var n,o,a,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dmz,o=t.anvil,s("reduceSystem anvil: %o",o.type),i(o),e.next=5,g.reducer(n,o);case 5:return a=e.sent,i(a,"System returned: ".concat(a)),c=d.create(a,o),i(f.clone(c.getState()),"Uncloneable dmz"),e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}});e.exports={interpreterConfig:function(e,t,n,r){return i("function"===typeof e),i(f.isModel(t)),i(p.isModel(r)),i(l.isModel(n)||u.isModel(n)),l.isModel(n)&&i(n.getAddress().equals(r)),s("interpreterConfig: %o from chainId: %o",n.type,r.getChainId()),k.withContext({dmz:t,anvil:n,address:r,isolatedTick:e})}}},function(e,t,n){var r={id:"interpreter",initial:"idle",context:{anvil:void 0,address:void 0,dmz:void 0,reduceRejection:void 0,reduceResolve:void 0,originalLoopback:void 0},strict:!0,states:{idle:{on:{TICK:"reduce"}},done:{id:"done",data:function(e){return e.dmz},type:"final"},reduce:{initial:"isSystem",states:{isSystem:{always:[{target:"reduceSystem",cond:"isSystem"},{target:"reduceCovenant"}]},reduceSystem:{invoke:{src:"reduceSystem",onDone:"done",onError:"error"}},reduceCovenant:{invoke:{src:"reduceCovenant",onDone:"done",onError:"error"}},error:{type:"final",entry:"assignRejection"},done:{type:"final",entry:"assignResolve"}},onDone:{target:"merge"}},merge:{initial:"isRejection",states:{isRejection:{entry:"assignOriginalLoopback",always:[{target:"done",cond:"isRejection"},{target:"mergeSystem",cond:"isSystem"},{target:"mergeCovenant"}]},mergeSystem:{entry:"mergeSystem",type:"final"},mergeCovenant:{entry:"mergeCovenant",type:"final"},done:{type:"final"}},onDone:"respond"},respond:{initial:"isReply",states:{isReply:{always:[{target:"done",cond:"isChannelUnavailable"},{target:"respondReply",cond:"isReply"},{target:"respondRejection",cond:"isRejection"},{target:"done",cond:"isResponseDone"},{target:"respondRequest"}]},respondReply:{entry:"respondReply",type:"final"},respondRejection:{entry:"respondRejection",type:"final"},respondRequest:{entry:"respondRequest",type:"final"},done:{type:"final"}},onDone:[{target:"done",cond:"isSelfExhausted"},{target:"reduce",actions:"loadSelfAnvil"}]}}},o=Machine(r);e.exports={definition:r,machine:o}},function(e,t,n){var r={id:"isolator",initial:"idle",context:{lock:void 0,dmz:void 0,isolation:function(){return"isolation function"},hasPierced:!1},strict:!0,states:{idle:{on:{EXECUTE_COVENANT:{target:"isDmzChangeable",actions:["assignLock","primeDmz"]}}},isDmzChangeable:{always:[{target:"loadCovenant",cond:"isDmzChangeable"},{target:"done"}]},loadCovenant:{invoke:{src:"loadCovenant",onDone:{target:"isExhausted",actions:"assignContainerId"},onError:"error"}},isExhausted:{always:[{target:"reduceActionless",cond:"isPiercable"},{target:"unloadCovenant",cond:"isExhausted"},{target:"reduce"}]},reduce:{invoke:{src:"reduce",onDone:{target:"isExhausted",actions:"updateDmz"},onError:"error"}},reduceActionless:{invoke:{src:"reduceActionless",onDone:{target:"isExhausted",actions:["updateDmz","assignHasPierced"]},onError:"error"}},unloadCovenant:{invoke:{src:"unloadCovenant",onDone:"done",onError:"error"}},done:{data:function(e){return e.dmz},type:"final"},error:{type:"final"}}},o=Machine(r);e.exports={definition:r,machine:o}},function(e,t,n){var r=n(2),o=n(3),a=n(19),i=n(8),s=n(4),c=n(11)("interblock:config:pool"),u=(n(24),n(39).assign),l=n(460).machine,p=n(21),d=p.channelModel,f=p.networkModel,h=p.blockModel,v=p.lockModel,g=p.interblockModel,y=p.addressModel,m=p.dmzModel,k=p.covenantIdModel,b=p.publicKeyModel,x=(p.provenanceModel,n(69)),w=x.blockProducer,M=x.lockProducer,I=x.channelProducer,C=x.networkProducer,A=w.generateNext,E=n(50),P=n(110);e.exports={poolConfig:function(e,t){var n=E.toFunctions(t),p=P.toFunctions(e);return l.withConfig({actions:{assignInterblock:u({interblock:function(e,t){var n=t.payload;return s(g.isModel(n)),n}}),assignLock:u({lock:function(e,t){return s(v.isModel(t.data)),t.data}}),assignDmz:u({dmz:function(e){var t=e.lock;s(v.isModel(t));var n=t.block&&t.block.getDmz();return n}}),assignNextBlock:u({nextBlock:function(e){var t=e.lock;return s(v.isModel(t)),t.block}}),mergeGenesis:u({nextBlock:function(e){var t=e.lock,n=e.interblock;c("mergeGenesis"),s(v.isModel(t)),s(g.isModel(n));var r=n.extractGenesis();return r}}),connectToParent:u({dmz:function(e){var t=e.interblock,n=e.dmz;c("connectToParent");var r=t.provenance.getAddress(),o=n.network[".."];o=I.setAddress(o,r);var a=i({},n.network,{"..":o});return m.clone(i({},n,{network:a}))}}),ingestParentLineage:u({dmz:function(e,t){var n=e.dmz,r=t.data;s(Array.isArray(r)),s(r.every(g.isModel)),c("ingestParentLineage length: ".concat(r.length));var o=C.ingestInterblocks(n.network,r,n.config);return n=m.clone(i({},n,{network:o}))}}),mergeBlockToLock:u({lock:function(e){var t=e.lock,n=e.nextBlock;return s(v.isModel(t)),s(h.isModel(n)),c("mergeBlockToLock increased: ".concat(!n.equals(t.block))),M.reconcile(t,n)}}),assignInitializedAddress:u({affectedAddresses:function(e){return[e.lock.block.provenance.getAddress()]}}),assignGeneratedBlock:u({nextBlock:function(e,t){return s(h.isModel(t.data)),c("assignGeneratedBlock"),t.data}}),unassignLock:u({lock:function(){}}),createBaseDmz:u({baseDmz:function(e){var t=e.validators,n=k.create("hyper"),r=y.create("ROOT"),o=d.create(r),a=i({},f.create(),{"..":o});return m.create({covenantId:n,validators:t,network:a,config:{isPierced:!0,isPublicChannelOpen:!0}})}}),assignValidatorKey:u({validators:function(e,t){c("assignValidatorKey: %o",t.data);var n=Object.values(t.data)[0];return s(b.isModel(n)),t.data}}),assignAffectedAddresses:u({affectedAddresses:function(e,t){var n=e.affectedAddresses;c("assignAffectedAddresses");var r=t.data;return s(Array.isArray(r)),[].concat(a(r),a(n))}}),assignConnectionAttempt:u({affectedAddresses:function(e){var t=e.interblock,n=e.affectedAddresses;s(Array.isArray(n)),s(g.isModel(t));var r=t.getTargetAddress();return[].concat(a(n),[r])}})},guards:{isStorageEmpty:function(e,t){var n=t.data.isStorageEmpty;return c("isStorageEmpty: ".concat(n)),n},isInitialConditions:function(e){return!!e.baseDmz},isGenesis:function(e){var t=e.interblock;s(g.isModel(t));var n=!1;try{t.extractGenesis(),n=!0}catch(r){}return c("isGenesis: ".concat(n)),n},isOriginPresent:function(e,t){var n=t.data;return s("boolean"===typeof n),c("isOriginPresent: ".concat(n)),n},isLockFailed:function(e,t){var n=!t.data&&!v.isModel(t.data);return c("isLockFailed: ".concat(n)),n},isBirthingCompleted:function(e){var t=e.lock;s(v.isModel(t));var n=t.block&&t.block.provenance.height>=1;return c("isBirthingCompleted: ".concat(n)),n},verifyLineage:function(e,t){var n=e.interblock,r=t.data;return s(r.length),s.strictEqual(n.getChainId(),r[0].getChainId()),s(!r[0].provenance.height),c("verifyLineage"),!0},isLockForGenesis:function(e){var t=e.lock;s(v.isModel(t));var n=t.block,r=n&&n.provenance.address.isGenesis();return c("isLockForGenesis: ".concat(r)),r},isLockForBirthBlock:function(e){var t=e.lock;s(v.isModel(t));var n=t.block,r=n&&1===n.provenance.height;return c("isLockForBirthBlock: ".concat(r)),r},isConnectionAttempt:function(e){return e.interblock.isConnectionAttempt()},isConnectable:function(e,t){return t.data}},services:{isStorageEmpty:function(){var e=o(r.mark((function e(){var t,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0,e.next=3,n.getBlock({address:void 0});case 3:return t=e.sent,c("isStorageEmpty: ".concat(o=!t)),e.abrupt("return",{isStorageEmpty:o});case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),checkIsOriginPresent:function(){var e=o(r.mark((function e(t){var o,a,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.interblock,a=o.provenance.getAddress(),e.next=4,n.getIsPresent(a);case 4:return i=e.sent,c("checkIsOriginPresent: %O",!!i),e.abrupt("return",!!i);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),lockChildChain:function(){var e=o(r.mark((function e(t){var o,a,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.interblock,s(g.isModel(o)),a=o.extractGenesis().provenance.getAddress(),e.next=5,n.putLockChain(a);case 5:return i=e.sent,c("lockChildChain: ".concat(!!i)),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchParentLineage:function(){var e=o(r.mark((function e(t){var o,a,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.interblock,s(g.isModel(o)),a=o.provenance,e.next=5,n.getLineage({provenance:a});case 5:return i=e.sent,s(Array.isArray(i)),s(i.every(g.isModel)),s.strictEqual(i[0].provenance.height,0),c("fetchParentLineage length: ".concat(i.length)),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),generateBirthBlock:function(){var e=o(r.mark((function e(t){var n,o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dmz,o=t.lock,s(m.isModel(n)),s(v.isModel(o)),c("generateBirthBlock"),e.next=6,A(n,o.block,p.sign);case 6:return a=e.sent,e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),unlockChain:function(){var e=o(r.mark((function e(t){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.lock,s(v.isModel(o)),c("unlockChain"),e.next=5,n.putUnlockChain(o);case 5:return e.abrupt("return");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),poolBirthBlock:function(){var e=o(r.mark((function e(t){var o,a,i,c,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.lock,s(v.isModel(o)),a=o.block,s(a),s(1===a.provenance.height),i=a.network[".."].address,s(i.isResolved()),c=g.create(a),u=[i],e.next=11,n.putPoolInterblock({affectedAddresses:u,interblock:c});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchValidatorKey:function(){var e=o(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("fetchValidatorKey"),e.next=3,p.getValidatorEntry();case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),signBlock:function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.baseDmz,c("signBlock"),e.next=4,h.create(n,p.sign);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),lockBaseChain:function(){var e=o(r.mark((function e(t){var o,a,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.nextBlock,c("lockBaseChain"),a=o.provenance.getAddress(),e.next=5,n.putLockChain(a);case 5:return i=e.sent,e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchAffectedAddresses:function(){var e=o(r.mark((function e(t){var o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.interblock,e.next=3,n.getAffected(o);case 3:return a=e.sent,c("fetchAffectedAddresses: ".concat(a.length)),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),isConnectable:function(){var e=o(r.mark((function e(t){var o,a,i,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.interblock,s(g.isModel(o)),a=o.getTargetAddress(),s(a),e.next=6,n.getBlock({address:a});case 6:return(i=e.sent)&&s(h.isModel(i)),u=i&&i.config.isPublicChannelOpen,c("isConnectable: ",u),e.abrupt("return",u);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),storeInPools:function(){var e=o(r.mark((function e(t){var o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.interblock,a=t.affectedAddresses,s(Array.isArray(a)),s(g.isModel(o)),c("storeInPools"),e.next=6,n.putPoolInterblock({affectedAddresses:a,interblock:o});case 6:c("storeInPools completed on ".concat(a.length," items"));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}})}}},function(e,t,n){var r={id:"pool",initial:"idle",context:{interblock:void 0,lock:void 0,dmz:void 0,nextBlock:void 0,affectedAddresses:[],baseDmz:void 0,validators:void 0},strict:!0,states:{idle:{on:{POOL_INTERBLOCK:{target:"initializeStorage",actions:"assignInterblock"}}},done:{id:"done",data:function(e){return e.affectedAddresses},type:"final"},initializeStorage:{initial:"isStorageEmpty",states:{isStorageEmpty:{invoke:{src:"isStorageEmpty",onDone:[{target:"fetchValidatorKey",cond:"isStorageEmpty"},{target:"done"}]}},fetchValidatorKey:{invoke:{src:"fetchValidatorKey",onDone:{target:"createBaseBlock",actions:"assignValidatorKey"}}},createBaseBlock:{entry:"createBaseDmz",invoke:{src:"signBlock",onDone:{target:"lockBaseChain",actions:"assignGeneratedBlock"}}},lockBaseChain:{invoke:{src:"lockBaseChain",onDone:{target:"unlockChain",actions:"assignLock"}}},unlockChain:{entry:"mergeBlockToLock",invoke:{src:"unlockChain",onDone:{target:"done",actions:"assignInitializedAddress"}}},done:{type:"final"}},onDone:[{target:"done",cond:"isInitialConditions"},{target:"poolInterblock"}]},poolInterblock:{initial:"isGenesis",states:{isGenesis:{always:[{target:"birthChild",cond:"isGenesis"},{target:"poolAffectedChains"}]},poolAffectedChains:{initial:"fetchAffectedAddresses",states:{fetchAffectedAddresses:{invoke:{src:"fetchAffectedAddresses",onDone:{target:"isConnectionAttempt",actions:"assignAffectedAddresses"}}},isConnectionAttempt:{always:[{target:"isConnectable",cond:"isConnectionAttempt"},{target:"storeInPools"}]},isConnectable:{invoke:{src:"isConnectable",onDone:[{target:"storeInPools",cond:"isConnectable",actions:"assignConnectionAttempt"},{target:"storeInPools"}]}},storeInPools:{invoke:{src:"storeInPools",onDone:{target:"done"}}},done:{type:"final"}},onDone:"done"},done:{type:"final"},birthChild:{initial:"checkIsOriginPresent",states:{checkIsOriginPresent:{invoke:{src:"checkIsOriginPresent",onDone:[{target:"lockChildChain",cond:"isOriginPresent"},{target:"done"}]}},done:{type:"final"},lockChildChain:{entry:"unassignLock",invoke:{src:"lockChildChain",onDone:[{target:"done",cond:"isLockFailed"},{target:"increaseChain"}]}},increaseChain:{entry:["assignLock","assignDmz","assignNextBlock"],always:[{target:"unlockChain",cond:"isBirthingCompleted"},{target:"fetchParentLineage",cond:"isLockForGenesis"},{target:"mergeGenesis"}]},mergeGenesis:{entry:"mergeGenesis",always:"unlockChain"},fetchParentLineage:{entry:"connectToParent",invoke:{src:"fetchParentLineage",onDone:{target:"generateBirthBlock",cond:"verifyLineage"}},exit:"ingestParentLineage"},generateBirthBlock:{invoke:{src:"generateBirthBlock",onDone:{target:"unlockChain",actions:"assignGeneratedBlock"}}},unlockChain:{entry:"mergeBlockToLock",invoke:{src:"unlockChain",onDone:[{target:"lockChildChain",cond:"isLockForGenesis"},{target:"poolBirthBlock",cond:"isLockForBirthBlock"},{target:"done"}]}},poolBirthBlock:{invoke:{src:"poolBirthBlock",onDone:"done"}}},onDone:"poolAffectedChains"}},onDone:"done"},error:{id:"error",type:"final"}}},o=Machine(r);e.exports={definition:r,machine:o}},function(e,t,n){var r=n(2),o=n(3),a=n(4),i=n(11)("interblock:config:receive"),s=(n(24),n(39).assign),c=n(21),u=(c.lockModel,c.addressModel,c.txModel),l=c.blockModel,p=c.interblockModel,d=n(69),f=(d.blockProducer,d.lockProducer,d.networkProducer,n(462).machine),h=n(50);e.exports={receiveConfig:function(e){var t=h.toFunctions(e);return f.withConfig({actions:{assignInterblock:s({interblock:function(e,t){var n=t.payload;return a(u.isModel(n)),n.interblock}}),assignSocket:s({socket:function(e,t){var n=t.payload;return a(u.isModel(n)),n.socket}}),assignIsPoolable:s({isPoolable:function(e,t){return!0}})},guards:{isInitialConditions:function(e,t){var n=t.data;return i("isInitialConditions: ".concat(n)),n},isPoolable:function(e,t){var n=t.data;return a("boolean"===typeof n),i("isPoolable: ".concat(n)),n},isConnectionAttempt:function(e){return e.interblock.isConnectionAttempt()},isConnectable:function(e,t){return t.data}},services:{isInitialConditions:function(){var e=o(r.mark((function e(){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0,e.next=3,t.getBlock({address:void 0});case 3:return n=e.sent,i("isInitialConditions: ".concat(!n)),e.abrupt("return",!n);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),isAnyAffected:function(){var e=o(r.mark((function e(n){var o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,e.next=3,t.getIsAnyAffected(o);case 3:return a=e.sent,i("isAnyAffected: ".concat(a)),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),isConnectable:function(){var e=o(r.mark((function e(n){var o,s,c,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,a(p.isModel(o)),s=o.getTargetAddress(),a(s),e.next=6,t.getBlock({address:s});case 6:return(c=e.sent)&&a(l.isModel(c)),u=c&&c.config.isPublicChannelOpen,i("isConnectable: ",u),e.abrupt("return",u);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),storeConnection:function(){var e=o(r.mark((function e(n){var o,a,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,a=n.socket,i("storeConnection"),s=o.provenance.getAddress(),e.next=5,t.putSocket({address:s,socket:a});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}})}}},function(e,t,n){var r={id:"receive",initial:"idle",context:{socket:void 0,interblock:void 0,isPoolable:!1,isCatchupable:!1},strict:!0,states:{idle:{on:{RECEIVE_INTERBLOCK:{target:"isInitialConditions",actions:["assignInterblock","assignSocket"]}}},isInitialConditions:{invoke:{src:"isInitialConditions",onDone:[{target:"done",actions:"assignIsPoolable",cond:"isInitialConditions"},{target:"isAnyAffected"}]}},isAnyAffected:{invoke:{src:"isAnyAffected",onDone:[{target:"storeConnection",actions:"assignIsPoolable",cond:"isPoolable"},{target:"isConnectable",cond:"isConnectionAttempt"},{target:"done"}]}},storeConnection:{invoke:{src:"storeConnection",onDone:"done"}},isConnectable:{invoke:{src:"isConnectable",onDone:[{target:"storeConnection",actions:"assignIsPoolable",cond:"isConnectable"},{target:"done"}]}},done:{data:function(e){return{isPoolable:e.isPoolable,isCatchupable:e.isCatchupable}},type:"final"},error:{id:"error",type:"final"}}},o=Machine(r);e.exports={definition:r,machine:o}},function(e,t,n){var r=n(2),o=n(3),a=n(19),i=n(4),s=n(11)("interblock:config:transmit"),c=n(24),u=n(39).assign,l=n(21),p=l.interblockModel,d=l.blockModel,f=l.socketModel,h=l.txModel,v=l.addressModel,g=n(464).machine,y=n(50);e.exports={transmitConfig:function(e){var t=y.toFunctions(e);return g.withConfig({actions:{assignInterblock:u({interblock:function(e,t){var n=t.payload;return s("assignInterblock"),i(p.isModel(n)),n}}),assignBlock:u({block:function(e,t){var n=t.data.block;return i(d.isModel(n)),n}}),extendListeningTxs:u({listeningTxs:function(e,t){var n=e.interblock,r=e.listeningTxs;s("extendListeningTxs");var o=t.data.sockets;i(o.every(f.isModel));var c=n.getWithoutRemote(),u=o.map((function(e){return h.create(e,c)}));return[].concat(a(r),a(u))}}),extendTargetTxs:u({targetTxs:function(e,t){var n=e.interblock,r=e.targetTxs;s("assignTargetTxs");var o=t.data;i(o.every(f.isModel));var c=o.map((function(e){return h.create(e,n)}));return[].concat(a(r),a(c))}}),assignLineage:u({lineage:function(e,t){return t.data}}),assignSelfTarget:u({targetTxs:function(e){var t=e.targetTxs,n=e.interblock,r=f.create(),o=h.create(r,n),i=[].concat(a(t),[o]);return s("assignSelfTarget targetTxs length: ".concat(i.length)),i}}),extendLineageTxs:u({lineageTxs:function(e){var t=e.targetTxs,n=e.lineage;s("extendLineageTxs"),i(n.every(p.isModel)),i(n.every((function(e){return!e.getTargetAddress()})));var r=[];return t.forEach((function(e){n.forEach((function(t){i(h.isModel(e));var n=e.socket;i(f.isModel(n)),r.push(h.create(n,t))}))})),s("extendLineageTxs generated ".concat(r.length," extensions")),r}}),extendGenesisAttempt:u({targetTxs:function(e){var t=e.interblock,n=e.targetTxs;i(p.isModel(t)),i(t.isGenesisAttempt());var r=h.create(f.create(),t);return n=[].concat(a(n),[r])}}),removeListeningTxs:u({listeningTxs:function(e){var t=e.listeningTxs,n=e.targetTxs;s("removeListeningTxs");var r=n.map((function(e){return e.socket})),o=t.filter((function(e){var t=e.socket;return!r.some((function(e){return e.equals(t)}))}));return s("filter removed: ".concat(r.length-o.length)),o}}),mergeTransmissions:u({transmissions:function(e){var t=e.listeningTxs,n=e.targetTxs,r=e.lineageTxs;return[].concat(a(t),a(r),a(n))}})},guards:{isBlockFetched:function(e,t){return d.isModel(t.data.block)},isLineageInterblock:function(e){return!e.interblock.getRemote()},isConnectionResponse:function(e){return e.interblock.isConnectionResponse()},isConnectionResolve:function(e){return e.interblock.isConnectionResolve()},isGenesisAttempt:function(e){return e.interblock.isGenesisAttempt()},isOriginPresent:function(e,t){return t.data.isOriginPresent}},services:{fetchBlock:function(){var e=o(r.mark((function e(n){var o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,i(p.isModel(o)),e.next=4,t.getBlock(o.provenance);case 4:return a=e.sent,i(d.isModel(a)),i(a.provenance.equals(o.provenance)),s("fetchBlock height: ".concat(a.provenance.height)),e.abrupt("return",{block:a});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchRemoteListeners:function(){var e=o(r.mark((function e(n){var o,u,l,h,v,g,y,m;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,u=n.block,i(p.isModel(o)),i(!o.getRemote()),i(d.isModel(u)),l=u.network,h=l.getResolvedAliases().map((function(e){var n=l[e].address;return t.getSockets(n)})),e.next=8,Promise.all(h);case 8:return v=e.sent,g=c.flatten(v),y=new Set(g),s("fetchListeningSockets length: ".concat(y.size)),m=a(y),i(m.every(f.isModel)),e.abrupt("return",{sockets:m});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchSelfListener:function(){var e=o(r.mark((function e(n){var o,a,c,u,l,h;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,a=n.block,i(p.isModel(o)),i(d.isModel(a)),c=a.network,u=c.getResolvedAliases().map((function(e){var n=c[e].address;return t.getIsPresent(n)})),e.next=7,Promise.race(u);case 7:return l=e.sent,s("fetchSelfListener: ".concat(l)),h=l?[f.create()]:[],e.abrupt("return",{sockets:h});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchRemoteTargets:function(){var e=o(r.mark((function e(n){var o,a,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,i(p.isModel(o)),a=o.getTargetAddress(),i(v.isModel(a)),e.next=6,t.getSockets(a);case 6:return c=e.sent,s("fetchTargetSockets length: ".concat(c.length)),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchSelfTarget:function(){var e=o(r.mark((function e(n){var o,a,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,i(p.isModel(o)),a=o.getTargetAddress(),i(a),e.next=6,t.getIsPresent(a);case 6:return c=e.sent,s("fetchSelfTarget: ".concat(c)),e.abrupt("return",c?[f.create()]:[]);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchLineageToGenesis:function(){var e=o(r.mark((function e(n){var o,a,c,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,i(p.isModel(o)),0,s("fetchLineage from height: ".concat(0)),a=o.provenance,c={provenance:a,height:0},e.next=8,t.getLineage(c);case 8:return u=e.sent,s("fetchLineage length: ".concat(u.length)),e.abrupt("return",u);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),isOriginPresent:function(){var e=o(r.mark((function e(n){var o,a,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,i(p.isModel(o)),a=o.provenance.getAddress(),e.next=5,t.getIsPresent(a);case 5:return c=e.sent,s("isOriginPresent: ",c),e.abrupt("return",{isOriginPresent:c});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}})}}},function(e,t,n){var r={id:"transmit",initial:"idle",context:{interblock:void 0,listeningTxs:[],targetTxs:[],lineage:[],lineageTxs:[],transmissions:[]},strict:!0,states:{idle:{on:{TRANSMIT_INTERBLOCK:{target:"isLineageInterblock",actions:"assignInterblock"}}},done:{entry:["removeListeningTxs","mergeTransmissions"],data:function(e){return e.transmissions},type:"final"},isLineageInterblock:{always:[{target:"fetchLineageSockets",cond:"isLineageInterblock"},{target:"fetchTargetSockets"}]},fetchLineageSockets:{initial:"fetchBlock",states:{fetchBlock:{invoke:{src:"fetchBlock",onDone:[{target:"fetchListeners",actions:"assignBlock",cond:"isBlockFetched"},{target:"done"}]}},done:{type:"final"},fetchListeners:{type:"parallel",states:{fetchRemoteListeners:{initial:"promise",states:{promise:{invoke:{src:"fetchRemoteListeners",onDone:{target:"done",actions:"extendListeningTxs"}}},done:{type:"final"}}},fetchSelfListener:{initial:"promise",states:{promise:{invoke:{src:"fetchSelfListener",onDone:{target:"done",actions:"extendListeningTxs"}}},done:{type:"final"}}}},onDone:"done"}},onDone:"done"},fetchTargetSockets:{type:"parallel",states:{isGenesisAttempt:{initial:"isGenesisAttempt",states:{isGenesisAttempt:{always:[{target:"isOriginPresent",cond:"isGenesisAttempt"},{target:"done"}]},isOriginPresent:{invoke:{src:"isOriginPresent",onDone:[{target:"done",cond:"isOriginPresent",actions:"extendGenesisAttempt"},{target:"done"}]}},done:{type:"final"}}},fetchRemoteTargets:{initial:"promise",states:{promise:{invoke:{src:"fetchRemoteTargets",onDone:{target:"done",actions:"extendTargetTxs"}}},done:{type:"final"}}},fetchSelfTarget:{initial:"promise",states:{promise:{invoke:{src:"fetchSelfTarget",onDone:{target:"done",actions:"extendTargetTxs"}}},done:{type:"final"}}},addLineage:{initial:"isLineageRequired",states:{isLineageRequired:{always:[{target:"fetchLineageToGenesis",cond:"isConnectionResponse"},{target:"fetchLineageToGenesis",cond:"isConnectionResolve"},{target:"done"}]},fetchLineageToGenesis:{invoke:{src:"fetchLineageToGenesis",onDone:{target:"done",actions:"assignLineage"}}},done:{type:"final"}}}},onDone:{target:"done",actions:"extendLineageTxs"}}}},o=Machine(r);e.exports={definition:r,machine:o}},function(e,t,n){(function(t){var r=n(19),o=n(33),a=n(28),i=n(2),s=n(8),c=n(3),u=n(4),l=n(102),p=l.isReplyFor,d=l.request,f=n(11)("interblock:effector:dispatchCovenant"),h=n(67).unity,v=n(117).v4;e.exports={dispatchCovenantFactory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.reducer,n=new Map,l=[],g=v(),y=0,m=function(){var e=c(i.mark((function e(t){var n,r,o,a,c,u;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.type,r=t.payload,o=t.to,a="".concat(y++," ").concat(g),f("injector: %s to: %s id: %o",n,o,a),r=s({},r,{_dispatchId:a}),c=d(n,r,o),u=x(c),l.push(c),e.next=9,Promise.resolve();case 9:return e.abrupt("return",u);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=function(){var d=c(i.mark((function c(d,h){var v,g,y,m,k,x,w,M;return i.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(u.strictEqual(typeof h,"object","must supply an action object"),f("reducer: %O",h.type),!b(h)){i.next=35;break}v=a(n),i.prev=4,v.s();case 6:if((g=v.n()).done){i.next=24;break}if(y=o(g.value,2),m=y[0],k=y[1],x=k.pending,w=k.settled,!p(h,m)){i.next=22;break}f("reply received: %O for: %O",h.type,m.type),consumed=!0,x.resolve(),i.t0=h.type,i.next="@@REJECT"===i.t0?15:"@@PROMISE"===i.t0?18:"@@RESOLVE"===i.t0?19:22;break;case 15:return t(w.reject,h.payload),n.delete(m),i.abrupt("break",22);case 18:throw new Error("Promises should never be seen by covenants");case 19:return t(w.resolve,h.payload),n.delete(m),i.abrupt("break",22);case 22:i.next=6;break;case 24:i.next=29;break;case 26:i.prev=26,i.t1=i.catch(4),v.e(i.t1);case 29:return i.prev=29,v.f(),i.finish(29);case 32:return i.abrupt("return",d);case 35:return i.next=37,e(d,h);case 37:return d=i.sent,u.strictEqual(typeof d,"object","wrappedReducer invalid state"),M=[],Array.isArray(d.actions)&&M.push.apply(M,r(d.actions)),M.push.apply(M,l),l.length=0,i.abrupt("return",s({},d,{actions:M}));case 44:case"end":return i.stop()}}),c,null,[[4,26,29,32]])})));return function(e,t){return d.apply(this,arguments)}}(),b=function(e){if(u.strictEqual(typeof e.payload,"object","must supply payload"),p(e)){u.strictEqual(typeof e.request,"object"),u.strictEqual(typeof e.request.payload,"object");var t=e.request.payload._dispatchId;return t&&"string"===typeof t&&t.endsWith(g)}return!1},x=function(e){var t={},r=new Promise((function(e,n){t.settled={resolve:e,reject:n}}));return r.pending=new Promise((function(e,n){t.pending={resolve:e,reject:n}})),n.set(e,t),r};return{injector:m,reducer:k}}}}).call(this,n(54).setImmediate)},function(e,t,n){var r=n(2),o=n(3),a=n(21),i=a.blockModel,s=a.interblockModel,c=function(){var e=o(r.mark((function e(t,n){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u(n),e.next=3,l(t);case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),u=function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.create();case 2:n=e.sent,o=s.create(n),t.push(o);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(e){var t,n=new Promise((function(e){return t=e})),a=e.subscribe(function(){var e=o(r.mark((function e(n,o){var i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("UNLOCK"!==n.type){e.next=6;break}return i=n.payload.block,e.next=4,o;case 4:t(i.provenance.getAddress()),a();case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());return n};e.exports={createBase:c}},function(e,t,n){var r=n(4),o=n(24),a=(n(240),n(82),n(242)),i=n(243),s=i.blockPrint,c=i.interPrint,u=n(21),l=u.blockModel,p=u.interblockModel;e.exports={createTap:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"interblock:blocktap",t=!1,i=function(){return t=!0},u=function(){return t=!1},d=n(11)(e),f={},h=(a.gray("undefined"),d.extend("tran")),v=function(e){if(t){var n=m(e);h(n)}},g=d.extend("pool"),y=function(e){if(t){var n=m(e);g(n)}},m=function(e){r(p.isModel(e));var t=a.yellow("INTER_LIGHT"),n=a.gray(w(e,f));return e.getRemote()&&(t=a.yellow("INTER_HEAVY")),c(e,t,n,"bgYellow","yellow")},k=d.extend("bloc"),b=function(e){r(l.isModel(e));var n=e.provenance.getAddress().getChainId(),o=!f[n],a=f[n]&&f[n].some((function(t){return t.equals(e)}));if(x(e,f),t){var i=w(e,f),c=s(e,i,o,a);k(c)}},x=function(e,t){var n=e.provenance.getAddress().getChainId();t[n]||(t[n]=[]),t[n].some((function(t){return t.equals(e)}))||t[n].push(e)},w=function(e,t){if(!(e=o.last(t[e.provenance.getAddress().getChainId()])))return"(unknown)";for(var n=[],a=e,i=0;a&&i<10;){i++;var s=a.network[".."].address;if(s.isRoot())a=void 0,n.unshift("");else if(s.isUnknown())n.unshift("(unknown)"),a=void 0;else{var c=s.getChainId(),u=o.last(t[c]);r(l.isModel(u),"Hole in pedigree");var p=u.network.getAlias(a.provenance.getAddress());n.unshift(p),a=u}}i>=10&&debug("Path over loopCount");var d=n.join("/");return d||"/"};return{on:i,off:u,block:b,interblockTransmit:v,interblockPool:y}}}},,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=n(2),o=n(3),a=n(4),i=n(21),s=(i.blockModel,i.interblockModel,n(11)("interblock:transport")),c=n(491);e.exports={tcpTransportFactory:function(e){var t;return{connect:function(){var n=o(r.mark((function n(){return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a(!t),(t=new c(e)).on("message",(function(e){s("message: %O",e)})),t.on("close",(function(e){return s("close",e)})),t.on("error",(function(e){return s("error %O",e)})),t.on("ping",(function(e){return s("ping",e)})),t.on("pong",(function(e){return s("pong",e.toString())})),t.on("upgrade",(function(e){return s("upgrade")})),n.abrupt("return",new Promise((function(n,a){var i=function(){var e=o(r.mark((function e(n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s("unexpectedResponse"),t.terminate(),a("unexpectedResponse");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.on("open",(function(){s("socket open to ".concat(e)),t.removeListener("unexpected-response",i),n()})),t.on("unexpected-response",i)})));case 9:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),ping:function(){var e=o(r.mark((function e(){var n,o=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:"",s("ping: %O",n),e.abrupt("return",new Promise((function(e){var r=Date.now();t.ping(n),t.on("pong",(function(t){a.strictEqual(t.toString(),n),e(Date.now()-r)}))})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pingLambda:function(){var e=o(r.mark((function e(){var n,o=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:"",s("pingLambda: %O",n),e.abrupt("return",new Promise((function(e){var r=Date.now();t.send("PING_LAMBDA ".concat(n)),t.on("message",(function(t){a.strictEqual(t.toString(),"PONG_LAMBDA ".concat(n)),e(Date.now()-r)}))})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),version:function(){var e=o(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s("version"),e.abrupt("return",new Promise((function(e){t.send("VERSION"),t.on("message",(function(t){a.strictEqual(t.toString(),"PONG_LAMBDA ".concat(data)),e(Date.now()-start)}))})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),close:function(){var e=o(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.close(),e.abrupt("return",new Promise((function(e,n){t.on("close",e)})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),interblock:function(){var e=o(r.mark((function e(n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:1,a.strictEqual(t.readyState,1,"websocket not open"),t.send(n.serialize());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}}},,function(e,t,n){var r=n(2),o=n(8),a=n(3),i=n(123).metrologyFactory,s=n(67).hyper,c=function(){var e=a(r.mark((function e(){var t,n,a,c,u,l,p,d=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.length>0&&void 0!==d[0]?d[0]:"aws",n=d.length>1?d[1]:void 0,n=o({},n,{hyper:s}),e.next=5,i(t,n);case 5:return a=e.sent,c=a.getEngine(),u=c.sqsTx,l=c.sqsRx,p=a.getState().provenance.getAddress(),e.next=10,a.settle();case 10:return e.abrupt("return",{sqsTx:u,sqsRx:l,hyperAddress:p,engine:a});case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e.exports={awsFactory:c}},function(e,t,n){var r=n(2),o=n(3),a=n(169).effectorFactory,i=n(11)("interblock:browser"),s=n(494),c=function(){var e=o(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.config({name:"@dreamcatcher/interblock_".concat(t)}),i("loading browser module"),e.next=4,a("web");case 4:return n=e.sent,i("browser client ready"),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();e.exports={browserFactory:c}},,function(e,t,n){(function(t){var r=n(2),o=n(3),a=n(22)("dos"),i=n(498),s=n(161).evaluate,c=n(162).withSpin,u=n(257);function l(e,t,n,r){return a("evalPrint"),r.evaluate=r.evaluate||c(s),u((function(){return r.evaluate(e,t,n)}))}e.exports=function(){var e=o(r.mark((function e(n){var o,s=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.length>1&&void 0!==s[1]?s[1]:{},a("argv",n),n=(n||t.argv).slice(2),a("argv",n),e.abrupt("return",n.length?l(ctx,n[0],n.slice(1),o):i(o));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}).call(this,n(10))},,,function(e,t,n){var r=n(2),o=n(19),a=n(499),i=n(3),s=n(22)("dos:repl"),c=n(245),u=n(118).effectorFactory,l=n(523).read,p=n(161).evaluate,d=n(605).withAutoComplete,f=n(162).withSpin,h=n(257),v=n(606),g=n(113);n(607)(0,80);function y(e){return m.apply(this,arguments)}function m(){return(m=i(r.mark((function e(t){var n,o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.blockchain,t.evaluate,(o=c({spinner:"arrow3"}).start()).info("begining boot sequence Ctrl+C to cancel and drop to local shell"),o.text='checking for new app version on server "this webpage"',o.info("current build version: 0.0.0").start(),o.text='looking for previous chains under the domain "this webpage"',o.info("no previous chains found").start(),n||(o.text="Initializing blockchain...",n=u("console")),!n.then){e.next=12;break}return e.next=11,n;case 11:n=e.sent;case 12:return a=n.getState().getChainId(),o.info("Blockchain initialized with chainId: ".concat(a)).start(),o.text="connecting to mainnet...",e.next=17,new Promise((function(e){return setTimeout(e,700)}));case 17:return o.info("connection to mainnet established").start(),o.info("mainnet latency: 543 ms"),o.info("peer connection count: 1").start(),o.text="benchmarking local system",e.next=23,new Promise((function(e){return setTimeout(e,700)}));case 23:return o.info("local blockrate 23 blocks per second / 53 ms per block"),o.stop(),e.next=27,h('Welcome to the HyperNet\n  Blockchain core: v0.0.5\n  Terminal:        v0.0.12\n  type "help" to get started');case 27:return"root","local",o.stop(),e.abrupt("return",{user:"root",machineId:"local",blockchain:n});case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports=function(){var e=i(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s("repl"),(t=t||{}).read=t.read||d(l),t.evaluate=t.evaluate||f(p),s("opts: ",Object.keys(t)),e.next=7,y(t);case 7:return n=e.sent,s("changing to home directory"),e.next=11,t.evaluate(n,"cd",[]);case 11:return e.abrupt("return",v(function(){var e=i(r.mark((function e(){var c,u,l,p,d;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.read(n);case 2:return c=e.sent,u=c.split(" ").filter(Boolean),l=a(u),p=l[0],d=l.slice(1),s("command: ",p,d),e.next=7,h(i(r.mark((function e(){var a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!k.includes(p)&&g[p]&&(d=[p].concat(o(d)),p="time"),e.next=3,t.evaluate(n,p,d);case 3:return(a=e.sent)&&a.ctx&&Object.assign(n,a.ctx),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)}))));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var k=["time","clear","help"]},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=n(2),o=n(3),a=n(47).prompt,i=n(22)("dos:read"),s=n(40);t.read=function(){var e=o(r.mark((function e(t){var n,o,c,u,l,p,d,f,h;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.autoComplete,n=t.user,o=t.machineId,c=t.blockchain,u=c.getContext(),l=u.wd,p="".concat(s.green("".concat(n,"@").concat(o)),":").concat(s.blue(l),"$"),i("reading: ".concat(p)),d={type:"input",name:"result",message:p},e.next=8,a(d);case 8:return f=e.sent,h=f.result,i("prompt result: ",h),e.abrupt("return",h);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=n(2),o=n(3),a=(n(44),n(34)),i=(n(52).promisify,n(91)),s=n(22)("dos:commands:config"),c=n(253).getHomePath,u=a.join(i.homedir(),".cmd-prototype"),l={set:function(e,t,n){return o(r.mark((function o(){var a,i,l,d,f;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s("set",t,n),a=e.configPath||u,r.next=4,p(a);case 4:return(i=r.sent)[t]=n,r.next=8,writeFile(a,JSON.stringify(i));case 8:if("apiaddr"!==t.toLowerCase()){r.next=15;break}return l=(e.IpfsApi||IpfsApi)(n),d=new Ipld(l.block),r.next=13,c(l);case 13:return f=r.sent,r.abrupt("return",{ctx:{ipld:d,ipfs:l,wd:f}});case 15:case"end":return r.stop()}}),o)})))()},get:function(e,t){return o(r.mark((function n(){var o,a;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s("get",t),n.next=3,p(e.configPath||u);case 3:return o=n.sent,a=t?o[t]:o,n.abrupt("return",{out:a});case 6:case"end":return n.stop()}}),n)})))()}};function p(e){return d.apply(this,arguments)}function d(){return(d=o(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=JSON,e.next=4,readFile(t);case 4:e.t1=e.sent,n=e.t0.parse.call(e.t0,e.t1),e.next=11;break;case 8:e.prev=8,e.t2=e.catch(0),s("failed to read config",e.t2);case 11:return e.abrupt("return",n||{});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}e.exports=function(){var e=o(r.mark((function e(t,n){var o,a,i,s=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l[n]){e.next=2;break}throw new Error("".concat(n,": subcommand not found"));case 2:for(o=s.length,a=new Array(o>2?o-2:0),i=2;i<o;i++)a[i-2]=s[i];return e.abrupt("return",l[n].apply(l,[t].concat(a)));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},function(e,t,n){(function(t){e.exports=function(e){var n=e.spinner;n&&n.stop(),t.exit()},e.exports.help="Exit the current program"}).call(this,n(10))},function(e,t,n){var r=n(22)("dos:commands:help"),o=n(114),a=n(113);n(569);e.exports=function(e){var t=o();r("help: ",Object.keys(a)),t.div('Use the following commands (use "tab" for autocomplete):\n');var n=Object.keys(a).filter((function(e){return!!a[e].help}));n.forEach((function(e){t.div({text:e,width:20,padding:[0,0,0,0]},a[e].help.replace(/\n|\r|\r\n/g," ").trim()),t.div()}));var i=Object.keys(a).filter((function(e){return!a[e].help}));return t.div("No help provided for:\n"),t.div("    "+i.toString()),t.div(),{out:t.toString()}},e.exports.help="\nPrints this message\n"},,,,,,,,,,,,function(e,t,n){var r=n(2),o=n(3),a=(n(34).posix||n(34),n(22)("dos:commands:ls")),i=n(114),s=n(40);n(571);e.exports=function(){var e=o(r.mark((function e(t,n){var o,c,u,l,p;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.spinner,c=t.blockchain,u=c.getState(),l=u.network,o.text="Resolving ".concat(n),p=i(),Object.keys(l).forEach((function(e){a("child: ".concat(e));var t,n=l[e],r=n.address.getChainId().substring(0,8);a("chainId: ".concat(r));var o=n.lineageHeight,i=n.heavyHeight;(-1===o&&(o="-"),-1===i&&(i="-"),"."===e)&&(o=i=c.getState().provenance.height,r=c.getState().getChainId().substring(0,8));var u=i+"."+o;t="SYMLINK"!==n.systemRole?s.red(e):s.magenta(e),p.div({text:t,width:20},{text:u,width:10},{text:r,width:55})})),e.abrupt("return",{out:p.toString()});case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.exports.help="\nlist the objects at the cwd.  lists alias, heavy height.lineage height, and chainId\n"},,function(e,t){e.exports=function(e){return{out:e.wd}}},function(e,t,n){var r=n(574);e.exports=function(){return{out:"v".concat(r.version)}}},function(e){e.exports=JSON.parse('{"name":"@dreamcatcher-tech/dos","version":"0.0.0","description":"Terminal interface to the HyperNet","main":"src/index.js","bin":{"dos":"src/bin.js"},"scripts":{"start":"DEBUG=\'\' node src/bin","dev":"DEBUG=\'*\' nodemon src/bin","build":"webpack","build:watch":"nodemon --exec npm run build"},"author":"","license":"AGPL-3.0-or-later","dependencies":{"better-opn":"^2.0.0","chalk":"^4.1.0","clear":"^0.1.0","cliui":"^6.0.0","commander":"^6.1.0","debug":"^4.1.0","dedent":"^0.7.0","detect-node":"^2.0.4","docker-names":"^1.1.1","enquirer":"^2.3.6","figlet":"^1.2.4","filesize":"^3.6.1","localforage":"^1.9.0","ora":"^3.0.0","pad":"^3.2.0","pretty-ms":"^7.0.0","pull-stream":"^3.6.9","random-hash":"^4.0.1","wordwrap":"^1.0.0"},"devDependencies":{"nodemon":"^1.19.3"},"nodemonConfig":{"verbose":false,"watch":["./"]},"jest":{"testEnvironment":"node","transform":{}},"prettier":{"trailingComma":"es5","tabWidth":2,"semi":false,"singleQuote":true}}')},function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:pkg");e.exports=function(){var e=o(r.mark((function e(t,n){var o,i,s,c,u=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=t.spinner,i=u.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=u[c];return a(n,s),e.next=5,new Promise((function(e){return setTimeout(e,2e3)}));case 5:return o.text="now with text",e.next=8,new Promise((function(e){return setTimeout(e,2e3)}));case 8:return o.succeed("stage 1 complete").start(),e.next=11,new Promise((function(e){return setTimeout(e,2e3)}));case 11:return o.fail("stage 2 failed").start(),e.next=14,new Promise((function(e){return setTimeout(e,2e3)}));case 14:return o.info("please try again later").start(),e.next=17,new Promise((function(e){return setTimeout(e,2e3)}));case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.exports.help="\nThe platform package manager.  Use list --installed \nto list all applications installed on the system.\nuse list to show all available applications available for install.\nUse search to narrow down the list of available packages.\nDefaults to listing installed applications.\n"},function(e,t,n){var r=n(577);e.exports=function(){return r()},e.exports.help="Clear the screen"},,function(e,t,n){var r=n(2),o=n(3),a=(n(47).prompt,n(579));e.exports=function(){var e=o(r.mark((function e(t,n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return debug("open: ",n),e.next=3,a("https://aws.amazon.com/cognito/");case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},,,function(e,t,n){var r=n(2),o=n(3);n(22)("dos:commands:login");e.exports=function(){var e=o(r.mark((function e(t){var n,o,a,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.spinner,o=t.blockchain,a="34e3c74c43c0e9b2f3f2ef9f93a0f427ededf5878891b23d792d8f7c1a174b94",n.info("logging in to ".concat(a)).start(),n.text="connecting to: ".concat(url),e.next=6,o.addTransport(a,{url:url});case 6:return i=e.sent,n.succeed("latency of ".concat(i," ms ").concat(url)).start(),n.text="logging in to chain",e.next=11,o.login({chainId:a});case 11:return n.succeed("login successful"),e.abrupt("return",{out:url});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help='Loop the user through a signon process that links\nThe current machine pubkey to their interblock user chain.\nWhen this occurs, the guest chain will transition to the\nuser chain, and the prompt will change from "guest" to "user"'},function(e,t,n){var r=n(2),o=n(3),a=function(e){return new Promise((function(t){return setTimeout(t,e)}))};e.exports=function(){var e=o(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("\n"),n(116)("https://aws.amazon.com/cognito/"),e.abrupt("return",a(2e3));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nDisconnect from the current remote host, else error and stay as local\n"},function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:su"),i=(new(n(584).Command),n(47).prompt);e.exports=function(){var e=o(r.mark((function e(t,n){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a(n),n){e.next=3;break}throw new Error("must supply user name or chainId to elevate to");case 3:return e.next=5,i([{name:"password"}]);case 5:o=e.sent,a(o);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},,function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:add"),i=n(40);n(47).prompt;e.exports=function(){var e=o(r.mark((function e(t){var n,o,s,c,u,l,p,d,f,h,v,g,y=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.spinner,o=t.blockchain,s=y.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=y[u];a("add: %O",c),l="",p=0,d=c;case 5:if(!(p<d.length)){e.next=18;break}return f=d[p],n.text="adding ".concat(f,"..."),e.next=10,o.add(f);case 10:h=e.sent,v=h.alias,g=h.chainId,n.succeed("added ".concat(f)).start(),l+="Added: ".concat(i.red(v),"\n - chainId: ").concat(i.greenBright(g),"\n");case 15:p++,e.next=5;break;case 18:return e.abrupt("return",{out:l.trim()});case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nThis command will be overridden by each application.\nIt serves as the general action of creating a new entity\nwhere the entity is specific to the application being executed.\nWhen used in the native setting, it makes a blank datum chain.\nDepending on the context, additional info may need to be provided to\ncreate the child.\n"},function(e,t,n){var r=n(2),o=n(3);e.exports=o(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),e.exports.help="\nLinking is act of inserting one Object as the child of another\nwhich allows an Object to be the child of more than one parent.\nThis operation is essential to application data structures\nas opposed to simple filesystem data structures, which are \nusually a tree\n"},function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:rm");n(40),n(47).prompt;e.exports=function(){var e=o(r.mark((function e(t,n){var o,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.spinner,o=t.blockchain,a("rm: %O",n),e.next=4,o.rm(n);case 4:i=e.sent,a("result: %O",i);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.exports.help="\nRemove blockchains.  If they are symlinks, will remove\nthe link only.  If children, will be permanently deleted.\n"},function(e,t,n){var r=n(2),o=n(3),a=(n(22)("dos:commands:whoami"),n(40)),i=n(114);e.exports=function(){var e=o(r.mark((function e(t){var n,o,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.blockchain,o=n.getState().getChainId(),(s=i()).div({text:"User:",width:15},"root"),s.div({text:"Machine:",width:15},a.green(o)),s.div({text:"Hypercomputer:",width:15},a.red("NOT CONNECTED")),e.abrupt("return",{out:s.toString()});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nLists info about the current machine, current user, and connected hypercomputer\n"},function(e,t,n){var r=n(2),o=n(3);e.exports=o(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(116)("https://aws.amazon.com/cognito/");case 1:case"end":return e.stop()}}),e)})))},function(e,t,n){var r=n(2),o=n(3),a=n(591),i=n(22)("dos:commands:time");e.exports=function(){var e=o(r.mark((function e(t){var o,s,c,u,l,p,d,f,h,v=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=n(161),s=o.evaluate,c=v.length,u=new Array(c>1?c-1:0),l=1;l<c;l++)u[l-1]=v[l];if(!(u.length<1)){e.next=4;break}throw new Error("Must supply command");case 4:return p=u[0],d=u.slice(1),i("time: ",p,d),f=Date.now(),e.next=9,s(t,p,d);case 9:if(e.t0=e.sent,e.t0){e.next=12;break}e.t0={};case 12:return(h=e.t0).out=h.out||"",h.out=h.out+"\nTime: ".concat(a(Date.now()-f)),e.abrupt("return",h);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nMeasure how long a command takes.\n"},,,function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:ping");e.exports=function(){var e=o(r.mark((function e(t,n,o){var i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.spinner,i=t.blockchain,a("ping path: %O options: %O",n,o),e.next=4,i.ping(n);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),e.exports.help="\nSend a ping to a chain, receive a response.\n\nTODO: \n1. send data with the ping\n2. ping indefinitely\n3. do 4 pings and report average times\n4. allow path pings\n"},function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:reset"),i=n(47).prompt;e.exports=function(){var e=o(r.mark((function e(t){var n,o,s,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.spinner,t.blockchain,a("reset"),n.stop(),e.next=5,i({type:"confirm",name:"reset",message:"Resetting will delete all local blockchains"});case 5:return o=e.sent,s=o.reset,c=s?"All local blockchains deleted":"Cancelled reset",e.abrupt("return",{out:c});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nDump all the local blockchain state, generate a new\ngenesis block, reset login status.\nIn dev mode will also reset the emulated aws.\n"},function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:dns");n(40),n(47).prompt;e.exports=function(){var t=o(r.mark((function t(n,o){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.spinner,n.blockchain,a("dns %O",o),t.abrupt("return",{out:e.exports.help});case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.exports.help="\nService to map strings to chainIds.\nMultiple services and manual overrides can be provided.\n"},function(e,t,n){var r=n(2),o=n(3),a=n(52),i=n(22)("dos:commands:cat");n(40),n(47).prompt;e.exports=function(){var e=o(r.mark((function e(t){var n,o,s,c,u,l,p,d=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t.spinner,n=t.blockchain,o=d.length>1&&void 0!==d[1]?d[1]:".",s=d.length,c=new Array(s>2?s-2:0),u=2;u<s;u++)c[u-2]=d[u];return i("cat path: %O args: %O",o,c),l=n.getState(o),p=a.inspect(l,{colors:!0,depth:null}),e.abrupt("return",{out:p});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nShow the internal state of a chain.\n\nTODO\nArgs for full state, or partial state, or a particular path in the state.\n"},function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:tx");n(40),n(47).prompt;e.exports=function(){var e=o(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.spinner,t.blockchain,a("TODO tx: %O");case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nList and modify the transports used.  These are typically URLs\nwhich point to various block producing peers\n"},function(e,t,n){var r=n(2),o=n(3),a=n(22);e.exports=function(){var e=o(r.mark((function e(t){var n,o,i,s,c,u,l,p,d=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.blockchain,o=d.length,i=new Array(o>1?o-1:0),s=1;s<o;s++)i[s-1]=d[s];return c=i.join(" "),u=n._debug.disable(),l=a.disable(),p="current interblock flags: "+u,p+="\ncurrent dos flags: "+l,p+="\nsetting flags to: "+c,n._debug.enable(c),a.enable(c),e.abrupt("return",{out:p});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nChange flags to alter debug output on console.\n\nWith no arguments, toggle disable and enable, and will print the currently set flags.\nOtherwise will set the current flags.\n\nSee https://github.com/visionmedia/debug"},function(e,t,n){var r=n(2),o=n(3);e.exports=o(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(116)("https://aws.amazon.com/cognito/");case 1:case"end":return e.stop()}}),e)})))},function(e,t,n){var r=n(2),o=n(3),a=n(40),i=n(114),s=a.bold.yellow("Object"),c=a.bold.yellow("Link"),u=a.bold.yellow("Covenant"),l=a.bold.yellow("StateMachine"),p=a.bold.yellow("DistributedOperatingSystem"),d=a.bold.yellow("FileSystem"),f=a.bold.yellow("App");e.exports=o(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=i()).div("Everything in this ".concat(p," is a Blockchain ").concat(s)),t.div(),t.div({text:"1.",width:4},"".concat(s,"s exist everywhere independent of any single computer because they are virtual, and not tied to a particular machine, freeing them from the faults of nature which plague physical hardware")),t.div({text:"2.",width:4},"".concat(s,"s can connect to each other to transfer instructions or payload data via ").concat(c,"s.")),t.div({text:"3.",width:4},"The logic governing the behaviour of ".concat(s,"s is inside a ").concat(u)),t.div({text:"4.",width:4},"A subclass of ".concat(u," is a ").concat(l)),t.div({text:"5.",width:4},"In our system, ".concat(s,"s are only changed internally by ").concat(l,"s")),t.div({text:"6.",width:4},"When viewed as a Graph, the ".concat(c,"s between all ").concat(s,"s are the ").concat(d)),t.div({text:"7.",width:4},"The ".concat(d," is arranged in a hierarchy from a root, so that it looks like a POSIX filesystem for the familiarity of our users")),t.div({text:"8.",width:4},"When viewed as executables, the collection of ".concat(l,"s are the ").concat(f,"s of our ").concat(p," ")),t.div({text:"9.",width:4},"Including the ".concat(f," named the Dreamcatcher means we by default include the ").concat(f," that coordinates Talent into making more ").concat(f,"s")),t.div(),t.div("type 'help' for a list of commands"),t.div(),e.abrupt("return",{out:t.toString()});case 16:case"end":return e.stop()}}),e)}))),e.exports.help="Information about the HyperNet"},function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:blocks"),i=n(118).engine.blockPrint;e.exports=function(){var e=o(r.mark((function e(t){var n,o,s,c,u,l,p,d,f,h,v,g,y,m=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.blockchain,o=m.length,s=new Array(o>1?o-1:0),c=1;c<o;c++)s[c-1]=m[c];for(a("blocks %O",s),u=n.getContext(),l=u.wd,p=s[0]||l,a("using path: %o",p),f=p===l?n:n[p],h=f.getState().provenance.height,v=0,g="";v<=h;)y=[],d=f.getState(y,v),g+=i(d,p)+"\n",v++,a("next height: ",v);return e.abrupt("return",{out:g});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nShow the blocks of any given blockchain.\nIf no chain ID or alias given, print the blocks of the \nblockchain at the cwd\n"},function(e,t,n){var r=n(2),o=n(3);e.exports=o(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),e.exports.help="\nTo ensure the integrity of the system, invoke scrub to\ncheck the hashes of all objects at this location,\nand to verify the availability of all objects.\nUse the option --history to check all blocks in the past\nas well as LATEST.  This will incur significant usage fees\nand bandwidth.\n"},function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:namegen"),i=n(604);e.exports=function(){var e=o(r.mark((function e(t){var n,o,s=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t.spinner,t.blockchain,n=s.length>1&&void 0!==s[1]?s[1]:1,a("count: %O",n),o="";n>0;)o+=i.getRandomName(),--n>0&&(o+="\n");return e.abrupt("return",{out:o});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nGenerate a random name, which can be used as an identity for anything.\n"},,function(e,t,n){var r=n(2),o=n(3),a=n(9),i=n(12),s=n(22)("dos:auto-complete"),c=n(40),u=n(162).withSpin,l=n(113),p=function(){"use strict";function e(){a(this,e),this._list=[],this.getList=this.getList.bind(this)}return i(e,[{key:"updateList",value:function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.wd,(n=t.spinner)&&(n.text="Updating auto-complete list"),o=Object.keys(l),[],this._list=o;case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getList",value:function(e){return e.includes(" ")?this._list:Object.keys(l)}}]),e}();t.AutoComplete=p,t.withAutoComplete=function(e){return function(){var t=o(r.mark((function t(n){var o=arguments;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.autoComplete||(n.autoComplete=new p,n.autoComplete.updateList=u(n.autoComplete.updateList)),t.prev=1,t.next=4,n.autoComplete.updateList(n);case 4:t.next=10;break;case 6:t.prev=6,t.t0=t.catch(1),console.warn("".concat(c.yellow("\u26a0")," failed to update auto-complete list")),s(t.t0);case 10:return s("auto-complete"),t.abrupt("return",e.apply(this,o));case 12:case"end":return t.stop()}}),t,this,[[1,6]])})));return function(e){return t.apply(this,arguments)}}()}},function(e,t,n){var r=n(2),o=n(3);e.exports=function(){var e=o(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,t();case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},,,,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(5),o=n.n(r),a=n(259),i=n.n(a),s=(n(272),n(273),n(120),n(71)),c=n.n(s),u=n(260);c()("shell:App");c.a.enable("*metro* dos-shell*");var l=function(){return o.a.createElement(u.a,{style:{height:"100vh",backgroundColor:"black"}})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(l,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}]),[[267,1,2]]]);