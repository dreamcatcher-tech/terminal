/*! For license information please see main.a8a538b4.chunk.js.LICENSE.txt */
(this.webpackJsonpterminal=this.webpackJsonpterminal||[]).push([[0],{103:function(e,t,n){var r=n(4),o=n(20).standardize,a=n(152).covenantIdModel,i=n(104).timestampModel,s=n(69).keypairModel,c=n(127).aclModel,u=n(150).binaryModel,l=(n(41).integrityModel,n(105).networkModel),d=n(158).stateModel,p=n(159).configModel,f=n(160).validatorsModel,h=n(161).pendingModel,v=(n(107).rxRequestModel,o({schema:{type:"object",title:"Dmz",description:"DMZ coordinates all the models in one place.\nDmz is equivalent to CombineReducers in Redux.",required:["validators","encryption","config","network","covenantId","binaryIntegrity","acl","state","pending"],additionalProperties:!1,properties:{validators:f.schema,encryption:s.schema,config:p.schema,covenantId:a.schema,binaryIntegrity:u.schema,timestamp:i.schema,acl:c.schema,network:l.schema,state:d.schema,pending:h.schema}},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r("object"===typeof e);var t={validators:f.clone(e.validators),encryption:s.clone(e.encryption),config:p.create(e.config),covenantId:a.clone(e.covenantId),binaryIntegrity:u.clone(e.binaryIntegrity),acl:c.clone(e.acl),network:l.clone(e.network),state:d.clone(e.state),pending:h.create()};return v.clone(t)},logicize:function(e){var t=e.network,n=e.pending,o=e.config;r(n.isBufferValid(t)),r(!t[".@@io"]||o.isPierced);return{rx:function(){var e=t.rxReply();if(e)return e;if(!n.getIsPending()){var r=n.rxBufferedRequest(t);if(r)return r}return t.rxRequest()}}}}));e.exports={dmzModel:v}},104:function(e,t,n){var r=(0,n(20).standardize)({schema:{title:"Timestamp",type:"object",description:"Time of issuance in standard format, with Zulu offset",additionalProperties:!1,required:["date","ms"],properties:{date:{type:"string",format:"date-time",examples:["2011-10-05T14:48:00.000Z"]},ms:{type:"integer"}}},create:function(){var e=new Date,t=e.toISOString(),n=e.valueOf();return r.clone({date:t,ms:n})},logicize:function(e){return{isExpired:function(t){return Date.now()-e.ms>=t}}}});e.exports={timestampModel:r}},105:function(e,t,n){var r=n(7),o=n(4),a=(n(9)("interblock:models:network"),n(24)),i=n(20).standardize,s=n(106).channelModel,c=n(52).addressModel,u=n(68).provenanceModel,l=n(155).rxRequestModel,d=i({schema:{title:"Network",description:"All communication in and out of this blockchain.",type:"object",required:["..","."],additionalProperties:!1,minProperties:2,patternProperties:{"(.*?)":s.schema}},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e[".."]?e[".."]:s.create(c.create(),".."),n=e["."]?e["."]:s.create(c.create("LOOPBACK"),".");return o(n.address.isLoopback()),d.clone(r({},e,{"..":t,".":n}))},logicize:function(e){o(!e[void 0]);var t=Object.keys(e);o(t.includes("..")),o(t.includes(".")),o(s.isModel(e["."]),"channel invalid"),o("."===e["."].systemRole,"self not loopback channel");var n=function(n){var r;return t.find((function(t){var o,a=e[t],i=a.rxReply(),s=a.rxRequest();switch(n){case"reply":o=i;break;case"request":o=s}if(o)return r={alias:t,event:o,channel:a},!0})),r},r=function(){return Object.keys(e)},i=function(){return r().filter((function(t){return e[t].address.isResolved()&&".@@io"!==t}))},p=function(t){return o(c.isModel(t)),o(!t.isUnknown()),r().find((function(n){return e[n].address.equals(t)}))};return{rxReply:function(){return n("reply")},rxRequest:function(){return n("request")},rxSelf:function(){var t=e["."];return t.rxReply()||t.rxRequest()},getAliases:r,getResolvedAliases:i,getAlias:p,getParent:function(){return e[".."]},includesInterblock:function(t){var n=t.provenance;o(u.isModel(n));var r=p(n.getAddress());if(!r)return!1;var i=!1,s=e[r];if(n.height<=s.lineageHeight&&(i=!0),n.height===s.lineageHeight){var c=n.equals(a.last(s.lineageTip).provenance);o(c)}return t.getRemote()&&i?(n.height===s.heavy.provenance.height&&o(t.equals(s.heavy)),n.height<=s.heavy.provenance.height):i},getResponse:function(t){o(l.isModel(t));var n=t.getAddress(),r=t.getIndex(),a=p(n);return o(e[a]),e[a].replies[r]},txInterblockAliases:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.create();o(d.isModel(t));var n=i(),r=n.filter((function(n){var r=e[n],o=t.getAlias(r.address);if(!o)return!0;var a=t[o];return r.isTxGreaterThan(a)}));return r},isNewChannels:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.create();o(d.isModel(t));var n=i(),r=n.some((function(n){var r=e[n].address;if(!t.getAlias(r))return!0}));return r}}}});e.exports={networkModel:d}},106:function(e,t,n){var r=n(28),o=n(7),a=n(4),i=n(9)("interblock:models:channel"),s=n(24),c=n(107),u=c.rxRequestModel,l=c.rxReplyModel,d=n(20).standardize,p=n(52).addressModel,f=n(67).actionModel,h=n(88).continuationModel,v=n(109).remoteModel,g=d({schema:n(38).channelSchema,create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DOWN_LINK";e=p.clone(e);var n=v.create({address:e}),r=o({},n,{systemRole:t,requestsLength:0,lineage:[],lineageTip:[]});return g.clone(r)},logicize:function(e){var t=e.address,n=e.systemRole,o=e.requests,c=e.replies,d=e.heavy,p=e.lineageHeight,h=e.heavyHeight,x=e.lineage,w=e.lineageTip,I=(e.requestsLength,"."===n);I&&a(t.isLoopback()),t.isUnknown()&&a.strictEqual(Object.keys(c).length,0);var M=I?v.create(e):d&&d.getRemote()?d.getRemote():v.create();if(a(M),d&&(a(d.getRemote()||0===h),a.strictEqual(d.provenance.height,h),a(p>=h)),w.length){var P=s.last(w).provenance;a.strictEqual(P.height,p),a(s.last(x).equals(P.reflectIntegrity()))}a(w.every((function(e){return!e.getRemote()}))),b(o),b(c);var R=function(){if(!t.isUnknown())return k(M.replies).find((function(e){return!M.replies[e].isPromise()&&o[e]}))},E=function(){var e,t=k(M.requests),n=r(t);try{for(n.s();!(e=n.n()).done;){var o=e.value;if(!c[o])return o}}catch(a){n.e(a)}finally{n.f()}};return{rxRequest:function(e){if(!t.isUnknown()||I){Number.isInteger(e)||(e=E());var n=M.requests[e];if(n){a(f.isModel(n));var r=n.type,o=n.payload,s=u.create(r,o,t,e);return i("rxRequest ".concat(s.type)),s}}},rxReply:function(e){if(Number.isInteger(e)||(e=R()),Number.isInteger(e)&&!(e<0)){a(o[e],"No request for: ".concat(e)),a(M.replies[e],"No reply for: ".concat(e));var t=M.replies[e],n=t.type,r=t.payload,i=o[e];return l.create(n,r,i)}},rxReplyIndex:R,getNextReplyIndex:E,getRemoteRequestIndices:function(){return k(M.requests)},getRemoteReplyIndices:function(){return k(M.replies)},isTxGreaterThan:function(e){a(g.isModel(e));var n=!e.address.equals(t),r=m(c,e.replies),i=m(o,e.requests),s=y(c,e.replies);return n||r||i||s},getRemote:function(){return M},getOutboundPairs:function(){return k(o).map((function(e){return[o[e],M.replies[e]]}))},getRequestIndices:function(){return k(o)}}}}),y=function(e,t){return k(e).some((function(n){var r=e[n],o=t[n];return!(!o||!r)&&(a(h.isModel(r)),a(h.isModel(o)),o.isPromise()&&!r.isPromise())}))},m=function(e,t){var n=k(e),r=k(t),o=x(n,r);return o},k=function(e){var t=[];return Object.keys(e).forEach((function(e){var n=parseInt(e);t.push(n)})),t.sort((function(e,t){return e-t})),t},b=function(e){var t=-1,n=Object.keys(e).every((function(e){var n=parseInt(e),r=n>t;return t=n,r}));a(n)},x=function(e,t){return!(!t.length&&!e.length)&&(!(t.length||!e.length)||!(t.length&&!e.length)&&s.last(t)<s.last(e))};e.exports={channelModel:g}},107:function(e,t,n){var r=n(244).rxReplyModel,o=n(155).rxRequestModel,a=n(156).txReplyModel,i=n(157).txRequestModel,s=n(1731).reductionModel;e.exports={rxReplyModel:r,rxRequestModel:o,txReplyModel:a,txRequestModel:i,reductionModel:s}},108:function(e,t){e.exports={txRequestSchema:{title:"txRequest",description:"Covenant created",type:"object",required:["type","payload","to"],additionalProperties:!1,properties:{type:{type:"string"},payload:{type:"object"},to:{type:"string"}}},rxRequestSchema:{title:"rxRequest",description:"System created inside ChannelModel",type:"object",required:["type","payload","sequence"],additionalProperties:!1,properties:{type:{type:"string"},payload:{type:"object"},sequence:{type:"string",pattern:""}}},txReplySchema:{title:"txReply",description:"Covenant created",type:"object",required:["type","payload","request"],additionalProperties:!1,properties:{type:{type:"string",enum:["@@REJECT","@@PROMISE","@@RESOLVE"]},payload:{type:"object"},request:{description:"Sequence created in rxRequest",type:"object",required:["sequence"],additionalProperties:!1,properties:{sequence:{type:"string",pattern:""}}}}},rxReplySchema:{title:"rxReply",description:'System created.\nCreate requires the sequence to be included.\n@@PROMISE cannot ever be dispatched to a reducer, hence its exclusion from "type"',type:"object",required:["type","payload","request"],additionalProperties:!1,properties:{type:{type:"string",enum:["@@REJECT","@@RESOLVE"]},payload:{type:"object"},request:{description:"Covenants original request, without the 'to' field",type:"object",required:["type","payload"],additionalProperties:!1,properties:{type:{type:"string"},payload:{type:"object"}}}}}}},109:function(e,t,n){var r=n(7),o=n(4),a=(n(24),n(20).standardize),i=n(38).remoteSchema,s=n(52).addressModel,c=a({schema:i,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o("object"===typeof e);var t={},n=["address","requests","replies","heavyHeight","lineageHeight"];n.forEach((function(n){e[n]&&(t[n]=e[n])}));var a={address:s.create(),requests:{},replies:{},heavyHeight:-1,lineageHeight:-1},i=r({},a,{},t);return c.clone(i)},logicize:function(e){return{}}});e.exports={remoteModel:c}},110:function(e,t,n){var r=n(7),o=n(47),a=n(4),i=(n(24),n(9)("interblock:models:interblock"),n(20).standardize),s=(n(68).provenanceModel,n(41).integrityModel,n(88).continuationModel),c=n(84).blockModel,u=n(106).channelModel,l=n(109).remoteModel,d=n(38).interblockSchema,p=n(163).proofModel,f=i({schema:d,create:function(e,t){a(c.isModel(e)),h(e,t);var n=e.provenance,r=e.validators,i={provenance:n,proof:p.create(e,t),validators:r};if(t){var s=e.network[t];a(u.isModel(s));var d=l.create(s);i.network=o({},t,d)}return f.clone(i)},logicize:function(e){var t,n=e.provenance,o=(e.proof,e.validators,e.network),i=o&&Object.keys(o)[0],u=i&&o[i];if(a(!u||l.isModel(u)),i){a.strictEqual(Object.keys(o).length,1);var d=o[i];a(!d.address.isUnknown(),"interblock transmission address must be known")}var p,h=function(){if(!t){var e=c.clone(u.requests[0].payload.genesis);a(e.provenance.address.isGenesis()),t=e}return t},v=function(){if(!u)return!1;var e=u.requests[0],t=1===u.requests.length;return!(!e||"@@INTRO"!==e.type||!t)||void 0};return{extractGenesis:h,getTargetAddress:function(){return u&&u.address},getOriginAlias:function(){return i},getRemote:function(){return u},isConnectionAttempt:v,isGenesisAttempt:function(){try{return h()}catch(e){}return!1},getWithoutRemote:function(){if(!p){var t={block:e.proof.block},n=r({},e,{proof:t});delete n.network,p=f.clone(n)}return p},getLineageHeight:function(){return u.lineageHeight},getHeavyHeight:function(){return u.heavyHeight},isConnectionResponse:function(){if(!u)return!1;a(u&&i);var e=-1===u.lineageHeight&&-1===u.heavyHeight,t=i.startsWith("@@PUBLIC_"),n=i.substring("@@PUBLIC_".length),r=t&&n===u.address.getChainId(),o=u.requests[0],s=o&&"@@ACCEPT"===o.type,c=!Object.keys(u.replies).length;return e&&r&&s&&c},isConnectionResolve:function(){if(!v())return!1;var e=u.replies[0];return e?(a(s.isModel(e)),e.isResolve()):void 0},isDownlinkInit:function(){if(!u)return!1;var e=u.requests[0]&&!Object.keys(u.replies).length,t=u.heavyHeight<0;return e&&t},isUplinkInit:function(){return!!u&&(u.replies[0]&&!Object.keys(u.requests).length)},getChainId:function(){return n.getAddress().getChainId()}}}}),h=function(e,t){if(t&&"string"!==typeof t)throw new Error("Invalid format for target alias: ".concat(t));if(!e.isValidated())throw new Error("Only validated blocks can be reduced to Interblocks");if("."===t)throw new Error("Cannot make interblock from loopback channel")};e.exports={interblockModel:f}},111:function(e,t,n){var r=n(7),o=n(2),a=n(3),i=n(4),s=n(40).interpret,c=n(1736).machineLogger,u=function(){var e=a(o.mark((function e(t,n){var i,u,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c(t.type||t,n.id),u=s(n,{execute:!1}),l=new Promise((function(e,t){var n=!1;u.onTransition(function(){var e=a(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("error"===t.value&&(n=t.event),"error"===t.value||"done"===t.value){e.next=4;break}return e.next=4,i.writeTransition(t.value,t.event,t.context);case 4:u.execute(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),u.onDone(function(){var s=a(o.mark((function a(s){var c,u,l;return o.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!n){o.next=11;break}return(c=n).type,u=c.data,(l=r({},new Error,{},u)).message=u.message,l.stack=u.stack,l.name=u.name,o.next=8,i.writeTermination(l);case 8:t(l),o.next=14;break;case 11:return o.next=13,i.writeTermination();case 13:e(s.data);case 14:case"end":return o.stop()}}),a)})));return function(e){return s.apply(this,arguments)}}())})),u.start(),u.send(t),e.abrupt("return",l);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();e.exports={thread:u,setLogger:function(e){i.strictEqual(typeof e,"function"),c=e}}},112:function(e,t,n){var r=n(2),o=n(3),a=n(7),i=n(4),s=n(34)["@@GLOBAL_HOOK"],c=n(21),u=c.blockModel,l=c.rxReplyModel,d=c.rxRequestModel,p=n(86),f=n(9)("interblock:isolate");e.exports={isolateFactory:function(e){var t=function(e){var t={},n=a({},p,{},e);return{loadCovenant:function(){var e=o(r.mark((function e(o){var a,s,c,l;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(u.isModel(o)),a=o.covenantId,s=o.provenance.reflectIntegrity().hash,c=a.name,i(n[c],"No covenant loaded: ".concat(c)),f("loadCovenant %o from %o",c,Object.keys(n)),f("containerId: %o",s.substring(0,9)),l=n[c],t[s]={covenant:l,block:o,effects:{}},e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),tick:function(){var e=o(r.mark((function e(n){var o,a,c,u,p,h,v,g,y,m,k,b,x,w,I;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.containerId,a=n.state,c=n.action,u=n.accumulator,p=void 0===u?[]:u,h=n.timeout,f("tick: %o action: %o",o.substring(0,9),c.type),v=t[o],i(v,"No tick container for: ".concat(o)),i(!a||"object"===typeof a),i(Array.isArray(p)),h=h||3e4,i(Number.isInteger(h)&&h>=0),l.isModel(c)?i(!p.length):i(d.isModel(c)),g=function(){return v.covenant.reducer(a,c)},y=c.getHash(),e.next=13,s(g,p,y);case 13:return m=e.sent,f("syncResult",m),k=m.reduction,b=m.isPending,x=m.requests,w=m.replies,i(k&&!b||!k&&b),i.strictEqual(typeof b,"boolean"),i(Array.isArray(x)),i(Array.isArray(w)),b&&i(p.length||x.length),I=x.map((function(e){if(".@@io"===e.to){i.strictEqual(typeof e.exec,"function");var t=e.payload[".@@ioRequestId"];return i.strictEqual(typeof t,"string"),i(t.length>y.length+1),i(!v.effects[t]),v.effects[t]=e,{type:e.type,payload:e.payload,to:e.to}}return e})),e.abrupt("return",{reduction:k,isPending:b,requests:I,replies:w});case 23:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),unloadCovenant:function(){var e=o(r.mark((function e(n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f("attempting to unload: %o",n),e.next=3,Promise.resolve();case 3:i(t[n],"No container for: ".concat(n)),delete t[n];case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),setEffectPermissions:function(){var e=o(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.containerId,t.permissions;case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),executeEffect:function(){var e=o(r.mark((function e(n){var o,a,s,c,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.containerId,a=n.effectId,n.timeout,f("executeEffect effectId: %o",a),s=t[o],i(s,"No effects container for: ".concat(o)),i(s.effects[a],"No effect for: ".concat(a)),c=s.effects[a],f("action: ",c),i.strictEqual(typeof c.exec,"function"),e.next=10,c.exec();case 10:return u=e.sent,e.abrupt("return",u);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}(e);return function(e){switch(e.type){case"LOAD_COVENANT":return t.loadCovenant(e.payload);case"TICK":return t.tick(e.payload);case"UNLOAD_COVENANT":return t.unloadCovenant(e.payload);case"EXECUTE":return t.executeEffect(e.payload);default:throw new Error("Unknown isolator action type")}}},toFunctions:function(e){return{loadCovenant:function(t){return e.push({type:"LOAD_COVENANT",payload:t})},tick:function(t){return e.push({type:"TICK",payload:t})},unloadCovenant:function(t){return e.push({type:"UNLOAD_COVENANT",payload:t})},executeEffect:function(t){return e.push({type:"EXECUTE",payload:t})}}}}},113:function(e,t,n){var r=n(2),o=n(3),a=n(9)("interblock:services:crypto"),i=n(4),s=n(21),c=s.cryptoCacher,u=s.keypairModel,l=s.integrityModel,d=n(53),p=d.ramDynamoDbFactory,f=d.dbFactory,h=n(48),v=c.cacheVerifyKeypair,g=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CI";e=e||p();var n=f(e);i("string"===typeof t);var s,c=function(){var e=o(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(l.isModel(t)),e.next=3,g();case 3:return n=e.sent,e.abrupt("return",n.sign(t));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=o(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g();case 2:return t=e.sent,e.abrupt("return",t.getValidatorEntry());case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=function(){var e=o(r.mark((function e(){var o,i,c,l,d,p,f,g;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s){e.next=2;break}return e.abrupt("return",s);case 2:return e.next=4,n.scanKeypair();case 4:if(!(o=e.sent)){e.next=12;break}return i=JSON.parse(o.keypairJson),e.next=9,v(i);case 9:s=u.clone(i),e.next=30;break;case 12:return e.next=14,h.generateKeyPair();case 14:return c=e.sent,l=u.create(t,c),d=l.serialize(),e.next=19,n.putKeypair({keyname:t,keypairJson:d});case 19:return e.next=21,n.scanKeypair();case 21:if(p=e.sent,f=p.keypairJson){e.next=25;break}throw new Error("cannot store keypair");case 25:return g=JSON.parse(f),e.next=28,v(g);case 28:(s=u.clone(g)).equals(l)||a("collision avoided for: ",t);case 30:return e.abrupt("return",s);case 31:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{sign:c,getValidatorEntry:d}};e.exports={cryptoFactory:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CI",n=g(e,t),i=function(){var e=o(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a("crypto: ".concat(t.type)),e.t0=t.type,e.next="SIGN"===e.t0?4:"VALIDATOR"===e.t0?5:6;break;case 4:return e.abrupt("return",n.sign(t.payload));case 5:return e.abrupt("return",n.getValidatorEntry());case 6:throw new Error("Unknown crypto action type: ".concat(t.type));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return i},toFunctions:function(e){return{sign:function(t){return e.push({type:"SIGN",payload:t})},getValidatorEntry:function(){return e.push({type:"VALIDATOR"})}}},crypto:h}},114:function(e,t,n){(function(t){var r=n(59),o=n(2),a=n(3),i=n(9)("interblock:aws:ramDynamoDb"),s=n(4),c=(n(24),{dbChains:"height",dbPools:"originChainId_height_type",dbLocks:"chainId",dbSockets:"socketId",dbSubscribers:"targetChainId",dbPiercings:"hash"}),u=function(e,t){return t[c[e]]};e.exports={ramDynamoDbFactory:function(){var e={dbCrypto:{},dbChains:{},dbPools:{},dbLocks:{},dbSubscribers:{},dbSockets:{},dbPiercings:{}};return{get:function(n,r){var c=n.TableName,l=n.Key;i("get %O callback: %O",c,r),s(e[c]),r&&t(a(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=r,e.next=3,d.promise();case 3:e.t1=e.sent,(0,e.t0)(null,e.t1);case 5:case"end":return e.stop()}}),e)}))));var d={promise:function(){var t=a(o.mark((function t(){var n,r,a;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:return s(l.chainId),n=e[c][l.chainId]||{},r=u(c,l),a=n[r],t.abrupt("return",{Item:a});case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()};return d},query:function(t){i("query %O",t.TableName);var n=t.TableName,r=t.KeyConditionExpression,c=t.ExpressionAttributeValues;s.strictEqual(r,"chainId = :hkey");var u=c[":hkey"];return s(u),{promise:function(){var t=a(o.mark((function t(){var r,a;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:return r=e[n][u]||{},a=Object.values(r).reverse(),t.abrupt("return",{Items:a});case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}},delete:function(t){var n=t.TableName,r=t.Key;return i("del %O %O",n,r),{promise:function(){var t=a(o.mark((function t(){var a,i,c;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:a=e[n][r.chainId],i=u(n,r),c=a[i],s(c,"cannot delete non existent item"),delete a[i];case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}},put:function(n,s){var c=n.TableName,l=n.Item;r(n,["TableName","Item"]);i("put %O %O",c,l.chainId),s&&t(a(o.mark((function e(){var t;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.promise();case 3:t=e.sent,s(null,t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),s(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))));var d={promise:function(){var t=a(o.mark((function t(){var n,r,a;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:return n=l.chainId,r=e[c][n]||{},a=u(c,l),r[a]&&i("already exists: %O",l.chainId),r[a]=l,e[c][n]=r,t.abrupt("return",!0);case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()};return d},scan:function(t){var n=t.TableName,r=t.Limit;return i("scan: %O %O",n,r),s(["dbChains","dbCrypto"].includes(n)),s.strictEqual(r,1),{promise:function(){var t=a(o.mark((function t(){var r,a,i;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:return r=e[n],a=Object.values(r)[0],i=[],a&&i.push(Object.values(a)[0]),t.abrupt("return",{Items:i});case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}},_getTables:function(){return e}}}}}).call(this,n(57).setImmediate)},116:function(e,t,n){t.cd=n(263),t.config=n(1844),t.exit=n(1845),t.help=n(1846),t.ls=n(1858),t.pwd=n(1860),t.version=n(1861),t.pkg=n(1863),t.clear=n(1864),t.error=n(1866),t.open=n(1867),t.login=n(1870),t.logout=n(1871),t.su=n(1872),t.add=n(1874),t.ln=n(1875),t.rm=n(1876),t.whoami=n(1877),t.search=n(1878),t.time=n(1879),t.ping=n(1882),t.reset=n(1883),t.dns=n(1884),t.cat=n(1885),t.net=n(1886),t.debug=n(1887),t.edit=n(1888),t.about=n(1889),t.blocks=n(1890),t.scrub=n(1891),t.namegen=n(1892),t.validators=n(1894)},121:function(e,t,n){var r=n(291),o=r.browserFactory,a=r.effectorFactory,i=r.awsFactory,s=n(126),c=n(21);e.exports={browserFactory:o,effectorFactory:a,awsFactory:i,engine:s,models:c}},126:function(e,t,n){var r=n(292).metrologyFactory,o=n(177).standardEngineFactory,a=n(53),i=a.consistencyFactory,s=a.toFunctions,c=n(113),u=c.cryptoFactory,l=c.crypto,d=n(253).blockPrint,p=n(111).setLogger;e.exports={metrologyFactory:r,standardEngineFactory:o,consistencyFactory:i,cryptoFactory:u,crypto:l,blockPrint:d,setLogger:p,consistencyQueueToFunctions:s}},127:function(e,t,n){var r=(0,n(20).standardize)({schema:{type:"object",title:"Acl",description:"Access control list, power rating, alias table, and chargeout rates\nGroups are similar to roles.\nGroups contain only Actors\nActors are similar to users, but represent chains\nThis is the alias table\nActors contain only a single ChainId\nThis might be extended to cover token balance from other chains.\nCould use proofs to show your current balance when an action was requested.\n\nAlias table is contained within the join slices directly.",required:["groups","everybody","balance","shares","costs"],additionalProperties:!1,properties:{groups:{},everybody:{},balance:{},shares:{},costs:{}}},create:function(){return r.clone({groups:{children:{alice:50,chain123:60},founders:{chain123:1}},everybody:{},balance:{},shares:{children:0,founders:100},costs:{"*":{children:50}}})},logicize:function(e){return{isAllowed:function(e,t,n){}}}});e.exports={aclModel:r}},150:function(e,t,n){var r=n(20).standardize,o=n(41).integrityModel,a=r({schema:{title:"Binary",type:"object",description:"Manages the binary attached to each chain.",additionalProperties:!1,required:["integrity","size"],properties:{integrity:o.schema,size:{type:"number",min:0}}},create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e=o.clone(e),a.clone({integrity:e,size:t})},logicize:function(e){return{}}});e.exports={binaryModel:a}},151:function(e,t,n){var r=n(48),o=n(20).standardize,a=(n(85).publicKeyModel,n(41).integrityModel,o({schema:n(38).signatureSchema,create:function(){throw new Error("Only the keypairModel can create signatureModel types")},logicize:function(e){var t=e.integrity,n=e.seal,o=e.publicKey,a=t.hash,i=o.key;if(!r.verifyHashSync(a,n,i)){var s=new Error("Could not verify hash synchronously: ".concat(a));throw s.toVerify={hash:a,seal:n,key:i},s}return{}}}));e.exports={signatureModel:a}},152:function(e,t,n){var r=n(20).standardize,o=n(41).integrityModel,a=r({schema:{title:"CovenantId",description:"Covenants are how behaviour is introduced to the system.\nA Covenant represents the loaded piece of language specific code.\nA covenant is a binary package on disk, but in ram it is executable code.\n\nIn all languages, a reducer must be supplied.\nThis pure function takes a json state, and a json action, and returns a json state\n\nOptionally, a list of async functions that are invoked by the side effect system \nmay be supplied",type:"object",additionalProperties:!1,required:["name","version","integrity","language"],properties:{name:{type:"string"},version:{type:"string"},integrity:o.schema,language:{enum:["javascript","javascript/xstate","python","go","rust","haskell","c","c++"]}}},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unity",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0.0.0",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"javascript",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.create();if(!o.isModel(r))throw new Error("Invalid integrity for name: ".concat(e));return a.clone({name:e,version:t,integrity:r,language:n})},logicize:function(e){return{isSystemCovenant:function(){return i(e.name)}}}}),i=function(e){return"string"===typeof e&&!!n(86)[e]};e.exports={covenantIdModel:a}},154:function(e,t,n){var r=n(1727);e.exports=r},155:function(e,t,n){var r=n(4),o=n(20).standardize,a=n(245),i=n(67).actionModel,s=n(52).addressModel,c=o({schema:n(108).rxRequestSchema,create:function(e,t,n,o){r(Number.isInteger(o)),r(s.isModel(n));var a={type:e,payload:t,sequence:"".concat(n.getChainId(),"_").concat(o)};return c.clone(a)},logicize:function(e){var t=e.type,n=e.payload,o=e.sequence,s=a(o),c=s.address,u=s.index;r(!c.isUnknown()),r(Number.isInteger(u)),r(u>=0);var l=i.create({type:t,payload:n});return{getAddress:function(){return c},getIndex:function(){return u},getRequest:function(){return l},isReply:function(){return!1}}}});e.exports={rxRequestModel:c}},156:function(e,t,n){var r=n(4),o=n(20).standardize,a=n(88).continuationModel,i=n(108).txReplySchema,s=n(245),c=o({schema:i,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"@@RESOLVE",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;r.strictEqual(typeof t,"object");var o={type:e,payload:t,request:{sequence:n}};return c.clone(o)},logicize:function(e){var t=e.type,n=e.payload,r=e.request.sequence,o=s(r),i=o.address,c=o.index,u=a.create(t,n);return{getAddress:function(){return i},getIndex:function(){return c},getReply:function(){return u}}}});e.exports={txReplyModel:c}},157:function(e,t,n){var r=n(4),o=n(20).standardize,a=n(67).actionModel,i=o({schema:n(108).txRequestSchema,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"DEFAULT_TX_REQUEST",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";r.strictEqual(typeof t,"object");var o={type:e,payload:t,to:n};return i.clone(o)},logicize:function(e){var t=e.type,n=e.payload,r=(e.to,a.create({type:t,payload:n}));return{getRequest:function(){return r}}}});e.exports={txRequestModel:i}},158:function(e,t,n){var r=(0,n(20).standardize)({schema:{title:"State",description:"The result of running a covenant is stored here.\nIt checks the state minus the actions is serializable\nIncludes the array of requests and replies returned from \nreducing the covenant.  These actions are intended to be transmitted\nvia the network.  This model enforces the format and logic of the\nreturns from the reducer\n\nThis is how covenant info is ingested back into the trusted system.\nIt is crucial that the format of this data is correct\n\nEntry point from covenant to system.\n\nMaximally inflates actions with defaults.  Logical checking is done inside\nthe networkProducer as needs context of the initiating action to fill in\nremaining defaults\n\nThe actions in from the covenant are refined over three states:\n1. create( state ) inflates actions to pass schema validation\n2. logicize( state ) checks static logic\n3. networkProducer.tx( state ) checks context logic\n\nThe returned model is forbidden to have an actions key on it.\nThe validation is run during clone, then logicize strips the actions out.\n\nCreate is only called immediately after a reducer call returns some state.\nTherefore, we always know what the default action is, so we require it of create.\n",type:"object",required:[]},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.clone(e)},logicize:function(e){return{}}});e.exports={stateModel:r}},159:function(e,t,n){var r=n(7),o=(0,n(20).standardize)({schema:{title:"Config",description:"Configuration options for the chain",type:"object",required:["isPierced","sideEffects","isPublicChannelOpen"],additionalProperties:!1,properties:{isPierced:{type:"boolean",description:"If the chain should be reduced, even with no known actions"},sideEffects:{type:"object",description:"When reducing, will this chain be allowed network access",required:["networkPatterns","asyncTimeoutMs"],properties:{networkPatterns:{type:"array",description:"Empty string means no network access",items:{type:"string",format:"regex"}},asyncTimeoutMs:{type:"number",description:"0 means no timeout allowed",minimum:0}}},isPublicChannelOpen:{type:"boolean",description:"Will the validators open up new channels on request from unknown chains"}}},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={networkPatterns:[""],asyncTimeoutMs:0};e=r({},e,{sideEffects:r({},t,{},e.sideEffects)});var n={isPierced:!1,sideEffects:t,isPublicChannelOpen:!1};return o.clone(r({},n,{},e))},logicize:function(e){return{}}});e.exports={configModel:o}},160:function(e,t,n){var r=n(20).standardize,o=n(38).validatorsSchema,a=(n(85).publicKeyModel,n(69)),i=a.keypairModel,s=a.ciKeypair,c=r({schema:o,create:function(){var e=i.create("CI",s).getValidatorEntry();return c.clone(e)},logicize:function(e){return{}}});e.exports={validatorsModel:c}},161:function(e,t,n){var r=n(4),o=n(20).standardize,a=n(107),i=a.rxRequestModel,s=a.rxReplyModel,c=n(162).simpleArrayModel,u=n(105).networkModel,l=n(52).addressModel,d=o({schema:{title:"Pending",description:"Indicates chain is waiting for a promise to resolve\n    Stores the address and index of the request.\n    Note that only requests can be origin actions for promises\n    First request is the origin request\n    The pendingRequest is saved in its entirety so structural changes\n    can occur to networking and channels, and the request will still\n    be able to proceed.",type:"object",required:["replies","requests"],additionalProperties:!1,properties:{pendingRequest:i.schema,replies:{type:"array",description:"Full replies, allowing the originating request to be lowered,\n        and the remote side to lower the reply, without losing it from the accumulator",uniqueItems:!0,items:s.schema},requests:{type:"object",additionalProperties:!1,patternProperties:{"(.*?)":c.schema}}}},create:function(){return d.clone({replies:[],requests:{}})},logicize:function(e){var t=e.pendingRequest,n=e.replies,o=e.requests;t||r(!n.length);return{getIsPending:function(){return!!t},isBufferValid:function(e){return!0},getAccumulator:function(){return n},rxBufferedRequest:function(e){r(u.isModel(e));var t=Object.keys(o);if(t.length){var n=t[0],a=l.create(n),s=e.getAlias(a);r(s);var c=e[s];r(c);var d=o[n][0];r(d>=0);var p=c.rxRequest(d);return r(i.isModel(p)),{alias:s,event:p,channel:c}}},getIsBuffered:function(e){r(i.isModel(e));var t=e.getAddress().getChainId(),n=e.getIndex();return!!o[t]&&o[t].includes(n)}}}});e.exports={pendingModel:d}},162:function(e,t,n){var r=n(4),o=(0,n(20).standardize)({schema:{title:"SimpleArray",description:"ascending indexes of requests to process",type:"array",uniqueItems:!0,items:{type:"number",minimum:0,multipleOf:1}},create:function(){return o.clone([])},logicize:function(e){var t=e.every((function(t,n){return!n||t>e[n-1]}));return r(t,"Values not monotonic: ".concat(e)),{}}});e.exports={simpleArrayModel:o}},163:function(e,t,n){var r=n(4),o=n(20).standardize,a=n(38).proofSchema,i=n(84).blockModel,s=o({schema:a,create:function(e,t){r(i.isModel(e));var n={block:e.getProof()};return t&&(r(e.network[t],"missing ".concat(t)),n.network=e.network.getProof(),n.channel=e.network[t].getProof()),s.clone(n)},logicize:function(e){return{}}});e.exports={proofModel:s}},165:function(e,t,n){var r=n(2),o=n(3),a=n(9)("interblock:aws:ramS3"),i=n(4);n(24);e.exports={ramS3Factory:function(){var e={wbblockbucket:{},wbinterbucket:{}};return{putObject:function(t){var n=t.Bucket,s=t.Key,c=t.Body;return a("putObject %O %O",n,s),i("string"===typeof n),i("string"===typeof s),i("object"===typeof c),{promise:function(){var t=o(r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:return i(e[n]),e[n][s]&&a("item already exists: %O %O",n,s),e[n][s]=c,t.abrupt("return",!0);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}},getObject:function(t){var n=t.Bucket,s=t.Key;return a("getObject %O %O",n,s),i("string"===typeof n),i("string"===typeof s),{promise:function(){var t=o(r.mark((function t(){var o;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:return i(e[n]),e[n][s]||(a(n),a(s)),i(e[n][s]),o=e[n][s],t.abrupt("return",{Body:o});case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}},deleteObject:function(t){var n=t.Bucket,s=t.Key;return a("deleteObject %O %O",n,s),{promise:function(){var t=o(r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve();case 2:return i(e[n]),i(e[n][s]),delete e[n][s],t.abrupt("return",!0);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}},_getBuckets:function(){return e},_isRam:!0}}}},168:function(e,t,n){var r=n(17),o=n(22)("dos:eval"),a=n(116);e.exports.evaluate=function(e,t,n){if(o(t,n),t=t||""){if(!a[t])throw new Error("".concat(t,": command not found"));return a[t].apply(a,[e].concat(r(n)))}}},169:function(e,t,n){var r=n(2),o=n(3),a=n(255),i=n(22)("dos:spinner");t.withSpin=function(e){return function(){var t=o(r.mark((function t(n){var o=arguments;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i("spinner"),n.spinner=a({spinner:"clock"}).start(),t.prev=2,t.next=5,e.apply(this,o);case 5:return t.abrupt("return",t.sent);case 8:throw t.prev=8,t.t0=t.catch(2),i(t.t0),t.t0;case 12:return t.prev=12,n.spinner.stop(),n.spinner=null,t.finish(12);case 16:case"end":return t.stop()}}),t,this,[[2,8,12,16]])})));return function(e){return t.apply(this,arguments)}}()}},1718:function(e,t,n){var r=n(33),o=n(28),a=n(59),i=n(2),s=n(7),c=n(3),u=n(4),l=n(9)("interblock:dmzReducer"),d=(n(24),n(83)),p=n(21),f=p.actionModel,h=p.addressModel,v=p.covenantIdModel,g=p.dmzModel,y=p.blockModel,m=p.interblockModel,k=p.channelModel,b=p.networkModel,x=p.txRequestModel,w=p.rxRequestModel,I=p.rxReplyModel,M=n(70),P=M.networkProducer,R=M.channelProducer,E=n(34),C=E.replyPromise,q=E.replyResolve,A=E.replyReject,O=E.isReplyFor,T=E.effectInBand,S=E.interchain,N=function(){var e=c(i.mark((function e(t,n){var r,o,a,c,d,p,f,h,v,m,k,b,x,M,P,R,E,A,T;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l("reducer( ".concat(n.type," )")),u(g.isModel(t)),u(I.isModel(n)||w.isModel(n)),r=t.network,e.t0=n.type,e.next="@@SPAWN"===e.t0?7:"@@CONNECT"===e.t0?13:"@@UPLINK"===e.t0?15:"@@GENESIS"===e.t0?19:"@@OPEN_CHILD"===e.t0?20:"@@LIST_CHILDREN"===e.t0?22:"@@GET_GIVEN_NAME"===e.t0?25:"@@INTRO"===e.t0?28:"@@ACCEPT"===e.t0?29:"@@DEPLOY"===e.t0?30:34;break;case 7:return e.next=9,j(t,n);case 9:return o=e.sent,r=o,C(),e.abrupt("break",35);case 13:return r=z(t.network,n),e.abrupt("break",35);case 15:return a=B(t.network,n),c=a.nextNetwork,d=a.payload,q(d),r=c,e.abrupt("break",35);case 19:return e.abrupt("break",35);case 20:return K(t.network,n),e.abrupt("break",35);case 22:return p=_(t.network),q(p),e.abrupt("break",35);case 25:return f=F(t.network),q(f),e.abrupt("break",35);case 28:case 29:return e.abrupt("break",35);case 30:return e.next=32,G(t,n);case 32:return r=e.sent,e.abrupt("break",35);case 34:return e.abrupt("break",35);case 35:if(!O(n)){e.next=60;break}h=n.getRequest(),e.t1=h.type,e.next="@@GENESIS"===e.t1?40:"@@UPLINK"===e.t1?46:"@@OPEN_CHILD"===e.t1?52:"@@DEPLOY"===e.t1?57:60;break;case 40:return v=h.payload,m=v.genesis,k=v.alias,b=v.originAction,x=y.clone(m),M={alias:k,chainId:x.getChainId()},b.sequence&&q(M,b),l("reply received for @@GENESIS"),e.abrupt("break",60);case 46:return P=h.payload.originAction.payload.alias,l("reply received for @@UPLINK: %o",P),R=r[P].address.getChainId(),q({chainId:R},h.payload.originAction),e.abrupt("break",60);case 52:return E=n.payload.chainId,l("reply received for @@OPEN_CHILD: %o",E.substring(0,9)),A=h.payload.fullPath,S(D.connect(A,E)),e.abrupt("break",60);case 57:return l("reply received for deploy",n),H(t,n),e.abrupt("break",60);case 60:return T=s({},t,{network:r}),e.abrupt("return",T);case 62:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),D={},L={spawn:"@@SPAWN",connect:"@@CONNECT",uplink:"@@UPLINK",intro:"@@INTRO",accept:"@@ACCEPT",genesis:"@@GENESIS",openChild:"@@OPEN_CHILD",listChildren:"@@LIST_CHILDREN",getGivenName:"@@GET_GIVEN_NAME",deploy:"@@DEPLOY"};D.spawn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r={type:L.spawn,payload:{alias:e,spawnOpts:t,initialActions:n}};return e||delete r.payload.alias,r};var j=function(){var e=c(i.mark((function e(t,n){var r,o,a,c,d,p,h,v,w,I,M,E,C,q,A;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.payload,o=r.alias,a=r.spawnOpts,c=r.initialActions,Array.isArray(c)||(c=[c]),c=c.map((function(e){var t=e.type,n=e.payload,r=e.to;return x.create(t,n,r)})),d=t.network,p=t.validators,h=t.covenantId,v=P.tx(b.create(),c,[]),w=g.create(s({network:v,covenantId:h},a,{validators:p})),l("spawn alias: ".concat(o)),o=o||V(d),u(!o.includes("/"),'No / character allowed in "'.concat(o,'"')),I=!d[o]||d[o].address.isUnknown(),u(I,"childAlias exists: ".concat(o)),e.next=13,T("SIGN_BLOCK",y.create,w);case 13:return M=e.sent,u(y.isModel(M),"Genesis block creation failed"),E={genesis:M,alias:o,originAction:n},C=f.create("@@GENESIS",E),q=M.provenance.getAddress(),A=b.clone(d,(function(e){var t=k.create(q,"./"),n=m.create(M);t=R.ingestInterblock(t,n),t=R.txRequest(t,C),d[o]&&d[o].getRequestIndices().forEach((function(e){var n=d[o].requests[e];t=R.txRequest(t,n)})),e[o]=t})),e.abrupt("return",A);case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();D.connect=function(e,t){return{type:L.connect,payload:{alias:e,chainId:t}}};var z=function(e,t){return b.clone(e,(function(n){u(b.isModel(e));var r=h.create(t.payload.chainId);u(r.isResolved()),u.strictEqual(r.getChainId(),t.payload.chainId);var o=t.payload.alias;u(o&&"string"===typeof o);var a=e[o]||k.create(r);n[o]=R.setAddress(a,r)}))};D.connectUplink=function(e,t){return{type:L.uplink,payload:{chainId:e,originAction:t}}};var B=function(e,t){var n,r=b.clone(e,(function(r){u(b.isModel(e));var o=h.create(t.payload.chainId);u.strictEqual(o.getChainId(),t.payload.chainId),u(o.isResolved());var a=e.getAlias(o);u(!a||"UP_LINK"!==e[a].systemRole),n=V(e,".uplink_"),u(!e[n]),r[n]=k.create(o);var i=t.payload.chainId.substring(0,9);l("connectUplinkReducer ".concat(n," set to ").concat(i))}));return u(n),{nextNetwork:r,payload:{alias:n}}};D.openChild=function(e,t){return{type:L.openChild,payload:{alias:e,fullPath:t}}};var K=function(e,t){u(w.isModel(t));var n=t.payload.alias,r=e[n];if(r)if("./"!==r.systemRole)A("Alias found, but is not child: ".concat(n));else{var o=t.getAddress().getChainId(),a=D.connectUplink(o,t),i=a.type,s=a.payload;S(i,s,n),C()}else A("Alias not found: ".concat(n))};D.listChildren=function(){return{type:L.listChildren}};var _=function(e){return l("listChildrenReducer"),{children:e.getAliases()}};D.getGivenName=function(){return{type:L.getGivenName}};var F=function(e){l("getGivenNameReducer");var t,n=e[".."];return n.address.isRoot()?(u(!n.heavy),t="/"):(u(n.heavy),t=n.heavy.getOriginAlias()),u(t),{givenName:t}};D.deploy=function(e){return{type:"@@DEPLOY",payload:{installer:e}}};var G=function(){var e=c(i.mark((function e(t,n){var r,o,c,u,l,d,p,f,h,y,m;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.payload.installer,o=r.children,c=void 0===o?{}:o,e.t0=i.keys(c);case 3:if((e.t1=e.t0()).done){e.next=18;break}return u=e.t1.value,l=c[u],l.children,d=l.covenant,p=a(l,["children","covenant"]),d=d||"unity",f=v.create(d),p=s({},p,{covenantId:f}),h=D.spawn(u,p),e.next=12,j(t,h);case 12:y=e.sent,t=g.clone(s({},t,{network:y})),m=D.deploy(c[u]),S(m,u),e.next=3;break;case 18:return Object.keys(c).length&&C(),e.abrupt("return",t.network);case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),H=function(e,t){var n,r=e.network.getResolvedAliases(),a=o(r);try{for(a.s();!(n=a.n()).done;){var i=n.value,s=e.network[i];s.requests[1];if("./"===s.systemRole&&"@@DEPLOY"===s.requests[1].type&&!s.rxReplyIndex(1))return}}catch(f){a.e(f)}finally{a.f()}var c,u=e.network[".."],l=o(u.getRemoteRequestIndices());try{for(l.s();!(c=l.n()).done;){var d=c.value,p=u.rxRequest(d);"@@DEPLOY"===p.type&&q({},p)}}catch(f){l.e(f)}finally{l.f()}},U=[L.genesis,L.uplink,L.openChild,"@@DEPLOY"],V=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"file_",n=0;return e.getAliases().forEach((function(e){if(e.startsWith(t))try{var r=parseInt(e.substring(t.length));n=r>n?r:n}catch(o){l("autoAlias error: ",o)}})),t+d(5,n+1,"0")},W=function(e){return e.getOutboundPairs().some((function(e){var t=r(e,2),n=t[0],o=t[1],a=!o||o.isPromise();return"@@OPEN_CHILD"===n.type&&a}))},J=function(e){var t="";return e.split("/").map((function(e){return t&&(t+="/"),t+=e}))};e.exports={actions:D,reducer:N,isSystemRequest:function(e){if(!w.isModel(e))return!1;var t=Object.values(L).includes(e.type);return l("isSystemAction: ".concat(t," type: ").concat(e.type)),t},isSystemReply:function(e){if(!I.isModel(e))return!1;var t=e.getRequest(),n=U.includes(t.type);return l("isSystemReply: ".concat(n," type: ").concat(t.type)),n},openPaths:function(e){return b.clone(e,(function(t){u(b.isModel(e)),e.getAliases().filter((function(t){return e[t].address.isUnknown()})).forEach((function(n){if(".@@io"!==n){var r=J(n);r.forEach((function(n,o){var a=e[n];if(!a||a.address.isUnknown()){l("unresolved path: ",n),0===o&&l("immediate child unresolved");var i=r[o-1];l("parent: ",i);var s=n.substring(i.length+1);if(l("child: ",s),W(e[i]))l("parent: %o was already asked to open child: %o",i,s);else{var c=f.create(D.openChild(s,n));l("open: ",c),t[i]=R.txRequest(e[i],c)}}}))}}))}))}}},1719:function(e,t,n){var r=n(17),o=n(7),a=n(4),i=n(9)("interblock:producers:network"),s=n(24),c=n(21),u=c.channelModel,l=c.continuationModel,d=c.actionModel,p=c.networkModel,f=c.interblockModel,h=c.addressModel,v=c.rxRequestModel,g=c.txRequestModel,y=c.txReplyModel,m=c.configModel,k=n(237),b=function(e,t,n){return p.clone(e,(function(r){a(v.isModel(t)),a(l.isModel(n));var o=t.getAddress(),i=e.getAlias(o),s=e[i];a(u.isModel(s)),a(s.address.equals(o)),a(s.rxRequest().equals(t));var c=t.getIndex();a(!s.replies[c]);var d=k.txReply(s,n);a(d.replies[c]),r[i]=d}))},x=function(e,t){return Array.isArray(e)||(e=[e]),e.map(t)};e.exports={ingestInterblocks:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;return p.clone(e,(function(c){t=x(t,f.clone),a(m.isModel(n)),i("ingestInterblocks count: ".concat(t.length)),t.sort((function(e,t){return e.provenance.height-t.provenance.height}));var l={};t.forEach((function(t){var r=t.provenance.getAddress(),s=e.getAlias(r),p=n.isPublicChannelOpen;if(!s&&p&&t.isConnectionAttempt()){i("connection attempt accepted");var f="@@PUBLIC_".concat(r.getChainId()),h=u.create(r),v=d.create({type:"@@ACCEPT"}),g=u.clone(o({},h,{requests:{0:v}}));c[f]=g}if(s){var y=l[s]||e[s];if(a(u.isModel(y)),y=k.ingestInterblock(y,t),t.isConnectionResponse(),!y.heavy||y.equals(e[s]))return;l[s]=y}})),e.getAliases().forEach((function(t){var n=e[t];if(n&&n.address.isResolved()&&n.heavy){var i=l[t]||n,c=n.lineageTip.slice(0,-1),d=s.without.apply(s,[i.lineageTip].concat(r(c))),p=i.lineage.findIndex((function(e){return e.equals(i.heavy.provenance.reflectIntegrity())})),f=i.lineage.findIndex((function(e){return e.equals(d[0].provenance.reflectIntegrity())})),h=p<f?p:f;a(h>=0,"minIndex out of bounds");var v=i.lineage.slice(h);(i=u.clone(o({},i,{lineage:v,lineageTip:d}))).equals(n)||(l[t]=i)}})),Object.keys(l).forEach((function(e){return c[e]=l[e]}))}))},respondRejection:function(e,t,n){i("respondRejection %O",n);var r=l.create("@@REJECT",n);return b(e,t,r)},respondRequest:function(e,t){i("respondRequest request: %o",t.type);var n=l.create("@@RESOLVE");return b(e,t,n)},respondReply:function(e,t,n){return p.clone(e,(function(r){a(h.isModel(t)),a(u.isModel(n));var o=e.getAlias(t);i("respondReply alias: ".concat(o));var s=e[o],c=k.shiftTxRequest(s,n);r[o]=c}))},tx:function(e,t,n){return p.clone(e,(function(r){a(p.isModel(e)),a(Array.isArray(t)),a(Array.isArray(n)),i("tx requests: ".concat(t.length," replies: ").concat(n.length));var o={};t.forEach((function(t){a(g.isModel(t));var n=t.to,r=o[n]||e[n];if(!r){var s=".@@io"===n?"PIERCE":"DOWN_LINK",c=h.create();r=u.create(c,s),i("channel created with systemRole: ".concat(s))}o[n]=k.txRequest(r,t.getRequest())})),n.forEach((function(t){a(y.isModel(t));var n=t.getAddress(),r=t.getIndex(),s=e.getAlias(n);if(s){var c=o[s]||e[s],u=t.getReply();o[s]=k.txReply(c,u,r)}else i("No alias found for: %O",t)})),Object.keys(o).forEach((function(e){return r[e]=o[e]}))}))}}},1720:function(e,t,n){var r=n(7),o=n(2),a=n(3),i=n(4),s=n(21),c=s.dmzModel,u=s.keypairModel,l=s.provenanceModel,d=s.blockModel,p=s.integrityModel,f=function(){var e=a(o.mark((function e(t){var n;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.create("CI"),i(p.isModel(t)),e.abrupt("return",n.sign(t));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=a(o.mark((function e(t,n){var a,s,u,h,v,g,y,m,k,b=arguments;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=b.length>2&&void 0!==b[2]?b[2]:f,i(c.isModel(t)),i(d.isModel(n)),i(!t.equals(n.getDmz()),"block dmz has not changed"),i("function"===typeof a),s=t.network.isNewChannels(n.network),u={},h=0===n.provenance.height,s&&!h&&(v=p.create(),g=n.provenance.getAddress().getChainId(),y=p.clone(r({},v,{hash:g})),u[0]=y),e.next=11,l.create(t,n.provenance,u,a);case 11:return m=e.sent,k=d.clone(r({},t,{provenance:m})),i(n.isNext(k)),e.abrupt("return",k);case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();e.exports={generateNext:h}},1721:function(e,t,n){var r=n(4),o=n(21),a=o.lockModel,i=o.blockModel;e.exports={reconcile:function(e,t){return a.clone(e,(function(n){r(i.isModel(t)),r(a.isModel(e)),n.block=t,n.piercings={requests:[],replies:[]},n.interblocks=[]}))}}},1722:function(e,t,n){var r=n(238),o=n(17),a=n(7),i=n(4),s=n(21),c=s.rxRequestModel,u=s.rxReplyModel,l=s.pendingModel;e.exports={raisePending:function(e,t){return i(c.isModel(t)),i(l.isModel(e)),i(!e.getIsPending()),l.clone(a({},e,{pendingRequest:t}))},bufferRequest:function(e,t){return l.clone(e,(function(n){i(c.isModel(t)),i(e.getIsPending());var r=t.getAddress().getChainId(),a=t.getIndex(),s=e.requests[r]||[];n.requests[r]=[].concat(o(s),[a])}))},pushReply:function(e,t){return l.clone(e,(function(n){i(u.isModel(t)),i(e.getIsPending()),n.replies=[].concat(o(e.replies),[t])}))},settle:function(e){return l.clone(e,(function(t){i(e.getIsPending()),delete t.pendingRequest,t.replies=[]}))},shiftRequests:function(e,t){return l.clone(e,(function(n){i(!e.getIsPending()),i(!e.replies.length);var o=e.rxBufferedRequest(t).event;i(c.isModel(o));var a=o.getAddress().getChainId(),s=o.getIndex(),u=r(e.requests[a]),l=u[0],d=u.slice(1);i.strictEqual(l,s),d.length?n.requests[a]=d:delete n.requests[a]}))}}},1724:function(e,t,n){(function(t){var r=n(17),o=n(47),a=n(2),i=n(3),s=n(4),c=n(9)("interblock:api:hooks"),u=n(239),l=u.request,d=u.promise,p=u.resolve,f=(u.reject,u.isReplyFor),h=new Promise((function(){}));h.isEternal=!0,Object.freeze(h);var v=function(){},g=function(){var e=i(a.mark((function e(t,n,r){var o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=l(t,n,r),s(".@@io"!==o.to),e.abrupt("return",k(o));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),y=function(){var e=i(a.mark((function e(t,n){var r,i,c,u,l,d,p=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=p.length,i=new Array(r>2?r-2:0),c=2;c<r;c++)i[c-2]=p[c];return s.strictEqual(typeof t,"string"),s.strictEqual(typeof n,"function"),u=E(),l=o({args:i},".@@ioRequestId",u),d=function(){return n.apply(void 0,i)},e.abrupt("return",k({type:t,payload:l,to:".@@io",exec:d,inBand:!1}));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),m=function(){var e=i(a.mark((function e(t,n){var r,o,i,s,c,u=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=u.length,o=new Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=u[i];return s={args:o},c=function(){return n.apply(void 0,o)},e.abrupt("return",k({type:t,payload:s,exec:c,inBand:!0}));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),k=function(e){c("_promise request.type: %o",e.type);var t=M();s(Array.isArray(t));var n=e.type,r=e.payload,o=e.to,a=e.exec,i=e.inBand;s(!a||"function"===typeof a);var u={type:n,payload:r,to:o},l=t.find((function(e){return f(e,u)}));if(!l)return a&&(u.exec=a,u.inBand=i),P(u),h;if("@@RESOLVE"===l.type)return l.payload;throw l.payload},b=function(){var e=i(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=i(a.mark((function e(n){var r,o,i,u,l,d,p,f,h,v,g,y,m=arguments;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=m.length>1&&void 0!==m[1]?m[1]:[],o=m.length>2&&void 0!==m[2]?m[2]:"unsalted",s.strictEqual(typeof n,"function"),s(Array.isArray(r)),s.strictEqual(typeof o,"string"),c("hook salt:",o),e.prev=6,e.next=9,w(r,o);case 9:if("object"===typeof(u=n())){e.next=12;break}throw new Error("Must return object from tick: ".concat(u));case 12:if(l=!1,"function"!==typeof u.then){e.next=36;break}return d=Symbol("RACECAR"),p=new Promise((function(e){return t((function(){return e(d)}))})),e.next=18,Promise.race([u,p]);case 18:if(f=e.sent,h=f===d,i=I(),!h||i.requests.length){e.next=23;break}throw new Error('Non standard promise returned - use "effectInBand(...)"');case 23:if(h){e.next=32;break}return e.next=26,u;case 26:if(u=e.sent,l=!1,"object"===typeof u){e.next=30;break}throw new Error("Must resolve object from tick: ".concat(u));case 30:e.next=34;break;case 32:u=void 0,l=!0;case 34:e.next=37;break;case 36:i=I();case 37:return g=(v=i).requests,y=v.replies,e.abrupt("return",{reduction:u,isPending:l,requests:g,replies:y});case 41:throw e.prev=41,e.t0=e.catch(6),c("error: ",e.t0),!i&&I(),e.t0;case 46:case"end":return e.stop()}}),e,null,[[6,41]])})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=i(a.mark((function e(n,o){var i,u,l;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(globalThis["@@interblock"]=globalThis["@@interblock"]||{},!globalThis["@@interblock"].promises){e.next=6;break}return i=Date.now(),e.next=5,new Promise(t);case 5:c("waited for global for ".concat(Date.now()-i,"ms"));case 6:s(!globalThis["@@interblock"].promises),u=r(n),0,l={accumulator:u,requests:[],replies:[],requestId:0,salt:o},globalThis["@@interblock"].promises=l;case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),I=function(){C();var e=globalThis["@@interblock"].promises,t=e.requests,n=e.replies;return delete globalThis["@@interblock"].promises,{requests:t,replies:n}},M=function(){C();var e=globalThis["@@interblock"].promises.accumulator;return c("_getGlobalAccumulator"),e},P=function(e){C();var t=globalThis["@@interblock"].promises.requests;c("_pushGlobalRequest",e.type),t.push(e)},R=function(e){C();var t=globalThis["@@interblock"].promises.replies;c("_pushGlobalReply",e.type),t.push(e)},E=function(){var e=globalThis["@@interblock"].promises.salt,t=globalThis["@@interblock"].promises.requestId++;return"".concat(t,"_").concat(e)},C=function(){s(globalThis["@@interblock"]),s(globalThis["@@interblock"].promises);var e=globalThis["@@interblock"].promises,t=e.accumulator,n=e.requests,r=e.replies,o=e.requestId;s(Array.isArray(t)),s(Array.isArray(n)),s(Array.isArray(r)),s(Number.isInteger(o)&&o>=0)};e.exports={replyPromise:function(){return R(d())},replyResolve:function(e,t){return R(p(e,t))},replyReject:function(e,t){return v()},interchain:g,effect:y,effectInBand:m,all:b,"@@GLOBAL_HOOK":x}}).call(this,n(57).setImmediate)},1725:function(e,t,n){var r=n(7),o=n(2),a=n(59),i=n(3),s=n(9)("interblock:covenants:shell"),c=n(1726),u=n(4),l=n(21).covenantIdModel,d=n(44),p=n(40),f=p.Machine,h=p.assign,v=d.actions,g=v.spawn,y=v.connect,m=v.listChildren,k=v.getGivenName,b=v.deploy,x=n(34).interchain,w=n(240),I=n(154),M=I.respond,P=(I.send,I.sendParent,{ping:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:"PING",payload:r({},t,{to:e})}},login:function(e,t){return{type:"LOGIN",payload:{terminalChainId:e,credentials:t}}},add:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:"ADD",payload:{alias:e,spawnOptions:t}}},ls:function(e){return{type:"LS",payload:{path:e}}},rm:function(e){return{type:"RM",payload:{path:e}}},cd:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".";return{type:"CD",payload:{path:e}}},up:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".",t=arguments.length>1?arguments[1]:void 0;return{type:"UP",payload:{path:e,remoteParent:t}}},dispatch:function(e,t){return u.strictEqual(typeof e,"object"),u.strictEqual(typeof t,"string"),{type:"DISPATCH",payload:{action:e,to:t}}},install:function(e,t){return{type:"INSTALL",payload:{dpkgPath:e,installPath:t}}},publish:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";return{type:"PUBLISH",payload:{name:e,installer:t,registry:n}}}}),R=(0,I.translator)(f({id:"shell",initial:"idle",context:{root:"/",wd:"/"},strict:!0,states:{idle:{on:{PING:"ping",LOGIN:"login",ADD:"addActor",LS:"listActors",CD:"changeDirectory",RM:"removeActor",MV:"moveActor",LN:"linkActor",UP:"uplinkActor",CAT:"getState",DISPATCH:"dispatch",PUBLISH:"publish",INSTALL:"install",LOGOUT:"logout",BAL:"balance"}},ping:{invoke:{src:"ping",onDone:"idle"},exit:"respondOrigin"},login:{invoke:{src:"login",onDone:"idle"}},addActor:{invoke:{src:"addActor",onError:"idle",onDone:"idle"},exit:"respondOrigin"},listActors:{invoke:{src:"listActors",onDone:"idle",onError:"idle"}},changeDirectory:{invoke:{src:"changeDirectory",onDone:{target:"idle",actions:["assignWd","respondOrigin"]},onError:"idle"}},removeActor:{invoke:{src:"removeActor",onDone:"idle",onError:"idle"}},moveActor:{},linkActor:{},uplinkActor:{},getState:{},logout:{},balance:{},dispatch:{invoke:{src:"dispatch",onDone:{target:"idle",actions:"respondOrigin"}}},publish:{invoke:{src:"publish",onDone:{target:"idle",actions:"respondOrigin"}}},install:{invoke:{src:"install",onDone:{target:"idle",actions:"respondOrigin"}}},done:{id:"done",data:"info about the files ?",type:"final"},error:{id:"error",type:"final"}}},{actions:{respondOrigin:function(e,t){return s("respondOrigin",t.type),M(t.data)},assignWd:h({wd:function(e,t){var n=t.data.absolutePath;return u.strictEqual(typeof n,"string"),s("assignWd",n),n}})},guards:{},services:{ping:function(){var e=i(o.mark((function e(t,n){var r,i,c,l,d,p;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s("ping: %O",n),r=n.type,i=n.payload,c=i.to,l=void 0===c?".":c,d=a(i,["to"]),u("PING"===r),"."!==l){e.next=7;break}return s("ping to self"),e.abrupt("return",{type:"PONG",payload:d});case 7:return e.next=9,x(r,d,l);case 9:return p=e.sent,s("ping result: %O",p),e.abrupt("return",p);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),login:function(){var e=i(o.mark((function e(t,n){var r,a,i,c,u;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s("login: %O",n.payload),r=n.payload,a=r.terminalChainId,i=r.credentials,c=y("terminal",a),e.next=5,invoke(c);case 5:return e.next=7,invoke("@@INTRO",i,"terminal");case 7:return u=e.sent,s("loginResult: %O",u),e.abrupt("return",{loginResult:u});case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),addActor:function(){var e=i(o.mark((function e(t,n){var r,a,i,c,d,p,f,h;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.strictEqual(typeof n.payload,"object"),r=n.payload,a=r.alias,i=r.spawnOptions,c=C(a),d=E(a),s("addActor",d,c),"string"===typeof i&&(p=l.create(i),i={covenantId:p}),f=g(d,i),e.next=9,x(f,c);case 9:return h=e.sent,e.abrupt("return",h);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),listActors:function(){var e=i(o.mark((function e(t,n){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),changeDirectory:function(){var e=i(o.mark((function e(t,n){var a,i,l,d,p,f,h,v,g;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.payload.path,u.strictEqual(typeof a,"string"),i=c(a),s("changeDirectory",i),e.next=6,x(k());case 6:return l=e.sent,d=l.givenName,s("givenName: ",d),(p=d+i).endsWith("/.")&&(p=p.substring(0,p.length-1)),s("absolutePath",p),f=m(),h=f.type,v=f.payload,e.next=15,x(h,v,a);case 15:return g=e.sent,u(Array.isArray(g.children)),s("changeDirectory result: ",g),e.abrupt("return",r({},g,{absolutePath:p}));case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),removeActor:function(){var e=i(o.mark((function e(t,n){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s("removeActor",n);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),dispatch:function(){var e=i(o.mark((function e(t,n){var r,a,i,c,u,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.payload,a=r.action,i=r.to,c=a.type,u=a.payload,s("dispatch type: %o to: %o",c,i),e.next=5,x(c,u,i);case 5:return l=e.sent,e.abrupt("return",l);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),publish:function(){var e=i(o.mark((function e(t,n){var r,a,i,c,u;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.payload,a=r.name,i=r.installer,r.registry,s("publish: ",a),c=l.create("dpkg"),u={installer:i},e.next=6,x(g(a,{covenantId:c,state:u}));case 6:return e.abrupt("return",{dpkgPath:a});case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),install:function(){var e=i(o.mark((function e(t,n){var i,c,u,d,p,f,h,v,y,m;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.payload,c=i.dpkgPath,u=i.installPath,e.next=3,x(w.actions.getInstaller(),c);case 3:return d=e.sent,d.children,p=d.covenant,f=a(d,["children","covenant"]),p=p||"unity",h=l.create(p),f=r({},f,{covenantId:h}),v=g(u,f),x(v),y=b(d),e.next=13,x(y,u);case 13:m=e.sent,s(m);case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}}));e.exports={actions:P,reducer:R};var E=function(e){return/^(?:\/?|)(?:[\s\S]*?)((?:\.{1,2}|[^\/]+?|)(?:\.[^.\/]*|))(?:[\/]*)$/.exec(e)[1]},C=function(e){return/^((?:\.(?![^\/]))|(?:(?:\/?|)(?:[\s\S]*?)))(?:\/+?|)(?:(?:\.{1,2}|[^\/]+?|)(?:\.[^.\/]*|))(?:[\/]*)$/.exec(e)[1]||"."}},1727:function(e,t,n){var r=n(2),o=n(59),a=n(7),i=n(3),s=n(4),c=n(9)("interblock:xstate:translator"),u=(n(24),n(62)),l=n(40).State,d=n(34),p=(d.request,d.promise,d.resolve,d.reject,d.isReplyFor),f=(d.replyPromise,d.replyReject,d.replyResolve),h=d.interchain,v=function(e,t){if(e&&e.message&&e.stack){c("error detected %O",e);var n=e,r=n.message,o=n.stack;e=a({},e,{stack:o,message:r})}return{type:"done.invoke."+t,data:e}},g=function(e){s(Array.isArray(e))},y=function(e,t){switch(e.type){case"@@SEND":throw c("send: %O",e),new Error("not implemented");case"@@SEND_PARENT":throw c("sendParent: %O",e),new Error("not implemented");case"@@RESPOND":c("@@RESPOND to: ",t.type),f(e.data,t);break;default:if(e.type.startsWith("done.invoke.")){var n=a({},e,{payload:e.data});return delete n.data,n}return e}},m=function(e,t){if(!e.nextEvents.includes(t.type)){var n=t&&t.type,r=e&&e.value;throw new Error("State: ".concat(r," does not accept event type: ").concat(n))}};e.exports={respond:function(e){return"string"===typeof e&&(e={type:e}),{type:"@@RESPOND",data:e}},send:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";return{type:"@@SEND",payload:e,path:t}},sendParent:function(e){return{type:"@@SEND_PARENT",payload:e,path:".."}},translator:function(e){var t=e.initialState;return function(){var n=i(r.mark((function n(d,f){var k,b,x,w,I,M,P,R,E,C,q;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s.strictEqual(typeof f,"object"),d&&!u(d,{})||(d=t),s(!d.actions||!d.actions.length,"uncleared xstate"),"@@INIT"!==f.type){n.next=5;break}return n.abrupt("return",d);case 5:if(f.type.startsWith("done.invoke.")&&delete(f=a({},f,{data:f.payload})).payload,c("translator reducer action: %O",f),!p(f)){n.next=10;break}return c("ignoring reply received: ",f),n.abrupt("return",d);case 10:return c("previous machine state: ",d.value),k=l.create(d),b=e.resolveState(k),m(b,f),x=e.transition(b,f),c("next machine state: ",x.value),w=x.toJSON(),I=w.actions,M=o(w,["actions"]),P=JSON.parse(JSON.stringify(M)),R=P.context,E=P.event,g(I),C=P.history.event,c("originAction: ",C.type),q=I.map(function(){var t=i(r.mark((function t(n){var o,a,i,u,l,d,p,f,g;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=n.type,t.next="xstate.start"===t.t0?3:"xstate.stop"===t.t0?18:20;break;case 3:return c("xstate.start"),o=n.activity,s(o&&"xstate.invoke"===o.type),a=o.src,i=e.options.services[a],s("function"===typeof i),c("running service: ",a),t.next=12,i(R,E);case 12:return u=t.sent,c("invoke result: ",u&&u.type),l=v(u,a),d=l.type,p=l.data,c("doneInvoke",p),h(d,p),t.abrupt("break",23);case 18:return c("end of invoke"),t.abrupt("break",23);case 20:return c("default: %O",n),n.exec?(f=n.exec(R,E),c("execResult %O",f),f&&y(f,C)):(c("standard action ? %O",n),g=y(n,C),protocolActions.push(g)),t.abrupt("break",23);case 23:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),n.next=26,Promise.all(q);case 26:return n.abrupt("return",P);case 27:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()}}},1729:function(e,t,n){var r=n(2),o=n(7),a=n(3),i=n(9)("interblock:covenants:hyper"),s=n(34),c=s.replyResolve,u=(s.request,n(44).actions,{}),l={reducer:function(){var e=a(r.mark((function e(){var t,n,a=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a.length>0&&void 0!==a[0]?a[0]:u,n=a.length>1?a[1]:void 0,i("hyper action: ",n.type),e.t0=n.type,e.next="PING"===e.t0?6:8;break;case 6:return c({type:"PONG"}),e.abrupt("break",8);case 8:return e.abrupt("return",o({},t));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),actions:{}};e.exports=o({},l)},1730:function(e,t,n){var r=n(2),o=n(7),a=n(3),i=n(9)("interblock:covenants:probe"),s=n(34),c=s.replyResolve,u=(s.request,n(44).actions,{}),l={reducer:function(){var e=a(r.mark((function e(){var t,n,a,s,l=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=l.length>0&&void 0!==l[0]?l[0]:u,n=l.length>1?l[1]:void 0,a=n.type,s=n.payload,i("test action: ",a),e.t0=a,e.next="PING"===e.t0?7:9;break;case 7:return c({type:"PONG",payload:s}),e.abrupt("break",9);case 9:return e.abrupt("return",o({},t));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),actions:{}};e.exports=o({},l)},1731:function(e,t,n){var r=n(4),o=n(20).standardize,a=n(157).txRequestModel,i=n(156).txReplyModel,s=n(244).rxReplyModel,c=n(155).rxRequestModel,u=n(93).registry,l=function(e,t){if(!e)throw new Error("Action cannot be interpreted: ".concat(e));if("string"===typeof e&&(e={type:e}),r(e.type,"Action must supply a type"),d(e.type)){var n,o=e,s=o.type,u=o.payload,l=void 0===u?{}:u,p=e.request;return p?n=p.sequence:(r(c.isModel(t)),n=t.sequence),i.create(s,l,n)}var f=e,h=f.type,v=f.payload,g=void 0===v?{}:v,y=f.to,m=void 0===y?".":y;return a.create(h,g,m)},d=function(e){return i.schema.properties.type.enum.includes(e)},p=o({schema:{title:"Reduction",type:"object",required:["isPending","requests","replies"],additionalProperties:!1,properties:{reduction:{type:"object"},isPending:{type:"boolean"},requests:{type:"array",uniqueItems:!0,items:a.schema},replies:{type:"array",uniqueItems:!0,items:i.schema}}},create:function(e,t,n){var o=e.reduction,a=e.isPending,i=e.requests,d=e.replies;r(Array.isArray(i)),r(Array.isArray(d)),r(c.isModel(t)||s.isModel(t)),r(u.get("Dmz").isModel(n)),i=i.map((function(e){return l(e,t)})),d=d.map((function(e){return l(e,t)})),i.forEach((function(e){".@@io"===e.to&&r(n.config.isPierced)}));var f={reduction:o,isPending:a,requests:i,replies:d};return o||delete f.reduction,p.clone(f)},logicize:function(e){var t=e.reduction,n=e.isPending,o=e.requests,s=e.replies;r(t&&!n||!t&&n),r(o.every(a.isModel)),r(s.every(i.isModel));var c=0,u=new Set;s.forEach((function(e){e.getReply().isPromise()&&c++,u.add(e.request.sequence)})),n?r.strictEqual(c,0,"No promises allowed if pending"):r(c<=1,"Max one promise allowed: ".concat(c)),r(u.size===s.length,"Duplicate sequence detected");return{getIsPending:function(){return n}}}});e.exports={reductionModel:p}},1732:function(e,t,n){var r=n(1733).txModel,o=n(247).socketModel;e.exports={socketModel:o,txModel:r}},1733:function(e,t,n){var r=n(4),o=n(20).standardize,a=n(110).interblockModel,i=n(247).socketModel,s=o({schema:{title:"Tx",description:"An interblock plus socket info, used for transmission functions",type:"object",required:["socket","interblock"],additionalProperties:!1,properties:{socket:i.schema,interblock:a.schema}},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.create(),t=arguments.length>1?arguments[1]:void 0;return r(i.isModel(e)),r(a.isModel(t)),s.clone({socket:e,interblock:t})},logicize:function(e){return{}}});e.exports={txModel:s}},1734:function(e,t,n){var r=n(2),o=n(3),a=n(48),i=function(){var e=o(r.mark((function e(t){var n,i,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("object"===typeof t){e.next=2;break}return e.abrupt("return");case 2:if(n=t,t.interblock&&(n=t.interblock),n.provenance&&n.provenance.signatures){e.next=6;break}return e.abrupt("return");case 6:if(i=n.provenance.signatures,Array.isArray(i)){e.next=9;break}return e.abrupt("return");case 9:return c=i.map(function(){var e=o(r.mark((function e(t){var n,o,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.publicKey,o=t.integrity,i=t.seal,a.verifyKeyPairSync(o.hash,i,n.key)){e.next=3;break}return e.abrupt("return",a.verifyHash(o.hash,i,n.key));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=12,Promise.all(c);case 12:if(!n.network||!n.network["."]){e.next=15;break}return e.next=15,s(n.network);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s=function(){var e=o(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object.values(t).map(function(){var e=o(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(t.heavy);case 2:return n=t.lineageTip.map(i),e.next=5,Promise.all(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=3,Promise.all(n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=o(r.mark((function e(t){var n,o,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.publicKey.key,o=t.secretKey,i={publicKey:n,secretKey:o},a.verifyKeyPairSync(i)){e.next=6;break}return e.next=6,a.verifyKeyPair(i);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();e.exports={cacheVerifyHash:i,cacheVerifyKeypair:c}},1735:function(e,t,n){(function(t){var r=n(2),o=n(3),a=n(40),i=a.Machine,s=a.assign;t.Machine=i,t.assign=s;var c=n(4),u=n(179).ioQueueFactory,l=n(21),d=l.interblockModel,p=l.addressModel,f=l.txModel,h=n(111).thread,v=n(112).isolateFactory,g=n(113).cryptoFactory,y=n(53).consistencyFactory,m=n(1744).increasorConfig,k=n(1750).poolConfig,b=n(1752).receiveConfig,x=n(1754).transmitConfig;e.exports={fsmFactory:function(){var e=u("ioIsolate"),t=u("ioCrypto"),n=u("ioConsistency"),a=u("ioPool",d),i=u("ioIncrease",p),s=u("ioReceive",f),l=u("ioTransmit",d);e.setProcessor(v()),t.setProcessor(g()),n.setProcessor(y());var w=k(t,n);a.setProcessor(function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(d.isModel(t)),n={type:"POOL_INTERBLOCK",payload:t},e.next=4,h(n,w);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var I=m(t,n,e);i.setProcessor(function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(p.isModel(t)),n={type:"INCREASE_CHAIN",payload:t},e.next=4,h(n,I);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var M=b(n);s.setProcessor(function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(f.isModel(t)),n={type:"RECEIVE_INTERBLOCK",payload:t},e.next=4,h(n,M);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var P=x(n);return l.setProcessor(function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(d.isModel(t)),n={type:"TRANSMIT_INTERBLOCK",payload:t},e.next=4,h(n,P);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),{ioIsolate:e,ioCrypto:t,ioConsistency:n,ioPool:a,ioIncrease:i,ioReceive:s,ioTransmit:l}}}}).call(this,n(31))},1736:function(e,t,n){var r=n(120).v4,o=n(83),a=n(9),i=0;e.exports={machineLogger:function(e,t){var n=r(),s=a("interblock:machines:".concat(o(t,11)));s("INVOCATION: ".concat(t," -> ").concat(e));var c=[],u=!1,l=function(e){i++,s("TRANSITION: ".concat(o(3,i)," %O"),e)},d=function(e){s("TERMINATOR: ".concat(e.machine," -> ").concat(e.type," execution ended after ").concat(e.elapsedTime,"ms"))};return{writeTransition:function(e,t,n){var r=e;if(c.push(r),u)return l(r);u=!0},writeTermination:function(r){return d({invocation:n,type:e,machine:t,state:"TERMINATION",event:c})}}}}},1737:function(e,t,n){var r=n(17),o=n(2),a=n(3),i=n(7),s=n(4),c=n(24),u=n(21),l=(u.actionModel,u.addressModel),d=u.integrityModel,p=u.provenanceModel,f=u.lockModel,h=u.blockModel,v=u.socketModel,g=u.interblockModel,y=u.txRequestModel,m=u.txReplyModel,k=n(9)("interblock:services:consistency"),b=function(e){var t=d.create(),n=d.clone(i({},t,{hash:e})),r=l.create(n);return s.strictEqual(r.getChainId(),e),r},x=function(e){return{chainId:e.provenance.getAddress().getChainId(),height:e.provenance.height,blockHash:e.getHash(),shortestLineage:e.provenance.lineage[0]}},w=function(e){return function(t){return I(t,e)}},I=function(e,t){var n=t.getChainId(),r=e.getRemote()?"heavy":"light",o=e.provenance.getAddress().getChainId(),a=e.provenance.height;return{chainId:n,originChainId_height_type:"".concat(o,"_").concat(a,"_").concat(r),interblockHash:e.getHash(),isDeleted:!1}},M=function(e){return function(t){var n=t.getChainId(),r=e.provenance.getAddress().getChainId(),o=e.network.getAlias(t),a=e.network[o];return s(a),{chainId:n,targetChainId:r,heavyHeight:a.heavyHeight,lineageHeight:a.lineageHeight,height:e.provenance.height}}},P=n(1738).lockFactory,R=n(248).dbFactory,E=n(249),C=E.s3Factory,q=E.s3Keys,A=n(114).ramDynamoDbFactory,O=n(165).ramS3Factory;e.exports={consistencySourceFactory:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"CI";e=e||A(),t=t||O();var u=P(e),d=R(e),E=C(t),T=new Map,S=function(){var e=a(o.mark((function e(t){var n,r,a,i,c,u,p,f,h;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.affectedAddresses,r=t.interblock,s(n.every(l.isModel)),s(g.isModel(r)),k("poolInterblocks for ".concat(n.length," addresses")),c=r.getWithoutRemote(),u=n.map((function(e){var t=c;return e.equals(r.getTargetAddress())?(i=!0,t=r):a=!0,I(t,e)})),k("poolItems count: %O",u.length),p=[],a&&(f=q.fromInterblock(c),p.push(E.putInterblock(f,c))),i&&(h=q.fromInterblock(r),p.push(E.putInterblock(h,r))),e.next=12,d.putPool(u);case 12:return e.next=14,Promise.all(p);case 14:k("poolInterblock complete for: ".concat(n.length," addresses"));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=a(o.mark((function e(t,r){var i,p,h,v,y,m,b,x,w,I,M,P;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(l.isModel(t)),i=t.getChainId(),e.next=4,u.tryAcquire(i,n,r);case 4:if(p=e.sent){e.next=8;break}return k("lockChain could not lock ".concat(i)),e.abrupt("return");case 8:return k("locked chain: ".concat(i," with: ").concat(p)),h=W({address:t}),e.next=12,d.queryPool(i);case 12:return v=e.sent,y=v.filter((function(e){return!e.isDeleted})),k("pool total: ".concat(v.length," valid: ").concat(y.length)),m=y.map(function(){var e=a(o.mark((function e(t){var n,r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=q.fromPoolItem(t),e.next=3,E.getInterblock(n);case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return");case 6:return s(g.isModel(r)),s.strictEqual(t.interblockHash,r.getHash()),e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=18,Promise.all(m);case 18:return b=e.sent,x=c.compact(b),k("interblocks fetched: ".concat(x.length)),e.next=23,h;case 23:return w=e.sent,k("block height: %O",w&&w.provenance.height),k("interblock count: %O",x.length),e.next=28,d.queryPiercings(i);case 28:return I=e.sent,M={requests:[],replies:[]},I.forEach((function(e){var t=e.txRequest,n=e.txReply;s(!t||!n),t&&M.requests.push(t),n&&M.replies.push(n)})),P=f.create(w,x,p,M),s(!T.has(i)),T.set(i,P),k("lock complete: %O",P.uuid),e.abrupt("return",P);case 36:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),D=function(){var e=a(o.mark((function e(t){var n,r,a,i,c,l,p,h,v,g;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k("putUnlockChain"),s(f.isModel(t)),n=t.block,s(n,"cannot unlock without a block"),r=n.provenance.getAddress(),a=r.getChainId(),e.next=8,u.isValid(a,t.uuid);case 8:if(e.sent){e.next=12;break}return k("unlock rejected for ".concat(a)),e.abrupt("return");case 12:if(i=T.get(a),!(c=i.block)||c.isNext(n)){e.next=19;break}k("block is not next %O",n.provenance.height),k("no change: ",c.equals(n)),e.next=30;break;case 19:if(c||n.provenance.address.isGenesis()){e.next=23;break}k("next was not genesis: %O",n.height),e.next=30;break;case 23:return l=q.fromBlock(n),e.next=26,E.putBlock(l,n);case 26:return p=x(n),e.next=29,d.putBlock(p);case 29:k("block added");case 30:return h=L(n,c),v=j(n,i.interblocks),g=B(n,i.piercings),e.next=35,Promise.all([h,v,g]);case 35:return T.delete(a),e.next=38,u.release(a,t.uuid);case 38:k("putUnlockChain complete");case 39:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=a(o.mark((function e(t,n){var r,a,i,c,u,l,p,f;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(h.isModel(t)),s(!n||h.isModel(n)),r=n?n.network.getAliases():[],a=r.filter((function(e){return n.network[e].address.isResolved()})),i=t.network.getAliases().filter((function(e){return t.network[e].address.isResolved()})),c=i.filter((function(e){return!a.includes(e)})).map((function(e){return t.network[e].address})),u=a.filter((function(e){return!i.includes(e)})).map((function(e){return t.network[e].address})),l=c.map((function(e){return e.getChainId()})),k("_updateRouteTable newAddresses",l),p=c.map(M(t)),f=u.map(M(t)),e.next=13,Promise.all([d.putSubscriptions(p),d.delSubscriptions(f)]);case 13:k("updateRouteTable complete");case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),j=function(){var e=a(o.mark((function e(t,n){var r,a,s,c,u,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=X(t,n),a=t.provenance.getAddress(),s=r.map(w(a)).map((function(e){return i({},e,{isDeleted:!0})})),e.next=5,d.putPool(s);case 5:return k("_purgePool isDeleted marked"),e.next=8,z(r);case 8:return c=e.sent,k("_purgePool _findOrphans found: ".concat(c.length)),u=c.map(q.fromInterblock),e.next=13,E.deleteInterblocks(u);case 13:return l=s.map((function(e){return{chainId:e.chainId,originChainId_height_type:e.originChainId_height_type}})),e.next=16,d.delPool(l);case 16:k("_purgePool complete");case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),z=function(){var e=a(o.mark((function e(t){var n,i,s,u;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.filter((function(e){return e.getRemote()})),i=t.filter((function(e){return!e.getRemote()})),s=i.map(function(){var e=a(o.mark((function e(t){var n;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(t);case 2:return n=e.sent,e.abrupt("return",!n&&t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.t0=c,e.next=6,Promise.all(s);case 6:return e.t1=e.sent,u=e.t0.compact.call(e.t0,e.t1),e.abrupt("return",[].concat(r(u),r(n)));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=a(o.mark((function e(t,n){var a,i,s,c,u,l,p,f,h,v,g;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.network[".@@io"]){e.next=3;break}return e.abrupt("return");case 3:return i=a.getRemote(),s=i.requests,c=i.replies,u=Object.values(s),l=Object.values(c),p=n.requests.filter((function(e){return u.some((function(t){return e.getRequest().equals(t)}))})),f=n.replies.filter((function(e){return l.some((function(t){return e.getReply().equals(t)}))})),h=t.getChainId(),v=[].concat(r(p),r(f)),g=v.map((function(e){var t=e.getHash();return{chainId:h,hash:t}})),e.abrupt("return",d.delPierce(g));case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),K=function(){var e=a(o.mark((function e(t){var n,r,a,i,c,u,l,d,f;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.provenance,r=t.height,k("getLineage from height: ",a=void 0===r?0:r),s(p.isModel(n)),s(Number.isInteger(a)&&a>=0),s(a<n.height),i=n.getAddress(),c=[],l=n;case 8:return u=l.getShortestHeight(),e.next=11,W({address:i,height:u});case 11:d=e.sent,s(h.isModel(d)),c.push(d),l=d.provenance;case 15:if(u>a){e.next=8;break}case 16:return f=c.map((function(e){return g.create(e)})),e.abrupt("return",f);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(){var e=a(o.mark((function e(t){var n,r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(g.isModel(t)),n=t.provenance.getAddress().getChainId(),!0,e.next=5,d.queryAffected(n,!0);case 5:return r=e.sent,e.abrupt("return",!!r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=a(o.mark((function e(t){var n,a,i,c,u,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(g.isModel(t)),n=t.provenance.getAddress().getChainId(),a=t.provenance.height,e.next=5,d.queryAffected(n);case 5:return i=e.sent,c=i.filter((function(e){var t=e.targetChainId,n=e.heavyHeight,r=e.lineageHeight;return t.startsWith(t)?n<a:r<a})),u=c.map((function(e){var t=e.targetChainId;return b(t)})),l=new Set(u),k("dbQueryAffected items length: %O",l.size),e.abrupt("return",r(l));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),G=function(){var e=a(o.mark((function e(t){var n,r,a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(l.isModel(t)),n=t.getChainId(),k("getSockets for: %O",n),e.next=5,d.querySockets(n);case 5:return r=e.sent,s(Array.isArray(r)),s(r.every((function(e){return"object"===typeof e}))),a=r.map((function(e){var t=e.socketJson;return s(t),v.clone(t)})),k("getSockets length: ".concat(a.length)),e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=a(o.mark((function e(t){var n,r,a,i,c,u,p;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.address,r=t.socket,k("putSocket"),s(l.isModel(n)),s(v.isModel(r)),a=n.getChainId(),i=r.id,c=parseInt(Date.now()/1e3),u=r.serialize(),p={chainId:a,socketId:i,updatedTime:c,socketJson:u},e.next=11,d.putSocket(p);case 11:k("putSocket complete");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=a(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s(v.isModel(t)),k("delSocket %o",t.id);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V=function(e){return d.queryLatest(e.getChainId())},W=function(){var e=a(o.mark((function e(t){var n,r,a,i,c,u;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.address,r=t.height,k("getBlock",n&&n.getChainId(),r),n){e.next=5;break}return s(!r),e.abrupt("return",J());case 5:if(s(l.isModel(n)),a=n.getChainId(),Number.isInteger(r)){e.next=13;break}return e.next=10,d.queryLatest(a);case 10:i=e.sent,e.next=16;break;case 13:return e.next=15,d.getBlock({chainId:a,height:r});case 15:i=e.sent;case 16:if(i){e.next=18;break}return e.abrupt("return");case 18:return Number.isInteger(r)||(r=i.height),c=q.fromBlockItem(i),k("s3.getBlock(s3Key)",c),e.next=23,E.getBlock(c);case 23:return u=e.sent,s(h.isModel(u)),s(n.equals(u.provenance.getAddress())),s.strictEqual(u.getHash(),i.blockHash),s.strictEqual(u.provenance.height,r),k("getBlock complete"),e.abrupt("return",u);case 30:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J=function(){var e=a(o.mark((function e(){var t,n;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k("getBaseAddress"),e.next=3,d.scanBaseChainId();case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return");case 6:return s(t.chainId),n=l.create(t.chainId),s.strictEqual(t.chainId,n.getChainId()),k("getBaseAddress: ".concat(n.getChainId())),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Q=function(){var e=a(o.mark((function e(t){var n,r,a,i,c;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.txRequest,s(y.isModel(n)),r=l.create(n.to),s(r.isResolved()),a=r.getChainId(),i=n.getHash(),k("putPierceRequest %o %o",a,n),c={chainId:a,hash:i,txRequest:n},e.next=10,d.putPierce(c);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Y=function(){var e=a(o.mark((function e(t){var n,r,a,i,c;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.txReply,s(m.isModel(n)),r=n.getAddress(),s(r.isResolved()),a=r.getChainId(),i=n.getHash(),k("putPierceReply %o %o",a,n),c={chainId:a,hash:i,txReply:n},e.next=10,d.putPierce(c);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X=function(e,t){return t.filter((function(t){var n=e.network.includesInterblock(t),r=e.network.getAlias(t.provenance.getAddress());return n||!r}))};return{putSocket:H,getSockets:G,delSocket:U,putLockChain:N,putUnlockChain:D,getLineage:K,getIsAnyAffected:_,getAffected:F,getIsPresent:V,getBlock:W,putPoolInterblock:S,putPierceRequest:Q,putPierceReply:Y}}}},1738:function(e,t,n){var r=n(2),o=n(3),a=n(1739),i=n(56).promisify,s=n(114).ramDynamoDbFactory,c=0,u=1;e.exports={lockFactory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s(),t=n(9)("interblock:aws:lock:id-".concat(c++)),l=new Map,d=function(){var n=o(r.mark((function n(s,c,d){var p,f,v,g,y,m,k,b,x,w,I,M;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t("attempting to lock %o %o %o",s.substring(0,16),c,d),!l.has(s)){n.next=4;break}return t("already locked to this thread: ".concat(s)),n.abrupt("return");case 4:if(!e._getTables){n.next=9;break}return p="ramLockId-"+u++,f={uuid:p,tryRelease:function(){t("ram tryRelease for uuid: %o and chainId: %o",p,s)}},l.set(s,f),n.abrupt("return",p);case 9:return l.set(s,"acquisition in progress"),v=new a.FailOpen({dynamodb:e,lockTable:"dbLocks",partitionKey:"chainId",leaseDurationMs:d||12e3,retryCount:0,owner:c,trustLocalTime:!0}),n.prev=11,n.next=14,h("dbLocks",{chainId:s});case 14:if(!(g=n.sent)||1===g.leaseDurationMs){n.next=23;break}if(y=g.lockAcquiredTimeUnixMs,m=g.leaseDurationMs,2e3,Date.now()-y>m+2e3){n.next=23;break}return t("lock not available ".concat(s)),n.abrupt("return");case 23:return k=i(v.acquireLock).bind(v),n.next=26,k(s);case 26:return b=n.sent,x=b.fencingToken,t("locked ".concat(s," with fencing token: ").concat(x)),w=function(){var e=o(r.mark((function e(){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=i(b.release).bind(b),e.next=4,n();case 4:t("released lock for ".concat(s)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t("failed to release lock for ".concat(s," ").concat(e.t0.message));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),I=b._guid.toString("base64"),M={uuid:I,tryRelease:w},l.set(s,M),t("lock complete"),n.abrupt("return",I);case 37:return n.prev=37,n.t0=n.catch(11),t("failed to lock: ".concat(s," %O"),n.t0),"string"===typeof l.get(s)&&l.delete(s),n.abrupt("return");case 43:case"end":return n.stop()}}),n,null,[[11,37]])})));return function(e,t,r){return n.apply(this,arguments)}}(),p=function(){var e=o(r.mark((function e(n,o){var a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve();case 2:if(l.has(n)){e.next=5;break}return t("unknown lock for ".concat(n)),e.abrupt("return",!1);case 5:return a=l.get(n),e.abrupt("return",a.uuid===o);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),f=function(){var e=o(r.mark((function e(t,n){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((o=l.get(t)).uuid!==n){e.next=6;break}return e.next=4,o.tryRelease();case 4:return l.delete(t),e.abrupt("return");case 6:throw new Error("invalid lock: ".concat(t," ").concat(n));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),h=function(){var t=o(r.mark((function t(n,o){var a,i,s;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={TableName:n,Key:o,ConsistentRead:!0,ReturnConsumedCapacity:"TOTAL"},t.next=3,e.get(a).promise();case 3:return i=t.sent,i.ConsumedCapacity,s=i.Item,t.abrupt("return",s);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return{tryAcquire:d,isValid:p,release:f}}}},1743:function(e,t,n){var r=n(2),o=n(3);e.exports={toFunctions:function(e){return{putSocket:function(t){return e.push({type:"PUT_SOCKET",payload:t})},getSockets:function(t){return e.push({type:"GET_SOCKETS",payload:t})},delSocket:function(t){return e.push({type:"DEL_SOCKET",payload:t})},putPoolInterblock:function(t){return e.push({type:"POOL",payload:t})},putLockChain:function(t){return e.push({type:"LOCK",payload:t})},putUnlockChain:function(t){return e.push({type:"UNLOCK",payload:t})},getLineage:function(t){return e.push({type:"LINEAGE",payload:t})},getIsAnyAffected:function(t){return e.push({type:"ANY_AFFECTED",payload:t})},getAffected:function(t){return e.push({type:"AFFECTED",payload:t})},getIsPresent:function(t){return e.push({type:"IS_PRESENT",payload:t})},getBlock:function(t){return e.push({type:"GET_BLOCK",payload:t})},putPierceRequest:function(t){return e.push({type:"PIERCE_REQ",payload:t})},putPierceReply:function(t){return e.push({type:"PIERCE_REP",payload:t})}}},fromFunctions:function(e){return function(){var t=o(r.mark((function t(n){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=n.type,t.next="PUT_SOCKET"===t.t0?3:"GET_SOCKETS"===t.t0?4:"DEL_SOCKET"===t.t0?5:"POOL"===t.t0?6:"LOCK"===t.t0?7:"UNLOCK"===t.t0?8:"LINEAGE"===t.t0?9:"ANY_AFFECTED"===t.t0?10:"AFFECTED"===t.t0?11:"IS_PRESENT"===t.t0?12:"GET_BLOCK"===t.t0?13:"PIERCE_REQ"===t.t0?14:"PIERCE_REP"===t.t0?15:16;break;case 3:return t.abrupt("return",e.putSocket(n.payload));case 4:return t.abrupt("return",e.getSockets(n.payload));case 5:return t.abrupt("return",e.delSocket(n.payload));case 6:return t.abrupt("return",e.putPoolInterblock(n.payload));case 7:return t.abrupt("return",e.putLockChain(n.payload));case 8:return t.abrupt("return",e.putUnlockChain(n.payload));case 9:return t.abrupt("return",e.getLineage(n.payload));case 10:return t.abrupt("return",e.getIsAnyAffected(n.payload));case 11:return t.abrupt("return",e.getAffected(n.payload));case 12:return t.abrupt("return",e.getIsPresent(n.payload));case 13:return t.abrupt("return",e.getBlock(n.payload));case 14:return t.abrupt("return",e.putPierceRequest(n.payload));case 15:return t.abrupt("return",e.putPierceReply(n.payload));case 16:throw new Error("Unknown action type: ".concat(n&&n.type));case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}}},1744:function(e,t,n){var r=n(2),o=n(3),a=n(4),i=n(9)("interblock:config:increasor"),s=(n(24),n(40).assign),c=n(21),u=c.channelModel,l=c.lockModel,d=c.addressModel,p=c.dmzModel,f=c.blockModel,h=c.interblockModel,v=c.networkModel,g=c.rxRequestModel,y=c.txReplyModel,m=n(70),k=m.blockProducer,b=m.lockProducer,x=(m.networkProducer,k.generateNext),w=n(111).thread,I=n(1745).machine,M=n(53),P=n(113),R=n(112),E=n(1746).isolatorConfig,C=function(e,t){if(!e[".@@io"])return!1;var n=e[".@@io"],r=t[".@@io"]||u.create();return n.isTxGreaterThan(r)};e.exports={increasorConfig:function(e,t,n){var c=M.toFunctions(t),m=P.toFunctions(e),k=R.toFunctions(n);return I.withConfig({actions:{assignLock:s({lock:function(e,t){i("assignLock");var n=t.data.lock;return a(l.isModel(n)),n}}),assignNextDmz:s({nextDmz:function(e,t){var n=t.data.dmz;return a(p.isModel(n)),n}}),assignContainerId:s({containerId:function(e,t){var n=t.data.containerId;return a(!n||"string"===typeof n),i("assignContainerId: ",n),n}}),assignBlock:s({block:function(e,t){var n=t.data.nextBlock;return a(f.isModel(n)),n}}),reconcileLock:s({nextLock:function(e){var t=e.lock,n=e.block;a(l.isModel(t)),a(f.isModel(n)),i("reconcileLock");var r=b.reconcile(t,n);return r}}),repeatLock:s({nextLock:function(e){return e.lock}}),assignIsRedriveRequired:s({isRedriveRequired:function(e,t){var n=e.isRedriveRequired;a(!n);var r=t.data.effectsReplyCount;a(Number.isInteger(r)),a(r>=0);var o=!!r;return i("isRedriveRequired",o),o}}),assignTxInterblocks:s({txInterblocks:function(e){var t=e.block,n=e.lock;i("txInterblocks");var r=n.block;a(f.isModel(t)),a(f.isModel(r)),a(!t.provenance.address.isGenesis());var o=r.network;2===t.provenance.height&&!t.network[".."].address.isRoot()&&(o=v.create());var s=t.network.txInterblockAliases(o).map((function(e){return h.create(t,e)}));return i("txInterblocks raw length: ".concat(s.length)),s.push(h.create(t)),s}})},guards:{isLockAcquired:function(e,t){var n=!1,r=t.data.lock;return r&&(a(l.isModel(r)),n=r.block,!r.block&&i("WARNING missing chain locked")),i("isLockAcquired: ",!!n),n},isProposer:function(){return!0},isValidator:function(){return!1},isIsolationComplete:function(e){var t=!!e.nextDmz;return i("isIsolationComplete: ".concat(t)),t},isDmzChanged:function(e){var t=e.lock,n=e.nextDmz;a(l.isModel(t)),a(p.isModel(n));var r=n.network;a(t.block,"increasor never makes a new chain");var o=t.block.network,s=r.txInterblockAliases(o),c=C(r,o),u=s.length||c;return i("isDmzChanged: ".concat(u)),u},isNewBlock:function(e){var t=e.block,n=t&&f.isModel(t);return i("isNewBlock: ".concat(n)),n},isEffectable:function(e){var t=e.block,n=e.containerId;a(f.isModel(t)),a.strictEqual(typeof n,"string");var r=t.config.isPierced&&n;return i("isEffectable %o",r),r}},services:{lockChain:function(){var e=o(r.mark((function e(t,n){var o,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.payload,i("lockChain ".concat(o.getChainId())),a(d.isModel(o)),e.next=5,c.putLockChain(o);case 5:return s=e.sent,e.abrupt("return",{lock:s});case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),isolatedExecution:function(){var e=o(r.mark((function e(t){var o,i,s,c,u,l;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.lock,i={type:"EXECUTE_COVENANT",payload:{lock:o}},s=E(n),e.next=5,w(i,s);case 5:return c=e.sent,u=c.dmz,l=c.containerId,a(p.isModel(u)),e.abrupt("return",{dmz:u,containerId:l});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),signBlock:function(){var e=o(r.mark((function e(t){var n,o,i,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.lock,o=t.nextDmz,a(p.isModel(o)),a(l.isModel(n)),i=n.block,a(i),e.next=7,x(o,i,m.sign);case 7:return s=e.sent,e.abrupt("return",{nextBlock:s});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),effects:function(){var e=o(r.mark((function e(t){var n,s,l,d,p,f,h,v;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.containerId,s=t.nextLock,l=t.lock,a.strictEqual(typeof n,"string"),a(s.block),a(!s.block.equals(l.block)),i("effects"),d=u.create(),l.block&&l.block.network[".@@io"]&&(d=l.block.network[".@@io"]),p=s.block.network[".@@io"]||d,f=p.getRequestIndices().filter((function(e){return!d.requests[e]})),i("nextIoIndices: ",f),3e4,h=f.map(function(){var e=o(r.mark((function e(t){var o,u,l,d,f,h,v,m,b;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=p.requests[t],a(o&&o.payload),u=o.payload[".@@ioRequestId"],a.strictEqual(typeof u,"string"),l=o.type,d=o.payload,f=s.block.provenance.getAddress(),h=g.create(l,d,f,t),v=h.sequence,e.prev=8,e.next=11,k.executeEffect({containerId:n,effectId:u,timeout:3e4});case 11:b=e.sent,i("effects payload: ",b),m=y.create("@@RESOLVE",b,v),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(8),m=y.create("@@REJECT",e.t0,v);case 19:return e.next=21,c.putPierceReply({txReply:m});case 21:return i("reply address:",m.getAddress().getChainId()),e.abrupt("return",m);case 23:case"end":return e.stop()}}),e,null,[[8,16]])})));return function(t){return e.apply(this,arguments)}}()),e.next=14,Promise.all(h);case 14:return v=e.sent,i("settlements: ",v),e.next=18,k.unloadCovenant(n);case 18:return e.abrupt("return",{effectsReplyCount:v.length});case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),unlockChain:function(){var e=o(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.nextLock,a(l.isModel(n)),i("unlockChain"),e.next=5,c.putUnlockChain(n);case 5:return e.abrupt("return");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}})}}},1745:function(e,t,n){var r={id:"increasor",initial:"idle",context:{lock:void 0,nextLock:void 0,block:void 0,nextDmz:void 0,txInterblocks:[],containerId:"",isRedriveRequired:!1},strict:!0,states:{idle:{on:{INCREASE_CHAIN:"lockChain"}},lockChain:{invoke:{src:"lockChain",onDone:[{target:"execute",cond:"isLockAcquired",actions:"assignLock"},{target:"done"}],onError:"error"}},execute:{initial:"branch",states:{branch:{always:[{target:"proposeNext",cond:"isProposer"},{target:"validateNext",cond:"isValidator"},{target:"#done"}]},proposeNext:{initial:"branch",states:{branch:{always:[{target:"isDmzChanged",cond:"isIsolationComplete"},{target:"#increasor.isolate"}]},isDmzChanged:{always:[{target:"signBlock",cond:"isDmzChanged"},{target:"#increasor.unlockChain"}]},signBlock:{invoke:{src:"signBlock",onDone:{target:"#increasor.unlockChain",actions:"assignBlock"},onError:"#error"}}}},validateNext:{always:[{target:".signBlock",cond:"isIsolationComplete"},{target:"#increasor.isolate",cond:"isIsolationRequired"}],initial:"signBlock",states:{signBlock:{}}},history:{type:"history"}}},isolate:{invoke:{src:"isolatedExecution",onDone:{target:"#increasor.execute.history",actions:["assignNextDmz","assignContainerId"]},onError:"#error"}},unlockChain:{initial:"isNewBlock",states:{isNewBlock:{always:[{target:"effects",cond:"isNewBlock",actions:"reconcileLock"},{target:"unlockChain",actions:"repeatLock"}]},effects:{initial:"isEffectable",states:{isEffectable:{always:[{target:"executeEffects",cond:"isEffectable"},{target:"done"}]},executeEffects:{invoke:{src:"effects",onDone:{target:"done",actions:"assignIsRedriveRequired"}}},done:{type:"final"}},onDone:"unlockChain"},unlockChain:{invoke:{src:"unlockChain",onDone:"done"}},done:{type:"final"}},onDone:[{target:"done",cond:"isNewBlock",actions:"assignTxInterblocks"},{target:"done"}]},done:{id:"done",data:function(e){return{txInterblocks:e.txInterblocks,isRedriveRequired:e.isRedriveRequired}},type:"final"},error:{id:"error",type:"final"}}},o=Machine(r);e.exports={definition:r,machine:o}},1746:function(e,t,n){var r=n(2),o=n(3),a=n(7),i=n(4),s=n(9)("interblock:config:isolator"),c=n(40).assign,u=n(21),l=u.channelModel,d=u.interblockModel,p=u.blockModel,f=u.provenanceModel,h=u.dmzModel,v=u.lockModel,g=u.keypairModel,y=u.pierceSigner,m=n(70),k=m.networkProducer,b=m.channelProducer,x=(n(44).openPaths,n(111).thread),w=n(1747).interpreterConfig,I=n(1749).machine,M=n(112),P=n(48),R=g.create("PIERCE",P.pierceKeypair),E=function(e){var t=e.dmz;i(h.isModel(t));var n=t.rx();return s("isReduceable",n&&n.event.type),!!n},C=function(e){var t=e.dmz,n=e.hasPierced;i(h.isModel(t));var r=t.config.isPierced&&!n;return s("isPiercable: %O",r),r},q=I.withConfig({actions:{assignLock:c({lock:function(e,t){var n=t.payload.lock;return i(v.isModel(n)),i(n.block,"can only isolate for existing chains"),n}}),primeDmz:c({dmz:function(e){var t=e.lock;i(v.isModel(t));var n=t.block,r=t.interblocks,o=n.getDmz(),s=k.ingestInterblocks(o.network,r,o.config);return h.clone(a({},o,{network:s}))}}),assignContainerId:c({containerId:function(e,t){var n=t.data.containerId;return i(n),n}}),updateDmz:c({dmz:function(e,t){s("updateDmz");var n=t.data.nextDmz;return i(h.isModel(n)),n}}),generatePierceDmz:c({pierceDmz:function(e){var t=e.lock;i(v.isModel(t)),i(t.block);var n=t.block,r=t.piercings,o=A(t.block),c=o.network["@@PIERCE_TARGET"];return i(c.address.equals(n.provenance.getAddress())),i.strictEqual(c.systemRole,"PIERCE"),s("generatePierceDmz piercings.length: ",r.length),r.requests.forEach((function(e){var t=e.getRequest();c=b.txRequest(c,t)})),r.replies.forEach((function(e){i(e.getAddress().equals(c.address));var t=e.getReply(),n=e.getIndex();c=b.txReply(c,t,n)})),network=a({},o.network,{"@@PIERCE_TARGET":c}),o=h.clone(a({},o,{network:network})),o}}),assignHasPierced:c({hasPierced:function(){return!0}}),openPierceChannel:c({dmz:function(e,t){var n=e.dmz;s("openPierceChannel");var r=t.data.pierceBlock;i(p.isModel(r)),i(h.isModel(n));var o=r.provenance.getAddress(),c=n.network[".@@io"]||l.create(o,"PIERCE");c.address.isUnknown()&&(c=b.setAddress(c,o));var u=c.address;i(u.equals(o)),i.strictEqual(c.systemRole,"PIERCE");var d=a({},n.network,{".@@io":c});return h.clone(a({},n,{network:d}))}}),ingestPierceBlock:c({dmz:function(e,t){var n=e.dmz;s("ingestPierceBlock");var r=t.data.pierceBlock;i(p.isModel(r)),i(h.isModel(n));var o=d.create(r,"@@PIERCE_TARGET"),c=k.ingestInterblocks(n.network,[o],n.config);return i(o.equals(c[".@@io"].heavy)),h.clone(a({},n,{network:c}))}}),unassignContainerId:c({containerId:function(){return""}})},guards:{isDmzChangeable:function(e){var t=e.lock;i(v.isModel(t)),i(t.block);var n=C(e)&&t.isPiercingsPresent(),r=E(e)||n;return s("isDmzChangeable: ".concat(r)),r},isReduceable:E,isPiercable:C,isPierceDmzChanged:function(e){var t=e.lock,n=e.pierceDmz;if(!n)return s("isPierceDmzChanged: ",n),!1;i(v.isModel(t)),i(t.block),i(h.isModel(n));var r=A(t.block).network["@@PIERCE_TARGET"],o=n.network["@@PIERCE_TARGET"].isTxGreaterThan(r);return s("isPierceDmzChanged: %o",o),o},isPierceChannelUnopened:function(e){var t=e.dmz;i(h.isModel(t));var n=t.network[".@@io"],r=n&&!n.address.isResolved();return s("isPierceChannelUnopened",r),r},isCovenantEffectable:function(e){var t=e.lock,n=e.dmz;i(v.isModel(t)),i(h.isModel(n));var r=l.create();t.block&&t.block.network[".@@io"]&&(r=t.block.network[".@@io"]);var o=(n.network[".@@io"]||r).getRequestIndices().filter((function(e){return!r.requests[e]})).length;return s("isCovenantEffectable",o),o}},services:{loadCovenant:function(){var e=o(r.mark((function e(t){var n,o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.lock,o=t.isolation,i(v.isModel(n)),e.next=4,o.loadCovenant(n.block);case 4:return a=e.sent,s("loadCovenant containerId: ".concat(a.substring(0,9))),e.abrupt("return",{containerId:a});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),reduce:function(){var e=o(r.mark((function e(t){var n,o,a,c,u,l,d,p,f,v,g;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dmz,o=t.containerId,a=t.isolation,i(h.isModel(n)),i(n.rx()),c=n.rx(),u=c.event,l=c.channel,s("reduce: ",u.type),d=l.address,i(!d.isUnknown()),p=T(o,a.tick),f=w(p),v={type:"TICK",payload:{dmz:n,externalAction:u,address:d}},e.next=13,x(v,f);case 13:return g=e.sent,i(h.isModel(g)),e.abrupt("return",{nextDmz:g});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),signPierceDmz:function(){var e=o(r.mark((function e(t){var n,o,c,u,l,d,g;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.pierceDmz,o=t.lock,i(h.isModel(n)),i(v.isModel(o)),c=o.block,i(c),u=O(c),s("signPierceDmz with previous: %O",!!u),l={},e.next=10,f.create(n,u,l,y);case 10:return d=e.sent,g=p.clone(a({},n,{provenance:d})),e.abrupt("return",{pierceBlock:g});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),unloadCovenant:function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.containerId,o=t.isolation,s("unloadCovenant containerId: %o",n.substring(0,9)),e.next=4,o.unloadCovenant(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}),A=function(e){var t=R.getValidatorEntry(),n=h.create({validators:t}),r=e.provenance.getAddress(),o=l.create(r,"PIERCE");if(e.network[".@@io"]&&e.network[".@@io"].address.isResolved()){var s=e.network[".@@io"],c=s.getRemote();i(c&&c.address.equals(r));var u=c.requests,p=c.replies,f=s.getRemoteRequestIndices(),v=f.length?f.pop()+1:0,g=a({},o,{requests:u,replies:p,requestsLength:v});o=l.clone(g);var y=d.create(e,".@@io");for(o=b.ingestPierceInterblock(o,y);o.rxReply();)o=b.shiftTxRequest(o)}var m=a({},n.network,{"@@PIERCE_TARGET":o});return h.clone(a({},n,{network:m}))},O=function(e){var t=e.network[".@@io"];if(t){var n=t.heavy.provenance;return i(f.isModel(n)),n}},T=function(e,t){return function(n,r,o){return t({containerId:e,state:n,action:r,accumulator:o,timeout:3e4})}};e.exports={isolatorConfig:function(e){s("isolatorConfig");var t=M.toFunctions(e);return q.withContext({isolation:t})}}},1747:function(e,t,n){var r=n(17),o=n(2),a=n(3),i=n(7),s=n(4),c=n(9)("interblock:config:interpreter"),u=n(21),l=u.txReplyModel,d=u.txRequestModel,p=u.rxReplyModel,f=u.rxRequestModel,h=u.addressModel,v=u.dmzModel,g=u.channelModel,y=u.reductionModel,m=u.pendingModel,k=n(70),b=k.networkProducer,x=k.pendingProducer,w=n(44),I=n(1748).machine,M=n(34),P=M["@@GLOBAL_HOOK"],R=M.resolve,E=(M.reject,M.isReplyFor,n(40).assign),C=I.withConfig({actions:{assignExternalAction:E({externalAction:function(e,t){var n=t.payload.externalAction;return n}}),assignDmz:E({dmz:function(e,t){var n=t.payload,r=n.dmz,o=n.address;return s(v.isModel(r)),s(r.network.getAlias(o)),r},initialPending:function(e,t){var n=t.payload.dmz;return s(v.isModel(n)),n.pending}}),assignAnvil:E({anvil:function(e,t){var n=t.payload,r=n.externalAction,o=n.address,a=r;s(f.isModel(a)||p.isModel(a)),s(h.isModel(o)),f.isModel(a)&&s(a.getAddress().equals(o));var i=o.getChainId();return c("interpreterConfig type: %o chainId: %o",a.type,i),a},address:function(e,t){var n=t.payload.address;return s(h.isModel(n)),s(n.isResolved()||n.isLoopback()),n}}),loadSelfAnvil:E({anvil:function(e){var t=e.dmz.network.rxSelf();return c("loadSelfAnvil anvil: %o",t.type),t},address:function(e){var t=e.dmz.network["."].address;return s(t.isLoopback()),c("loadSelfAnvil selfAddress: %o",t.getChainId()),t}}),assignResolve:E({reduceResolve:function(e,t){var n=e.dmz,r=e.anvil;s(v.isModel(n));var o=t.data.reduceResolve;s(o);o.reduction;var a=o.isPending;o.requests,o.replies;return c("assignResolve pending: %o",a),y.create(o,r,n)}}),assignRejection:E({reduceRejection:function(e,t){return t.data}}),respondRejection:E({dmz:function(e){var t=e.dmz,n=e.anvil,r=e.reduceRejection;s(v.isModel(t));var o=b.respondRejection(t.network,n,r);return v.clone(i({},t,{network:o}))}}),assignDirectCovenantAction:E({covenantAction:function(e){var t=e.dmz,n=e.anvil;return s(v.isModel(t)),s(f.isModel(n)||p.isModel(n)),s(!t.pending.getIsPending()),s(!t.pending.getAccumulator().length),n}}),bufferRequest:E({dmz:function(e){var t=e.dmz,n=e.anvil;s(v.isModel(t)),s(f.isModel(n)),c("bufferRequest: ",n.type);var r=x.bufferRequest(t.pending,n);return v.clone(i({},t,{pending:r}))}}),accumulateReply:E({dmz:function(e){var t=e.dmz,n=e.anvil;s(v.isModel(t)),s(p.isModel(n)),c("accumulateReply: ",n.type);var r=x.pushReply(t.pending,n);return v.clone(i({},t,{pending:r}))}}),shiftCovenantAction:E({covenantAction:function(e){var t=e.dmz,n=e.anvil;s(v.isModel(t)),s(p.isModel(n));var r=t.pending;s(r.getIsPending());var o=r.pendingRequest;return s(f.isModel(o)),c("shiftCovenantAction: ",o.type),o}}),mergeSystemState:E({dmz:function(e){var t=e.dmz,n=e.reduceResolve;return s(v.isModel(t)),s(y.isModel(n)),c("mergeSystemState"),v.clone(n.reduction)}}),deduplicatePendingReplyTx:E({reduceResolve:function(e){var t=e.dmz,n=e.reduceResolve;s(v.isModel(t)),s(y.isModel(n));var r=n.requests,o=n.replies;return r=r.filter((function(e){s(d.isModel(e));var n=t.network[e.to];if(!n)return!0;var r=e.getRequest();return!Object.values(n.requests).some((function(e){return r.equals(e)}))})),o=o.filter((function(e){s(l.isModel(e));var n=e.getAddress(),r=e.getIndex(),o=t.network.getAlias(n);if(!o)return!0;var a=t.network[o].replies[r];return!e.getReply().equals(a)})),c("deduplicatePendingReplyTx dedupes: ",n.requests.length-r.length),y.clone(i({},n,{requests:r,replies:o}))}}),transmit:E({dmz:function(e){var t=e.dmz,n=e.reduceResolve;s(v.isModel(t)),s(y.isModel(n));var r=n.requests,o=n.replies;c("transmit req: %o rep %o",r,o);var a=b.tx(t.network,r,o);return v.clone(i({},t,{network:a}))},isExternalPromise:function(e){var t=e.isExternalPromise,n=e.externalAction,r=e.reduceResolve;if(t)return t;s(y.isModel(r));var o=r.replies;return p.isModel(n)?(c("transmit isExternalPromise",!1),!1):(s(f.isModel(n)),t=o.some((function(e){return e.getReply().isPromise()&&e.request.sequence===n.sequence})),c("transmit isExternalPromise",t),t)},isOriginPromise:function(e){var t=e.isOriginPromise,n=e.initialPending,r=e.reduceResolve;if(t||!n.getIsPending())return c("transmit isOriginPromise",t),t;s(m.isModel(n)),s(y.isModel(r));var o=r.replies,a=n.pendingRequest;return t=o.some((function(e){return e.getReply().isPromise()&&e.request.sequence===a.sequence})),c("transmit isOriginPromise",t),t}}),settleOrigin:E({dmz:function(e){var t=e.initialPending,n=e.dmz;s(m.isModel(t)),s(t.getIsPending()),s(v.isModel(n)),s(!n.pending.getIsPending());var r=t.pendingRequest;s(f.isModel(r)),c("settleOrigin",r);var o=r.sequence,a=l.create("@@RESOLVE",{},o),u=b.tx(n.network,[],[a]);return v.clone(i({},n,{network:u}))}}),rejectOriginRequest:E({dmz:function(e){var t=e.dmz,n=e.anvil,r=e.reduceRejection,o=e.covenantAction;s(v.isModel(t)),s(p.isModel(n)),s(f.isModel(o)),s.strictEqual(typeof r,"object"),c("rejectOriginRequest",n.type,r);var a=o.sequence,u=l.create("@@REJECT",r,a),d=b.tx(t.network,[],[u]);return v.clone(i({},t,{network:d}))}}),warnReplyRejection:function(e){var t=e.reduceRejection;c("warnReplyRejection"),console.warn("Warning: rejection occured during reply"),console.warn(t)},raisePending:E({dmz:function(e){var t=e.dmz,n=e.anvil;s(v.isModel(t)),s(f.isModel(n)),s(!t.pending.getIsPending()),c("raisePending",n.type);var r=x.raisePending(t.pending,n);return v.clone(i({},t,{pending:r}))}}),assignInitialPending:E({initialPending:function(e){var t=e.dmz;return s(v.isModel(t)),s(t.pending.getIsPending()),c("assignInitialPending"),t.pending}}),promiseAnvil:E({dmz:function(e){var t=e.dmz,n=e.anvil;s(v.isModel(t)),s(f.isModel(n)),c("promiseanvil",n.type);var r=n.sequence,o=l.create("@@PROMISE",{},r),a=b.tx(t.network,[],[o]);return v.clone(i({},t,{network:a}))}}),promiseOriginRequest:E({dmz:function(e){var t=e.dmz,n=e.anvil,r=e.covenantAction;s(v.isModel(t)),s(f.isModel(n)),s(!r||n.equals(r));var o=n.sequence,a=l.create("@@PROMISE",{},o),u=b.tx(t.network,[],[a]);return c("promiseOriginRequest",n.type),v.clone(i({},t,{network:u}))},isExternalPromise:function(){return!0}}),settlePending:E({dmz:function(e){var t=e.dmz;s(v.isModel(t)),s(t.pending.getIsPending()),c("settlePending");var n=x.settle(t.pending);return v.clone(i({},t,{pending:n}))}}),mergeState:E({dmz:function(e){var t=e.dmz,n=e.reduceResolve;return s(v.isModel(t)),s(y.isModel(n)),c("mergeState"),v.clone(i({},t,{state:n.reduction}))}}),respondReply:E({dmz:function(e){var t=e.dmz,n=e.address;s(v.isModel(t));var r=t.network["."];s(g.isModel(r)),s(h.isModel(n)),c("respondReply");var o=b.respondReply(t.network,n,r);return v.clone(i({},t,{network:o}))}}),respondRequest:E({dmz:function(e){var t=e.externalAction,n=e.dmz,r=e.address,o=e.anvil;c("respondRequest"),s(v.isModel(n)),s(f.isModel(o)),s(o.getAddress().equals(r)),s(!o.equals(t));var a=b.respondRequest(n.network,o);return v.clone(i({},n,{network:a}))}}),shiftBufferedRequests:E({dmz:function(e){var t=e.dmz;s(v.isModel(t)),c("shiftBufferedRequests");var n=x.shiftRequests(t.pending,t.network);return v.clone(i({},t,{pending:n}))}}),defaultResolve:E({dmz:function(e){var t=e.dmz,n=e.externalAction;c("defaultResolve"),s(v.isModel(t)),s(f.isModel(n));var r=n.sequence,o=l.create("@@RESOLVE",{},r),a=b.tx(t.network,[],[o]);return v.clone(i({},t,{network:a}))}}),openPaths:E({dmz:function(e){var t=e.dmz;s(v.isModel(t)),c("openPaths");var n=w.openPaths(t.network);return v.clone(i({},t,{network:n}))}})},guards:{isSelfExhausted:function(e){var t=!e.dmz.network.rxSelf();return c("isSelfExhausted: ".concat(t)),t},isSystem:function(e){var t=e.anvil;s(f.isModel(t)||p.isModel(t));var n=w.isSystemReply(t)||w.isSystemRequest(t);return c("isSystem: ".concat(n)),n},isExternalAction:function(e){var t=e.externalAction,n=e.anvil,r=e.address;s(f.isModel(n)||p.isModel(n)),s(h.isModel(r));var o=!r.isLoopback();return s(!o||t.equals(n)),c("isExternalAction",o),o},isPending:function(e){var t=e.dmz.pending.getIsPending();return c("isPending",t),t},isReductionPending:function(e){var t=e.reduceResolve;s(y.isModel(t));var n=t.getIsPending();return c("isReductionPending",n),n},isChannelUnavailable:function(e){var t=e.dmz,n=e.address;s(h.isModel(n),"If Anvil, then address required"),s(!n.isUnknown(),"Address unknown");var r=t.network.getAlias(n);return c("isChannelUnavailable: ",!r),!r},isReply:function(e){var t=e.anvil,n=p.isModel(t);return n||s(f.isModel(t)),c("isReply: %o",n),n},isAnvilPromised:function(e){var t=e.dmz,n=e.anvil;s(v.isModel(t)),s(f.isModel(n));var r=t.network.getResponse(n),o=r&&r.isPromise();return c("isAnvilPromised",o),o},isUnbuffered:function(e){var t=e.dmz,n=e.covenantAction;s(v.isModel(t)),s(f.isModel(n));var r=!t.pending.getIsBuffered(n);return c("isUnbuffered",r),r},isLoopbackResponseDone:function(e){var t=e.dmz,n=e.anvil,r=e.address;s(v.isModel(t)),s(f.isModel(n)),s(n.getAddress().equals(r)),s(r.isLoopback());var o=!!t.network.getResponse(n);return c("isLoopbackResponseDone: %o anvil: %o",o,n.type),o},isOriginSettled:function(e){var t=e.initialPending,n=e.dmz;if(s(m.isModel(t)),s(v.isModel(n)),!t.getIsPending())return c("isOriginSettled",!0),!0;var r=t.pendingRequest;s(f.isModel(r));var o=n.network.getResponse(r),a=o&&!o.isPromise();return c("isOriginSettled",a),a},isPendingUnlowered:function(e){var t=e.initialPending,n=e.dmz;s(m.isModel(t)),s(v.isModel(n));var r=!(t.getIsPending()&&!n.pending.getIsPending());return c("isPendingUnlowered",r),r},isTxOriginPromise:function(e){var t=e.isOriginPromise;return c("isTxOriginPromise",t),t},isExternalActionReply:function(e){var t=e.externalAction,n=p.isModel(t);return c("isExternalActionReply",n),n},isExternalActionSettled:function(e){var t=e.dmz,n=e.externalAction;s(v.isModel(t)),s(f.isModel(n));var r=t.network.getResponse(n),o=r&&!r.isPromise();return c("isExternalActionSettled",o),o},isTxExternalActionPromise:function(e){var t=!!e.isExternalPromise;return c("isTxExternalActionPromise",t),t}},services:{reduceSystem:function(){var e=a(o.mark((function e(t){var n,i,u,l,d,h,g,y;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.dmz,i=t.anvil,s(v.isModel(n)),s(f.isModel(i)||p.isModel(i)),c("reduceSystem anvil: %o",i.type),u=function(){return w.reducer(n,i)},l=[];case 6:return e.next=8,P(u,l);case 8:return d=e.sent,h=d.requests.filter((function(e){return e.inBand})),g=h.map(function(){var e=a(o.mark((function e(t){var n,r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("inband execution of: ",t.type),e.next=3,t.exec();case 3:return n=e.sent,r=R(n,t),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=13,Promise.all(g);case 13:y=e.sent,c("inband awaits results: ",y.length),l.push.apply(l,r(y));case 16:if(h.length){e.next=6;break}case 17:return c("result isPending: ",d.isPending),s(d,"System returned: ".concat(d)),s(!d.isPending,"System can never raise pending"),e.abrupt("return",{reduceResolve:d});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),reduceCovenant:function(){var e=a(o.mark((function e(t){var n,r,a,i,u,l,d,h;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dmz,r=t.covenantAction,a=t.isolatedTick,c("reduceCovenant: %o",r.type),i=p.isModel(r),u=f.isModel(r),s(i||u),l=n.state,d=n.pending.getAccumulator(),e.next=9,a(l,r,d);case 9:return h=e.sent,s(h,"Covenant returned: ".concat(h)),c("reduceCovenant result pending: ",h.isPending),e.abrupt("return",{reduceResolve:h});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}});e.exports={interpreterConfig:function(e){return s("function"===typeof e),C.withContext({isolatedTick:e})}}},1748:function(e,t,n){var r={id:"interpreter",initial:"idle",context:{isolatedTick:void 0,externalAction:void 0,anvil:void 0,address:void 0,dmz:void 0,initialPending:void 0,covenantAction:void 0,reduceRejection:void 0,reduceResolve:void 0,isExternalPromise:void 0,isOriginPromise:void 0},strict:!0,states:{idle:{on:{TICK:{target:"interpret",actions:["assignExternalAction","assignDmz","assignAnvil"]}}},loopback:{always:[{target:"autoResolves",cond:"isSelfExhausted"},{target:"interpret",actions:"loadSelfAnvil"}]},interpret:{always:[{target:"interpretSystem",cond:"isSystem"},{target:"interpretCovenant"}]},interpretSystem:{initial:"reduceSystem",states:{reduceSystem:{invoke:{src:"reduceSystem",onDone:{target:"merge",actions:"assignResolve"},onError:{target:"respondRejection",actions:"assignRejection"}}},respondRejection:{entry:"respondRejection",always:"done"},merge:{entry:["mergeSystemState","transmit"],always:[{target:"done",cond:"isChannelUnavailable"},{target:"respondReply",cond:"isReply"},{target:"respondRequest"}]},respondReply:{entry:"respondReply",always:"done"},respondRequest:{always:[{target:"done",cond:"isExternalAction"},{target:"done",cond:"isLoopbackResponseDone"},{target:"done",actions:"respondRequest"}]},done:{type:"final"}},onDone:"loopback"},interpretCovenant:{initial:"isPending",states:{isPending:{always:[{target:"pending",cond:"isPending"},{target:"direct"}]},pending:{initial:"isReply",states:{isReply:{always:[{target:"reducePendingReply",cond:"isReply"},{target:"bufferRequest"}]},bufferRequest:{entry:"bufferRequest",always:[{target:"done",cond:"isAnvilPromised"},{target:"done",actions:"promiseAnvil"}]},reducePendingReply:{entry:["accumulateReply","shiftCovenantAction"],invoke:{src:"reduceCovenant",onDone:{target:"deduplicatePendingReplyTx",actions:"assignResolve"},onError:{target:"rejectPending",actions:"assignRejection"}},exit:"respondReply"},deduplicatePendingReplyTx:{entry:"deduplicatePendingReplyTx",always:"transmit"},transmit:{entry:"transmit",always:[{target:"done",cond:"isReductionPending"},{target:"resolvePending"}]},rejectPending:{entry:["rejectOriginRequest","settlePending"],always:"done"},resolvePending:{entry:["settlePending","mergeState"],always:"done"},done:{type:"final"}},onDone:"done"},direct:{initial:"isReply",states:{isReply:{entry:"assignDirectCovenantAction",always:[{target:"reply",cond:"isReply"},{target:"request"}]},reply:{initial:"reduce",states:{reduce:{invoke:{src:"reduceCovenant",onDone:{target:"isPending",actions:"assignResolve"},onError:{target:"reject",actions:"assignRejection"}}},isPending:{always:[{target:"reject",cond:"isReductionPending",actions:"assignRejectionFromReply"},{target:"transmit"}]},transmit:{entry:"transmit",always:"done"},reject:{entry:"warnReplyRejection",always:"done"},done:{entry:"respondReply",type:"final"}},onDone:"done"},request:{initial:"reduce",states:{reduce:{invoke:{src:"reduceCovenant",onDone:{target:"transmit",actions:"assignResolve"},onError:{target:"reject",actions:"assignRejection"}}},transmit:{entry:"transmit",always:[{target:"raisePending",cond:"isReductionPending"},{target:"respondRequest"}]},respondRequest:{entry:"mergeState",always:[{target:"isUnbuffered",cond:"isExternalAction"},{target:"isUnbuffered",cond:"isLoopbackResponseDone"},{target:"isUnbuffered",actions:"respondRequest"}]},raisePending:{entry:["raisePending","promiseOriginRequest","assignInitialPending"],always:"isUnbuffered"},reject:{entry:"respondRejection",always:"isUnbuffered"},isUnbuffered:{always:[{target:"done",cond:"isUnbuffered"},{target:"done",actions:"shiftBufferedRequests"}]},done:{type:"final"}},onDone:"done"},done:{type:"final"}},onDone:"done"},done:{type:"final"}},onDone:"loopback"},autoResolves:{initial:"settleOrigin",states:{settleOrigin:{always:[{target:"settleExternalAction",cond:"isOriginSettled"},{target:"settleExternalAction",cond:"isPendingUnlowered"},{target:"settleExternalAction",cond:"isTxOriginPromise"},{target:"settleExternalAction",actions:"settleOrigin"}]},settleExternalAction:{always:[{target:"done",cond:"isExternalActionReply"},{target:"done",cond:"isExternalActionSettled"},{target:"done",cond:"isTxExternalActionPromise"},{target:"done",actions:"defaultResolve"}]},done:{type:"final"}},onDone:"done"},done:{entry:"openPaths",id:"done",data:function(e){return e.dmz},type:"final"}}},o=Machine(r);e.exports={definition:r,machine:o}},1749:function(e,t,n){var r={id:"isolator",initial:"idle",context:{lock:void 0,dmz:void 0,containerId:void 0,isolation:function(){return"isolation function"},pierceDmz:void 0,hasPierced:!1},strict:!0,states:{idle:{on:{EXECUTE_COVENANT:{target:"isDmzChangeable",actions:["assignLock","primeDmz"]}}},isDmzChangeable:{always:[{target:"loadCovenant",cond:"isDmzChangeable"},{target:"done"}]},loadCovenant:{invoke:{src:"loadCovenant",onDone:{target:"isReduceable",actions:"assignContainerId"},onError:"error"}},isReduceable:{always:[{target:"reduce",cond:"isReduceable"},{target:"pierce",cond:"isPiercable"},{target:"isCovenantUnloadable"}]},reduce:{invoke:{src:"reduce",onDone:{target:"isReduceable",actions:"updateDmz"},onError:"error"}},pierce:{initial:"generatePierceDmz",states:{generatePierceDmz:{entry:["assignHasPierced","generatePierceDmz"],always:[{target:"signPierceDmz",cond:"isPierceDmzChanged"},{target:"signPierceDmz",cond:"isPierceChannelUnopened"},{target:"done"}]},signPierceDmz:{invoke:{src:"signPierceDmz",onDone:{target:"done",actions:["openPierceChannel","ingestPierceBlock"]}}},done:{type:"final"}},onDone:"isReduceable"},isCovenantUnloadable:{always:[{target:"done",cond:"isCovenantEffectable"},{target:"unloadCovenant"}]},unloadCovenant:{invoke:{src:"unloadCovenant",onDone:{target:"done",actions:"unassignContainerId"},onError:"error"}},done:{data:function(e){return{dmz:e.dmz,containerId:e.containerId}},type:"final"},error:{type:"final"}}},o=Machine(r);e.exports={definition:r,machine:o}},1750:function(e,t,n){var r=n(2),o=n(3),a=n(17),i=n(7),s=n(4),c=n(9)("interblock:config:pool"),u=(n(24),n(40).assign),l=n(1751).machine,d=n(21),p=d.channelModel,f=d.networkModel,h=d.blockModel,v=d.lockModel,g=d.interblockModel,y=d.addressModel,m=d.dmzModel,k=d.covenantIdModel,b=d.publicKeyModel,x=(d.provenanceModel,n(70)),w=x.blockProducer,I=x.lockProducer,M=x.channelProducer,P=x.networkProducer,R=w.generateNext,E=n(53),C=n(113);e.exports={poolConfig:function(e,t){var n=E.toFunctions(t),d=C.toFunctions(e);return l.withConfig({actions:{assignInterblock:u({interblock:function(e,t){var n=t.payload;return s(g.isModel(n)),n}}),assignLock:u({lock:function(e,t){return s(v.isModel(t.data)),t.data}}),assignDmz:u({dmz:function(e){var t=e.lock;s(v.isModel(t));var n=t.block&&t.block.getDmz();return n}}),assignNextBlock:u({nextBlock:function(e){var t=e.lock;return s(v.isModel(t)),t.block}}),mergeGenesis:u({nextBlock:function(e){var t=e.lock,n=e.interblock;c("mergeGenesis"),s(v.isModel(t)),s(g.isModel(n));var r=n.extractGenesis();return r}}),connectToParent:u({dmz:function(e){var t=e.interblock,n=e.dmz;c("connectToParent");var r=t.provenance.getAddress(),o=n.network[".."];o=M.setAddress(o,r);var a=i({},n.network,{"..":o});return m.clone(i({},n,{network:a}))}}),ingestParentLineage:u({dmz:function(e,t){var n=e.dmz,r=t.data;s(Array.isArray(r)),s(r.every(g.isModel)),c("ingestParentLineage length: ".concat(r.length));var o=P.ingestInterblocks(n.network,r,n.config);return n=m.clone(i({},n,{network:o}))}}),mergeBlockToLock:u({lock:function(e){var t=e.lock,n=e.nextBlock;return s(v.isModel(t)),s(h.isModel(n)),c("mergeBlockToLock increased: ".concat(!n.equals(t.block))),I.reconcile(t,n)}}),assignInitializedAddress:u({affectedAddresses:function(e){return[e.lock.block.provenance.getAddress()]}}),assignGeneratedBlock:u({nextBlock:function(e,t){return s(h.isModel(t.data)),c("assignGeneratedBlock"),t.data}}),unassignLock:u({lock:function(){}}),createBaseDmz:u({baseDmz:function(e){var t=e.validators,n=k.create("hyper"),r=y.create("ROOT"),o=p.create(r),a=i({},f.create(),{"..":o});return m.create({covenantId:n,validators:t,network:a,config:{isPierced:!0,isPublicChannelOpen:!0}})}}),assignValidatorKey:u({validators:function(e,t){c("assignValidatorKey: %o",t.data);var n=Object.values(t.data)[0];return s(b.isModel(n)),t.data}}),assignAffectedAddresses:u({affectedAddresses:function(e,t){var n=e.affectedAddresses;c("assignAffectedAddresses");var r=t.data;return s(Array.isArray(r)),[].concat(a(r),a(n))}}),assignConnectionAttempt:u({affectedAddresses:function(e){var t=e.interblock,n=e.affectedAddresses;s(Array.isArray(n)),s(g.isModel(t));var r=t.getTargetAddress();return[].concat(a(n),[r])}})},guards:{isStorageEmpty:function(e,t){var n=t.data.isStorageEmpty;return c("isStorageEmpty: ".concat(n)),n},isInitialConditions:function(e){return!!e.baseDmz},isGenesis:function(e){var t=e.interblock;s(g.isModel(t));var n=!1;try{t.extractGenesis(),n=!0}catch(r){}return c("isGenesis: ".concat(n)),n},isOriginPresent:function(e,t){var n=t.data;return s("boolean"===typeof n),c("isOriginPresent: ".concat(n)),n},isLockFailed:function(e,t){var n=!t.data&&!v.isModel(t.data);return c("isLockFailed: ".concat(n)),n},isBirthingCompleted:function(e){var t=e.lock;s(v.isModel(t));var n=t.block&&t.block.provenance.height>=1;return c("isBirthingCompleted: ".concat(n)),n},verifyLineage:function(e,t){var n=e.interblock,r=t.data;return s(r.length),s.strictEqual(n.getChainId(),r[0].getChainId()),s(!r[0].provenance.height),c("verifyLineage"),!0},isLockForGenesis:function(e){var t=e.lock;s(v.isModel(t));var n=t.block,r=n&&n.provenance.address.isGenesis();return c("isLockForGenesis: ".concat(r)),r},isLockForBirthBlock:function(e){var t=e.lock;s(v.isModel(t));var n=t.block,r=n&&1===n.provenance.height;return c("isLockForBirthBlock: ".concat(r)),r},isConnectionAttempt:function(e){return e.interblock.isConnectionAttempt()},isConnectable:function(e,t){return t.data}},services:{isStorageEmpty:function(){var e=o(r.mark((function e(){var t,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0,e.next=3,n.getBlock({address:void 0});case 3:return t=e.sent,c("isStorageEmpty: ".concat(o=!t)),e.abrupt("return",{isStorageEmpty:o});case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),checkIsOriginPresent:function(){var e=o(r.mark((function e(t){var o,a,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.interblock,a=o.provenance.getAddress(),e.next=4,n.getIsPresent(a);case 4:return i=e.sent,c("checkIsOriginPresent: %O",!!i),e.abrupt("return",!!i);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),lockChildChain:function(){var e=o(r.mark((function e(t){var o,a,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.interblock,s(g.isModel(o)),a=o.extractGenesis().provenance.getAddress(),e.next=5,n.putLockChain(a);case 5:return i=e.sent,c("lockChildChain: ".concat(!!i)),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchParentLineage:function(){var e=o(r.mark((function e(t){var o,a,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.interblock,s(g.isModel(o)),a=o.provenance,e.next=5,n.getLineage({provenance:a});case 5:return i=e.sent,s(Array.isArray(i)),s(i.every(g.isModel)),s.strictEqual(i[0].provenance.height,0),c("fetchParentLineage length: ".concat(i.length)),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),generateBirthBlock:function(){var e=o(r.mark((function e(t){var n,o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dmz,o=t.lock,s(m.isModel(n)),s(v.isModel(o)),c("generateBirthBlock"),e.next=6,R(n,o.block,d.sign);case 6:return a=e.sent,e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),unlockChain:function(){var e=o(r.mark((function e(t){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.lock,s(v.isModel(o)),c("unlockChain"),e.next=5,n.putUnlockChain(o);case 5:return e.abrupt("return");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),poolBirthBlock:function(){var e=o(r.mark((function e(t){var o,a,i,c,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.lock,s(v.isModel(o)),a=o.block,s(a),s(1===a.provenance.height),i=a.network[".."].address,s(i.isResolved()),c=g.create(a),u=[i],e.next=11,n.putPoolInterblock({affectedAddresses:u,interblock:c});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchValidatorKey:function(){var e=o(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("fetchValidatorKey"),e.next=3,d.getValidatorEntry();case 3:return t=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),signBlock:function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.baseDmz,c("signBlock"),e.next=4,h.create(n,d.sign);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),lockBaseChain:function(){var e=o(r.mark((function e(t){var o,a,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.nextBlock,c("lockBaseChain"),a=o.provenance.getAddress(),e.next=5,n.putLockChain(a);case 5:return i=e.sent,e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchAffectedAddresses:function(){var e=o(r.mark((function e(t){var o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.interblock,e.next=3,n.getAffected(o);case 3:return a=e.sent,c("fetchAffectedAddresses: ".concat(a.length)),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),isConnectable:function(){var e=o(r.mark((function e(t){var o,a,i,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.interblock,s(g.isModel(o)),a=o.getTargetAddress(),s(a),e.next=6,n.getBlock({address:a});case 6:return(i=e.sent)&&s(h.isModel(i)),u=i&&i.config.isPublicChannelOpen,c("isConnectable: ",u),e.abrupt("return",u);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),storeInPools:function(){var e=o(r.mark((function e(t){var o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.interblock,a=t.affectedAddresses,s(Array.isArray(a)),s(g.isModel(o)),c("storeInPools"),e.next=6,n.putPoolInterblock({affectedAddresses:a,interblock:o});case 6:c("storeInPools completed on ".concat(a.length," items"));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}})}}},1751:function(e,t,n){var r={id:"pool",initial:"idle",context:{interblock:void 0,lock:void 0,dmz:void 0,nextBlock:void 0,affectedAddresses:[],baseDmz:void 0,validators:void 0},strict:!0,states:{idle:{on:{POOL_INTERBLOCK:{target:"initializeStorage",actions:"assignInterblock"}}},done:{id:"done",data:function(e){return e.affectedAddresses},type:"final"},initializeStorage:{initial:"isStorageEmpty",states:{isStorageEmpty:{invoke:{src:"isStorageEmpty",onDone:[{target:"fetchValidatorKey",cond:"isStorageEmpty"},{target:"done"}]}},fetchValidatorKey:{invoke:{src:"fetchValidatorKey",onDone:{target:"createBaseBlock",actions:"assignValidatorKey"}}},createBaseBlock:{entry:"createBaseDmz",invoke:{src:"signBlock",onDone:{target:"lockBaseChain",actions:"assignGeneratedBlock"}}},lockBaseChain:{invoke:{src:"lockBaseChain",onDone:{target:"unlockChain",actions:"assignLock"}}},unlockChain:{entry:"mergeBlockToLock",invoke:{src:"unlockChain",onDone:{target:"done",actions:"assignInitializedAddress"}}},done:{type:"final"}},onDone:[{target:"done",cond:"isInitialConditions"},{target:"poolInterblock"}]},poolInterblock:{initial:"isGenesis",states:{isGenesis:{always:[{target:"birthChild",cond:"isGenesis"},{target:"poolAffectedChains"}]},poolAffectedChains:{initial:"fetchAffectedAddresses",states:{fetchAffectedAddresses:{invoke:{src:"fetchAffectedAddresses",onDone:{target:"isConnectionAttempt",actions:"assignAffectedAddresses"}}},isConnectionAttempt:{always:[{target:"isConnectable",cond:"isConnectionAttempt"},{target:"storeInPools"}]},isConnectable:{invoke:{src:"isConnectable",onDone:[{target:"storeInPools",cond:"isConnectable",actions:"assignConnectionAttempt"},{target:"storeInPools"}]}},storeInPools:{invoke:{src:"storeInPools",onDone:{target:"done"}}},done:{type:"final"}},onDone:"done"},done:{type:"final"},birthChild:{initial:"checkIsOriginPresent",states:{checkIsOriginPresent:{invoke:{src:"checkIsOriginPresent",onDone:[{target:"lockChildChain",cond:"isOriginPresent"},{target:"done"}]}},done:{type:"final"},lockChildChain:{entry:"unassignLock",invoke:{src:"lockChildChain",onDone:[{target:"done",cond:"isLockFailed"},{target:"increaseChain"}]}},increaseChain:{entry:["assignLock","assignDmz","assignNextBlock"],always:[{target:"unlockChain",cond:"isBirthingCompleted"},{target:"fetchParentLineage",cond:"isLockForGenesis"},{target:"mergeGenesis"}]},mergeGenesis:{entry:"mergeGenesis",always:"unlockChain"},fetchParentLineage:{entry:"connectToParent",invoke:{src:"fetchParentLineage",onDone:{target:"generateBirthBlock",cond:"verifyLineage"}},exit:"ingestParentLineage"},generateBirthBlock:{invoke:{src:"generateBirthBlock",onDone:{target:"unlockChain",actions:"assignGeneratedBlock"}}},unlockChain:{entry:"mergeBlockToLock",invoke:{src:"unlockChain",onDone:[{target:"lockChildChain",cond:"isLockForGenesis"},{target:"poolBirthBlock",cond:"isLockForBirthBlock"},{target:"done"}]}},poolBirthBlock:{invoke:{src:"poolBirthBlock",onDone:"done"}}},onDone:"poolAffectedChains"}},onDone:"done"},error:{id:"error",type:"final"}}},o=Machine(r);e.exports={definition:r,machine:o}},1752:function(e,t,n){var r=n(2),o=n(3),a=n(4),i=n(9)("interblock:config:receive"),s=(n(24),n(40).assign),c=n(21),u=(c.lockModel,c.addressModel,c.txModel),l=c.blockModel,d=c.interblockModel,p=n(70),f=(p.blockProducer,p.lockProducer,p.networkProducer,n(1753).machine),h=n(53);e.exports={receiveConfig:function(e){var t=h.toFunctions(e);return f.withConfig({actions:{assignInterblock:s({interblock:function(e,t){var n=t.payload;return a(u.isModel(n)),n.interblock}}),assignSocket:s({socket:function(e,t){var n=t.payload;return a(u.isModel(n)),n.socket}}),assignIsPoolable:s({isPoolable:function(e,t){return!0}})},guards:{isInitialConditions:function(e,t){var n=t.data;return i("isInitialConditions: ".concat(n)),n},isPoolable:function(e,t){var n=t.data;return a("boolean"===typeof n),i("isPoolable: ".concat(n)),n},isConnectionAttempt:function(e){return e.interblock.isConnectionAttempt()},isConnectable:function(e,t){return t.data}},services:{isInitialConditions:function(){var e=o(r.mark((function e(){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0,e.next=3,t.getBlock({address:void 0});case 3:return n=e.sent,i("isInitialConditions: ".concat(!n)),e.abrupt("return",!n);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),isAnyAffected:function(){var e=o(r.mark((function e(n){var o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,e.next=3,t.getIsAnyAffected(o);case 3:return a=e.sent,i("isAnyAffected: ".concat(a)),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),isConnectable:function(){var e=o(r.mark((function e(n){var o,s,c,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,a(d.isModel(o)),s=o.getTargetAddress(),a(s),e.next=6,t.getBlock({address:s});case 6:return(c=e.sent)&&a(l.isModel(c)),u=c&&c.config.isPublicChannelOpen,i("isConnectable: ",u),e.abrupt("return",u);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),storeConnection:function(){var e=o(r.mark((function e(n){var o,a,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,a=n.socket,i("storeConnection"),s=o.provenance.getAddress(),e.next=5,t.putSocket({address:s,socket:a});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}})}}},1753:function(e,t,n){var r={id:"receive",initial:"idle",context:{socket:void 0,interblock:void 0,isPoolable:!1,isCatchupable:!1},strict:!0,states:{idle:{on:{RECEIVE_INTERBLOCK:{target:"isInitialConditions",actions:["assignInterblock","assignSocket"]}}},isInitialConditions:{invoke:{src:"isInitialConditions",onDone:[{target:"done",actions:"assignIsPoolable",cond:"isInitialConditions"},{target:"isAnyAffected"}]}},isAnyAffected:{invoke:{src:"isAnyAffected",onDone:[{target:"storeConnection",actions:"assignIsPoolable",cond:"isPoolable"},{target:"isConnectable",cond:"isConnectionAttempt"},{target:"done"}]}},storeConnection:{invoke:{src:"storeConnection",onDone:"done"}},isConnectable:{invoke:{src:"isConnectable",onDone:[{target:"storeConnection",actions:"assignIsPoolable",cond:"isConnectable"},{target:"done"}]}},done:{data:function(e){return{isPoolable:e.isPoolable,isCatchupable:e.isCatchupable}},type:"final"},error:{id:"error",type:"final"}}},o=Machine(r);e.exports={definition:r,machine:o}},1754:function(e,t,n){var r=n(2),o=n(3),a=n(17),i=n(4),s=n(9)("interblock:config:transmit"),c=n(24),u=n(40).assign,l=n(21),d=l.interblockModel,p=l.blockModel,f=l.socketModel,h=l.txModel,v=l.addressModel,g=n(1755).machine,y=n(53);e.exports={transmitConfig:function(e){var t=y.toFunctions(e);return g.withConfig({actions:{assignInterblock:u({interblock:function(e,t){var n=t.payload;return s("assignInterblock"),i(d.isModel(n)),n}}),assignBlock:u({block:function(e,t){var n=t.data.block;return i(p.isModel(n)),n}}),extendListeningTxs:u({listeningTxs:function(e,t){var n=e.interblock,r=e.listeningTxs;s("extendListeningTxs");var o=t.data.sockets;i(o.every(f.isModel));var c=n.getWithoutRemote(),u=o.map((function(e){return h.create(e,c)}));return[].concat(a(r),a(u))}}),extendTargetTxs:u({targetTxs:function(e,t){var n=e.interblock,r=e.targetTxs;s("assignTargetTxs");var o=t.data;i(o.every(f.isModel));var c=o.map((function(e){return h.create(e,n)}));return[].concat(a(r),a(c))}}),assignLineage:u({lineage:function(e,t){return t.data}}),assignSelfTarget:u({targetTxs:function(e){var t=e.targetTxs,n=e.interblock,r=f.create(),o=h.create(r,n),i=[].concat(a(t),[o]);return s("assignSelfTarget targetTxs length: ".concat(i.length)),i}}),extendLineageTxs:u({lineageTxs:function(e){var t=e.targetTxs,n=e.lineage;s("extendLineageTxs"),i(n.every(d.isModel)),i(n.every((function(e){return!e.getTargetAddress()})));var r=[];return t.forEach((function(e){n.forEach((function(t){i(h.isModel(e));var n=e.socket;i(f.isModel(n)),r.push(h.create(n,t))}))})),s("extendLineageTxs generated ".concat(r.length," extensions")),r}}),extendGenesisAttempt:u({targetTxs:function(e){var t=e.interblock,n=e.targetTxs;i(d.isModel(t)),i(t.isGenesisAttempt());var r=h.create(f.create(),t);return n=[].concat(a(n),[r])}}),removeListeningTxs:u({listeningTxs:function(e){var t=e.listeningTxs,n=e.targetTxs;s("removeListeningTxs");var r=n.map((function(e){return e.socket})),o=t.filter((function(e){var t=e.socket;return!r.some((function(e){return e.equals(t)}))}));return s("filter removed: ".concat(r.length-o.length)),o}}),mergeTransmissions:u({transmissions:function(e){var t=e.listeningTxs,n=e.targetTxs,r=e.lineageTxs;return[].concat(a(t),a(r),a(n))}})},guards:{isBlockFetched:function(e,t){return p.isModel(t.data.block)},isLineageInterblock:function(e){return!e.interblock.getRemote()},isInitiatingAction:function(e){var t=e.interblock;i(d.isModel(t));var n=t.isConnectionResponse(),r=t.isConnectionResolve(),o=t.isDownlinkInit(),a=t.isUplinkInit();return n||r||o||a},isGenesisAttempt:function(e){return e.interblock.isGenesisAttempt()},isOriginPresent:function(e,t){return t.data.isOriginPresent}},services:{fetchBlock:function(){var e=o(r.mark((function e(n){var o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,i(d.isModel(o)),e.next=4,t.getBlock(o.provenance);case 4:return a=e.sent,i(p.isModel(a)),i(a.provenance.equals(o.provenance)),s("fetchBlock height: ".concat(a.provenance.height)),e.abrupt("return",{block:a});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchRemoteListeners:function(){var e=o(r.mark((function e(n){var o,u,l,h,v,g,y,m;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,u=n.block,i(d.isModel(o)),i(!o.getRemote()),i(p.isModel(u)),l=u.network,h=l.getResolvedAliases().map((function(e){var n=l[e].address;return t.getSockets(n)})),e.next=8,Promise.all(h);case 8:return v=e.sent,g=c.flatten(v),y=new Set(g),s("fetchListeningSockets length: ".concat(y.size)),m=a(y),i(m.every(f.isModel)),e.abrupt("return",{sockets:m});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchSelfListener:function(){var e=o(r.mark((function e(n){var o,a,c,u,l,h,v;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,a=n.block,i(d.isModel(o)),i(p.isModel(a)),c=a.network,u=c.getResolvedAliases().map((function(e){var n=c[e].address;return t.getIsPresent(n)})),e.next=7,Promise.all(u);case 7:return l=e.sent,h=l.some((function(e){return e})),s("fetchSelfListener: ".concat(h)),v=h?[f.create()]:[],e.abrupt("return",{sockets:v});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchRemoteTargets:function(){var e=o(r.mark((function e(n){var o,a,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,i(d.isModel(o)),a=o.getTargetAddress(),i(v.isModel(a)),e.next=6,t.getSockets(a);case 6:return c=e.sent,s("fetchTargetSockets length: ".concat(c.length)),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchSelfTarget:function(){var e=o(r.mark((function e(n){var o,a,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,i(d.isModel(o)),a=o.getTargetAddress(),i(a),e.next=6,t.getIsPresent(a);case 6:return c=e.sent,s("fetchSelfTarget: ".concat(c)),e.abrupt("return",c?[f.create()]:[]);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),fetchLineageToGenesis:function(){var e=o(r.mark((function e(n){var o,a,c,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,i(d.isModel(o)),0,s("fetchLineage from height: ".concat(0)),a=o.provenance,c={provenance:a,height:0},e.next=8,t.getLineage(c);case 8:return u=e.sent,s("fetchLineage length: ".concat(u.length)),e.abrupt("return",u);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),isOriginPresent:function(){var e=o(r.mark((function e(n){var o,a,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.interblock,i(d.isModel(o)),a=o.provenance.getAddress(),e.next=5,t.getIsPresent(a);case 5:return c=e.sent,s("isOriginPresent: ",c),e.abrupt("return",{isOriginPresent:c});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}})}}},1755:function(e,t,n){var r={id:"transmit",initial:"idle",context:{interblock:void 0,listeningTxs:[],targetTxs:[],lineage:[],lineageTxs:[],transmissions:[]},strict:!0,states:{idle:{on:{TRANSMIT_INTERBLOCK:{target:"isLineageInterblock",actions:"assignInterblock"}}},done:{entry:["removeListeningTxs","mergeTransmissions"],data:function(e){return e.transmissions},type:"final"},isLineageInterblock:{always:[{target:"fetchLineageSockets",cond:"isLineageInterblock"},{target:"fetchTargetSockets"}]},fetchLineageSockets:{initial:"fetchBlock",states:{fetchBlock:{invoke:{src:"fetchBlock",onDone:[{target:"fetchListeners",actions:"assignBlock",cond:"isBlockFetched"},{target:"done"}]}},done:{type:"final"},fetchListeners:{type:"parallel",states:{fetchRemoteListeners:{initial:"promise",states:{promise:{invoke:{src:"fetchRemoteListeners",onDone:{target:"done",actions:"extendListeningTxs"}}},done:{type:"final"}}},fetchSelfListener:{initial:"promise",states:{promise:{invoke:{src:"fetchSelfListener",onDone:{target:"done",actions:"extendListeningTxs"}}},done:{type:"final"}}}},onDone:"done"}},onDone:"done"},fetchTargetSockets:{type:"parallel",states:{isGenesisAttempt:{initial:"isGenesisAttempt",states:{isGenesisAttempt:{always:[{target:"isOriginPresent",cond:"isGenesisAttempt"},{target:"done"}]},isOriginPresent:{invoke:{src:"isOriginPresent",onDone:[{target:"done",cond:"isOriginPresent",actions:"extendGenesisAttempt"},{target:"done"}]}},done:{type:"final"}}},fetchRemoteTargets:{initial:"promise",states:{promise:{invoke:{src:"fetchRemoteTargets",onDone:{target:"done",actions:"extendTargetTxs"}}},done:{type:"final"}}},fetchSelfTarget:{initial:"promise",states:{promise:{invoke:{src:"fetchSelfTarget",onDone:{target:"done",actions:"extendTargetTxs"}}},done:{type:"final"}}},addLineage:{initial:"isLineageRequired",states:{isLineageRequired:{always:[{target:"fetchLineageToGenesis",cond:"isInitiatingAction"},{target:"done"}]},fetchLineageToGenesis:{invoke:{src:"fetchLineageToGenesis",onDone:{target:"done",actions:"assignLineage"}}},done:{type:"final"}}}},onDone:{target:"done",actions:"extendLineageTxs"}}}},o=Machine(r);e.exports={definition:r,machine:o}},1756:function(e,t,n){var r=n(2),o=n(3),a=n(21),i=a.blockModel,s=a.interblockModel,c=function(){var e=o(r.mark((function e(t,n){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u(n),e.next=3,l(t);case 3:return o=e.sent,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),u=function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.create();case 2:n=e.sent,o=s.create(n),t.push(o);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(e){var t,n=new Promise((function(e){return t=e})),a=e.subscribe(function(){var e=o(r.mark((function e(n,o){var i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("UNLOCK"!==n.type){e.next=6;break}return i=n.payload.block,e.next=4,o;case 4:t(i.provenance.getAddress()),a();case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());return n};e.exports={createBase:c}},1757:function(e,t,n){var r=n(4),o=n(24),a=(n(250),n(83),n(252)),i=n(253),s=i.blockPrint,c=i.interPrint,u=n(21),l=u.blockModel,d=u.interblockModel;e.exports={createTap:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"interblock:blocktap",t=!1,i=function(){return t=!0},u=function(){return t=!1},p=n(9)(e),f={},h=(a.gray("undefined"),p.extend("tran")),v=function(e){if(t){var n=m(e);h(n)}},g=p.extend("pool"),y=function(e){if(t){var n=m(e);g(n)}},m=function(e){r(d.isModel(e));var t=a.yellow("INTER_LIGHT"),n=a.gray(M(e,f));return e.getRemote()&&(t=a.yellow("INTER_HEAVY")),c(e,t,n,"bgYellow","yellow")},k=new Map,b=function(e,t){var n=e.getChainId(),r=Date.now();k.set(n,{lockStart:t,workStart:r})},x=p,w=function(e){r(l.isModel(e));var n=e.provenance.getAddress().getChainId(),o=!f[n],a=f[n]&&f[n].some((function(t){return t.equals(e)}));if(I(e,f),t&&!a){var i=M(e,f),c=s(e,i,o,a),u=k.get(e.getChainId()),d=u.lockStart,p=u.workStart;Date.now(),Date.now();x(c)}},I=function(e,t){var n=e.provenance.getAddress().getChainId();t[n]||(t[n]=[]),t[n].some((function(t){return t.equals(e)}))||t[n].push(e)},M=function(e,t){if(!(e=o.last(t[e.provenance.getAddress().getChainId()])))return"(unknown)";for(var n=[],a=e,i=0;a&&i<10;){i++;var s=a.network[".."].address;if(s.isRoot())a=void 0,n.unshift("");else if(s.isUnknown())n.unshift("(unknown)"),a=void 0;else{var c=s.getChainId(),u=o.last(t[c]);r(l.isModel(u),"Hole in pedigree");var d=u.network.getAlias(a.provenance.getAddress());n.unshift(d),a=u}}i>=10&&p("Path over loopCount");var f=n.join("/");return f||"/"};return{on:i,off:u,lock:b,block:w,interblockTransmit:v,interblockPool:y}}}},176:function(e,t,n){var r=n(2),o=n(7),a=n(3),i=n(4),s=n(126).metrologyFactory,c=n(24),u=n(9)("interblock:effector"),l=n(21).covenantIdModel,d=(n(243).tcpTransportFactory,n(86)),p=n(241).netFactory,f=n(242).socketFactory,h=function(){var e=a(r.mark((function e(t){var n,c,l,h,g,y,m=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=m.length>1&&void 0!==m[1]?m[1]:{},i(!n||"object"===typeof n),u("effectorFactory"),n=b(n),l=p(c={}),h=f(c),n=o({},n,{net:l,socket:h,hyper:d.shell}),e.next=10,s(t,n);case 10:return g=e.sent,(y=v(g,g.pierce)).startNetworking=a(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.add("net",{covenantId:l.covenantId});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),e.abrupt("return",y);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function e(t,r){var a,i=t.getAbsolutePath(),s=function(e){var t=e.type,n=e.payload,o=void 0===n?{}:n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i;if(u("dispatch to: %o type: %O",a,t),"/"===i)return r({type:t,payload:o});var s=d.shell.actions.dispatch({type:t,payload:o},a);return r(s)},c=o({},t,{dispatch:s,_debug:n(9)}),l={},p=function(){var n=t.getState();if(n){var o=t.getCovenants(),i=k(n,o);if(i&&!i.covenantId.equals(a)){a=i.covenantId,u("set covenant to: %O",a.name);var d=x(s,i);m(c,t),Object.assign(c,d)}var p=t.getChildren();if(u("currentChildren",Object.keys(p)),!g(p,l)){for(var f in y(c,l),p)u("creating child: %O",f),l[f]=e(p[f],r);Object.assign(c,l)}}};return p(),t.subscribe(p),c},g=function(e,t){var n=Object.keys(e).sort(),r=Object.keys(t).sort();return c.isEqual(n,r)},y=function(e,t){for(var n in t)delete e[n],delete t[n]},m=function(e,t){for(var n in e)"_debug"===n||t[n]||"function"===typeof e[n]&&delete e[n]},k=function(e,t){var n=e.covenantId,r=o({},d,{},t),a=d.unity;if("hyper"===n.name)return t.hyper;for(var s in r)r[s].covenantId.equals(n)&&(i(a===d.unity),a=r[s]);return a},b=function(e){var t={};for(var n in e){covenant=e[n];var r=covenant.covenantId,o=r.name,a=r.version,i=r.language,s=r.integrity;covenant.covenantId=l.create(o,a,i,s),t[n]=covenant}return t},x=function(e,t){var n={};if("object"!==typeof t.actions)return n;var r=function(r){n[r]=function(){var n,o=(n=t.actions)[r].apply(n,arguments);return e(o)}};for(var o in t.actions)r(o);return n};e.exports={effectorFactory:h}},177:function(e,t,n){var r=n(7),o=n(2),a=n(3),i=n(4),s=(n(24),n(296)),c=n(179).sqsQueueFactory,u=n(21),l=u.interblockModel,d=u.addressModel,p=u.txModel,f=(u.socketModel,n(1735).fsmFactory),h=n(9)("interblock:engine");e.exports={standardEngineFactory:function(){h("standardEngineFactory");var e=0,t=f(),n=(t.ioIsolate,t.ioCrypto,t.ioConsistency,t.ioPool),u=t.ioIncrease,v=t.ioReceive,g=t.ioTransmit,y=c("sqsTx",p),m=c("sqsRx",p),k=c("sqsTransmit",l),b=c("sqsPool",l),x=c("sqsIncrease",d),w={sqsTx:y,sqsRx:m,sqsTransmit:k,sqsPool:b,sqsIncrease:x};m.setProcessor(function(e,t,n){return function(){var r=a(o.mark((function r(a){var s,c,u,l,d;return o.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return h.extend("receiver")("receiver"),i(p.isModel(a)),s=a.interblock,r.next=6,e.push(a);case 6:return c=r.sent,u=c.isPoolable,l=c.isCatchupable,i("boolean"===typeof u),i("boolean"===typeof l),d=[],u&&d.push(t.push(s)),l&&d.push(n.push(s)),r.next=16,Promise.all(d);case 16:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}(v,b,k)),k.setProcessor(function(e,t,n){return function(){var r=a(o.mark((function r(a){var s,c;return o.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return h.extend("transmitter")("transmitter"),i(l.isModel(a)),r.next=5,e.push(a);case 5:return s=r.sent,i(s.every(p.isModel),"failed transmitter"),c=s.map((function(e){var r=e.interblock;return e.socket.getIsInternal()?n.push(r):t.push(e)})),r.next=10,Promise.all(c);case 10:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}(g,y,b)),b.setProcessor(function(e,t){return function(){var n=a(o.mark((function n(r){var a,s,c;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(a=h.extend("pooler"))("pooler"),i(l.isModel(r)),n.next=5,e.push(r);case 5:return s=n.sent,i(Array.isArray(s),"failed pool"),a("affectedAddresses length: %o",s.length),c=s.map((function(e){return t.push(e)})),n.next=11,Promise.all(c);case 11:return n.abrupt("return",s);case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}(n,x)),x.setProcessor(function(t,n){var r=new Map,c=new Map;return function(){var u=a(o.mark((function a(u){var p,f,v,g,y,m;return o.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if((p=h.extend("increasor").extend(s(3,e++)))("throttler"),i(d.isModel(u)),f=u.getChainId(),c.get(f)){o.next=23;break}case 5:return r.delete(f),c.set(f,!0),o.next=9,t.push(u);case 9:return v=o.sent,g=v.txInterblocks,y=v.isRedriveRequired,i(Array.isArray(g)),i(g.every(l.isModel)),i.strictEqual(typeof y,"boolean"),p("transmission count: ".concat(g.length)),m=g.map((function(e){return n.push(e)})),o.next=18,Promise.all(m);case 18:c.delete(f),y&&r.set(f,!0);case 20:if(r.get(f)){o.next=5;break}case 21:o.next=25;break;case 23:r.set(f,!0),p("redrive raised");case 25:case"end":return o.stop()}}),a)})));return function(e){return u.apply(this,arguments)}}()}(u,k));var I=r({},t,{},w);return Object.freeze(I),I}}},1780:function(e,t,n){(function(t){var r=n(7),o=n(2),a=n(3),i=n(4),s=n(120).v4,c=n(9)("interblock:engine:piercerFactory"),u=n(34).request,l=n(21).txRequestModel,d=n(53).toFunctions,p=function(){var e={},t=new Promise((function(t,n){e.settled={resolve:t,reject:n}}));return t.pending=new Promise((function(t,n){e.pending={resolve:t,reject:n}})),{promise:t,callbacks:e}};e.exports={piercerFactory:function(e,n,f){var h=new Map,v=s(),g=0,y=d(n);return n.subscribe(function(){var n=a(o.mark((function n(r,a){var s,c;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("UNLOCK"!==r.type){n.next=10;break}return n.next=3,a;case 3:if((s=r.payload.block).getChainId()!==e.getChainId()){n.next=10;break}if(c=s.network[".@@io"]){n.next=8;break}return n.abrupt("return");case 8:c.getRemoteRequestIndices().forEach((function(e){var n=c.getRemote().requests[e];i(n);var r=n.payload._dispatchId;if(i(r.endsWith(v)),h.has(r)){var o=h.get(r);o.pending.resolve();var a=c.replies[e];if(a&&!a.isPromise()){var s=o.settled,u=s.resolve,l=s.reject,d=a.isResolve()?u:l;t((function(){return d(a.payload)})),h.delete(r)}}}));case 10:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()),function(){var t=a(o.mark((function t(n,a){var i,s,d,m,k,b,x,w,I,M;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=u(n,a),s=i.type,d=i.payload,m=void 0===d?{}:d,k="".concat(g++," ").concat(v),c("pierce: %s id: %o",s,k),m=r({},m,{_dispatchId:k}),b=e.getChainId(),x=l.create(s,m,b),w=p(),I=w.promise,M=w.callbacks,h.set(k,M),t.next=10,y.putPierceRequest({txRequest:x});case 10:return t.next=12,f.push(e);case 12:return t.abrupt("return",I);case 13:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}}}).call(this,n(57).setImmediate)},1781:function(e,t,n){var r=n(2),o=n(7),a=n(3),i=n(126).metrologyFactory,s=n(86).hyper,c=function(){var e=a(r.mark((function e(){var t,n,a,c,u,l,d,p=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:"aws",n=p.length>1?p[1]:void 0,n=o({},n,{hyper:s}),e.next=5,i(t,n);case 5:return a=e.sent,c=a.getEngine(),u=c.sqsTx,l=c.sqsRx,d=a.getState().provenance.getAddress(),e.next=10,a.settle();case 10:return e.abrupt("return",{sqsTx:u,sqsRx:l,hyperAddress:d,engine:a});case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e.exports={awsFactory:c}},1782:function(e,t,n){var r=n(2),o=n(3),a=n(176).effectorFactory,i=n(9)("interblock:browser"),s=n(1783),c=function(){var e=o(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.config({name:"@dreamcatcher/interblock_".concat(t)}),i("loading browser module"),e.next=4,a("web");case 4:return n=e.sent,i("browser client ready"),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();e.exports={browserFactory:c}},1784:function(e,t,n){(function(t){var r=n(2),o=n(3),a=n(22)("dos"),i=n(1787),s=n(168).evaluate,c=n(169).withSpin,u=n(267);function l(e,t,n,r){return a("evalPrint"),r.evaluate=r.evaluate||c(s),u((function(){return r.evaluate(e,t,n)}))}e.exports=function(){var e=o(r.mark((function e(n){var o,s=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.length>1&&void 0!==s[1]?s[1]:{},a("argv",n),n=(n||t.argv).slice(2),a("argv",n),e.abrupt("return",n.length?l(ctx,n[0],n.slice(1),o):i(o));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}).call(this,n(11))},1787:function(e,t,n){var r=n(2),o=n(17),a=n(238),i=n(3),s=n(22)("dos:repl"),c=n(255),u=n(121).effectorFactory,l=n(1811).read,d=n(168).evaluate,p=n(1895).withAutoComplete,f=n(169).withSpin,h=n(267),v=n(1896),g=n(116);n(1897)(0,80);function y(e){return m.apply(this,arguments)}function m(){return(m=i(r.mark((function e(t){var n,o,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.blockchain,t.evaluate,(o=c({spinner:"arrow3"}).start()).info("\u2705  begining boot sequence Ctrl+C to cancel and drop to local shell"),o.text='checking for new app version on server "this webpage"',o.info("current build version: 0.0.0").start(),o.text='looking for previous chains under the domain "this webpage"',o.info("no previous chains found").start(),n||(o.text="Initializing blockchain...",n=u("console")),!n.then){e.next=12;break}return e.next=11,n;case 11:n=e.sent;case 12:return a=n.getState().getChainId(),o.info("Blockchain initialized with chainId: ".concat(a)).start(),o.text="connecting to mainnet...",e.next=17,new Promise((function(e){return setTimeout(e,700)}));case 17:return o.info("connection to mainnet established").start(),o.info("mainnet latency: 543 ms"),o.info("peer connection count: 1").start(),o.text="benchmarking local system",e.next=23,new Promise((function(e){return setTimeout(e,700)}));case 23:return o.info("local blockrate 23 blocks per second / 53 ms per block"),o.stop(),e.next=27,h('Welcome to the HyperNet\n  Blockchain core: v0.0.5\n  Terminal:        v0.0.12\n  type "help" to get started');case 27:return"root","local",o.stop(),e.abrupt("return",{user:"root",machineId:"local",blockchain:n});case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports=function(){var e=i(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s("repl"),(t=t||{}).read=t.read||p(l),t.evaluate=t.evaluate||f(d),s("opts: ",Object.keys(t)),e.next=7,y(t);case 7:return n=e.sent,s("changing to home directory"),e.next=11,t.evaluate(n,"cd",[]);case 11:return e.abrupt("return",v(function(){var e=i(r.mark((function e(){var c,u,l,d,p;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.read(n);case 2:return c=e.sent,u=c.split(" ").filter(Boolean),l=a(u),d=l[0],p=l.slice(1),s("command: ",d,p),e.next=7,h(i(r.mark((function e(){var a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!k.includes(d)&&g[d]&&(p=[d].concat(o(p)),d="time"),e.next=3,t.evaluate(n,d,p);case 3:return(a=e.sent)&&a.ctx&&Object.assign(n,a.ctx),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)}))));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var k=["time","clear","help"]},179:function(e,t,n){var r=n(299),o=r.ioQueueFactory,a=r.sqsQueueFactory;e.exports={ioQueueFactory:o,sqsQueueFactory:a}},1811:function(e,t,n){var r=n(2),o=n(3),a=n(45).prompt,i=n(22)("dos:read"),s=n(39);t.read=function(){var e=o(r.mark((function e(t){var n,o,c,u,l,d,p,f,h;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.autoComplete,n=t.user,o=t.machineId,c=t.blockchain,u=c.getContext(),l=u.wd,d="".concat(s.green("".concat(n,"@").concat(o)),":").concat(s.blue(l),"$"),i("reading: ".concat(d)),p={type:"input",name:"result",message:d},e.next=8,a(p);case 8:return f=e.sent,h=f.result,i("prompt result: ",h),e.abrupt("return",h);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},1844:function(e,t,n){var r=n(2),o=n(3),a=(n(49),n(35)),i=(n(56).promisify,n(94)),s=n(22)("dos:commands:config"),c=n(263).getHomePath,u=a.join(i.homedir(),".cmd-prototype"),l={set:function(e,t,n){return o(r.mark((function o(){var a,i,l,p,f;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s("set",t,n),a=e.configPath||u,r.next=4,d(a);case 4:return(i=r.sent)[t]=n,r.next=8,writeFile(a,JSON.stringify(i));case 8:if("apiaddr"!==t.toLowerCase()){r.next=15;break}return l=(e.IpfsApi||IpfsApi)(n),p=new Ipld(l.block),r.next=13,c(l);case 13:return f=r.sent,r.abrupt("return",{ctx:{ipld:p,ipfs:l,wd:f}});case 15:case"end":return r.stop()}}),o)})))()},get:function(e,t){return o(r.mark((function n(){var o,a;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s("get",t),n.next=3,d(e.configPath||u);case 3:return o=n.sent,a=t?o[t]:o,n.abrupt("return",{out:a});case 6:case"end":return n.stop()}}),n)})))()}};function d(e){return p.apply(this,arguments)}function p(){return(p=o(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=JSON,e.next=4,readFile(t);case 4:e.t1=e.sent,n=e.t0.parse.call(e.t0,e.t1),e.next=11;break;case 8:e.prev=8,e.t2=e.catch(0),s("failed to read config",e.t2);case 11:return e.abrupt("return",n||{});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}e.exports=function(){var e=o(r.mark((function e(t,n){var o,a,i,s=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l[n]){e.next=2;break}throw new Error("".concat(n,": subcommand not found"));case 2:for(o=s.length,a=new Array(o>2?o-2:0),i=2;i<o;i++)a[i-2]=s[i];return e.abrupt("return",l[n].apply(l,[t].concat(a)));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},1845:function(e,t,n){(function(t){e.exports=function(e){var n=e.spinner;n&&n.stop(),t.exit()},e.exports.help="Exit the current program"}).call(this,n(11))},1846:function(e,t,n){var r=n(22)("dos:commands:help"),o=n(117),a=n(116);n(1857);e.exports=function(e){var t=o();r("help: ",Object.keys(a)),t.div('Use the following commands (use "tab" for autocomplete):\n');var n=Object.keys(a).filter((function(e){return!!a[e].help}));n.forEach((function(e){t.div({text:e,width:20,padding:[0,0,0,0]},a[e].help.replace(/\n|\r|\r\n/g," ").trim()),t.div()}));var i=Object.keys(a).filter((function(e){return!a[e].help}));return t.div("No help provided for:\n"),t.div("    "+i.toString()),t.div(),{out:t.toString()}},e.exports.help="\nPrints this message\n"},1858:function(e,t,n){var r=n(2),o=n(3),a=(n(35).posix||n(35),n(22)("dos:commands:ls")),i=n(117),s=n(39);n(1859);e.exports=function(){var e=o(r.mark((function e(t,n){var o,c,u,l,d;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.spinner,c=t.blockchain,u=c.getState(),l=u.network,o.text="Resolving ".concat(n),d=i(),Object.keys(l).forEach((function(e){a("child: ".concat(e));var t,n=l[e],r=n.address.getChainId().substring(0,8);a("chainId: ".concat(r));var o=n.lineageHeight,i=n.heavyHeight;(-1===o&&(o="-"),-1===i&&(i="-"),"."===e)&&(o=i=c.getState().provenance.height,r=c.getState().getChainId().substring(0,8));var u=i+"."+o;t="SYMLINK"!==n.systemRole?s.red(e):s.magenta(e),d.div({text:t,width:20},{text:u,width:10},{text:r,width:55})})),e.abrupt("return",{out:d.toString()});case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.exports.help="\nlist the objects at the cwd.  lists alias, heavy height.lineage height, and chainId\n"},1860:function(e,t){e.exports=function(e){return{out:e.wd}}},1861:function(e,t,n){var r=n(1862);e.exports=function(){return{out:"v".concat(r.version)}}},1862:function(e){e.exports=JSON.parse('{"name":"@dreamcatcher-tech/dos","version":"0.0.0","description":"Terminal interface to the HyperNet","main":"src/index.js","bin":{"dos":"src/bin.js"},"scripts":{"start":"DEBUG=\'*dos*\' node src/bin","dev":"DEBUG=\'*nodemon*\' nodemon src/bin"},"author":"","license":"AGPL-3.0-or-later","dependencies":{"better-opn":"^2.0.0","chalk":"^4.1.0","clear":"^0.1.0","cliui":"^6.0.0","commander":"^6.1.0","debug":"^4.1.0","dedent":"^0.7.0","detect-node":"^2.0.4","docker-names":"^1.1.1","enquirer":"^2.3.6","figlet":"^1.2.4","filesize":"^3.6.1","localforage":"^1.9.0","ora":"^3.0.0","pad":"^3.2.0","pretty-ms":"^7.0.0","pull-stream":"^3.6.9","random-hash":"^4.0.1","wordwrap":"^1.0.0"},"devDependencies":{"nodemon":"^1.19.3"},"nodemonConfig":{"verbose":false,"watch":["./","/code/interblock"]},"jest":{"testEnvironment":"node","transform":{}},"prettier":{"trailingComma":"es5","tabWidth":2,"semi":false,"singleQuote":true}}')},1863:function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:pkg");e.exports=function(){var e=o(r.mark((function e(t,n){var o,i,s,c,u=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=t.spinner,i=u.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=u[c];return a(n,s),e.next=5,new Promise((function(e){return setTimeout(e,2e3)}));case 5:return o.text="now with text",e.next=8,new Promise((function(e){return setTimeout(e,2e3)}));case 8:return o.succeed("stage 1 complete").start(),e.next=11,new Promise((function(e){return setTimeout(e,2e3)}));case 11:return o.fail("stage 2 failed").start(),e.next=14,new Promise((function(e){return setTimeout(e,2e3)}));case 14:return o.info("please try again later").start(),e.next=17,new Promise((function(e){return setTimeout(e,2e3)}));case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.exports.help="\nThe platform package manager.  Use list --installed \nto list all applications installed on the system.\nuse list to show all available applications available for install.\nUse search to narrow down the list of available packages.\nDefaults to listing installed applications.\n"},1864:function(e,t,n){var r=n(1865);e.exports=function(){return r()},e.exports.help="Clear the screen"},1866:function(e,t){var n=0;e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Test Error";throw new Error(t+" "+n++)},e.exports.help="Throw an error, to test system response"},1867:function(e,t,n){var r=n(2),o=n(3),a=(n(45).prompt,n(1868));e.exports=function(){var e=o(r.mark((function e(t,n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return debug("open: ",n),e.next=3,a("https://aws.amazon.com/cognito/");case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},1870:function(e,t,n){var r=n(2),o=n(3);n(22)("dos:commands:login");e.exports=function(){var e=o(r.mark((function e(t){var n,o,a,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.spinner,o=t.blockchain,a="34e3c74c43c0e9b2f3f2ef9f93a0f427ededf5878891b23d792d8f7c1a174b94",n.info("logging in to ".concat(a)).start(),n.text="connecting to: ".concat(url),e.next=6,o.addTransport(a,{url:url});case 6:return i=e.sent,n.succeed("latency of ".concat(i," ms ").concat(url)).start(),n.text="logging in to chain",e.next=11,o.login({chainId:a});case 11:return n.succeed("login successful"),e.abrupt("return",{out:url});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help='Loop the user through a signon process that links\nThe current machine pubkey to their interblock user chain.\nWhen this occurs, the guest chain will transition to the\nuser chain, and the prompt will change from "guest" to "user"'},1871:function(e,t,n){var r=n(2),o=n(3),a=function(e){return new Promise((function(t){return setTimeout(t,e)}))};e.exports=function(){var e=o(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("\n"),n(119)("https://aws.amazon.com/cognito/"),e.abrupt("return",a(2e3));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nDisconnect from the current remote host, else error and stay as local\n"},1872:function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:su"),i=(new(n(1873).Command),n(45).prompt);e.exports=function(){var e=o(r.mark((function e(t,n){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a(n),n){e.next=3;break}throw new Error("must supply user name or chainId to elevate to");case 3:return e.next=5,i([{name:"password"}]);case 5:o=e.sent,a(o);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},1874:function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:add"),i=n(39);n(45).prompt;e.exports=function(){var e=o(r.mark((function e(t){var n,o,s,c,u,l,d,p,f,h,v,g,y=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.spinner,o=t.blockchain,s=y.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=y[u];a("add: %O",c),l="",d=0,p=c;case 5:if(!(d<p.length)){e.next=18;break}return f=p[d],n.text="adding ".concat(f,"..."),e.next=10,o.add(f);case 10:h=e.sent,v=h.alias,g=h.chainId,n.succeed("added ".concat(f)).start(),l+="Added: ".concat(i.red(v),"\n - chainId: ").concat(i.greenBright(g),"\n");case 15:d++,e.next=5;break;case 18:return e.abrupt("return",{out:l.trim()});case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nThis command will be overridden by each application.\nIt serves as the general action of creating a new entity\nwhere the entity is specific to the application being executed.\nWhen used in the native setting, it makes a blank datum chain.\nDepending on the context, additional info may need to be provided to\ncreate the child.\n"},1875:function(e,t,n){var r=n(2),o=n(3);e.exports=o(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),e.exports.help="\nLinking is act of inserting one Object as the child of another\nwhich allows an Object to be the child of more than one parent.\nThis operation is essential to application data structures\nas opposed to simple filesystem data structures, which are \nusually a tree\n"},1876:function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:rm");n(39),n(45).prompt;e.exports=function(){var e=o(r.mark((function e(t,n){var o,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.spinner,o=t.blockchain,a("rm: %O",n),e.next=4,o.rm(n);case 4:i=e.sent,a("result: %O",i);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.exports.help="\nRemove blockchains.  If they are symlinks, will remove\nthe link only.  If children, will be permanently deleted.\n"},1877:function(e,t,n){var r=n(2),o=n(3),a=(n(22)("dos:commands:whoami"),n(39)),i=n(117);e.exports=function(){var e=o(r.mark((function e(t){var n,o,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.blockchain,o=n.getState().getChainId(),(s=i()).div({text:"User:",width:15},"root"),s.div({text:"Machine:",width:15},a.green(o)),s.div({text:"Hypercomputer:",width:15},a.red("NOT CONNECTED")),e.abrupt("return",{out:s.toString()});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nLists info about the current machine, current user, and connected hypercomputer\n"},1878:function(e,t,n){var r=n(2),o=n(3);e.exports=o(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(119)("https://aws.amazon.com/cognito/");case 1:case"end":return e.stop()}}),e)})))},1879:function(e,t,n){var r=n(2),o=n(3),a=n(1880),i=n(22)("dos:commands:time");e.exports=function(){var e=o(r.mark((function e(t){var o,s,c,u,l,d,p,f,h,v=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=n(168),s=o.evaluate,c=v.length,u=new Array(c>1?c-1:0),l=1;l<c;l++)u[l-1]=v[l];if(!(u.length<1)){e.next=4;break}throw new Error("Must supply command");case 4:return d=u[0],p=u.slice(1),i("time: ",d,p),f=Date.now(),e.next=9,s(t,d,p);case 9:if(e.t0=e.sent,e.t0){e.next=12;break}e.t0={};case 12:return(h=e.t0).out=h.out||"",h.out=h.out+"\nTime: ".concat(a(Date.now()-f)),e.abrupt("return",h);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nMeasure how long a command takes.\n"},1882:function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:ping");e.exports=function(){var e=o(r.mark((function e(t,n,o){var i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.spinner,i=t.blockchain,a("ping path: %O options: %O",n,o),e.next=4,i.ping(n);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),e.exports.help="\nSend a ping to a chain, receive a response.\n\nTODO: \n1. send data with the ping\n2. ping indefinitely\n3. do 4 pings and report average times\n4. allow path pings\n"},1883:function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:reset"),i=n(45).prompt;e.exports=function(){var e=o(r.mark((function e(t){var n,o,s,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.spinner,t.blockchain,a("reset"),n.stop(),e.next=5,i({type:"confirm",name:"reset",message:"Resetting will delete all local blockchains"});case 5:return o=e.sent,s=o.reset,c=s?"All local blockchains deleted":"Cancelled reset",e.abrupt("return",{out:c});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nDump all the local blockchain state, generate a new\ngenesis block, reset login status.\nIn dev mode will also reset the emulated aws.\n"},1884:function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:dns");n(39),n(45).prompt;e.exports=function(){var t=o(r.mark((function t(n,o){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.spinner,n.blockchain,a("dns %O",o),t.abrupt("return",{out:e.exports.help});case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.exports.help="\nService to map strings to chainIds.\nMultiple services and manual overrides can be provided.\n"},1885:function(e,t,n){var r=n(2),o=n(3),a=n(56),i=n(22)("dos:commands:cat");n(39),n(45).prompt;e.exports=function(){var e=o(r.mark((function e(t){var n,o,s,c,u,l,d=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t.spinner,n=t.blockchain,o=d.length,s=new Array(o>1?o-1:0),c=1;c<o;c++)s[c-1]=d[c];return i("cat path: %O args: %O",s),u=n.getState(),l=a.inspect(u,{colors:!0,depth:null}),e.abrupt("return",{out:l});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nShow the internal state of a chain.\n\nTODO\nArgs for full state, or partial state, or a particular path in the state.\n"},1886:function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:tx");n(39),n(45).prompt;e.exports=function(){var e=o(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.spinner,t.blockchain,a("TODO tx: %O");case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nList and modify the transports used.  These are typically URLs\nwhich point to various block producing peers\n"},1887:function(e,t,n){var r=n(2),o=n(3),a=n(22);e.exports=function(){var e=o(r.mark((function e(t){var n,o,i,s,c,u,l,d,p=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.blockchain,o=p.length,i=new Array(o>1?o-1:0),s=1;s<o;s++)i[s-1]=p[s];return c=i.join(" "),u=n._debug.disable(),l=a.disable(),d="current interblock flags: "+u,d+="\ncurrent dos flags: "+l,d+="\nsetting flags to: "+c,n._debug.enable(c),a.enable(c),e.abrupt("return",{out:d});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nChange flags to alter debug output on console.\n\nWith no arguments, toggle disable and enable, and will print the currently set flags.\nOtherwise will set the current flags.\n\nSee https://github.com/visionmedia/debug"},1888:function(e,t,n){var r=n(2),o=n(3);e.exports=o(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n(119)("https://aws.amazon.com/cognito/");case 1:case"end":return e.stop()}}),e)})))},1889:function(e,t,n){var r=n(2),o=n(3),a=n(39),i=n(117),s=a.bold.yellow("Object"),c=a.bold.yellow("Link"),u=a.bold.yellow("Covenant"),l=a.bold.yellow("StateMachine"),d=a.bold.yellow("DistributedOperatingSystem"),p=a.bold.yellow("FileSystem"),f=a.bold.yellow("App");e.exports=o(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=i()).div("Everything in this ".concat(d," is a Blockchain ").concat(s)),t.div(),t.div({text:"1.",width:4},"".concat(s,"s exist everywhere independent of any single computer because they are virtual, and not tied to a particular machine, freeing them from the faults of nature which plague physical hardware")),t.div({text:"2.",width:4},"".concat(s,"s can connect to each other to transfer instructions or payload data via ").concat(c,"s.")),t.div({text:"3.",width:4},"The logic governing the behaviour of ".concat(s,"s is inside a ").concat(u)),t.div({text:"4.",width:4},"A subclass of ".concat(u," is a ").concat(l)),t.div({text:"5.",width:4},"In our system, ".concat(s,"s are only changed internally by ").concat(l,"s")),t.div({text:"6.",width:4},"When viewed as a Graph, the ".concat(c,"s between all ").concat(s,"s are the ").concat(p)),t.div({text:"7.",width:4},"The ".concat(p," is arranged in a hierarchy from a root, so that it looks like a POSIX filesystem for the familiarity of our users")),t.div({text:"8.",width:4},"When viewed as executables, the collection of ".concat(l,"s are the ").concat(f,"s of our ").concat(d," ")),t.div({text:"9.",width:4},"Including the ".concat(f," named the Dreamcatcher means we by default include the ").concat(f," that coordinates Talent into making more ").concat(f,"s")),t.div(),t.div("type 'help' for a list of commands"),t.div(),e.abrupt("return",{out:t.toString()});case 16:case"end":return e.stop()}}),e)}))),e.exports.help="Information about the HyperNet"},1890:function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:blocks"),i=n(121).engine.blockPrint;e.exports=function(){var e=o(r.mark((function e(t){var n,o,s,c,u,l,d,p,f,h,v,g,y,m=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.blockchain,o=m.length,s=new Array(o>1?o-1:0),c=1;c<o;c++)s[c-1]=m[c];for(a("blocks %O",s),u=n.getContext(),l=u.wd,d=s[0]||l,a("using path: %o",d),f=d===l?n:n[d],h=f.getState().provenance.height,v=0,g="";v<=h;)y=[],p=f.getState(y,v),g+=i(p,d)+"\n",v++,a("next height: ",v);return e.abrupt("return",{out:g});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nShow the blocks of any given blockchain.\nIf no chain ID or alias given, print the blocks of the \nblockchain at the cwd\n"},1891:function(e,t,n){var r=n(2),o=n(3);e.exports=o(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),e.exports.help="\nTo ensure the integrity of the system, invoke scrub to\ncheck the hashes of all objects at this location,\nand to verify the availability of all objects.\nUse the option --history to check all blocks in the past\nas well as LATEST.  This will incur significant usage fees\nand bandwidth.\n"},1892:function(e,t,n){var r=n(2),o=n(3),a=n(22)("dos:commands:namegen"),i=n(1893);e.exports=function(){var e=o(r.mark((function e(t){var n,o,s=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t.spinner,t.blockchain,n=s.length>1&&void 0!==s[1]?s[1]:1,a("count: %O",n),o="";n>0;)o+=i.getRandomName(),--n>0&&(o+="\n");return e.abrupt("return",{out:o});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nGenerate a random name, which can be used as an identity for anything.\n"},1894:function(e,t,n){var r=n(2),o=n(3);n(22)("dos:commands:add"),n(39),n(45).prompt;e.exports=function(){var e=o(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.spinner,t.blockchain;case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.help="\nView, change the validator set of a chain or group of chains.\nRecursively change all validators of the chains children.\nValidators must accept the role before the handover is complete.\nCan be used to force a change if a chain has stalled.\n"},1895:function(e,t,n){var r=n(2),o=n(3),a=n(10),i=n(12),s=n(22)("dos:auto-complete"),c=n(39),u=n(169).withSpin,l=n(116),d=function(){"use strict";function e(){a(this,e),this._list=[],this.getList=this.getList.bind(this)}return i(e,[{key:"updateList",value:function(){var e=o(r.mark((function e(t){var n,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.wd,(n=t.spinner)&&(n.text="Updating auto-complete list"),o=Object.keys(l),[],this._list=o;case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getList",value:function(e){return e.includes(" ")?this._list:Object.keys(l)}}]),e}();t.AutoComplete=d,t.withAutoComplete=function(e){return function(){var t=o(r.mark((function t(n){var o=arguments;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.autoComplete||(n.autoComplete=new d,n.autoComplete.updateList=u(n.autoComplete.updateList)),t.prev=1,t.next=4,n.autoComplete.updateList(n);case 4:t.next=10;break;case 6:t.prev=6,t.t0=t.catch(1),console.warn("".concat(c.yellow("\u26a0")," failed to update auto-complete list")),s(t.t0);case 10:return s("auto-complete"),t.abrupt("return",e.apply(this,o));case 12:case"end":return t.stop()}}),t,this,[[1,6]])})));return function(e){return t.apply(this,arguments)}}()}},1896:function(e,t,n){var r=n(2),o=n(3);e.exports=function(){var e=o(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,t();case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},190:function(e,t){},1905:function(e,t,n){"use strict";n.r(t);var r=n(5),o=n.n(r),a=n(269),i=n.n(a),s=(n(282),n(283),n(123),n(72)),c=n.n(s),u=n(270);c()("shell:App");c.a.enable("*metro* dos*");var l=function(){return o.a.createElement(u.a,{style:{height:"100vh",backgroundColor:"black"}})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(l,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},20:function(e,t,n){var r=n(47),o=n(7),a=n(4),i=(n(9)("interblock:models:utils"),n(302),n(24),n(128)),s=n(304),c=s.produce;(0,s.setAutoFreeze)(!1);var u=n(305),l=u.modelInflator,d=u.precompileSchema,p=n(93).registry,f=n(48),h=n(62),v=function(e,t,n){var r,o,s,c=function(){a.strictEqual(typeof t,"object");var n=g(e,t),r=n.hash,i=n.proof;o=r,s=i};return{equals:function(e){return!!n(e)&&h(t,e)},serialize:function(){return r||(r=i(t)),r},getHash:function(){return o||(c(),a(o)),o},getProof:function(){return s||(c(),a(s)),s}}},g=function(e,t){switch(e.title){case"Integrity":return{hash:t.hash};case"Block":var n=y(t,["encryption","timestamp","config","covenantId","binaryIntegrity","acl","state","pending"]),r=f.objectHash(b(n));return{hash:t.provenance.getHash(),proof:r};case"Network":var o=b(t);return{hash:o.hash,proof:{networkChannels:o.proof}};case"Channel":var a=p.get("Remote"),i=y(t,["address","replies","requests","heavyHeight","lineageHeight"]),s=a.clone(i),c=["systemRole","requestsLength","heavy","lineage","lineageTip"],u=y(t,c),l=y(e.properties,c),d=m({properties:l},u).hash;return{hash:f.objectHash({remote:s.getHash(),proof:d}),proof:d};case"State":case"SimpleArray":return{hash:f.objectHash(t)};default:return m(e,t)}},y=function(e,t){var n={};return t.forEach((function(t){"undefined"!==typeof e[t]&&(n[t]=e[t])})),n},m=function(e,t){if(e.patternProperties)return{hash:b(t).hash};var n={},r=e.properties;return Object.keys(t).map((function(e){var o=r[e],a=o.title,i=o.type,s=o.patternProperties,c=t[e];if(p.isRegistered(a))n[e]=c.getHash();else if("array"!==i)if(s){var u=b(c).hash;n[e]=u}else n[e]=f.objectHash(c);else n[e]=k(c)})),{hash:f.objectHash(n)}},k=function(e){return f.objectHash(e.map((function(e){return e.getHash()})))},b=function(e){var t=Object.keys(e).map((function(t){return f.objectHash(r({},t,e[t].getHash()))}));return t.sort(),{hash:f.objectHash(t),proof:t}},x=function(e,t){var n=new Proxy(e,{get:function(e,n,r){return t[n]?t[n]:e[n]},set:function(e,t,n,r){throw new Error("Model properties cannot be altered: ".concat(t))},deleteProperty:function(e,t){throw new Error("Model properties cannot be deleted: ".concat(t))}});return n},w=function(e){var t=e.schema.title;["create","logicize"].forEach((function(n){if("function"!==typeof e[n])throw new Error("Model: ".concat(t," needs function: ").concat(n))}));var n=Object.keys(e).length;if(3!==n)throw new Error("Model: ".concat(t," has ").concat(n," properties, not 3"))},I=function(e){return e.create},M=function e(t){Object.freeze(t),Object.getOwnPropertyNames(t).forEach((function(n){if(t.hasOwnProperty(n)){if(void 0===t[n])throw new Error("Values cannot be undefined: ".concat(n));if("function"===typeof t[n])throw new Error("No functions in deepFreeze: ".concat(n));"object"!==typeof t[n]||Object.isFrozen(t[n])||e(t[n])}}))};e.exports={standardize:function(e){w(e),d(e.schema);var t,n=I(e),r=new WeakSet,i=new WeakMap,s=function(e){return r.has(e)},u=Object.freeze(o({},e,{create:n,clone:function(n,d){if(!n)return t||(t=u.create()),t;if(s(n)&&!d)return n;if(n&&"function"===typeof d&&(a(s(n),"instance must be ".concat(e.schema.title)),n=c(n,d)),"string"===typeof n&&(n=JSON.parse(n)),i.has(n))return i.get(n);var p=l(e.schema,n);M(p);var f=e.logicize(p),h=v(e.schema,p,s),g=h.serialize,y=h.getHash,m=h.getProof,k=h.equals,b=o({},f,{serialize:g,getHash:y,getProof:m,equals:k}),w=x(p,b);return r.add(w),i.set(n,w),w},isModel:s}));return u}}},21:function(e,t,n){var r=n(7),o={};["aclModel","actionModel","addressModel","binaryModel","blockModel","covenantIdModel","continuationModel","dmzModel","configModel","integrityModel","interblockModel","keypairModel","lockModel","provenanceModel","publicKeyModel","signatureModel","timestampModel","channelModel","networkModel","stateModel","remoteModel","validatorsModel","proofModel","pendingModel","simpleArrayModel"].forEach((function(e){try{var t=n(301)("./".concat(e));o[e]=t[e]}catch(r){throw console.log("error loading: ".concat(e)),r}}));var a=n(1732),i=n(107),s=n(93).registry;s.registerModels(o),s.registerModels(a),s.registerModels(i);var c=n(1734),u=n(68),l=u.ciSigner,d=u.pierceSigner;e.exports=r({},o,{},i,{},a,{registry:s,cryptoCacher:c,ciSigner:l,pierceSigner:d})},235:function(e,t,n){var r=n(59),o=n(2),a=n(7),i=n(3),s=(n(4),n(153)),c=new(n(129))({allErrors:!0,verbose:!0}),u=n(9)("interblock:apps:datum"),l=n(44),d=n(34).interchain,p={type:"object",title:"Datum",required:["type","namePath","schema","uiSchema","subscribers","children"],additionalProperties:!1,properties:{type:{enum:["COLLECTION","XSTATE","ARRAY","DATA"]},isEditable:{type:"boolean"},namePath:{type:"array",items:{type:"string"}},formData:{type:"object"},schema:{type:"object"},uiSchema:{type:"object"},subscribers:{type:"array",description:"list of paths that need to be notified when changes occur",items:{type:"string"}},children:{type:"object",patternProperties:{"(.*?)":{$ref:"#"}}}}},f={type:"DATA",isEditable:!0,namePath:[],formData:{},schema:{},uiSchema:{},subscribers:[],children:{}},h=function(){var e=i(o.mark((function e(t,n){var r,i,s,c,p,h,y,m;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object.keys(t).length||(t=f),r=n.type,i=n.payload,e.t0=r,e.next="@@INIT"===e.t0?5:"SET"===e.t0?7:28;break;case 5:return u("@@INIT"),e.abrupt("break",29);case 7:if(v(i)&&(t=b(i)),s=g(t,n),t.formData=s.formData,!Object.keys(t.children).length){e.next=27;break}return e.next=13,d(l.actions.listChildren());case 13:c=e.sent,p=c.children,e.t1=o.keys(t.children);case 16:if((e.t2=e.t1()).done){e.next=27;break}if(h=e.t2.value,p[h]){e.next=25;break}return u("creating new child: ",h),y=P.set(a({},s.children[h],{},t.children[h])),m=l.actions.spawn(h),d(m),e.next=25,d(y,h);case 25:e.next=16;break;case 27:return e.abrupt("return",t);case 28:throw new Error("Unknown action: ".concat(r));case 29:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),v=function e(t){if(t.schema&&Object.keys(t.schema).length)return!0;var n=t.children,r=void 0===n?{}:n;return Object.values(r).some(e)},g=function(e,t){var n=t.payload;if(n.isTestData){var o=t.getHash(),a=parseInt(Number("0x"+o.substring(0,14)));s.seed(a)}x(e);var i=n.isTestData,c=r(n,["isTestData"]),u=y(c);return i&&(u=k(e,u)),m(e,u),u},y=function e(t){if(!t||"undefined"===typeof t.formData)return{};var n=t.formData,r={};if("undefined"!==typeof n&&(r.formData=n),t.children&&Object.keys(t.children).length)for(var o in r.children={},t.children)r.children[o]=e(t.children[o]);return r},m=function e(t,n){if(!c.validate(t.schema,n.formData)){var r=c.errorsText(c.errors);throw new Error("".concat(t.schema.title," failed validation: ").concat(r))}for(var o in t.children)e(t.children[o],n.children[o])},k=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.formData,o=void 0===r?{}:r,i=n.children,c=void 0===i?{}:i;Object.keys(t.schema.properties).forEach((function(e){if(!o[e])switch(e){case"firstName":o[e]=s.name.firstName();break;case"address":o[e]=s.address.streetAddress()}}));var u=a({},n,{formData:o});if(Object.keys(t.children).length){var l={};for(var d in t.children)l[d]=e(t.children[d],c[d]);u.children=l}return u},b=function(e){e.isTestData;var t=r(e,["isTestData"]),n=w(t);return n=I(n),x(n),M(n),n},x=function(e){if(!c.validate(p,e)){var t=c.errorsText(c.errors);throw new Error("Datum failed validation: ".concat(t))}},w=function e(t){var n=a({},f,{},t),r=n.children,o={};for(var i in r)o[i]=e(r[i]);return a({},n,{children:o})},I=function e(t){t.formData;var n=t.children,o=void 0===n?{}:n,i=r(t,["formData","children"]),s={};for(var c in o)s[c]=e(o[c]);return a({},i,{children:s})},M=function e(t){c.compile(t.schema),c.compile(t.uiSchema);Object.values(t.children).every(e)},P={set:function(e){return{type:"SET",payload:e}},subscribe:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{type:"SUBSCRIBE",payload:t}},unsubscribe:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{type:"UN_SUBSCRIBE",payload:t}},setDirectEdit:function(){return{type:"SET_DIRECT"}}};e.exports={actions:P,reducer:h,convertToTemplate:b,demuxFormData:g,validateDatumTemplate:x,muxTemplateWithFormData:function e(t,n){var r=a({},t,{children:{}});for(var o in r.formData=n.formData,t.children)r.children[o]=e(t.children[o],n.children[o]);return r}}},237:function(e,t,n){var r=n(17),o=n(4),a=n(9)("interblock:producers:channel"),i=n(24),s=n(21),c=s.addressModel,u=s.channelModel,l=s.interblockModel,d=s.actionModel,p=s.continuationModel,f=function(e,t){var n={};return t.forEach((function(t){"undefined"!==typeof e[t]&&(n[t]=e[t])})),n};e.exports={ingestInterblock:function(e,t){return u.clone(e,(function(n){a("ingestInterblock"),o(l.isModel(t)),o(e.address.equals(t.provenance.getAddress()));var s=t.provenance,c=s.reflectIntegrity(),u=t.getRemote(),d=t.getWithoutRemote(),p=r(e.lineage),h=function(){p.push(c),n.lineageTip.push(d),n.lineageHeight=s.height,a("ingested lineage: ".concat(s.height))},v=function(){if(n.heavy=t,n.heavyHeight=s.height,o(u||s.address.isGenesis()),u){var r=u.requests,i=Object.keys(r),c=f(e.replies,i);n.replies=c,a("ingested heavy: ".concat(s.height))}},g=i.last(e.lineageTip);g?g.provenance.isNext(s)&&h():s.address.isGenesis()&&(a("ingesting genesis"),h(),v()),u&&n.heavy&&s.height>n.heavy.provenance.height&&p.some((function(e){return e.equals(c)}))&&v(),n.lineage=p}))},ingestPierceInterblock:function(e,t){return u.clone(e,(function(n){o(l.isModel(t));var r=t.provenance;o(e.address.equals(r.getAddress()));var i=t.getRemote();o(i),a("ingestPierceInterblock"),n.heavy=t,n.heavyHeight=r.height,n.lineageHeight=r.height;var s=i.requests,c=Object.keys(s),u=f(e.replies,c);n.replies=u}))},setAddress:function(e,t){return u.clone(e,(function(e){o(c.isModel(t)),o(!t.isGenesis()),e.address=t}))},txRequest:function(e,t){return u.clone(e,(function(n){if(a("txRequest"),o(d.isModel(t),"must supply request object"),Object.values(e.requests).some((function(e){return e.equals(t)}))){var r="Duplicate request found: ".concat(t.type,".  All requests must be distinguishable from each other");throw new Error(r)}var i=n.requestsLength;n.requests[i]=t,n.requestsLength++}))},txReply:function(e,t,n){return u.clone(e,(function(r){o(p.isModel(t),"must supply reply object");var a=e.getNextReplyIndex();n=Number.isInteger(n)?n:a;var s=i.last(e.getRemoteRequestIndices());o(n>=0&&n<=s,"replyIndex out of bounds: ".concat(n)),o(e.getRemote().requests[n]);var c=e.replies[n],u=a===n;if(c&&!c.isPromise())throw new Error("Can only settle previous promises: ".concat(n));if(t.isPromise()&&!u)throw new Error("Can only promise for current action: ".concat(n));if(!c&&!u)throw new Error("Can only settle directly with tip: ".concat(t));r.replies[n]=t}))},shiftTxRequest:function(e,t){return u.clone(e,(function(n){o(u.isModel(e)),o(e.rxReply()),a("shiftTxRequest requestsLength: ".concat(e.requestsLength));var r=e.rxReplyIndex();e.address.isLoopback()&&(o(u.isModel(t)),o(t.address.isLoopback()),o(e.address.isLoopback()),r=t.rxReplyIndex(),o(e.replies[r],"loopback empty at ".concat(r)),delete n.replies[r]),o(e.requests[r],"nothing to remove at ".concat(r)),delete n.requests[r]}))}}},239:function(e,t,n){n(1723);var r=n(62),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"@@RESOLVE",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;switch(e){case"@@PROMISE":if(Object.keys(t).length)throw new Error("Promise payload must be empty");if(n)throw new Error("can only promise to the current request - leave blank");break;case"@@RESOLVE":case"@@REJECT":break;default:throw new Error("Disallowed type: ".concat(e))}if("object"!==typeof t)throw new Error("payload must be object: ".concat(t));var r={type:e,payload:t,request:n};return r},a=["@@PROMISE","@@RESOLVE","@@REJECT"],i=function(e){return!e||!e.type||!a.includes(e.type)};e.exports={request:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!e)throw new Error("Must supply at least one arg");if("object"===typeof e&&(n="string"===typeof t?t:e.to||".",t=e.payload||{},e=e.type),"string"!==typeof e)throw new Error('"type" must be a string: '.concat(e));if("string"!==typeof n)throw new Error('"to" must be a string: '.concat(n));if("object"!==typeof t)throw new Error('"payload" must be an object: '.concat(t));var r={type:e,payload:t,to:n};return r},promise:function(){return o("@@PROMISE")},resolve:function(e,t){return o("@@RESOLVE",e,t)},reject:function(e,t){return o("@@RESOLVE",e,t)},isReplyFor:function(e,t){if(t&&"object"!==typeof t)return!1;if(i(e))return!1;if(!t)return!0;var n=t.type,o=t.payload,a=e&&e.request;return a&&a.type===n&&r(a.payload,o)}}},240:function(e,t,n){var r=n(2),o=n(3),a=n(9)("interblock:covenants:dpkg"),i=n(34).replyResolve,s=function(){var e=o(r.mark((function e(t,n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=n.type,e.next="GET_INSTALL"===e.t0?3:(e.t0,6);break;case 3:return a("getInstaller"),i(t.installer||{}),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();e.exports={reducer:s,actions:{setInstaller:function(){return{type:"SET_INSTALL"}},getInstaller:function(){return{type:"GET_INSTALL"}}}}},241:function(e,t,n){var r=n(2),o=n(3),a=n(9)("interblock:covenants:net"),i=n(4),s=n(34).interchain,c=n(44),u=n(40),l=u.Machine,d=(u.assign,c.actions),p=d.spawn,f=(d.connect,n(21)),h=f.socketModel,v=f.covenantIdModel,g=n(154),y=(g.respond,g.send,g.sendParent,g.translator);e.exports={netFactory:function(e){var t={actions:{},guards:{},services:{addTransport:function(){var e=o(r.mark((function e(t,n){var o,i,c,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a("event: %o",n),o=n.payload.url,i=v.create("socket"),c={isPierced:!0},e.next=6,s(p(o,{covenantId:i,config:c}));case 6:return u=e.sent,e.abrupt("return",u);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),rmTransport:function(){var e=o(r.mark((function e(t,n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}},n=l({id:"net",initial:"idle",context:{},strict:!0,states:{idle:{on:{ADD:"addTransport",RM:"rmTransport",PING:"ping",PING_LAMBDA:"pingLambda",VERSION:"version"}},addTransport:{invoke:{src:"addTransport",onDone:"idle"}},rmTransport:{invoke:{src:"rmTransport",onDone:"idle"}},ping:{invoke:{src:"ping",onDone:"idle"}},pingLambda:{invoke:{src:"pingLambda",onDone:"idle"}},version:{entry:"respondVersion",always:"idle"},done:{id:"done",type:"final"},error:{id:"error",type:"final"}}},t);return{actions:{add:function(e){return i.strictEqual(typeof e,"string"),{type:"ADD",payload:{url:e=e.replace(/\//g,"|")}}},rm:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:"RM",payload:{url:e,force:t}}}},schemas:{add:{type:"object",description:"Add a new transport.  Will result in a child of this chain.",required:["url"],properties:{url:{type:"url"},type:h.schema.properties.type,name:{type:"string"}}},rm:{description:"Removes a transport.  Gracefully attempts to close the connection.\n        Force will terminate immediately by deleting the chain"}},reducer:y(n),covenantId:v.create("net")}}}},242:function(e,t,n){var r=n(2),o=n(7),a=n(3),i=n(17),s=n(9)("interblock:covenants:socket"),c=n(4),u=n(44),l=n(40),d=l.Machine,p=l.assign,f=u.actions,h=(f.spawn,f.connect,f.getGivenName),v=n(21),g=(v.socketModel,v.covenantIdModel),y=n(243).tcpTransportFactory,m=n(34),k=m.effect,b=m.interchain,x=n(154),w=x.respond,I=(x.send,x.sendParent,x.translator);e.exports={socketFactory:function(e){var t={actions:{addChainId:p({chainIds:function(e,t){var n=e.chainIds;c(Array.isArray(n));var r=new Set(n),o=t.payload.chainId;return c.strictEqual(typeof o,"string"),r.add(o),n=i(r),s("chainIds length: %o",n),n}}),rmChainId:p({chainIds:function(e,t){var n=e.chainIds;c(Array.isArray(n));var r=new Set(n),o=t.payload.chainId;return c.strictEqual(typeof o,"string"),r.delete(o),n=i(r),s("chainIds length: %o",n),n}}),assignGivenName:p({givenName:function(e,t){var n=t.data.givenName;return c.strictEqual(typeof n,"string"),s("givenName",n),n}}),respondPing:function(e,t){return s("respondPing",t),w(t.data)},respondOrigin:function(e,t){return w(t.data)}},guards:{},services:{connectSocket:function(){var t=a(r.mark((function t(n,a){var i,c,u,l,d;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s("connectSocket"),t.next=3,b(h());case 3:return i=t.sent,c=i.givenName,s("givenName: %O",c),u=c.replace(/\|/g,"/"),s("url: %O",u),l=e[c]||y(u),e[c]=l,t.next=12,k("CONNECT",l.connect);case 12:return d=t.sent,s("connected to %o",u),t.abrupt("return",o({givenName:c},d));case 15:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),ping:function(){var t=a(r.mark((function t(n,o){var a,i,u;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.givenName,c.strictEqual(typeof a,"string"),s("ping: %O",o),i=e[a]){t.next=6;break}throw new Error("No socket found for: ".concat(a));case 6:return t.next=8,k("PING",i.ping,o.payload.data);case 8:return u=t.sent,s("ping result: %O",u),t.abrupt("return",u);case 11:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),disconnectSocket:function(){var t=a(r.mark((function t(n,a){var i,c,u;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.givenName,s("disconnectSocket"),c=e[i]){t.next=5;break}throw new Error("No socket found for: ".concat(i));case 5:return t.next=7,k("DISCONNECT",c.disconnect);case 7:return u=t.sent,delete e[i],s("disconnectSocket result: ",u),t.abrupt("return",o({},u));case 11:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}},n=d({id:"socket",initial:"idle",context:{chainIds:[],givenName:""},strict:!0,states:{idle:{on:{ADD:"addChainId",CONNECT:"connectSocket",DISCONNECT:"disconnectSocket",PING:"ping",PING_LAMBDA:"pingLambda",VERSION:"version",RM:"rmChainId",TRANSMIT:"transmitInterblock"}},addChainId:{entry:"addChainId",always:"idle"},connectSocket:{invoke:{src:"connectSocket",onDone:{target:"idle",actions:["assignGivenName","respondOrigin"]}}},disconnectSocket:{invoke:{src:"disconnectSocket",onDone:{target:"idle",actions:"respondOrigin"}}},ping:{invoke:{src:"ping",onDone:{target:"idle",actions:"respondPing"}}},pingLambda:{invoke:{src:"pingLambda",onDone:"idle"}},version:{invoke:{src:"version",onDone:"idle"}},rmChainId:{entry:"rmChainId",always:"idle"},transmitInterblock:{invoke:{src:"transmitInterblock",onDone:"idle"}},done:{id:"done",type:"final"},error:{id:"error",type:"final"}}},t);return{actions:{addChainId:function(e){return{type:"ADD",payload:{chainId:e}}},connect:function(){return{type:"CONNECT"}},disconnect:function(){return{type:"DISCONNECT"}},ping:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return{type:"PING",payload:{data:e}}},pingLambda:function(){return{type:"PING_LAMBDA"}},version:function(){return{type:"VERSION"}},rmChainId:function(e){return{type:"RM",payload:{chainId:e}}},transmit:function(e){return{type:"TRANSMIT",payload:{interblock:e}}}},schemas:{},reducer:I(n),covenantId:g.create("socket")}}}},243:function(e,t,n){var r=n(2),o=n(3),a=n(4),i=n(21),s=(i.blockModel,i.interblockModel,n(9)("interblock:transport")),c=n(1728);e.exports={tcpTransportFactory:function(e){var t;return{connect:function(){var n=o(r.mark((function n(){var i;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a(!t),(t=new c(e)).on("message",(function(e){s("message: %O",e)})),t.on("close",(function(e){return s("close",e)})),t.on("error",(function(e){return s("error %O",e)})),t.on("ping",(function(e){return s("ping",e.toString())})),t.on("pong",(function(e){return s("pong",e.toString())})),t.on("upgrade",(function(e){return s("upgrade")})),i=Date.now(),n.abrupt("return",new Promise((function(n,a){var c=function(){var e=o(r.mark((function e(n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s("unexpectedResponse"),t.terminate(),a("unexpectedResponse");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.on("open",(function(){s("socket open to ".concat(e)),t.removeListener("unexpected-response",c),n({latencyMs:Date.now()-i})})),t.on("unexpected-response",c)})));case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),ping:function(){var e=o(r.mark((function e(){var n,o=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:"",s("ping: %O",n),e.abrupt("return",new Promise((function(e){var r=Date.now();t.ping(n),t.on("pong",(function(t){a.strictEqual(t.toString(),n);var o=Date.now()-r;e({data:n,latencyMs:o})}))})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pingLambda:function(){var e=o(r.mark((function e(){var n,o=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:"",s("pingLambda: %O",n),e.abrupt("return",new Promise((function(e){var r=Date.now();t.send("PING_LAMBDA ".concat(n)),t.on("message",(function(t){a.strictEqual(t.toString(),"PONG_LAMBDA ".concat(n)),e(Date.now()-r)}))})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),version:function(){var e=o(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s("version"),e.abrupt("return",new Promise((function(e){t.send("VERSION"),t.on("message",(function(t){a.strictEqual(t.toString(),"PONG_LAMBDA ".concat(data)),e(Date.now()-start)}))})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),disconnect:function(){var e=o(r.mark((function e(){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Date.now(),t.close(),e.abrupt("return",new Promise((function(e,r){t.on("close",(function(){return e({latencyMs:Date.now()-n})}))})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),interblock:function(){var e=o(r.mark((function e(n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:1,a.strictEqual(t.readyState,1,"websocket not open"),t.send(n.serialize());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}}}},244:function(e,t,n){var r=n(4),o=n(20).standardize,a=n(67).actionModel,i=o({schema:n(108).rxReplySchema,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"@@RESOLVE",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;r(a.isModel(n),"Request not model: ".concat(n));var o={type:e,payload:t,request:n};return i.clone(o)},logicize:function(e){var t=e.request,n=t.type,r=t.payload,o=a.create({type:n,payload:r});return{getRequest:function(){return o},isReply:function(){return!0}}}});e.exports={rxReplyModel:i}},245:function(e,t,n){var r=n(33),o=n(4),a=n(52).addressModel;e.exports=function(e){o("string"===typeof e);var t,n=e.split("_"),i=r(n,2),s=i[0],c=i[1],u=parseInt(c);return"LOOPBACK"===s?t=a.create("LOOPBACK"):(t=a.create(s),o(t.isResolved())),{address:t,index:u}}},246:function(e,t,n){var r=n(4),o=(n(9)("interblock:models:lock"),n(120).v4),a=n(20).standardize,i=n(104).timestampModel,s=n(84).blockModel,c=n(110).interblockModel,u=n(156).txReplyModel,l=n(157).txRequestModel,d={title:"Lock",description:"Locking of the persistence layer for execution to take place.",type:"object",required:["uuid","timestamp","expires","interblocks","piercings"],additionalProperties:!1,properties:{uuid:{type:"string",description:"uuidv4 identifying a lock on a chainId"},timestamp:i.schema,expires:{type:"integer",description:"ms until the lock expires",min:0},block:s.schema,interblocks:{type:"array",description:"Punched out blocks from other chains that have accumulated for this chain",uniqueItems:!0,items:c.schema},piercings:{type:"object",description:"Side effects",required:["requests","replies"],properties:{requests:{type:"array",uniqueItems:!0,items:l.schema},replies:{type:"array",uniqueItems:!0,items:u.schema}}}}},p={requests:[],replies:[]},f=a({schema:d,create:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o(),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p;r(!e||s.isModel(e)),t=t.map(c.clone),a=h(e,a);var u=i.create(),l=2e3,d={uuid:n,timestamp:u,expires:l,interblocks:t,piercings:a};return e&&(d.block=e),f.clone(d)},logicize:function(e){var t=e.block,n=e.timestamp,o=e.expires,a=e.piercings,i=h(t,a),s=a.requests,c=a.replies;r.strictEqual(i.requests.length,s.length),r.strictEqual(i.replies.length,c.length);return{isLocked:function(){return!n.isExpired(o)},isMatch:function(t){return t.uuid===e.uuid},isPiercingsPresent:function(){return s.length||c.length}}}}),h=function(e,t){var n=t.requests,o=t.replies;return n=n.map((function(e){return r.strictEqual(typeof e,"object"),e=l.clone(e)})),n=g(n),o=o.map((function(e){return r.strictEqual(typeof e,"object"),e=u.clone(e)})),o=g(o),v(e,{requests:n,replies:o})},v=function(e,t){var n=t.requests,r=t.replies;if(!e||!e.network[".@@io"])return{requests:n,replies:r};var o=e.network[".@@io"].getRemote(),a=o.requests,i=o.replies,s=Object.values(a),c=Object.values(i);return{requests:n=n.filter((function(e){return!s.some((function(t){return t.equals(e)}))})),replies:r=r.filter((function(e){return!c.some((function(t){return t.equals(e)}))}))}},g=function(e){var t=[];return e.forEach((function(e){t.every((function(t){return!e.equals(t)}))&&t.push(e)})),t};e.exports={lockModel:f}},247:function(e,t,n){var r=n(7),o=(n(4),n(120).v4),a=n(20).standardize,i={id:"fd9e9077-cda5-4b1d-afbf-c8a7cf648ded",type:"internal",info:{}},s=a({schema:{title:"Socket",description:"Socket info, used to store info about block producers",type:"object",required:["id","type","info"],additionalProperties:!1,properties:{id:{type:"string"},type:{enum:["internal","websocket","https","email","udp"]},info:{type:"object"}}},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;return e=r({id:o(),type:"internal",info:{}},e),s.clone(r({},e))},logicize:function(e){return{getIsInternal:function(){return"internal"===e.type}}}});e.exports={socketModel:s}},248:function(e,t,n){var r=n(33),o=n(2),a=n(3),i=n(9)("interblock:consistency:db"),s=n(4),c=(n(24),n(114).ramDynamoDbFactory);e.exports={dbFactory:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c(),n=function(){var e=a(o.mark((function e(n,r){var a,i,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={TableName:n,Key:r,ConsistentRead:!0,ReturnConsumedCapacity:"TOTAL"},e.next=3,t.get(a).promise();case 3:return i=e.sent,i.ConsumedCapacity,s=i.Item,e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),u=function(e){return n("dbChains",e)},l=function(){var e=a(o.mark((function e(n,r){var a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(n),s(r),Array.isArray(r)||(r=[r]),a=r.map((function(e){var r={TableName:n,Item:e,ReturnConsumedCapacity:"TOTAL"};return t.put(r).promise()})),e.next=6,Promise.all(a);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),d=function(e){return l("dbPools",e)},p=function(e){return l("dbChains",e)},f=function(e){return l("dbSubscribers",e)},h=function(){var e=a(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l("dbSockets",t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=a(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l("dbCrypto",t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=a(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l("dbPiercings",t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=a(o.mark((function e(n,r){var a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(Array.isArray(r)),a=r.map((function(e){var r={TableName:n,Key:e,ReturnConsumedCapacity:"TOTAL"};return t.delete(r).promise()})),e.next=4,Promise.all(a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),m=function(e){return y("dbSubscribers",e)},k=function(e){return y("dbPools",e)},b=function(e){return y("dbPiercings",e)},x=function(){var e=a(o.mark((function e(n,r,a){var c,u,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={TableName:n,KeyConditionExpression:"chainId = :hkey",ExpressionAttributeValues:{":hkey":r},ScanIndexForward:!1,ConsistentRead:!0,ReturnConsumedCapacity:"TOTAL"},a&&(c.Limit=1),i("dbQuery: %O %O",n,r),e.next=5,t.query(c).promise();case 5:if(u=e.sent,u.ConsumedCapacity,l=u.Items,s(Array.isArray(l)),i("dbQuery items length: %O",l.length),!a){e.next=11;break}return e.abrupt("return",l[0]);case 11:return e.abrupt("return",l);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),w=function(e,t){return x("dbSubscribers",e,t)},I=function(e){return x("dbSockets",e)},M=function(e){return x("dbChains",e,!0)},P=function(e){return x("dbPools",e)},R=function(e){return x("dbPiercings",e)},E=function(){var e=a(o.mark((function e(n){var a,i,c,u,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={TableName:n,ConsistentRead:!0,Limit:1},e.next=3,t.scan(a).promise();case 3:if(i=e.sent,i.ConsumedCapacity,c=i.Items,s(Array.isArray(c)),!c.length){e.next=10;break}return s.strictEqual(c.length,1),u=r(c,1),l=u[0],e.abrupt("return",l);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var t=a(o.mark((function t(){var n;return o.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=2;break}return t.abrupt("return",e);case 2:return t.next=4,E("dbChains");case 4:return(n=t.sent)&&(e=n),t.abrupt("return",e);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),q=function(){var e=a(o.mark((function e(){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",E("dbCrypto"));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{putPool:d,putBlock:p,putSubscriptions:f,putSocket:h,delSubscriptions:m,delPool:k,getBlock:u,queryAffected:w,querySockets:I,queryLatest:M,queryPool:P,scanBaseChainId:C,scanKeypair:q,putKeypair:v,putPierce:g,queryPiercings:R,delPierce:b}}}},249:function(e,t,n){var r=n(33),o=n(2),a=n(3),i=n(4),s=n(9)("interblock:consistency:s3"),c=(n(24),n(21)),u=c.cryptoCacher,l=c.blockModel,d=c.interblockModel,p=n(165).ramS3Factory,f={fromInterblock:function(e){var t=e.getHash(),n=e.provenance.getAddress().getChainId(),r=e.provenance.height,o=e.getRemote(),a=o?o.address.getChainId():"#LINEAGE";return"".concat(n,"/").concat(r,"_").concat(a,"_").concat(t)},fromPoolItem:function(e){var t=e.chainId,n=e.originChainId_height_type,o=e.interblockHash,a=n.split("_"),i=r(a,3),s=i[0],c=i[1],u="light"===i[2]?"#LINEAGE":t;return"".concat(s,"/").concat(c,"_").concat(u,"_").concat(o)},fromBlock:function(e){var t=h(e);return f.fromBlockItem(t)},fromBlockItem:function(e){var t=e.chainId,n=e.height,r=e.blockHash;e.shortestLineage;return"".concat(t,"/").concat(n,"_").concat(r)}},h=function(e){return{chainId:e.provenance.getAddress().getChainId(),height:e.provenance.height,blockHash:e.getHash(),shortestLineage:e.provenance.lineage[0]}};e.exports={s3Factory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p(),t=new Map,n=function(){var n=a(o.mark((function n(r,a){var c,u,l;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return c=e._isRam?a:a.serialize(),u={Bucket:"wbinterbucket",Key:r,Body:c,ContentType:"application/json"},n.next=4,e.putObject(u).promise();case 4:l=n.sent,t.set(r,a),s("putInterblock: %O",r),i(l);case 8:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),r=function(){var n=a(o.mark((function n(r){var a,i,c,l,p;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a={Bucket:"wbinterbucket",Key:r},s("getInterblock"),!t.has(r)){n.next=5;break}return s("interblock cache hit for %o",r),n.abrupt("return",t.get(r));case 5:return n.prev=5,n.next=8,e.getObject(a).promise();case 8:if(i=n.sent,!d.isModel(i.Body)){n.next=13;break}return n.abrupt("return",i.Body);case 13:return c=i.Body.toString(),l=JSON.parse(c),n.next=17,u.cacheVerifyHash(l);case 17:return p=d.clone(c),s("s3GetInterblock complete"),n.abrupt("return",p);case 20:n.next=25;break;case 22:n.prev=22,n.t0=n.catch(5),s("error fetching: %O %O",r,n.t0.message);case 25:case"end":return n.stop()}}),n,null,[[5,22]])})));return function(e){return n.apply(this,arguments)}}(),c=function(){var n=a(o.mark((function n(r){var c;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i(Array.isArray(r)),s("deleteInterblocks: %O",r.length),c=r.map(function(){var n=a(o.mark((function n(r){var a;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a={Bucket:"wbinterbucket",Key:r},n.next=3,e.deleteObject(a).promise();case 3:t.delete(r);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),n.next=5,Promise.all(c);case 5:s("deleteInterblocks complete");case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),f=function(){var n=a(o.mark((function n(r,a){var c,u,d;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i(l.isModel(a)),c=e._isRam?a:a.serialize(),u={Bucket:"wbblockbucket",Key:r,Body:c,ContentType:"application/json"},n.next=5,e.putObject(u).promise();case 5:d=n.sent,t.set(r,a),s("putBlock: %O",r),i(d);case 9:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),h=function(){var n=a(o.mark((function n(r){var a,i,c,d,p;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a={Bucket:"wbblockbucket",Key:r},s("getBlock: %O",r),!t.has(r)){n.next=5;break}return s("block cache hit for: %o",r),n.abrupt("return",t.get(r));case 5:return n.next=7,e.getObject(a).promise();case 7:if(i=n.sent,!l.isModel(i.Body)){n.next=10;break}return n.abrupt("return",i.Body);case 10:return c=i.Body.toString(),d=JSON.parse(c),n.next=14,u.cacheVerifyHash(d);case 14:return p=l.clone(d),s("getBlock complete: %O",r),n.abrupt("return",p);case 17:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return{putInterblock:n,getInterblock:r,deleteInterblocks:c,putBlock:f,getBlock:h}},s3Keys:f}},253:function(e,t,n){var r=n(17),o=n(4),a=n(250),i=n(252),s=n(83),c=n(1771),u=n(1772),l=n(21),d=l.interblockModel,p=(l.blockModel,l.addressModel,l.provenanceModel,i.gray("undefined")),f=new WeakMap,h=function(e){if(f.has(e))return f.get(e);var t=s(c(2*e.serialize().length),12);return f.set(e,t),t},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bgGreen",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white",r=" ".concat(a(s(e,9),9)," ");return i[n][t].bold(r)},g=function(e){return u(e,{truncate:!0,showHeaders:!1,minWidth:3,config:{msg:{minWidth:15,maxWidth:15},height:{minWidth:8,maxWidth:8},path:{minWidth:18,maxWidth:18}}})},y=function(e,t){var n=m(e),o=m(t),a=[].concat(r(n),r(o)),i=new Set(a),s=r(i);return s.sort((function(e,t){return e-t})),s},m=function(e){var t=[];return Object.keys(e).forEach((function(e){var n=parseInt(e);t.push(n)})),t.sort((function(e,t){return e-t})),t};e.exports={blockPrint:function(e,t,n,r){var o=v(e.provenance.getAddress().getChainId()),a=i.green(e.provenance.height),l=e.provenance.reflectIntegrity().hash,d=i.dim(v(l,"bgWhite","green")),f=(h(e),{msg:r?i.gray("NOCHANGE"):i.green("BLOCK"),height:a,path:t,chainId:o,hash:d});n&&(f.msg=i.red("NEW_CHAIN"));var g=[f],m=e.network.getAliases();!r&&m.forEach((function(t){var n=e.network[t],r=n.address,o="-",a=p,u=p;s(c(2*n.serialize().length),12);r.isResolved()&&(a=v(r.getChainId(),"bgMagenta","gray")),(r.isRoot()||r.isLoopback())&&(a=v(r.getChainId(),"bgBlack","gray"),u="");var l=n.getRemote();if(n.heavy){var d=n.heavy.provenance.reflectIntegrity().hash;u=i.dim(v(d,"bgWhite","magenta"));var f=n.lineageHeight,h=n.heavyHeight;o=i.magenta(h+"."+f)}var m={msg:i.magenta("  \u2514\u2500\u2500 channel"),height:o,path:i.gray(t),chainId:a,hash:u};g.push(m),y(n.requests,l.replies).forEach((function(e){var t=n.requests[e],r=l.replies[e],o=i.cyan("      \u2514\u2500\u2500 tx:"),a=t?t.type:p,s=i.gray(r?r.type:p),c={msg:o,height:i.cyan(e),path:"",chainId:a,hash:s};g.push(c)})),y(l.requests,n.replies).forEach((function(e){var t=l.requests[e],r=n.replies[e],o={msg:i.yellow("      \u2514\u2500\u2500 rx:"),height:i.yellow(e),path:"",chainId:i.gray(t?t.type:p),hash:r?r.type:p};g.push(o)}))}));return function(e){return u(e,{truncate:!0,showHeaders:!1,minWidth:3,config:{msg:{minWidth:15,maxWidth:15},height:{minWidth:8,maxWidth:8},path:{minWidth:18,maxWidth:18}}})}(g)},interPrint:function(e,t,n,r,a){o(d.isModel(e)),t=t||"INTERBLOCK",n=n||"(unknown)",r=r||"bgYellow",a=a||"yellow";var s=e.provenance,c=s.height,u=s.getAddress().getChainId(),l=v(u,r),f=s.reflectIntegrity().hash,y=i.dim(v(f,"bgWhite",a)),m=h(e),k=[{msg:t,height:c,path:n,chainId:l,hash:y,size:m}],b=e.getRemote();return b&&(t=i.magenta("  \u2514\u2500\u2500 channel"),c="-",n=i.gray(e.getOriginAlias()),m=h(b),k.push({msg:t,height:c,path:n,size:m}),t=i.cyan("      \u2514\u2500\u2500 tx:"),Object.keys(b.requests).forEach((function(e){c=e,l=b.requests[e].type,y=p,m=h(b.requests[e]),k.push({msg:t,height:c,chainId:l,hash:y,size:m})})),t=i.yellow("      \u2514\u2500\u2500 rx:"),Object.keys(b.replies).forEach((function(e){c=e,l=p,y=b.replies[e].type,m=h(b.replies[e]),k.push({msg:t,height:c,chainId:l,hash:y,size:m})}))),g(k)}}},263:function(e,t,n){var r=n(2),o=n(3),a=n(4),i=(n(35).posix||n(35),n(22)("dos:commands:cd")),s=function(){var e=o(r.mark((function e(t){var n,o,s,c,u,l=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.spinner,o=t.blockchain,s=l.length>1&&void 0!==l[1]?l[1]:".",a.strictEqual(typeof s,"string"),i("cd: ".concat(s)),n.text="Resolving ".concat(s),e.next=7,o.cd(s);case 7:return c=o.getContext(),i("context: %O",c),u=c.wd,e.abrupt("return",{ctx:{wd:u}});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();e.exports=s,e.exports.help="\nNavigate through the filesystem graph using Posix compliant pathing.\nCan jump straight to an object by specifying a chainId.\n"},267:function(e,t,n){(function(t){var r=n(2),o=n(3),a=n(39),i=n(22)("dos:print");e.exports=function(){var e=o(r.mark((function e(n){var o,s,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"string"!==typeof n){e.next=5;break}o={out:n},e.next=8;break;case 5:return e.next=7,n();case 7:o=e.sent;case 8:o&&o.out&&(s="[object String]"===Object.prototype.toString.call(o.out)?o.out:JSON.stringify(o.out,null,2),c=s.replace(/(?:\r\n|\r|\n)/g,"\r\n"),t.stdout.write(c),t.stdout.write("\r\n")),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),i(e.t0),t.stderr.writeln("".concat(a.red("\u2716")," ").concat(e.t0));case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}()}).call(this,n(11))},270:function(e,t,n){"use strict";(function(e){var r=n(122),o=n(4),a=n.n(o),i=n(5),s=n.n(i),c=n(72),u=n.n(c),l=n(271),d=n(274),p=n(275),f=(n(1898),n(1899).stdin),h=u()("terminal"),v=function(t){h("toStdStream");var n=function(){var t=e.stdin;f();var n=e.stdin;return Object.defineProperty(e,"stdin",{value:t,writable:!0}),n}();t.stdin=n,t.isTTY=!0;t.clearLine=function(){return t.write("\x1b[2K")},t.cursorTo=function(e,n){h("cursorTo: ",e,n),a.a.strictEqual(e,0);t.write("\x1b[1000D")}},g="F1 F2 F3 F4 F5 F6 F7 F8 F9 F10 F11 F12".split(" ");t.a=function(t){var n=Object(i.useRef)();Object(i.useEffect)((function(){h("opening terminal");var t=new d.Terminal({cursorBlink:!0,cursorStyle:"underline",convertEol:!0,fontFamily:["Courier New","TorEmoji"]}),r=new p.FitAddon;t.loadAddon(r),t.open(document.getElementById("xterm-container")),r.fit(),t.focus(),v(t),t.attachCustomKeyEventHandler((function(e){var t=e.key;e.type;if(g.includes(t))return h("ignoring: ".concat(t)),!1})),t.onKey((function(e){var n=e.key;e.domEvent;t.stdin.send(n)})),n.current=t,window.addEventListener("resize",(function(){return r.fit()})),e.stdout=t,e.stdin=t.stdin,e.stderr=t}),[]);var o=Object(l.a)();Object(r.a)(o,2)[1];return s.a.createElement("div",Object.assign({id:"xterm-container"},t))}}).call(this,n(11))},271:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(2),o=n.n(r),a=n(272),i=n(122),s=n(4),c=n.n(s),u=n(5),l=n(121),d=n(72)("useBlockchain"),p=n(1784),f=new Map,h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];c.a.strictEqual(typeof e,"string"),"string"===typeof t&&(t=[t]),c()(Array.isArray(t));var n=Object(u.useState)(),r=Object(i.a)(n,2),s=r[0],h=r[1],v=Object(u.useRef)();Object(u.useEffect)((function(){return function(){var t=Object(a.a)(o.a.mark((function t(){var n,r,a,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!v.current){t.next=2;break}return t.abrupt("return");case 2:if(f.has(e)){t.next=14;break}return d("initializing blockchain: ".concat(e)),n=Object(l.effectorFactory)(),f.set(e,n),t.next=8,n;case 8:r=t.sent,a=r.getState(),console.log("state: ",a),f.set(e,r),p([],{blockchain:r});case 14:i=f.get(e),v.current=i,h(i.getState()),i.subscribe((function(){h(i.getState())}));case 18:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()(),function(){d("TODO shutting down shell")}}),[e]);var g=v.current;return[s,g]}},277:function(e,t,n){e.exports=n(1905)},282:function(e,t,n){},283:function(e,t,n){},291:function(e,t,n){var r=n(176).effectorFactory,o=n(1781).awsFactory,a=n(1782).browserFactory;e.exports={effectorFactory:r,awsFactory:o,browserFactory:a}},292:function(e,t,n){(function(t){var r=n(7),o=n(2),a=n(3),i=n(4),s=n(9)("ib:met"),c=n(24),u=n(177).standardEngineFactory,l=n(112).isolateFactory,d=n(53),p=d.consistencyFactory,f=d.ramDynamoDbFactory,h=d.ramS3Factory,v=d.s3Keys,g=n(1756).createBase,y=n(1757).createTap,m=n(44).actions,k=(n(86).shell,n(21)),b=k.blockModel,x=k.interblockModel,w=k.addressModel,I=n(1780).piercerFactory,M=0,P=function(){var e=a(o.mark((function e(n){var d,y,k,P,E,C,q,A,O,T,S,N=arguments;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=N.length>1&&void 0!==N[1]?N[1]:{},i.strictEqual(typeof d,"object"),n=n||"id-".concat(M++),s.extend("".concat(n)),y=u(),y.sqsTx,y.sqsRx,y.sqsTransmit,k=y.sqsPool,P=y.sqsIncrease,y.ioCrypto,E=y.ioIsolate,C=y.ioConsistency,y.ioPool,y.ioIncrease,E.setProcessor(l(d)),q=f(),A=h(),C.setProcessor(p(q,A,n)),O=R(y,n),e.next=13,g(C,k);case 13:return T=e.sent,S=function e(n,s){i(w.isModel(n));var u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;"number"===typeof e&&void 0===t&&(t=e,e=[]);var r,o=q._getTables(),a=o.dbChains,s=a[n.getChainId()]||{};if(void 0===t)r=c.last(Object.values(s));else{if(!s[t])throw new Error("out of bounds: ".concat(t," ").concat(s.length));r=s[t]}if(r){var u=v.fromBlockItem(r),l=A._getBuckets(),d=l.wbblockbucket,p=d[u];i(b.isModel(p));var f=p;return e.forEach((function(e){i(f[e],"No segment: ".concat(e)),f=f[e]})),f}},l=new Set,p=new Set;C.subscribe(function(){var e=a(o.mark((function e(t,r){var a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("UNLOCK"!==t.type){e.next=5;break}return e.next=3,r;case 3:a=t.payload.block,p.has(a)||a.getChainId()!==n.getChainId()||(p.add(a),l.forEach((function(e){return e()})));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),t((function(){return l.forEach((function(e){return e()}))}));var f=function(){var e=a(o.mark((function e(n){var r,a;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Object.values(y);case 1:if(!r.some((function(e){return e.length()||e.awaitingLength()}))){e.next=12;break}return a=r.map((function(e){return e.settle()})),e.next=5,Promise.all(a);case 5:return e.next=7,new Promise(t);case 7:if(!n){e.next=10;break}return e.next=10,n.settle();case 10:e.next=1;break;case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=I(n,C,P);return{pierce:h,spawn:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(m.spawn(e,t))},subscribe:function(e){return i.strictEqual(typeof e,"function"),l.add(e),function(){return l.delete(e)}},getState:u,getContext:function(){return u(["state","context"])},getChildren:function(){var t=u(),n=t.network.getAliases(),r={};return n.forEach((function(n){var o=t.network[n];if("./"===o.systemRole){var a=o.address,i="/"===s?n:s+"/"+n;r[n]=e(a,i)}})),r},getAbsolutePath:function(){return s},getChannels:function(){return u().network},getEngine:function(){return y},getPersistence:function(){return C.getProcessor().persistence},getChainId:function(){return u().provenance.getAddress().getChainId()},getHeight:function(){return u().provenance.height},getPool:function(){var e=q._getTables().dbPools[n.getChainId()],t=Object.values(e).map(v.fromPoolItem),r=A._getBuckets().wbinterbucket;return t.map((function(e){var t=r[e];return i(t),x.clone(t)}))},getCovenants:function(){return r({},d)},settle:f,enableLogging:function(){return O.on()},disableLogging:function(){return O.off()}}},e.abrupt("return",S(T,"/"));case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=function(e,t){var n=e.sqsPool,r=e.sqsTransmit,i=e.ioConsistency;debugPrefix=t?"ib:met:".concat(t):"ib:met";var s=y(debugPrefix);return n.subscribe(function(){var e=a(o.mark((function e(t,n){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),r.subscribe(function(){var e=a(o.mark((function e(t,n){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),i.subscribe(function(){var e=a(o.mark((function e(t,n){var r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("LOCK"!==t.type){e.next=6;break}return r=Date.now(),e.next=4,n;case 4:e.sent&&s.lock(t.payload,r);case 6:if("UNLOCK"!==t.type){e.next=10;break}return e.next=9,n;case 9:s.block(t.payload.block);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),s};e.exports={metrologyFactory:P}}).call(this,n(57).setImmediate)},299:function(e,t,n){(function(t){var r=n(7),o=n(28),a=n(17),i=n(2),s=n(3),c=n(300),u=n(4),l=function(e,r){u(e&&"string"===typeof e);var l,p=n(9)("interblock:queue:"+e),f=!0,h=[],v=new Set,g=Number.MAX_SAFE_INTEGER,y=0,m=function(){var e=s(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,Promise.resolve();case 4:for(;f&&v.size<g&&h.length;)p("awaiting size: ".concat(v.size)),t=h.shift(),v.add(t),k(t);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var n=s(i.mark((function n(r){var o,a,s,c;return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return u(r&&"object"===typeof r),o=r.action,a=r.resolve,s=r.reject,r.promise,u(a&&s),n.prev=3,n.next=6,l(o);case 6:c=n.sent,t(a,c),n.next=14;break;case 10:n.prev=10,n.t0=n.catch(3),p("".concat(e," rejected: %O %O"),r,n.t0),t(s,n.t0);case 14:m(),u(v.has(r)),v.delete(r);case 17:case"end":return n.stop()}}),n,null,[[3,10]])})));return function(e){return n.apply(this,arguments)}}(),b=new Set,x={name:e,settle:function(){var e=s(i.mark((function e(){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!v.size&&!h.length){e.next=12;break}if(p("settle _awaiting.size: %o _requests.length: %o",v.size,h.length),!v.size){e.next=8;break}return n=a(v).map((function(e){return e.promise})),e.next=6,Promise.race(n);case 6:e.next=10;break;case 8:return e.next=10,new Promise(t);case 10:e.next=0;break;case 12:p("settled");case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),length:function(){return h.length},awaitingLength:function(){return v.size},awaitNextPush:function(){var e=s(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var t=x.subscribe((function(n,r){t(),e(n)}))})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),subscribe:function(e){return u("function"===typeof e),b.add(e),function(){return b.delete(e)}},getProcessor:function(){return l},rejectAll:function(){x.setProcessor((function(e){throw new Error("Tried to process: ".concat(JSON.parse(e,null,2)))}))},setConcurrency:function(e){g=e,m()},push:function(){var e=s(i.mark((function e(t){var n,a,s,c;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:p("push ".concat(t.type||r.schema.title)),d(r,t),a=new Promise((function(e,r){var o=y++;n={id:o,action:t,resolve:e,reject:r}})),n.promise=a,h.push(n),m(),s=o(b.values());try{for(s.s();!(c=s.n()).done;)(0,c.value)(t,a)}catch(i){s.e(i)}finally{s.f()}return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),setProcessor:function(e){u(!y||!l,"cannot switch after commencing"),u("function"===typeof e),l=e},halt:function(){var e=s(i.mark((function e(t){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("_isActive"),f=!1,e.next=3,new Promise((function(e){return setTimeout(e,t)}));case 3:n=new Error("Queue is halting operation"),v.values().forEach((function(e){return(0,e.reject)(n)})),v.clear();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};return x},d=function(e,t){e&&(u("function"===typeof e.isModel),u(e.isModel(t),"model is not addable"))};e.exports={ioQueueFactory:l,sqsQueueFactory:function(e,t){u(e&&"string"===typeof e);var o=n(9)("interblock:queue:sqs:"+e),a=l(e,t),c=a.push,p=function(e){a.push(e)};return r({},a,{push:function(){var n=s(i.mark((function n(r){return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o("push sqs ".concat(e)),d(t,r),n.next=4,p(r);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),pushDirect:c,setSqsProcessor:function(e){!a.getProcessor()||a.setProcessor(a.getProcessor()),p=e}})}}}).call(this,n(57).setImmediate)},301:function(e,t,n){var r={"./aclModel":127,"./aclModel.js":127,"./actionModel":67,"./actionModel.js":67,"./addressModel":52,"./addressModel.js":52,"./binaryModel":150,"./binaryModel.js":150,"./blockModel":84,"./blockModel.js":84,"./channelModel":106,"./channelModel.js":106,"./configModel":159,"./configModel.js":159,"./continuationModel":88,"./continuationModel.js":88,"./covenantIdModel":152,"./covenantIdModel.js":152,"./dmzModel":103,"./dmzModel.js":103,"./integrityModel":41,"./integrityModel.js":41,"./interblockModel":110,"./interblockModel.js":110,"./keypairModel":69,"./keypairModel.js":69,"./lockModel":246,"./lockModel.js":246,"./networkModel":105,"./networkModel.js":105,"./pendingModel":161,"./pendingModel.js":161,"./proofModel":163,"./proofModel.js":163,"./provenanceModel":68,"./provenanceModel.js":68,"./publicKeyModel":85,"./publicKeyModel.js":85,"./remoteModel":109,"./remoteModel.js":109,"./signatureModel":151,"./signatureModel.js":151,"./simpleArrayModel":162,"./simpleArrayModel.js":162,"./stateModel":158,"./stateModel.js":158,"./timestampModel":104,"./timestampModel.js":104,"./validatorsModel":160,"./validatorsModel.js":160};function o(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}o.keys=function(){return Object.keys(r)},o.resolve=a,e.exports=o,o.id=301},305:function(e,t,n){var r=n(7),o=n(4),a=(n(9)("interblock:models:modelInflator"),new(n(129))({allErrors:!0,verbose:!0})),i=n(93).registry,s=function(e,t){o("object"===e.type),o(e.patternProperties),o(!e.additionalProperties),o.strictEqual(Object.keys(e.patternProperties).length,1);var n=Object.keys(e.patternProperties)[0],r="[0-9]*"===n,a=e.patternProperties[n],s=i.get(a.title);o(s,"patternProperties must use models for values");var c={};return Object.keys(t).map((function(e){if(r){var n=parseInt(e);o(Number.isInteger(n),"".concat(e," is not number: ").concat(n))}c[e]=s.clone(t[e])})),c},c=function(e,t){if(o(Array.isArray(t)),o("array"===e.type),o(e.uniqueItems,"uniqueItems not set: ".concat(e.title)),"number"===e.items.type)return t;var n=i.get(e.items.title);return o(n,"Arrays must be models"),t.map(n.clone)},u=function(e,t){o(!e.additionalProperties,"additionalProperties: ".concat(e.title));var n=Object.keys(t),r=Object.keys(e.properties),a=e.required.every((function(e){return n.includes(e)}));o(a);var i=n.every((function(e){return r.includes(e)}));o(i,"fail ".concat(e.title))},l=new Map,d=function(e,t){o(e,"No schema supplied");var n=l.get(e);if(!n)try{n=a.compile(e),l.set(e,n)}catch(c){var r="Compilation failed: ".concat(e&&e.title," ").concat(c.message);throw new Error(r)}var i=n(t),s=a.errorsText(n.errors);if(!i)throw new Error("".concat(e.title," failed validation: ").concat(s))};e.exports={modelInflator:function(e,t){if("State"===e.title)return r({},t);if(o(e.title,"only titled schemas can be inflated"),e.patternProperties)return s(e,t);if("array"===e.type)return c(e,t);u(e,t);var n={},a=e.properties;return Object.keys(t).map((function(e){var r=a[e],o=r.title,u=r.type,l=r.patternProperties,p=t[e];i.isRegistered(o)?n[e]=i.get(o).clone(p):"array"!==u?l?n[e]=s(a[e],p):(d(a[e],p),n[e]=p):n[e]=c(a[e],p)})),n},precompileSchema:function(e){o(e.title,"No title supplied"),validator=a.compile(e),l.set(e,validator)}}},339:function(e,t,n){(function(t){var r=n(2),o=n(3),a=n(4),i=n(9)("interblock:crypto:sodium"),s=n(340),c=s.SodiumPlus,u=s.Ed25519PublicKey,l=s.Ed25519SecretKey,d=n(432),p=d.objectHash,f=d.generateNonce,h={publicKey:"I7xUkSwebpLEqGglyGfif/3FVb/71CRPF6Jqv//ull0=",secretKey:"MDEyMzQ1Njc4OWFiY2RlZjAxMjM0NTY3ODlhYmNkZWYjvFSRLB5uksSoaCXIZ+J//cVVv/vUJE8Xomq//+6WXQ=="},v={publicKey:"8aktZHsVyr/yy6arJiJP8F1OI4Na5eQw9pIH6f7XrV0=",secretKey:"r6m8nU2GqsSg38+0TXKXrIgd8WHsJfr5qlSZZDz7GN7xqS1kexXKv/LLpqsmIk/wXU4jg1rl5DD2kgfp/tetXQ=="};Object.freeze(h),Object.freeze(v);var g,y=new Set(["".concat(h.publicKey,"_").concat(h.secretKey),"".concat(v.publicKey,"_").concat(v.secretKey)]),m=function(){return g||(g=c.auto()),g},k=p("template"),b=function(){var e=o(r.mark((function e(){var t,n,o,s,c,u,l,d,p,f=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.length>0&&void 0!==f[0]?f[0]:"",e.next=3,m();case 3:for(n=e.sent,a.strictEqual(typeof t,"string"),a(t.length<=32,"seed too long: ".concat(t.length)),t.length&&i("INSECURE padding seed to 32 bytes - got ".concat(t.length));t.length&&t.length<32;)t+="_";if(t.length){e.next=12;break}return e.next=11,n.randombytes_buf(32);case 11:t=e.sent;case 12:return e.next=14,n.crypto_sign_seed_keypair(t);case 14:return o=e.sent,e.next=17,n.crypto_sign_secretkey(o);case 17:return s=e.sent,e.next=20,n.crypto_sign_publickey(o);case 20:return c=e.sent,u={publicKey:c.toString("base64"),secretKey:s.toString("base64")},l=u.publicKey,d=u.secretKey,p="".concat(l,"_").concat(d),y.add(p),e.abrupt("return",u);case 26:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=o(r.mark((function e(t){var n,o,i,s,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.publicKey,o=t.secretKey,a.strictEqual(typeof n,"string"),a.strictEqual(typeof o,"string"),i="".concat(n,"_").concat(o),e.prev=4,e.next=7,w(k,o);case 7:return s=e.sent,c=s.signature,e.next=11,I(k,c,n);case 11:e.sent&&y.add(i),e.next=17;break;case 15:e.prev=15,e.t0=e.catch(4);case 17:return e.abrupt("return",y.has(i));case 18:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=o(r.mark((function e(t,n){var o,i,s,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.strictEqual(t.length,k.length,"use objectHash()"),o=l.from(n,"base64"),e.next=4,m();case 4:return i=e.sent,e.next=7,i.crypto_sign_detached(t,o);case 7:return s=e.sent,c=s.toString("base64"),e.abrupt("return",{messageHash:t,signature:c});case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),I=function(){var e=o(r.mark((function e(n,o,a){var s,c,l,d,p;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.from(o,"base64"),c=u.from(a,"base64"),e.next=4,m();case 4:return l=e.sent,e.next=7,l.crypto_sign_verify_detached(n,c,s);case 7:return d=e.sent,p="".concat(n,"_").concat(o,"_").concat(a),d?y.add(p):i("verifyHash failed"),e.abrupt("return",d);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),M=function(){var e=o(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m();case 2:return t=e.sent,e.abrupt("return",t.getBackendName());case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e.exports={objectHash:p,signHash:w,verifyHash:I,verifyHashSync:function(e,t,n){var r="".concat(e,"_").concat(t,"_").concat(n);return y.has(r)},generateKeyPair:b,verifyKeyPair:x,verifyKeyPairSync:function(e){var t=e.publicKey,n=e.secretKey;return y.has("".concat(t,"_").concat(n))},generateNonce:f,testMode:function(){i("no testmode in sodium")},ciKeypair:h,pierceKeypair:v,_verifiedSet:y,_getBackend:M}}).call(this,n(8).Buffer)},34:function(e,t,n){var r=n(7),o=n(239),a=n(1724);e.exports=r({},o,{},a)},349:function(e,t){},351:function(e,t){},38:function(e,t,n){var r=n(7),o=n(17),a={title:"Action",description:"Messages for communicating with a chains reducer.\n  Actions are always delivered as part of a channel between chains.",type:"object",required:["type","payload"],additionalProperties:!1,properties:{type:{type:"string",description:"The type of the action which is specified by the developer"},payload:{type:"object",description:"Type dependent data being transmitted with the action"}}},i={title:"Continuation",description:"Actions that implement the continuation system.",type:"object",required:["type","payload"],additionalProperties:!1,properties:{type:{type:"string",description:"One of three types.  Synchronous replies are resolves or rejections too.",enum:["@@REJECT","@@PROMISE","@@RESOLVE"]},payload:{type:"object",description:"Type dependent data being transmitted with the action"}}},s={title:"Integrity",description:"cryptographically secure hash produced from content.\n  May be 'UNKNOWN' to signal an address is unknown.",type:"object",additionalProperties:!1,required:["hash","algorithm"],properties:{hash:{type:"string",description:"base58 encoded hash hopefully with identifier at front, or UNKNOWN"},algorithm:{enum:["sha256"]}}},c={title:"Address",description:"Hash of the Provenance of the first block in this chain, \n  with prefix, check digits, in base58",type:"object",additionalProperties:!1,required:["chainId","status"],properties:{chainId:s,status:{pattern:"^UNKNOWN$|^GENESIS_|^LOOPBACK$|^ROOT$|^RESOLVED$"}}},u={title:"PublicKey",description:"public key of a public / secret pair",type:"object",additionalProperties:!1,required:["key","algorithm"],properties:{key:{type:"string"},algorithm:{enum:["tweetnacl","sodium"]}}},l={title:"Signature",description:"A cryptographic signature of some detached integrity",type:"object",additionalProperties:!1,required:["publicKey","integrity","seal"],properties:{publicKey:u,integrity:s,seal:{type:"string"}}},d={title:"Provenance",description:'Proof of the Provenance of the object \n  referenced by signed integrity.\n  The integrity of the first provenance in a chain is the chainId.\n  When the provenance is inserted back into the dmz, the dmz becomes a Block.\n  The integrity which is signed is the integrity of the whole object, \n  minus "integrity" and "signatures" keys\n  \n  Integrity can be a merkle proof so a set of chains with the same\n  validators can create signatures for the root hash, then distribute\n  to all the chains where each is blinded to the others in the merkle \n  proof.\n  \n  Running chains internally is much faster than cross block boundaries.',type:"object",additionalProperties:!1,required:["dmzIntegrity","address","lineage","height","integrity","signatures"],properties:{dmzIntegrity:s,address:c,lineage:{type:"object",description:"Object of previous blockhashes this provenance item extends.\n  There may be many, but at least one is the most recent block provenance.\n  Others might be those resulting from overdrive consensus,\n  or periodic shortcutting of the chain history to quick lookup purposes.\n  Height must always be greater than any previous provenance for this address.\n  Provenance is monotonic, and should increment by 1 each time.\n  \n  First lineage supplied to create defines the chainId of the result.\n  \n  Provenance is a statement of authenticity and position in lineage.  \n  Lineage is the chain of previous provenances.\n  \n  Key gives the provenance id, which can be height, or foreignChain:height.\n  Value gives the hash of the block at the provenance id.",patternProperties:{"(.*?)":s}},height:{type:"integer",minimum:0},integrity:s,signatures:{type:"array",items:l,minItems:1,uniqueItems:!0}}},p={title:"Validators",type:"object",additionalProperties:!1,minProperties:1,patternProperties:{"(.*?)":u}},f={title:"Proof",description:"Interblock proof model.",type:"object",additionalProperties:!1,required:["block"],properties:{block:{type:"string"},network:{type:"object"},channel:{type:"string"}}},h={title:"Remote",description:"Slice of Channel state transmitted with a heavy Interblock",type:"object",additionalProperties:!1,required:["address","replies","requests","heavyHeight","lineageHeight"],properties:{address:c,replies:{type:"object",additionalProperties:!1,patternProperties:{"[0-9]*":i}},requests:{type:"object",additionalProperties:!1,patternProperties:{"[0-9]*":a}},heavyHeight:{type:"integer",minimum:-1},lineageHeight:{type:"integer",minimum:-1}}},v={title:"Interblock",description:"The fundamental unit of inter chain communication.\n  Contains provenance, a punched out DMZ, and a single transmit channel\n  of the source chain.\n  This must be an model, so as to ensure we do not leak info, rather \n  than making it a special case of a BlockModel.\n  This cannot import dmzModel directly, as it is a fundamental\n  circular reference, as the outside depends on the inside.\n  This can only be made from a validated block.\n  \n  This is the only place that needs punched out proofs.\n  \n  With no transmit key, an interblock is simply a provenance chain,\n  which is needed to ensure lineage\n  \n  By placing interblock stream inside the transmission, each side of\n  a connection can know what block of theirs the other side has processed.",type:"object",required:["provenance","proof","validators"],additionalProperties:!1,properties:{provenance:d,proof:f,network:{type:"object",additionalProperties:!1,minProperties:0,maxProperties:1,patternProperties:{"(.*?)":h}},validators:p}},g={title:"Channel",description:"Communication Queues.\n  These queues and their responses are what all interchain\n  communication seeks to facilitate.  All the cryptography\n  employed in this system is to reliably process these \n  queues.\n  \n  Each connection side has a transmit and a receive.\n  Each connection side transmits requests and replies to the other.\n  \n  Transmit = Sum( Channel ) \n  Receive = Sum( Interblock( Channel ) )\n  Interblocks  = Channel + Provenance\n  \n  'provenance' contains a continuous chain all the way back to  the foreign genesis.\n  \n  The contents of the latest received channel is stored on 'remote'\n  Replies are always processed before incoming requests.\n  When a received reply has executed, the local transmit action is removed\n  from the transmit queue.\n  \n  The queues hold the index for their next actions within them:\n  1.  Next remote reply index is the smallest index of the transit queue\n      for which there is a remote reply that is not a promise\n  2.  Next remote request index is given by the local highest reply index\n  \n  If systemRole === '.' then provenance checks are excused, as the\n  networkProducer.tx() function will flip outbound and inbound.  This is used\n  in the self channel.\n  \n  Counter is required to know where the request counter is up to, which needs independent\n  tracking as the channel might be cleared completely, but we cannot reuse numbers until\n  looparound at 32bit limit or similar",type:"object",required:[].concat(o(h.required),["systemRole","requestsLength","lineage","lineageTip"]),additionalProperties:!1,properties:r({},h.properties,{systemRole:{enum:["..",".","./","UP_LINK","DOWN_LINK","PIERCE"]},requestsLength:{type:"integer",minimum:0},heavy:v,lineage:{type:"array",uniqueItems:!0,items:s},lineageTip:{type:"array",uniqueItems:!0,items:v}})};e.exports={integritySchema:s,addressSchema:c,proofSchema:f,interblockSchema:v,provenanceSchema:d,validatorsSchema:p,signatureSchema:l,publicKeySchema:u,remoteSchema:h,channelSchema:g,actionSchema:a,continuationSchema:i}},381:function(e,t){},382:function(e,t){},41:function(e,t,n){var r=n(4),o=(n(9)("interblock:models:integrity"),n(48)),a=(0,n(20).standardize)({schema:n(38).integritySchema,create:function(e){if(!e||"UNKNOWN"===e)return a.clone({hash:"UNKNOWN",algorithm:"sha256"});"string"===typeof e&&(e={string:e}),r("object"===typeof e,"Must supply object: ".concat(e));var t={hash:o.objectHash(e),algorithm:"sha256"};return a.clone(t)},logicize:function(e){return{isUnknown:function(){return"UNKNOWN"===e.hash},isIntegrityMatch:function(t){return a.create(t).hash===e.hash}}}});e.exports={integrityModel:a}},432:function(e,t,n){(function(t){var r=n(433)({coerce:!1}),o=n(436),a=n(83),i=n(438),s=0;e.exports={objectHash:function(e){if("undefined"===typeof t){var n=r.sort(e);return i(n,{algorithm:"sha256",encoding:"hex"})}return r.hash(e)},generateNonce:function(e){if(e){var t=a(9,s,"0");return s++,"0x".concat(t,"c6ee4f60107cc496d1dcacd642be4011c3b4fe09668f08f01f41cc9")}return"0x"+o(32,{type:"Array"}).map((function(e){return("0"+(255&e).toString(16)).slice(-2)})).join("")}}}).call(this,n(11))},437:function(e,t){},44:function(e,t,n){var r=n(1718);e.exports=r},440:function(e,t,n){var r=n(59),o=n(2),a=n(7),i=n(3),s=n(4),c=(new(n(129))({allErrors:!0,verbose:!0}),n(9)("interblock:apps:collection")),u=n(235),l=u.datum,d=u.convertToTemplate,p=u.demuxFormData,f=u.validateDatumTemplate,h=u.muxTemplateWithFormData,v=n(34).interchain,g=n(44).actions.spawn,y=function(){var e=i(o.mark((function e(t,n){var r,i,s,u,y,x,w,I,M,P,R,E;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.type,i=n.payload,e.t0=r,e.next="ADD"===e.t0?4:"SET_TEMPLATE"===e.t0?26:29;break;case 4:if(s=t.datumTemplate,f(s),i.isTestData||m(i),u=p(s,n),y=b(s,u),x=l.covenantId,w=g(y,{covenantId:x}),!y){e.next=15;break}v(w),e.next=20;break;case 15:return e.next=17,v(w);case 17:I=e.sent,M=I.alias,y=M;case 20:return P=h(s,u),R=l.actions.set(P),c("set",R),e.next=25,v(R,y);case 25:return e.abrupt("return",t);case 26:return k(i),E=d(i),e.abrupt("return",a({},t,{datumTemplate:E}));case 29:throw c(n),new Error("Unknown action type: ".concat(n.type));case 31:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),m=function e(t){var n=t.formData,o=t.children,a=r(t,["formData","children"]);if("undefined"===typeof n)throw new Error("Must provide formData key");if(a)throw new Error("Only allowed keys are formData and children");if(o){if("object"!==typeof o)throw new Error("children must be object");return Object.values(o).every(e)}},k=function e(t){if(t.formData)throw new Error("No formData allowed on datum template");if(t.children)return Object.values(t.children).every(e)},b=function(e,t){if(e.namePath.length){var n=t.formData;return e.namePath.forEach((function(e){n=n[e]})),s.strictEqual(typeof n,"string"),c("_getChildName",n),n}c("_getChildName is blank")};e.exports={reducer:y,actions:{add:function(e){return{type:"ADD",payload:e}},setDatumTemplate:function(e){return{type:"SET_TEMPLATE",payload:e}},search:function(){return{type:"SEARCH"}},lock:function(){return{type:"LOCK"}},delete:function(){return{type:"DELETE"}}}}},48:function(e,t,n){e.exports=n(339)},52:function(e,t,n){var r=n(7),o=n(4),a=n(48),i=n(20).standardize,s=n(41).integrityModel,c=i({schema:n(38).addressSchema,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.create(),t="UNKNOWN";if("GENESIS"===e)t="GENESIS_".concat(a.generateNonce()),e=s.create("UNKNOWN");else if("LOOPBACK"===e)t="LOOPBACK",e=s.create("UNKNOWN");else if("ROOT"===e)t="ROOT",e=s.create("UNKNOWN");else if("string"===typeof e){var n=s.create(e);if(n.hash.length===e.length){var i=e;e=s.clone(r({},n,{hash:i}))}else e=n}return s.isModel(e)||debug("integrity not model: ",e),o(s.isModel(e)),e.isUnknown()||(t="RESOLVED"),c.clone({chainId:e,status:t})},logicize:function(e){var t=e.chainId,n=e.status;return{getChainId:function(){if("LOOPBACK"===n)return"LOOPBACK";if("ROOT"===n)return"ROOT";if("RESOLVED"!==n)throw new Error("Tried to get chainId on address with status: ".concat(n));return t.hash},isRoot:function(){return"ROOT"===n},isLoopback:function(){return"LOOPBACK"===n},isGenesis:function(){return n.startsWith("GENESIS_")},isUnknown:function(){return"UNKNOWN"===n},isResolved:function(){return"RESOLVED"===n}}}});e.exports={addressModel:c}},53:function(e,t,n){var r=n(1737).consistencySourceFactory,o=n(1743),a=o.toFunctions,i=o.fromFunctions,s=n(114).ramDynamoDbFactory,c=n(165).ramS3Factory,u=n(249).s3Keys,l=n(248).dbFactory;e.exports={consistencyFactory:function(e,t,n){var o=r(e,t,n);return i(o)},toFunctions:a,ramDynamoDbFactory:s,ramS3Factory:c,consistencySourceFactory:r,s3Keys:u,dbFactory:l}},67:function(e,t,n){var r=n(7),o=n(20).standardize,a=n(38).actionSchema,i=0,s=function(){return"DEFAULT_ACTION_".concat(i++)},c=o({schema:a,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"===typeof e&&(e={type:e,payload:t}),e.payload||(e=r({},e,{payload:{}})),c.clone(e)},logicize:function(e){return{}}});e.exports={actionModel:c}},68:function(e,t,n){var r,o=n(17),a=n(2),i=n(7),s=n(3),c=n(4),u=(n(24),n(9)("interblock:models:provenance"),n(20).standardize),l=n(41).integrityModel,d=n(69).keypairModel,p=n(52).addressModel,f=n(38).provenanceSchema,h=n(48),v=d.create("PIERCE",h.pierceKeypair),g=d.create("CI",h.ciKeypair),y=function(e){return c(l.isModel(e)),g.sign(e)},m=u({schema:f,create:function(e,t){var o=arguments;return s(a.mark((function s(){var u,d,f,h,v,g,k,b,x,w,I;return a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return u=o.length>2&&void 0!==o[2]?o[2]:{},d=o.length>3&&void 0!==o[3]?o[3]:y,r||(r=n(103).dmzModel,c(r)),e=e||r.create(),c(r.isModel(e)),c(!t||m.isModel(t)),c.strictEqual(typeof u,"object"),c(Object.values(u).every(l.isModel)),c(!Object.keys(u).length||t),f=l.create(),dmzIntegrity=l.clone(i({},f,{hash:e.getHash()})),h=p.create("GENESIS"),v=0,g=i({},u),t&&(k=t.reflectIntegrity(),c(!Object.values(g).some((function(e){return e.equals(k)}))),g[t.height]=k,v=t.height+1,h=t.getAddress()),b={dmzIntegrity:dmzIntegrity,address:h,lineage:g,height:v},x=l.create(b),a.next=19,d(x);case 19:return w=a.sent,I=[w],a.abrupt("return",m.clone(i({},b,{integrity:x,signatures:I})));case 22:case"end":return a.stop()}}),s)})))()},logicize:function(e){if(e.dmzIntegrity.isUnknown())throw new Error("Dmz not a genuine type of integrity: ".concat(e.dmzIntegrity.hash));var t=Object.keys(e.lineage).map((function(e){return parseInt(e)}));c(t.length||e.address.isGenesis()),c(e.height||e.address.isGenesis()),c(t.every((function(t){return t>=0&&t<e.height}))),c.strictEqual(e.signatures.length,1,"single signer only");if(!function(){var t={};["dmzIntegrity","address","lineage","height"].forEach((function(n){return t[n]=e[n]}));var n=l.create(t).equals(e.integrity);return n}())throw new Error("Self integrity degraded - refusing to instantiate");if(!e.signatures.length||!e.signatures.every((function(t){return t.integrity.equals(e.integrity)})))throw new Error("Signature degraded - refusing to instantiate");var n=l.create(e),r=e.address;0===e.height&&(c(r.isGenesis()),r=p.create(n));var a=function(){return n};return{merge:function(){},getAddress:function(){return r},reflectIntegrity:a,isNext:function(t){var n=Object.values(t.lineage).some((function(e){return e.equals(a())})),r=t.height>e.height;t.signatures[0].publicKey;return n&&r},getShortestHeight:function(){var n=o(t);n.sort((function(e,t){return e-t}));var r=n.shift();return c(r>=0&&r<e.height),r}}}});e.exports={provenanceModel:m,ciSigner:y,pierceSigner:function(e){return c(l.isModel(e)),v.sign(e)}}},69:function(e,t,n){var r=n(2),o=n(3),a=n(47),i=n(4),s=n(9)("interblock:models:keypair"),c=n(48),u=n(20).standardize,l=n(85).publicKeyModel,d=n(41).integrityModel,p=n(151).signatureModel,f=u({schema:{title:"Keypair",description:"public private key pair",type:"object",additionalProperties:!1,required:["name","publicKey","secretKey","algorithm"],properties:{name:{type:"string"},publicKey:l.schema,secretKey:{type:"string"},algorithm:{enum:["tweetnacl","sodium"]}}},create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"CI",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.ciKeypair;i.strictEqual(typeof e,"string");var n=l.clone({key:t.publicKey,algorithm:"sodium"}),r=t.secretKey;return f.clone({name:e,publicKey:n,secretKey:r,algorithm:"sodium"})},logicize:function(e){var t={publicKey:e.publicKey.key,secretKey:e.secretKey};if(!c.verifyKeyPairSync(t))throw new Error("Not a valid keypair - refusing to instantiate");return{sign:function(){var t=o(r.mark((function t(n){var o,a,u,l,f,h,v,g;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s("sign"),n){t.next=3;break}throw new Error("Refusing to sign undefined integrity");case 3:return n=d.clone(n),o=n.hash,a=e.publicKey,u=e.secretKey,t.next=8,c.signHash(o,u);case 8:return l=t.sent,f=l.signature,t.next=12,c.verifyHash(o,f,a.key);case 12:return h=t.sent,i(h),i(c.verifyHashSync(o,f,a.key)),v={publicKey:a,integrity:n,seal:f},g=p.clone(v),s("sign complete"),t.abrupt("return",g);case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getValidatorEntry:function(){return a({},e.name,e.publicKey)}}}});e.exports={keypairModel:f}},70:function(e,t,n){var r=n(1719),o=n(1720),a=n(1721),i=n(237),s=n(1722);e.exports={networkProducer:r,blockProducer:o,lockProducer:a,channelProducer:i,pendingProducer:s}},84:function(e,t,n){var r=n(59),o=n(2),a=n(3),i=n(17),s=n(7),c=n(4),u=n(9)("interblock:models:block"),l=n(20).standardize,d=n(68).provenanceModel,p=n(69).keypairModel,f=n(103).dmzModel,h=n(41).integrityModel,v=f.schema,g=s({},v,{title:"Block",description:"The fundamental unit of state persistence and transmission\nA DMZ with a 'provenance' key is a block.",required:[].concat(i(v.required),["provenance"]),properties:s({},v.properties,{provenance:d.schema})}),y=function(){var e=a(o.mark((function e(t){var n;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.create("CI");case 2:return n=e.sent,c(h.isModel(t)),e.abrupt("return",n.sign(t));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=l({schema:g,create:function(e){var t=arguments;return a(o.mark((function n(){var r,a,i,l;return o.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.length>1&&void 0!==t[1]?t[1]:y,u("create"),c("function"===typeof r),e=f.clone(e),void 0,a={},n.next=8,d.create(e,void 0,a,r);case 8:return i=n.sent,l=m.clone(s({},e,{provenance:i})),n.abrupt("return",l);case 11:case"end":return n.stop()}}),n)})))()},logicize:function(e){var t=e.network.getAliases().some((function(t){var n=e.network[t].address;return e.provenance.getAddress().equals(n)}));c(!t,"Loop detected");var n=e.provenance,o=r(e,["provenance"]),a=f.clone(o),i=a.getHash();c(i===n.dmzIntegrity.hash);return{isValidated:function(){if(n.address.isGenesis())return!0;var e=a.validators,t=Object.values(e),r=n.signatures.map((function(e){return e.publicKey})),o=t.every((function(e){return r.some((function(t){return t.equals(e)}))})),i=r.every((function(e){return t.some((function(t){return t.equals(e)}))}));return o&&i},getDmz:function(){return a},whoami:function(e,t){c(m.isModel(t)),e.forEach((function(e){publicKeyModel.clone(e)}))},isNext:function(t){var n=m.isModel(t),r=t.isValidated(),o=e.provenance.isNext(t.provenance);return n&&r&&o},getChainId:function(){return e.provenance.getAddress().getChainId()}}}});e.exports={blockModel:m}},85:function(e,t,n){var r=(0,n(20).standardize)({schema:n(38).publicKeySchema,create:function(){throw new Error("Only the keypairModel can create publicKeyModel types")},logicize:function(e){return{}}});e.exports={publicKeyModel:r}},86:function(e,t,n){var r=n(21).covenantIdModel,o=n(440);o.covenantId=r.create("collection");var a=n(235);a.covenantId=r.create("datum");var i=n(240);i.covenantId=r.create("dpkg");var s=n(1725);s.covenantId=r.create("shell");var c=n(241);c.covenantId=r.create("net");var u=n(242);u.covenantId=r.create("socket");var l=n(1729);l.covenantId=r.create("hyper");var d={reducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e}};d.covenantId=r.create("unity");var p=n(1730);p.covenantId=r.create("probe"),e.exports={collection:o,datum:a,dpkg:i,hyper:l,net:c,probe:p,shell:s,socket:u,unity:d},Object.values(e.exports).forEach(Object.freeze)},88:function(e,t,n){var r=n(4),o=(0,n(20).standardize)({schema:n(38).continuationSchema,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"@@RESOLVE",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o.clone({type:e,payload:t})},logicize:function(e){"@@PROMISE"===e.type&&r.strictEqual(Object.keys(e.payload).length,0,"Promises cannot have payloads");return{isPromise:function(){return"@@PROMISE"===e.type},isRejection:function(){return"@@REJECT"===e.type},isResolve:function(){return"@@RESOLVE"===e.type}}}});e.exports={continuationModel:o}},93:function(e,t){var n={},r={registerModels:function(e){Object.keys(e).forEach((function(t){var r=e[t];if(!t||!e[t])throw new Error("".concat(t," passed in as undefined"));var o=r.schema.title;if(n[o])throw new Error("".concat(o," was already registered"));n[o]=r}))},isRegistered:function(e){return!!n[e]},get:function(e){if(!n[e])throw new Error("Model not found in registry: ".concat(e));return n[e]},_getContainer:function(){return n}};e.exports={registry:r}}},[[277,1,2]]]);